<%= insert_trackjs('builder') %>

<script>
  var frontendConfig = <%= safe_js_object frontend_config %>;
  var visualizationData = <%= safe_js_object @canonical_visualization_data.to_json %>;
  var layersData = <%= safe_js_object @layers_data.to_json %>;
  var tableData = <%= safe_js_object @user_table_data.to_json %>;
  var userData = <%= safe_js_object current_user.data({ show_api_calls: false }).to_json %>;
  var authTokens = <%= safe_js_object @auth_tokens.to_json %>;
  var mapzenApiKey = '<%= mapzen_api_key %>';
  var mapboxApiKey = '<%= mapbox_api_key %>';
  var dashboardNotifications = <%= safe_js_object @dashboard_notifications.to_json %>;
  var ACTIVE_LOCALE = 'en';
</script>

<% if @canonical_visualization.map.provider == 'googlemaps' %>
  <%= render(partial: 'shared/visualizations/google_maps', locals: { google_maps_qs: @google_maps_qs }) %>
<% end %>

<%= javascript_include_tag 'common.js' %>
<%= javascript_include_tag 'dataset_vendor.js' %>
<%= javascript_include_tag 'dataset.js' %>
