!function(){var root=this,__prev={jQuery:root.jQuery,$:root.$,L:root.L,Mustache:root.Mustache,Backbone:root.Backbone,_:root._},GeoJSON=function(a,b){var c,d=function(a,b,c){var g;switch(a.type){case"Point":b.position=new google.maps.LatLng(a.coordinates[1],a.coordinates[0]),g=new google.maps.Marker(b),c&&g.set("geojsonProperties",c);break;case"MultiPoint":g=[];for(var h=0;h<a.coordinates.length;h++)b.position=new google.maps.LatLng(a.coordinates[h][1],a.coordinates[h][0]),g.push(new google.maps.Marker(b));if(c)for(var i=0;i<g.length;i++)g[i].set("geojsonProperties",c);break;case"LineString":for(var j=[],h=0;h<a.coordinates.length;h++){var k=a.coordinates[h],l=new google.maps.LatLng(k[1],k[0]);j.push(l)}b.path=j,g=new google.maps.Polyline(b),c&&g.set("geojsonProperties",c);break;case"MultiLineString":g=[];for(var h=0;h<a.coordinates.length;h++){for(var j=[],m=0;m<a.coordinates[h].length;m++){var k=a.coordinates[h][m],l=new google.maps.LatLng(k[1],k[0]);j.push(l)}b.path=j,g.push(new google.maps.Polyline(b))}if(c)for(var i=0;i<g.length;i++)g[i].set("geojsonProperties",c);break;case"Polygon":for(var n,o,p=[],h=0;h<a.coordinates.length;h++){for(var j=[],m=0;m<a.coordinates[h].length;m++){var l=new google.maps.LatLng(a.coordinates[h][m][1],a.coordinates[h][m][0]);j.push(l)}h?1==h?(o=f(j),p.push(n==o?j.reverse():j)):p.push(n==o?j.reverse():j):(n=f(j),p.push(j))}b.paths=p,g=new google.maps.Polygon(b),c&&g.set("geojsonProperties",c);break;case"MultiPolygon":g=[];for(var h=0;h<a.coordinates.length;h++){for(var n,o,p=[],m=0;m<a.coordinates[h].length;m++){for(var j=[],i=0;i<a.coordinates[h][m].length-1;i++){var l=new google.maps.LatLng(a.coordinates[h][m][i][1],a.coordinates[h][m][i][0]);j.push(l)}m?1==m?(o=f(j),p.push(n==o?j.reverse():j)):p.push(n==o?j.reverse():j):(n=f(j),p.push(j))}b.paths=p,g.push(new google.maps.Polygon(b))}if(c)for(var i=0;i<g.length;i++)g[i].set("geojsonProperties",c);break;case"GeometryCollection":if(g=[],a.geometries)for(var h=0;h<a.geometries.length;h++)g.push(d(a.geometries[h],b,c||null));else g=e('Invalid GeoJSON object: GeometryCollection object missing "geometries" member.');break;default:g=e('Invalid GeoJSON object: Geometry object must be one of "Point", "LineString", "Polygon" or "MultiPolygon".')}return g},e=function(a){return{type:"Error",message:a}},f=function(a){for(var b,c=0,d=0;d<a.length-2;d++)c+=(a[d+1].lat()-a[d].lat())*(a[d+2].lng()-a[d].lng())-(a[d+2].lat()-a[d].lat())*(a[d+1].lng()-a[d].lng());return b=c>0?!0:!1},g=b||{};switch(a.type){case"FeatureCollection":if(a.features){c=[];for(var h=0;h<a.features.length;h++)c.push(d(a.features[h].geometry,g,a.features[h].properties))}else c=e('Invalid GeoJSON object: FeatureCollection object missing "features" member.');break;case"GeometryCollection":if(a.geometries){c=[];for(var h=0;h<a.geometries.length;h++)c.push(d(a.geometries[h],g))}else c=e('Invalid GeoJSON object: GeometryCollection object missing "geometries" member.');break;case"Feature":c=a.properties&&a.geometry?d(a.geometry,g,a.properties):e('Invalid GeoJSON object: Feature object missing "properties" or "geometry" member.');break;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":c=a.coordinates?c=d(a,g):e('Invalid GeoJSON object: Geometry object missing "coordinates" member.');break;default:c=e('Invalid GeoJSON object: GeoJSON object must be one of "Point", "LineString", "Polygon", "MultiPolygon", "Feature", "FeatureCollection" or "GeometryCollection".')}return c};(function(){var a,b=this,c=b.Backbone,d=Array.prototype.slice,e=Array.prototype.splice;a="undefined"!=typeof exports?exports:b.Backbone={},a.VERSION="0.9.2";var f=b._;f||"undefined"==typeof require||(f=require("underscore"));var g=b.jQuery||b.Zepto||b.ender;a.setDomLibrary=function(a){g=a},a.noConflict=function(){return b.Backbone=c,this},a.emulateHTTP=!1,a.emulateJSON=!1;var h=/\s+/,i=a.Events={on:function(a,b,c){var d,e,f,g,i;if(!b)return this;for(a=a.split(h),d=this._callbacks||(this._callbacks={});e=a.shift();)i=d[e],f=i?i.tail:{},f.next=g={},f.context=c,f.callback=b,d[e]={tail:g,next:i?i.next:f};return this},off:function(a,b,c){var d,e,g,i,j,k;if(e=this._callbacks){if(!(a||b||c))return delete this._callbacks,this;for(a=a?a.split(h):f.keys(e);d=a.shift();)if(g=e[d],delete e[d],g&&(b||c))for(i=g.tail;(g=g.next)!==i;)j=g.callback,k=g.context,(b&&j!==b||c&&k!==c)&&this.on(d,j,k);return this}},trigger:function(a){var b,c,e,f,g,i,j;if(!(e=this._callbacks))return this;for(i=e.all,a=a.split(h),j=d.call(arguments,1);b=a.shift();){if(c=e[b])for(f=c.tail;(c=c.next)!==f;)c.callback.apply(c.context||this,j);if(c=i)for(f=c.tail,g=[b].concat(j);(c=c.next)!==f;)c.callback.apply(c.context||this,g)}return this}};i.bind=i.on,i.unbind=i.off;var j=a.Model=function(a,b){var c;a||(a={}),b&&b.parse&&(a=this.parse(a)),(c=A(this,"defaults"))&&(a=f.extend({},c,a)),b&&b.collection&&(this.collection=b.collection),this.attributes={},this._escapedAttributes={},this.cid=f.uniqueId("c"),this.changed={},this._silent={},this._pending={},this.set(a,{silent:!0}),this.changed={},this._silent={},this._pending={},this._previousAttributes=f.clone(this.attributes),this.initialize.apply(this,arguments)};f.extend(j.prototype,i,{changed:null,_silent:null,_pending:null,idAttribute:"id",initialize:function(){},toJSON:function(){return f.clone(this.attributes)},get:function(a){return this.attributes[a]},escape:function(a){var b;if(b=this._escapedAttributes[a])return b;var c=this.get(a);return this._escapedAttributes[a]=f.escape(null==c?"":""+c)},has:function(a){return null!=this.get(a)},set:function(a,b,c){var d,e,g;if(f.isObject(a)||null==a?(d=a,c=b):(d={},d[a]=b),c||(c={}),!d)return this;if(d instanceof j&&(d=d.attributes),c.unset)for(e in d)d[e]=void 0;if(!this._validate(d,c))return!1;this.idAttribute in d&&(this.id=d[this.idAttribute]);var h=c.changes={},i=this.attributes,k=this._escapedAttributes,l=this._previousAttributes||{};for(e in d)g=d[e],(!f.isEqual(i[e],g)||c.unset&&f.has(i,e))&&(delete k[e],(c.silent?this._silent:h)[e]=!0),c.unset?delete i[e]:i[e]=g,f.isEqual(l[e],g)&&f.has(i,e)==f.has(l,e)?(delete this.changed[e],delete this._pending[e]):(this.changed[e]=g,c.silent||(this._pending[e]=!0));return c.silent||this.change(c),this},unset:function(a,b){return(b||(b={})).unset=!0,this.set(a,null,b)},clear:function(a){return(a||(a={})).unset=!0,this.set(f.clone(this.attributes),a)},fetch:function(b){b=b?f.clone(b):{};var c=this,d=b.success;return b.success=function(a,e,f){return c.set(c.parse(a,f),b)?void(d&&d(c,a)):!1},b.error=a.wrapError(b.error,c,b),(this.sync||a.sync).call(this,"read",this,b)},save:function(b,c,d){var e,g;if(f.isObject(b)||null==b?(e=b,d=c):(e={},e[b]=c),d=d?f.clone(d):{},d.wait){if(!this._validate(e,d))return!1;g=f.clone(this.attributes)}var h=f.extend({},d,{silent:!0});if(e&&!this.set(e,d.wait?h:d))return!1;var i=this,j=d.success;d.success=function(a,b,c){var g=i.parse(a,c);return d.wait&&(delete d.wait,g=f.extend(e||{},g)),i.set(g,d)?void(j?j(i,a):i.trigger("sync",i,a,d)):!1},d.error=a.wrapError(d.error,i,d);var k=this.isNew()?"create":"update",l=(this.sync||a.sync).call(this,k,this,d);return d.wait&&this.set(g,h),l},destroy:function(b){b=b?f.clone(b):{};var c=this,d=b.success,e=function(){c.trigger("destroy",c,c.collection,b)};if(this.isNew())return e(),!1;b.success=function(a){b.wait&&e(),d?d(c,a):c.trigger("sync",c,a,b)},b.error=a.wrapError(b.error,c,b);var g=(this.sync||a.sync).call(this,"delete",this,b);return b.wait||e(),g},url:function(){var a=A(this,"urlRoot")||A(this.collection,"url")||B();return this.isNew()?a:a+("/"==a.charAt(a.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(a){return a},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return null==this.id},change:function(a){a||(a={});var b=this._changing;this._changing=!0;for(var c in this._silent)this._pending[c]=!0;var d=f.extend({},a.changes,this._silent);this._silent={};for(var c in d)this.trigger("change:"+c,this,this.get(c),a);if(b)return this;for(;!f.isEmpty(this._pending);){this._pending={},this.trigger("change",this,a);for(var c in this.changed)this._pending[c]||this._silent[c]||delete this.changed[c];this._previousAttributes=f.clone(this.attributes)}return this._changing=!1,this},hasChanged:function(a){return arguments.length?f.has(this.changed,a):!f.isEmpty(this.changed)},changedAttributes:function(a){if(!a)return this.hasChanged()?f.clone(this.changed):!1;var b,c=!1,d=this._previousAttributes;for(var e in a)f.isEqual(d[e],b=a[e])||((c||(c={}))[e]=b);return c},previous:function(a){return arguments.length&&this._previousAttributes?this._previousAttributes[a]:null},previousAttributes:function(){return f.clone(this._previousAttributes)},isValid:function(){return!this.validate(this.attributes)},_validate:function(a,b){if(b.silent||!this.validate)return!0;a=f.extend({},this.attributes,a);var c=this.validate(a,b);return c?(b&&b.error?b.error(this,c,b):this.trigger("error",this,c,b),!1):!0}});var k=a.Collection=function(a,b){b||(b={}),b.model&&(this.model=b.model),b.comparator&&(this.comparator=b.comparator),this._reset(),this.initialize.apply(this,arguments),a&&this.reset(a,{silent:!0,parse:b.parse})};f.extend(k.prototype,i,{model:j,initialize:function(){},toJSON:function(a){return this.map(function(b){return b.toJSON(a)})},add:function(a,b){var c,d,g,h,i,j,k={},l={},m=[];for(b||(b={}),a=f.isArray(a)?a.slice():[a],c=0,g=a.length;g>c;c++){if(!(h=a[c]=this._prepareModel(a[c],b)))throw new Error("Can't add an invalid model to a collection");i=h.cid,j=h.id,k[i]||this._byCid[i]||null!=j&&(l[j]||this._byId[j])?m.push(c):k[i]=l[j]=h}for(c=m.length;c--;)a.splice(m[c],1);for(c=0,g=a.length;g>c;c++)(h=a[c]).on("all",this._onModelEvent,this),this._byCid[h.cid]=h,null!=h.id&&(this._byId[h.id]=h);if(this.length+=g,d=null!=b.at?b.at:this.models.length,e.apply(this.models,[d,0].concat(a)),this.comparator&&this.sort({silent:!0}),b.silent)return this;for(c=0,g=this.models.length;g>c;c++)k[(h=this.models[c]).cid]&&(b.index=c,h.trigger("add",h,this,b));return this},remove:function(a,b){var c,d,e,g;for(b||(b={}),a=f.isArray(a)?a.slice():[a],c=0,d=a.length;d>c;c++)g=this.getByCid(a[c])||this.get(a[c]),g&&(delete this._byId[g.id],delete this._byCid[g.cid],e=this.indexOf(g),this.models.splice(e,1),this.length--,b.silent||(b.index=e,g.trigger("remove",g,this,b)),this._removeReference(g));return this},push:function(a,b){return a=this._prepareModel(a,b),this.add(a,b),a},pop:function(a){var b=this.at(this.length-1);return this.remove(b,a),b},unshift:function(a,b){return a=this._prepareModel(a,b),this.add(a,f.extend({at:0},b)),a},shift:function(a){var b=this.at(0);return this.remove(b,a),b},get:function(a){return null==a?void 0:this._byId[null!=a.id?a.id:a]},getByCid:function(a){return a&&this._byCid[a.cid||a]},at:function(a){return this.models[a]},where:function(a){return f.isEmpty(a)?[]:this.filter(function(b){for(var c in a)if(a[c]!==b.get(c))return!1;return!0})},sort:function(a){if(a||(a={}),!this.comparator)throw new Error("Cannot sort a set without a comparator");var b=f.bind(this.comparator,this);return 1==this.comparator.length?this.models=this.sortBy(b):this.models.sort(b),a.silent||this.trigger("reset",this,a),this},pluck:function(a){return f.map(this.models,function(b){return b.get(a)})},reset:function(a,b){a||(a=[]),b||(b={});for(var c=0,d=this.models.length;d>c;c++)this._removeReference(this.models[c]);return this._reset(),this.add(a,f.extend({silent:!0},b)),b.silent||this.trigger("reset",this,b),this},fetch:function(b){b=b?f.clone(b):{},void 0===b.parse&&(b.parse=!0);var c=this,d=b.success;return b.success=function(a,e,f){c[b.add?"add":"reset"](c.parse(a,f),b),d&&d(c,a)},b.error=a.wrapError(b.error,c,b),(this.sync||a.sync).call(this,"read",this,b)},create:function(a,b){var c=this;if(b=b?f.clone(b):{},a=this._prepareModel(a,b),!a)return!1;b.wait||c.add(a,b);var d=b.success;return b.success=function(e,f){b.wait&&c.add(e,b),d?d(e,f):e.trigger("sync",a,f,b)},a.save(null,b),a},parse:function(a){return a},chain:function(){return f(this.models).chain()},_reset:function(){this.length=0,this.models=[],this._byId={},this._byCid={}},_prepareModel:function(a,b){if(b||(b={}),a instanceof j)a.collection||(a.collection=this);else{var c=a;b.collection=this,a=new this.model(c,b),a._validate(a.attributes,b)||(a=!1)}return a},_removeReference:function(a){this==a.collection&&delete a.collection,a.off("all",this._onModelEvent,this)},_onModelEvent:function(a,b,c,d){("add"!=a&&"remove"!=a||c==this)&&("destroy"==a&&this.remove(b,d),b&&a==="change:"+b.idAttribute&&(delete this._byId[b.previous(b.idAttribute)],this._byId[b.id]=b),this.trigger.apply(this,arguments))}});var l=["forEach","each","map","reduce","reduceRight","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","sortBy","sortedIndex","toArray","size","first","initial","rest","last","without","indexOf","shuffle","lastIndexOf","isEmpty","groupBy"];f.each(l,function(a){k.prototype[a]=function(){return f[a].apply(f,[this.models].concat(f.toArray(arguments)))}});var m=a.Router=function(a){a||(a={}),a.routes&&(this.routes=a.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},n=/:\w+/g,o=/\*\w+/g,p=/[-[\]{}()+?.,\\^$|#\s]/g;f.extend(m.prototype,i,{initialize:function(){},route:function(b,c,d){return a.history||(a.history=new q),f.isRegExp(b)||(b=this._routeToRegExp(b)),d||(d=this[c]),a.history.route(b,f.bind(function(e){var f=this._extractParameters(b,e);d&&d.apply(this,f),this.trigger.apply(this,["route:"+c].concat(f)),a.history.trigger("route",this,c,f)},this)),this},navigate:function(b,c){a.history.navigate(b,c)},_bindRoutes:function(){if(this.routes){var a=[];for(var b in this.routes)a.unshift([b,this.routes[b]]);for(var c=0,d=a.length;d>c;c++)this.route(a[c][0],a[c][1],this[a[c][1]])}},_routeToRegExp:function(a){return a=a.replace(p,"\\$&").replace(n,"([^/]+)").replace(o,"(.*?)"),new RegExp("^"+a+"$")},_extractParameters:function(a,b){return a.exec(b).slice(1)}});var q=a.History=function(){this.handlers=[],f.bindAll(this,"checkUrl")},r=/^[#\/]/,s=/msie [\w.]+/;q.started=!1,f.extend(q.prototype,i,{interval:50,getHash:function(a){var b=a?a.location:window.location,c=b.href.match(/#(.*)$/);return c?c[1]:""},getFragment:function(a,b){if(null==a)if(this._hasPushState||b){a=window.location.pathname;var c=window.location.search;c&&(a+=c)}else a=this.getHash();return a.indexOf(this.options.root)||(a=a.substr(this.options.root.length)),a.replace(r,"")},start:function(a){if(q.started)throw new Error("Backbone.history has already been started");q.started=!0,this.options=f.extend({},{root:"/"},this.options,a),this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&window.history&&window.history.pushState);var b=this.getFragment(),c=document.documentMode,d=s.exec(navigator.userAgent.toLowerCase())&&(!c||7>=c);d&&(this.iframe=g('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(b)),this._hasPushState?g(window).bind("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!d?g(window).bind("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=b;var e=window.location,h=e.pathname==this.options.root;return this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!h?(this.fragment=this.getFragment(null,!0),window.location.replace(this.options.root+"#"+this.fragment),!0):(this._wantsPushState&&this._hasPushState&&h&&e.hash&&(this.fragment=this.getHash().replace(r,""),window.history.replaceState({},document.title,e.protocol+"//"+e.host+this.options.root+this.fragment)),this.options.silent?void 0:this.loadUrl())},stop:function(){g(window).unbind("popstate",this.checkUrl).unbind("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),q.started=!1},route:function(a,b){this.handlers.unshift({route:a,callback:b})},checkUrl:function(){var a=this.getFragment();return a==this.fragment&&this.iframe&&(a=this.getFragment(this.getHash(this.iframe))),a==this.fragment?!1:(this.iframe&&this.navigate(a),void(this.loadUrl()||this.loadUrl(this.getHash())))},loadUrl:function(a){var b=this.fragment=this.getFragment(a),c=f.any(this.handlers,function(a){return a.route.test(b)?(a.callback(b),!0):void 0});return c},navigate:function(a,b){if(!q.started)return!1;b&&b!==!0||(b={trigger:b});var c=(a||"").replace(r,"");this.fragment!=c&&(this._hasPushState?(0!=c.indexOf(this.options.root)&&(c=this.options.root+c),this.fragment=c,window.history[b.replace?"replaceState":"pushState"]({},document.title,c)):this._wantsHashChange?(this.fragment=c,this._updateHash(window.location,c,b.replace),this.iframe&&c!=this.getFragment(this.getHash(this.iframe))&&(b.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,c,b.replace))):window.location.assign(this.options.root+a),b.trigger&&this.loadUrl(a))},_updateHash:function(a,b,c){c?a.replace(a.toString().replace(/(javascript:|#).*$/,"")+"#"+b):a.hash=b}});var t=a.View=function(a){this.cid=f.uniqueId("view"),this._configure(a||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},u=/^(\S+)\s*(.*)$/,v=["model","collection","el","id","attributes","className","tagName"];f.extend(t.prototype,i,{tagName:"div",$:function(a){return this.$el.find(a)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this},make:function(a,b,c){var d=document.createElement(a);return b&&g(d).attr(b),c&&g(d).html(c),d},setElement:function(a,b){return this.$el&&this.undelegateEvents(),this.$el=a instanceof g?a:g(a),this.el=this.$el[0],b!==!1&&this.delegateEvents(),this},delegateEvents:function(a){if(a||(a=A(this,"events"))){this.undelegateEvents();for(var b in a){var c=a[b];if(f.isFunction(c)||(c=this[a[b]]),!c)throw new Error('Method "'+a[b]+'" does not exist');var d=b.match(u),e=d[1],g=d[2];c=f.bind(c,this),e+=".delegateEvents"+this.cid,""===g?this.$el.bind(e,c):this.$el.delegate(g,e,c)}}},undelegateEvents:function(){this.$el.unbind(".delegateEvents"+this.cid)},_configure:function(a){this.options&&(a=f.extend({},this.options,a));for(var b=0,c=v.length;c>b;b++){var d=v[b];a[d]&&(this[d]=a[d])}this.options=a},_ensureElement:function(){if(this.el)this.setElement(this.el,!1);else{var a=A(this,"attributes")||{};this.id&&(a.id=this.id),this.className&&(a["class"]=this.className),this.setElement(this.make(this.tagName,a),!1)}}});var w=function(a,b){var c=z(this,a,b);return c.extend=this.extend,c};j.extend=k.extend=m.extend=t.extend=w;var x={create:"POST",update:"PUT","delete":"DELETE",read:"GET"};a.sync=function(b,c,d){var e=x[b];d||(d={});var h={type:e,dataType:"json"};return d.url||(h.url=A(c,"url")||B()),d.data||!c||"create"!=b&&"update"!=b||(h.contentType="application/json",h.data=JSON.stringify(c.toJSON())),a.emulateJSON&&(h.contentType="application/x-www-form-urlencoded",h.data=h.data?{model:h.data}:{}),a.emulateHTTP&&("PUT"===e||"DELETE"===e)&&(a.emulateJSON&&(h.data._method=e),h.type="POST",h.beforeSend=function(a){a.setRequestHeader("X-HTTP-Method-Override",e)}),"GET"===h.type||a.emulateJSON||(h.processData=!1),g.ajax(f.extend(h,d))},a.wrapError=function(a,b,c){return function(d,e){e=d===b?e:d,a?a(b,e,c):b.trigger("error",b,e,c)}};var y=function(){},z=function(a,b,c){var d;return d=b&&b.hasOwnProperty("constructor")?b.constructor:function(){a.apply(this,arguments)},f.extend(d,a),y.prototype=a.prototype,d.prototype=new y,b&&f.extend(d.prototype,b),c&&f.extend(d,c),d.prototype.constructor=d,d.__super__=a.prototype,d},A=function(a,b){return a&&a[b]?f.isFunction(a[b])?a[b]():a[b]:null},B=function(){throw new Error('A "url" property or function must be specified')}}).call(this),function(a,b,c){a.fn.jScrollPane=function(d){function e(d,e){function f(b){var e,h,j,l,m,n,q=!1,r=!1;if(P=b,Q===c)m=d.scrollTop(),n=d.scrollLeft(),d.css({overflow:"hidden",padding:0}),R=d.innerWidth()+tb,S=d.innerHeight(),d.width(R),Q=a('<div class="jspPane" />').css("padding",sb).append(d.children()),T=a('<div class="jspContainer" />').css({width:R+"px",height:S+"px"}).append(Q).appendTo(d);else{if(d.css("width",""),q=P.stickToBottom&&C(),r=P.stickToRight&&D(),l=d.innerWidth()+tb!=R||d.outerHeight()!=S,l&&(R=d.innerWidth()+tb,S=d.innerHeight(),T.css({width:R+"px",height:S+"px"})),!l&&ub==U&&Q.outerHeight()==V)return void d.width(R);ub=U,Q.css("width",""),d.width(R),T.find(">.jspVerticalBar,>.jspHorizontalBar").remove().end()}Q.css("overflow","auto"),U=b.contentWidth?b.contentWidth:Q[0].scrollWidth,V=Q[0].scrollHeight,Q.css("overflow",""),W=U/R,X=V/S,Y=X>1,Z=W>1,Z||Y?(d.addClass("jspScrollable"),e=P.maintainPosition&&(ab||db),e&&(h=A(),j=B()),g(),i(),k(),e&&(y(r?U-R:h,!1),x(q?V-S:j,!1)),H(),E(),N(),P.enableKeyboardNavigation&&J(),P.clickOnTrack&&o(),L(),P.hijackInternalLinks&&M()):(d.removeClass("jspScrollable"),Q.css({top:0,width:T.width()-tb}),F(),I(),K(),p()),P.autoReinitialise&&!rb?rb=setInterval(function(){f(P)},P.autoReinitialiseDelay):!P.autoReinitialise&&rb&&clearInterval(rb),m&&d.scrollTop(0)&&x(m,!1),n&&d.scrollLeft(0)&&y(n,!1),d.trigger("jsp-initialised",[Z||Y])}function g(){Y&&(T.append(a('<div class="jspVerticalBar" />').append(a('<div class="jspCap jspCapTop" />'),a('<div class="jspTrack" />').append(a('<div class="jspDrag" />').append(a('<div class="jspDragTop" />'),a('<div class="jspDragBottom" />'))),a('<div class="jspCap jspCapBottom" />'))),eb=T.find(">.jspVerticalBar"),fb=eb.find(">.jspTrack"),$=fb.find(">.jspDrag"),P.showArrows&&(jb=a('<a class="jspArrow jspArrowUp" />').bind("mousedown.jsp",m(0,-1)).bind("click.jsp",G),kb=a('<a class="jspArrow jspArrowDown" />').bind("mousedown.jsp",m(0,1)).bind("click.jsp",G),P.arrowScrollOnHover&&(jb.bind("mouseover.jsp",m(0,-1,jb)),kb.bind("mouseover.jsp",m(0,1,kb))),l(fb,P.verticalArrowPositions,jb,kb)),hb=S,T.find(">.jspVerticalBar>.jspCap:visible,>.jspVerticalBar>.jspArrow").each(function(){hb-=a(this).outerHeight()}),$.hover(function(){$.addClass("jspHover")},function(){$.removeClass("jspHover")}).bind("mousedown.jsp",function(b){a("html").bind("dragstart.jsp selectstart.jsp",G),$.addClass("jspActive");var c=b.pageY-$.position().top;return a("html").bind("mousemove.jsp",function(a){r(a.pageY-c,!1)}).bind("mouseup.jsp mouseleave.jsp",q),!1}),h())}function h(){fb.height(hb+"px"),ab=0,gb=P.verticalGutter+fb.outerWidth(),Q.width(R-gb-tb);try{0===eb.position().left&&Q.css("margin-left",gb+"px")}catch(a){}}function i(){Z&&(T.append(a('<div class="jspHorizontalBar" />').append(a('<div class="jspCap jspCapLeft" />'),a('<div class="jspTrack" />').append(a('<div class="jspDrag" />').append(a('<div class="jspDragLeft" />'),a('<div class="jspDragRight" />'))),a('<div class="jspCap jspCapRight" />'))),lb=T.find(">.jspHorizontalBar"),mb=lb.find(">.jspTrack"),bb=mb.find(">.jspDrag"),P.showArrows&&(pb=a('<a class="jspArrow jspArrowLeft" />').bind("mousedown.jsp",m(-1,0)).bind("click.jsp",G),qb=a('<a class="jspArrow jspArrowRight" />').bind("mousedown.jsp",m(1,0)).bind("click.jsp",G),P.arrowScrollOnHover&&(pb.bind("mouseover.jsp",m(-1,0,pb)),qb.bind("mouseover.jsp",m(1,0,qb))),l(mb,P.horizontalArrowPositions,pb,qb)),bb.hover(function(){bb.addClass("jspHover")},function(){bb.removeClass("jspHover")}).bind("mousedown.jsp",function(b){a("html").bind("dragstart.jsp selectstart.jsp",G),bb.addClass("jspActive");var c=b.pageX-bb.position().left;return a("html").bind("mousemove.jsp",function(a){t(a.pageX-c,!1)}).bind("mouseup.jsp mouseleave.jsp",q),!1}),nb=T.innerWidth(),j())}function j(){T.find(">.jspHorizontalBar>.jspCap:visible,>.jspHorizontalBar>.jspArrow").each(function(){nb-=a(this).outerWidth()}),mb.width(nb+"px"),db=0}function k(){if(Z&&Y){var b=mb.outerHeight(),c=fb.outerWidth();hb-=b,a(lb).find(">.jspCap:visible,>.jspArrow").each(function(){nb+=a(this).outerWidth()}),nb-=c,S-=c,R-=b,mb.parent().append(a('<div class="jspCorner" />').css("width",b+"px")),h(),j()}Z&&Q.width(T.outerWidth()-tb+"px"),V=Q.outerHeight(),X=V/S,Z&&(ob=Math.ceil(1/W*nb),ob>P.horizontalDragMaxWidth?ob=P.horizontalDragMaxWidth:ob<P.horizontalDragMinWidth&&(ob=P.horizontalDragMinWidth),bb.width(ob+"px"),cb=nb-ob,u(db)),Y&&(ib=Math.ceil(1/X*hb),ib>P.verticalDragMaxHeight?ib=P.verticalDragMaxHeight:ib<P.verticalDragMinHeight&&(ib=P.verticalDragMinHeight),$.height(ib+"px"),_=hb-ib,s(ab))}function l(a,b,c,d){var e,f="before",g="after";"os"==b&&(b=/Mac/.test(navigator.platform)?"after":"split"),b==f?g=b:b==g&&(f=b,e=c,c=d,d=e),a[f](c)[g](d)}function m(a,b,c){return function(){return n(a,b,this,c),this.blur(),!1}}function n(b,c,d,e){d=a(d).addClass("jspActive");var f,g,h=!0,i=function(){0!==b&&vb.scrollByX(b*P.arrowButtonSpeed),0!==c&&vb.scrollByY(c*P.arrowButtonSpeed),g=setTimeout(i,h?P.initialDelay:P.arrowRepeatFreq),h=!1};i(),f=e?"mouseout.jsp":"mouseup.jsp",e=e||a("html"),e.bind(f,function(){d.removeClass("jspActive"),g&&clearTimeout(g),g=null,e.unbind(f)})}function o(){p(),Y&&fb.bind("mousedown.jsp",function(b){if(b.originalTarget===c||b.originalTarget==b.currentTarget){var d,e=a(this),f=e.offset(),g=b.pageY-f.top-ab,h=!0,i=function(){var a=e.offset(),c=b.pageY-a.top-ib/2,f=S*P.scrollPagePercent,k=_*f/(V-S);if(0>g)ab-k>c?vb.scrollByY(-f):r(c);else{if(!(g>0))return void j();c>ab+k?vb.scrollByY(f):r(c)}d=setTimeout(i,h?P.initialDelay:P.trackClickRepeatFreq),h=!1},j=function(){d&&clearTimeout(d),d=null,a(document).unbind("mouseup.jsp",j)};return i(),a(document).bind("mouseup.jsp",j),!1}}),Z&&mb.bind("mousedown.jsp",function(b){if(b.originalTarget===c||b.originalTarget==b.currentTarget){var d,e=a(this),f=e.offset(),g=b.pageX-f.left-db,h=!0,i=function(){var a=e.offset(),c=b.pageX-a.left-ob/2,f=R*P.scrollPagePercent,k=cb*f/(U-R);if(0>g)db-k>c?vb.scrollByX(-f):t(c);else{if(!(g>0))return void j();c>db+k?vb.scrollByX(f):t(c)}d=setTimeout(i,h?P.initialDelay:P.trackClickRepeatFreq),h=!1},j=function(){d&&clearTimeout(d),d=null,a(document).unbind("mouseup.jsp",j)};return i(),a(document).bind("mouseup.jsp",j),!1}})}function p(){mb&&mb.unbind("mousedown.jsp"),fb&&fb.unbind("mousedown.jsp")}function q(){a("html").unbind("dragstart.jsp selectstart.jsp mousemove.jsp mouseup.jsp mouseleave.jsp"),$&&$.removeClass("jspActive"),bb&&bb.removeClass("jspActive")}function r(a,b){Y&&(0>a?a=0:a>_&&(a=_),b===c&&(b=P.animateScroll),b?vb.animate($,"top",a,s):($.css("top",a),s(a)))}function s(a){a===c&&(a=$.position().top),T.scrollTop(0),ab=a;var b=0===ab,e=ab==_,f=a/_,g=-f*(V-S);(wb!=b||yb!=e)&&(wb=b,yb=e,d.trigger("jsp-arrow-change",[wb,yb,xb,zb])),v(b,e),Q.css("top",g),d.trigger("jsp-scroll-y",[-g,b,e]).trigger("scroll")}function t(a,b){Z&&(0>a?a=0:a>cb&&(a=cb),b===c&&(b=P.animateScroll),b?vb.animate(bb,"left",a,u):(bb.css("left",a),u(a)))}function u(a){a===c&&(a=bb.position().left),T.scrollTop(0),db=a;var b=0===db,e=db==cb,f=a/cb,g=-f*(U-R);(xb!=b||zb!=e)&&(xb=b,zb=e,d.trigger("jsp-arrow-change",[wb,yb,xb,zb])),w(b,e),Q.css("left",g),d.trigger("jsp-scroll-x",[-g,b,e]).trigger("scroll")}function v(a,b){P.showArrows&&(jb[a?"addClass":"removeClass"]("jspDisabled"),kb[b?"addClass":"removeClass"]("jspDisabled"))}function w(a,b){P.showArrows&&(pb[a?"addClass":"removeClass"]("jspDisabled"),qb[b?"addClass":"removeClass"]("jspDisabled"))}function x(a,b){var c=a/(V-S);r(c*_,b)}function y(a,b){var c=a/(U-R);t(c*cb,b)}function z(b,c,d){var e,f,g,h,i,j,k,l,m,n=0,o=0;try{e=a(b)}catch(p){return}for(f=e.outerHeight(),g=e.outerWidth(),T.scrollTop(0),T.scrollLeft(0);!e.is(".jspPane");)if(n+=e.position().top,o+=e.position().left,e=e.offsetParent(),/^body|html$/i.test(e[0].nodeName))return;h=B(),j=h+S,h>n||c?l=n-P.verticalGutter:n+f>j&&(l=n-S+f+P.verticalGutter),l&&x(l,d),i=A(),k=i+R,i>o||c?m=o-P.horizontalGutter:o+g>k&&(m=o-R+g+P.horizontalGutter),m&&y(m,d)}function A(){return-Q.position().left}function B(){return-Q.position().top}function C(){var a=V-S;return a>20&&a-B()<10}function D(){var a=U-R;return a>20&&a-A()<10}function E(){T.unbind(Bb).bind(Bb,function(a,b,c,d){var e=db,f=ab;return vb.scrollBy(c*P.mouseWheelSpeed,-d*P.mouseWheelSpeed,!1),e==db&&f==ab})}function F(){T.unbind(Bb)}function G(){return!1}function H(){Q.find(":input,a").unbind("focus.jsp").bind("focus.jsp",function(a){z(a.target,!1)})}function I(){Q.find(":input,a").unbind("focus.jsp")}function J(){function b(){var a=db,b=ab;switch(c){case 40:vb.scrollByY(P.keyboardSpeed,!1);break;case 38:vb.scrollByY(-P.keyboardSpeed,!1);break;case 34:case 32:vb.scrollByY(S*P.scrollPagePercent,!1);break;case 33:vb.scrollByY(-S*P.scrollPagePercent,!1);break;case 39:vb.scrollByX(P.keyboardSpeed,!1);break;case 37:vb.scrollByX(-P.keyboardSpeed,!1)}return e=a!=db||b!=ab}var c,e,f=[];Z&&f.push(lb[0]),Y&&f.push(eb[0]),Q.focus(function(){d.focus()}),d.attr("tabindex",0).unbind("keydown.jsp keypress.jsp").bind("keydown.jsp",function(d){if(d.target===this||f.length&&a(d.target).closest(f).length){var g=db,h=ab;switch(d.keyCode){case 40:case 38:case 34:case 32:case 33:case 39:case 37:c=d.keyCode,b();break;case 35:x(V-S),c=null;break;case 36:x(0),c=null}return e=d.keyCode==c&&g!=db||h!=ab,!e}}).bind("keypress.jsp",function(a){return a.keyCode==c&&b(),!e}),P.hideFocus?(d.css("outline","none"),"hideFocus"in T[0]&&d.attr("hideFocus",!0)):(d.css("outline",""),"hideFocus"in T[0]&&d.attr("hideFocus",!1))}function K(){d.attr("tabindex","-1").removeAttr("tabindex").unbind("keydown.jsp keypress.jsp")}function L(){if(location.hash&&location.hash.length>1){var b,c,d=escape(location.hash.substr(1));try{b=a("#"+d+', a[name="'+d+'"]')}catch(e){return}b.length&&Q.find(d)&&(0===T.scrollTop()?c=setInterval(function(){T.scrollTop()>0&&(z(b,!0),a(document).scrollTop(T.position().top),clearInterval(c))},50):(z(b,!0),a(document).scrollTop(T.position().top)))}}function M(){a(document.body).data("jspHijack")||(a(document.body).data("jspHijack",!0),a(document.body).delegate("a[href*=#]","click",function(c){var d,e,f,g,h,i,j=this.href.substr(0,this.href.indexOf("#")),k=location.href;if(-1!==location.href.indexOf("#")&&(k=location.href.substr(0,location.href.indexOf("#"))),j===k){d=escape(this.href.substr(this.href.indexOf("#")+1));try{e=a("#"+d+', a[name="'+d+'"]')}catch(l){return}e.length&&(f=e.closest(".jspScrollable"),g=f.data("jsp"),g.scrollToElement(e,!0),f[0].scrollIntoView&&(h=a(b).scrollTop(),i=e.offset().top,(h>i||i>h+a(b).height())&&f[0].scrollIntoView()),c.preventDefault())}}))}function N(){var a,b,c,d,e,f=!1;T.unbind("touchstart.jsp touchmove.jsp touchend.jsp click.jsp-touchclick").bind("touchstart.jsp",function(g){var h=g.originalEvent.touches[0];a=A(),b=B(),c=h.pageX,d=h.pageY,e=!1,f=!0}).bind("touchmove.jsp",function(g){if(f){var h=g.originalEvent.touches[0],i=db,j=ab;return vb.scrollTo(a+c-h.pageX,b+d-h.pageY),e=e||Math.abs(c-h.pageX)>5||Math.abs(d-h.pageY)>5,i==db&&j==ab}}).bind("touchend.jsp",function(){f=!1}).bind("click.jsp-touchclick",function(){return e?(e=!1,!1):void 0})}function O(){var a=B(),b=A();d.removeClass("jspScrollable").unbind(".jsp"),d.replaceWith(Ab.append(Q.children())),Ab.scrollTop(a),Ab.scrollLeft(b),rb&&clearInterval(rb)}var P,Q,R,S,T,U,V,W,X,Y,Z,$,_,ab,bb,cb,db,eb,fb,gb,hb,ib,jb,kb,lb,mb,nb,ob,pb,qb,rb,sb,tb,ub,vb=this,wb=!0,xb=!0,yb=!1,zb=!1,Ab=d.clone(!1,!1).empty(),Bb=a.fn.mwheelIntent?"mwheelIntent.jsp":"mousewheel.jsp";sb=d.css("paddingTop")+" "+d.css("paddingRight")+" "+d.css("paddingBottom")+" "+d.css("paddingLeft"),tb=(parseInt(d.css("paddingLeft"),10)||0)+(parseInt(d.css("paddingRight"),10)||0),a.extend(vb,{reinitialise:function(b){b=a.extend({},P,b),f(b)},scrollToElement:function(a,b,c){z(a,b,c)},scrollTo:function(a,b,c){y(a,c),x(b,c)},scrollToX:function(a,b){y(a,b)},scrollToY:function(a,b){x(a,b)},scrollToPercentX:function(a,b){y(a*(U-R),b)},scrollToPercentY:function(a,b){x(a*(V-S),b)},scrollBy:function(a,b,c){vb.scrollByX(a,c),vb.scrollByY(b,c)},scrollByX:function(a,b){var c=A()+Math[0>a?"floor":"ceil"](a),d=c/(U-R);t(d*cb,b)
},scrollByY:function(a,b){var c=B()+Math[0>a?"floor":"ceil"](a),d=c/(V-S);r(d*_,b)},positionDragX:function(a,b){t(a,b)},positionDragY:function(a,b){r(a,b)},animate:function(a,b,c,d){var e={};e[b]=c,a.animate(e,{duration:P.animateDuration,easing:P.animateEase,queue:!1,step:d})},getContentPositionX:function(){return A()},getContentPositionY:function(){return B()},getContentWidth:function(){return U},getContentHeight:function(){return V},getPercentScrolledX:function(){return A()/(U-R)},getPercentScrolledY:function(){return B()/(V-S)},getIsScrollableH:function(){return Z},getIsScrollableV:function(){return Y},getContentPane:function(){return Q},scrollToBottom:function(a){r(_,a)},hijackInternalLinks:a.noop,destroy:function(){O()}}),f(e)}return d=a.extend({},a.fn.jScrollPane.defaults,d),a.each(["mouseWheelSpeed","arrowButtonSpeed","trackClickSpeed","keyboardSpeed"],function(){d[this]=d[this]||d.speed}),this.each(function(){var b=a(this),c=b.data("jsp");c?c.reinitialise(d):(a("script",b).filter('[type="text/javascript"],:not([type])').remove(),c=new e(b,d),b.data("jsp",c))})},a.fn.jScrollPane.defaults={showArrows:!1,maintainPosition:!0,stickToBottom:!1,stickToRight:!1,clickOnTrack:!0,autoReinitialise:!1,autoReinitialiseDelay:500,verticalDragMinHeight:0,verticalDragMaxHeight:99999,horizontalDragMinWidth:0,horizontalDragMaxWidth:99999,contentWidth:c,animateScroll:!1,animateDuration:300,animateEase:"linear",hijackInternalLinks:!1,verticalGutter:4,horizontalGutter:4,mouseWheelSpeed:0,arrowButtonSpeed:0,arrowRepeatFreq:50,arrowScrollOnHover:!1,trackClickSpeed:0,trackClickRepeatFreq:70,verticalArrowPositions:"split",horizontalArrowPositions:"split",enableKeyboardNavigation:!0,hideFocus:!1,keyboardSpeed:0,initialDelay:300,speed:30,scrollPagePercent:.8}}(jQuery,this),"object"!=typeof JSON&&(JSON={}),function(){"use strict";function f(a){return 10>a?"0"+a:a}function quote(a){return escapable.lastIndex=0,escapable.test(a)?'"'+a.replace(escapable,function(a){var b=meta[a];return"string"==typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function str(a,b){var c,d,e,f,g,h=gap,i=b[a];switch(i&&"object"==typeof i&&"function"==typeof i.toJSON&&(i=i.toJSON(a)),"function"==typeof rep&&(i=rep.call(b,a,i)),typeof i){case"string":return quote(i);case"number":return isFinite(i)?String(i):"null";case"boolean":case"null":return String(i);case"object":if(!i)return"null";if(gap+=indent,g=[],"[object Array]"===Object.prototype.toString.apply(i)){for(f=i.length,c=0;f>c;c+=1)g[c]=str(c,i)||"null";return e=0===g.length?"[]":gap?"[\n"+gap+g.join(",\n"+gap)+"\n"+h+"]":"["+g.join(",")+"]",gap=h,e}if(rep&&"object"==typeof rep)for(f=rep.length,c=0;f>c;c+=1)"string"==typeof rep[c]&&(d=rep[c],e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));else for(d in i)Object.prototype.hasOwnProperty.call(i,d)&&(e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));return e=0===g.length?"{}":gap?"{\n"+gap+g.join(",\n"+gap)+"\n"+h+"}":"{"+g.join(",")+"}",gap=h,e}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(a,b,c){var d;if(gap="",indent="","number"==typeof c)for(d=0;c>d;d+=1)indent+=" ";else"string"==typeof c&&(indent=c);if(rep=b,b&&"function"!=typeof b&&("object"!=typeof b||"number"!=typeof b.length))throw new Error("JSON.stringify");return str("",{"":a})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(a,b){var c,d,e=a[b];if(e&&"object"==typeof e)for(c in e)Object.prototype.hasOwnProperty.call(e,c)&&(d=walk(e,c),void 0!==d?e[c]=d:delete e[c]);return reviver.call(a,b,e)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),function(a,b,c){var d=a.L,e={};e.version="0.7.3","object"==typeof module&&"object"==typeof module.exports?module.exports=e:"function"==typeof define&&define.amd&&define(e),e.noConflict=function(){return a.L=d,this},a.L=e,e.Util={extend:function(a){var b,c,d,e,f=Array.prototype.slice.call(arguments,1);for(c=0,d=f.length;d>c;c++){e=f[c]||{};for(b in e)e.hasOwnProperty(b)&&(a[b]=e[b])}return a},bind:function(a,b){var c=arguments.length>2?Array.prototype.slice.call(arguments,2):null;return function(){return a.apply(b,c||arguments)}},stamp:function(){var a=0,b="_leaflet_id";return function(c){return c[b]=c[b]||++a,c[b]}}(),invokeEach:function(a,b,c){var d,e;if("object"==typeof a){e=Array.prototype.slice.call(arguments,3);for(d in a)b.apply(c,[d,a[d]].concat(e));return!0}return!1},limitExecByInterval:function(a,b,c){var d,e;return function f(){var g=arguments;return d?void(e=!0):(d=!0,setTimeout(function(){d=!1,e&&(f.apply(c,g),e=!1)},b),void a.apply(c,g))}},falseFn:function(){return!1},formatNum:function(a,b){var c=Math.pow(10,b||5);return Math.round(a*c)/c},trim:function(a){return a.trim?a.trim():a.replace(/^\s+|\s+$/g,"")},splitWords:function(a){return e.Util.trim(a).split(/\s+/)},setOptions:function(a,b){return a.options=e.extend({},a.options,b),a.options},getParamString:function(a,b,c){var d=[];for(var e in a)d.push(encodeURIComponent(c?e.toUpperCase():e)+"="+encodeURIComponent(a[e]));return(b&&-1!==b.indexOf("?")?"&":"?")+d.join("&")},template:function(a,b){return a.replace(/\{ *([\w_]+) *\}/g,function(a,d){var e=b[d];if(e===c)throw new Error("No value provided for variable "+a);return"function"==typeof e&&(e=e(b)),e})},isArray:Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)},emptyImageUrl:"data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="},function(){function b(b){var c,d,e=["webkit","moz","o","ms"];for(c=0;c<e.length&&!d;c++)d=a[e[c]+b];return d}function c(b){var c=+new Date,e=Math.max(0,16-(c-d));return d=c+e,a.setTimeout(b,e)}var d=0,f=a.requestAnimationFrame||b("RequestAnimationFrame")||c,g=a.cancelAnimationFrame||b("CancelAnimationFrame")||b("CancelRequestAnimationFrame")||function(b){a.clearTimeout(b)};e.Util.requestAnimFrame=function(b,d,g,h){return b=e.bind(b,d),g&&f===c?void b():f.call(a,b,h)},e.Util.cancelAnimFrame=function(b){b&&g.call(a,b)}}(),e.extend=e.Util.extend,e.bind=e.Util.bind,e.stamp=e.Util.stamp,e.setOptions=e.Util.setOptions,e.Class=function(){},e.Class.extend=function(a){var b=function(){this.initialize&&this.initialize.apply(this,arguments),this._initHooks&&this.callInitHooks()},c=function(){};c.prototype=this.prototype;var d=new c;d.constructor=b,b.prototype=d;for(var f in this)this.hasOwnProperty(f)&&"prototype"!==f&&(b[f]=this[f]);a.statics&&(e.extend(b,a.statics),delete a.statics),a.includes&&(e.Util.extend.apply(null,[d].concat(a.includes)),delete a.includes),a.options&&d.options&&(a.options=e.extend({},d.options,a.options)),e.extend(d,a),d._initHooks=[];var g=this;return b.__super__=g.prototype,d.callInitHooks=function(){if(!this._initHooksCalled){g.prototype.callInitHooks&&g.prototype.callInitHooks.call(this),this._initHooksCalled=!0;for(var a=0,b=d._initHooks.length;b>a;a++)d._initHooks[a].call(this)}},b},e.Class.include=function(a){e.extend(this.prototype,a)},e.Class.mergeOptions=function(a){e.extend(this.prototype.options,a)},e.Class.addInitHook=function(a){var b=Array.prototype.slice.call(arguments,1),c="function"==typeof a?a:function(){this[a].apply(this,b)};this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(c)};var f="_leaflet_events";e.Mixin={},e.Mixin.Events={addEventListener:function(a,b,c){if(e.Util.invokeEach(a,this.addEventListener,this,b,c))return this;var d,g,h,i,j,k,l,m=this[f]=this[f]||{},n=c&&c!==this&&e.stamp(c);for(a=e.Util.splitWords(a),d=0,g=a.length;g>d;d++)h={action:b,context:c||this},i=a[d],n?(j=i+"_idx",k=j+"_len",l=m[j]=m[j]||{},l[n]||(l[n]=[],m[k]=(m[k]||0)+1),l[n].push(h)):(m[i]=m[i]||[],m[i].push(h));return this},hasEventListeners:function(a){var b=this[f];return!!b&&(a in b&&b[a].length>0||a+"_idx"in b&&b[a+"_idx_len"]>0)},removeEventListener:function(a,b,c){if(!this[f])return this;if(!a)return this.clearAllEventListeners();if(e.Util.invokeEach(a,this.removeEventListener,this,b,c))return this;var d,g,h,i,j,k,l,m,n,o=this[f],p=c&&c!==this&&e.stamp(c);for(a=e.Util.splitWords(a),d=0,g=a.length;g>d;d++)if(h=a[d],k=h+"_idx",l=k+"_len",m=o[k],b){if(i=p&&m?m[p]:o[h]){for(j=i.length-1;j>=0;j--)i[j].action!==b||c&&i[j].context!==c||(n=i.splice(j,1),n[0].action=e.Util.falseFn);c&&m&&0===i.length&&(delete m[p],o[l]--)}}else delete o[h],delete o[k],delete o[l];return this},clearAllEventListeners:function(){return delete this[f],this},fireEvent:function(a,b){if(!this.hasEventListeners(a))return this;var c,d,g,h,i,j=e.Util.extend({},b,{type:a,target:this}),k=this[f];if(k[a])for(c=k[a].slice(),d=0,g=c.length;g>d;d++)c[d].action.call(c[d].context,j);h=k[a+"_idx"];for(i in h)if(c=h[i].slice())for(d=0,g=c.length;g>d;d++)c[d].action.call(c[d].context,j);return this},addOneTimeEventListener:function(a,b,c){if(e.Util.invokeEach(a,this.addOneTimeEventListener,this,b,c))return this;var d=e.bind(function(){this.removeEventListener(a,b,c).removeEventListener(a,d,c)},this);return this.addEventListener(a,b,c).addEventListener(a,d,c)}},e.Mixin.Events.on=e.Mixin.Events.addEventListener,e.Mixin.Events.off=e.Mixin.Events.removeEventListener,e.Mixin.Events.once=e.Mixin.Events.addOneTimeEventListener,e.Mixin.Events.fire=e.Mixin.Events.fireEvent,function(){var d="ActiveXObject"in a,f=d&&!b.addEventListener,g=navigator.userAgent.toLowerCase(),h=-1!==g.indexOf("webkit"),i=-1!==g.indexOf("chrome"),j=-1!==g.indexOf("phantom"),k=-1!==g.indexOf("android"),l=-1!==g.search("android [23]"),m=-1!==g.indexOf("gecko"),n=typeof orientation!=c+"",o=a.navigator&&a.navigator.msPointerEnabled&&a.navigator.msMaxTouchPoints&&!a.PointerEvent,p=a.PointerEvent&&a.navigator.pointerEnabled&&a.navigator.maxTouchPoints||o,q="devicePixelRatio"in a&&a.devicePixelRatio>1||"matchMedia"in a&&a.matchMedia("(min-resolution:144dpi)")&&a.matchMedia("(min-resolution:144dpi)").matches,r=b.documentElement,s=d&&"transition"in r.style,t="WebKitCSSMatrix"in a&&"m11"in new a.WebKitCSSMatrix&&!l,u="MozPerspective"in r.style,v="OTransition"in r.style,w=!a.L_DISABLE_3D&&(s||t||u||v)&&!j,x=!a.L_NO_TOUCH&&!j&&function(){var a="ontouchstart";if(p||a in r)return!0;var c=b.createElement("div"),d=!1;return c.setAttribute?(c.setAttribute(a,"return;"),"function"==typeof c[a]&&(d=!0),c.removeAttribute(a),c=null,d):!1}();e.Browser={ie:d,ielt9:f,webkit:h,gecko:m&&!h&&!a.opera&&!d,android:k,android23:l,chrome:i,ie3d:s,webkit3d:t,gecko3d:u,opera3d:v,any3d:w,mobile:n,mobileWebkit:n&&h,mobileWebkit3d:n&&t,mobileOpera:n&&a.opera,touch:x,msPointer:o,pointer:p,retina:q}}(),e.Point=function(a,b,c){this.x=c?Math.round(a):a,this.y=c?Math.round(b):b},e.Point.prototype={clone:function(){return new e.Point(this.x,this.y)},add:function(a){return this.clone()._add(e.point(a))},_add:function(a){return this.x+=a.x,this.y+=a.y,this},subtract:function(a){return this.clone()._subtract(e.point(a))},_subtract:function(a){return this.x-=a.x,this.y-=a.y,this},divideBy:function(a){return this.clone()._divideBy(a)},_divideBy:function(a){return this.x/=a,this.y/=a,this},multiplyBy:function(a){return this.clone()._multiplyBy(a)},_multiplyBy:function(a){return this.x*=a,this.y*=a,this},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},distanceTo:function(a){a=e.point(a);var b=a.x-this.x,c=a.y-this.y;return Math.sqrt(b*b+c*c)},equals:function(a){return a=e.point(a),a.x===this.x&&a.y===this.y},contains:function(a){return a=e.point(a),Math.abs(a.x)<=Math.abs(this.x)&&Math.abs(a.y)<=Math.abs(this.y)},toString:function(){return"Point("+e.Util.formatNum(this.x)+", "+e.Util.formatNum(this.y)+")"}},e.point=function(a,b,d){return a instanceof e.Point?a:e.Util.isArray(a)?new e.Point(a[0],a[1]):a===c||null===a?a:new e.Point(a,b,d)},e.Bounds=function(a,b){if(a)for(var c=b?[a,b]:a,d=0,e=c.length;e>d;d++)this.extend(c[d])},e.Bounds.prototype={extend:function(a){return a=e.point(a),this.min||this.max?(this.min.x=Math.min(a.x,this.min.x),this.max.x=Math.max(a.x,this.max.x),this.min.y=Math.min(a.y,this.min.y),this.max.y=Math.max(a.y,this.max.y)):(this.min=a.clone(),this.max=a.clone()),this},getCenter:function(a){return new e.Point((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,a)},getBottomLeft:function(){return new e.Point(this.min.x,this.max.y)},getTopRight:function(){return new e.Point(this.max.x,this.min.y)},getSize:function(){return this.max.subtract(this.min)},contains:function(a){var b,c;return a="number"==typeof a[0]||a instanceof e.Point?e.point(a):e.bounds(a),a instanceof e.Bounds?(b=a.min,c=a.max):b=c=a,b.x>=this.min.x&&c.x<=this.max.x&&b.y>=this.min.y&&c.y<=this.max.y},intersects:function(a){a=e.bounds(a);var b=this.min,c=this.max,d=a.min,f=a.max,g=f.x>=b.x&&d.x<=c.x,h=f.y>=b.y&&d.y<=c.y;return g&&h},isValid:function(){return!(!this.min||!this.max)}},e.bounds=function(a,b){return!a||a instanceof e.Bounds?a:new e.Bounds(a,b)},e.Transformation=function(a,b,c,d){this._a=a,this._b=b,this._c=c,this._d=d},e.Transformation.prototype={transform:function(a,b){return this._transform(a.clone(),b)},_transform:function(a,b){return b=b||1,a.x=b*(this._a*a.x+this._b),a.y=b*(this._c*a.y+this._d),a},untransform:function(a,b){return b=b||1,new e.Point((a.x/b-this._b)/this._a,(a.y/b-this._d)/this._c)}},e.DomUtil={get:function(a){return"string"==typeof a?b.getElementById(a):a},getStyle:function(a,c){var d=a.style[c];if(!d&&a.currentStyle&&(d=a.currentStyle[c]),(!d||"auto"===d)&&b.defaultView){var e=b.defaultView.getComputedStyle(a,null);d=e?e[c]:null}return"auto"===d?null:d},getViewportOffset:function(a){var c,d=0,f=0,g=a,h=b.body,i=b.documentElement;do{if(d+=g.offsetTop||0,f+=g.offsetLeft||0,d+=parseInt(e.DomUtil.getStyle(g,"borderTopWidth"),10)||0,f+=parseInt(e.DomUtil.getStyle(g,"borderLeftWidth"),10)||0,c=e.DomUtil.getStyle(g,"position"),g.offsetParent===h&&"absolute"===c)break;if("fixed"===c){d+=h.scrollTop||i.scrollTop||0,f+=h.scrollLeft||i.scrollLeft||0;break}if("relative"===c&&!g.offsetLeft){var j=e.DomUtil.getStyle(g,"width"),k=e.DomUtil.getStyle(g,"max-width"),l=g.getBoundingClientRect();("none"!==j||"none"!==k)&&(f+=l.left+g.clientLeft),d+=l.top+(h.scrollTop||i.scrollTop||0);break}g=g.offsetParent}while(g);g=a;do{if(g===h)break;d-=g.scrollTop||0,f-=g.scrollLeft||0,g=g.parentNode}while(g);return new e.Point(f,d)},documentIsLtr:function(){return e.DomUtil._docIsLtrCached||(e.DomUtil._docIsLtrCached=!0,e.DomUtil._docIsLtr="ltr"===e.DomUtil.getStyle(b.body,"direction")),e.DomUtil._docIsLtr},create:function(a,c,d){var e=b.createElement(a);return e.className=c,d&&d.appendChild(e),e},hasClass:function(a,b){if(a.classList!==c)return a.classList.contains(b);var d=e.DomUtil._getClass(a);return d.length>0&&new RegExp("(^|\\s)"+b+"(\\s|$)").test(d)},addClass:function(a,b){if(a.classList!==c)for(var d=e.Util.splitWords(b),f=0,g=d.length;g>f;f++)a.classList.add(d[f]);else if(!e.DomUtil.hasClass(a,b)){var h=e.DomUtil._getClass(a);e.DomUtil._setClass(a,(h?h+" ":"")+b)}},removeClass:function(a,b){a.classList!==c?a.classList.remove(b):e.DomUtil._setClass(a,e.Util.trim((" "+e.DomUtil._getClass(a)+" ").replace(" "+b+" "," ")))},_setClass:function(a,b){a.className.baseVal===c?a.className=b:a.className.baseVal=b},_getClass:function(a){return a.className.baseVal===c?a.className:a.className.baseVal},setOpacity:function(a,b){if("opacity"in a.style)a.style.opacity=b;else if("filter"in a.style){var c=!1,d="DXImageTransform.Microsoft.Alpha";try{c=a.filters.item(d)}catch(e){if(1===b)return}b=Math.round(100*b),c?(c.Enabled=100!==b,c.Opacity=b):a.style.filter+=" progid:"+d+"(opacity="+b+")"}},testProp:function(a){for(var c=b.documentElement.style,d=0;d<a.length;d++)if(a[d]in c)return a[d];return!1},getTranslateString:function(a){var b=e.Browser.webkit3d,c="translate"+(b?"3d":"")+"(",d=(b?",0":"")+")";return c+a.x+"px,"+a.y+"px"+d},getScaleString:function(a,b){var c=e.DomUtil.getTranslateString(b.add(b.multiplyBy(-1*a))),d=" scale("+a+") ";return c+d},setPosition:function(a,b,c){a._leaflet_pos=b,!c&&e.Browser.any3d?a.style[e.DomUtil.TRANSFORM]=e.DomUtil.getTranslateString(b):(a.style.left=b.x+"px",a.style.top=b.y+"px")},getPosition:function(a){return a._leaflet_pos}},e.DomUtil.TRANSFORM=e.DomUtil.testProp(["transform","WebkitTransform","OTransform","MozTransform","msTransform"]),e.DomUtil.TRANSITION=e.DomUtil.testProp(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),e.DomUtil.TRANSITION_END="webkitTransition"===e.DomUtil.TRANSITION||"OTransition"===e.DomUtil.TRANSITION?e.DomUtil.TRANSITION+"End":"transitionend",function(){if("onselectstart"in b)e.extend(e.DomUtil,{disableTextSelection:function(){e.DomEvent.on(a,"selectstart",e.DomEvent.preventDefault)},enableTextSelection:function(){e.DomEvent.off(a,"selectstart",e.DomEvent.preventDefault)}});else{var c=e.DomUtil.testProp(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);e.extend(e.DomUtil,{disableTextSelection:function(){if(c){var a=b.documentElement.style;this._userSelect=a[c],a[c]="none"}},enableTextSelection:function(){c&&(b.documentElement.style[c]=this._userSelect,delete this._userSelect)}})}e.extend(e.DomUtil,{disableImageDrag:function(){e.DomEvent.on(a,"dragstart",e.DomEvent.preventDefault)},enableImageDrag:function(){e.DomEvent.off(a,"dragstart",e.DomEvent.preventDefault)}})}(),e.LatLng=function(a,b,d){if(a=parseFloat(a),b=parseFloat(b),isNaN(a)||isNaN(b))throw new Error("Invalid LatLng object: ("+a+", "+b+")");this.lat=a,this.lng=b,d!==c&&(this.alt=parseFloat(d))},e.extend(e.LatLng,{DEG_TO_RAD:Math.PI/180,RAD_TO_DEG:180/Math.PI,MAX_MARGIN:1e-9}),e.LatLng.prototype={equals:function(a){if(!a)return!1;a=e.latLng(a);var b=Math.max(Math.abs(this.lat-a.lat),Math.abs(this.lng-a.lng));return b<=e.LatLng.MAX_MARGIN},toString:function(a){return"LatLng("+e.Util.formatNum(this.lat,a)+", "+e.Util.formatNum(this.lng,a)+")"},distanceTo:function(a){a=e.latLng(a);var b=6378137,c=e.LatLng.DEG_TO_RAD,d=(a.lat-this.lat)*c,f=(a.lng-this.lng)*c,g=this.lat*c,h=a.lat*c,i=Math.sin(d/2),j=Math.sin(f/2),k=i*i+j*j*Math.cos(g)*Math.cos(h);return 2*b*Math.atan2(Math.sqrt(k),Math.sqrt(1-k))},wrap:function(a,b){var c=this.lng;return a=a||-180,b=b||180,c=(c+b)%(b-a)+(a>c||c===b?b:a),new e.LatLng(this.lat,c)}},e.latLng=function(a,b){return a instanceof e.LatLng?a:e.Util.isArray(a)?"number"==typeof a[0]||"string"==typeof a[0]?new e.LatLng(a[0],a[1],a[2]):null:a===c||null===a?a:"object"==typeof a&&"lat"in a?new e.LatLng(a.lat,"lng"in a?a.lng:a.lon):b===c?null:new e.LatLng(a,b)},e.LatLngBounds=function(a,b){if(a)for(var c=b?[a,b]:a,d=0,e=c.length;e>d;d++)this.extend(c[d])},e.LatLngBounds.prototype={extend:function(a){if(!a)return this;var b=e.latLng(a);return a=null!==b?b:e.latLngBounds(a),a instanceof e.LatLng?this._southWest||this._northEast?(this._southWest.lat=Math.min(a.lat,this._southWest.lat),this._southWest.lng=Math.min(a.lng,this._southWest.lng),this._northEast.lat=Math.max(a.lat,this._northEast.lat),this._northEast.lng=Math.max(a.lng,this._northEast.lng)):(this._southWest=new e.LatLng(a.lat,a.lng),this._northEast=new e.LatLng(a.lat,a.lng)):a instanceof e.LatLngBounds&&(this.extend(a._southWest),this.extend(a._northEast)),this},pad:function(a){var b=this._southWest,c=this._northEast,d=Math.abs(b.lat-c.lat)*a,f=Math.abs(b.lng-c.lng)*a;return new e.LatLngBounds(new e.LatLng(b.lat-d,b.lng-f),new e.LatLng(c.lat+d,c.lng+f))},getCenter:function(){return new e.LatLng((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new e.LatLng(this.getNorth(),this.getWest())},getSouthEast:function(){return new e.LatLng(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(a){a="number"==typeof a[0]||a instanceof e.LatLng?e.latLng(a):e.latLngBounds(a);var b,c,d=this._southWest,f=this._northEast;return a instanceof e.LatLngBounds?(b=a.getSouthWest(),c=a.getNorthEast()):b=c=a,b.lat>=d.lat&&c.lat<=f.lat&&b.lng>=d.lng&&c.lng<=f.lng},intersects:function(a){a=e.latLngBounds(a);var b=this._southWest,c=this._northEast,d=a.getSouthWest(),f=a.getNorthEast(),g=f.lat>=b.lat&&d.lat<=c.lat,h=f.lng>=b.lng&&d.lng<=c.lng;return g&&h},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(a){return a?(a=e.latLngBounds(a),this._southWest.equals(a.getSouthWest())&&this._northEast.equals(a.getNorthEast())):!1},isValid:function(){return!(!this._southWest||!this._northEast)}},e.latLngBounds=function(a,b){return!a||a instanceof e.LatLngBounds?a:new e.LatLngBounds(a,b)},e.Projection={},e.Projection.SphericalMercator={MAX_LATITUDE:85.0511287798,project:function(a){var b=e.LatLng.DEG_TO_RAD,c=this.MAX_LATITUDE,d=Math.max(Math.min(c,a.lat),-c),f=a.lng*b,g=d*b;return g=Math.log(Math.tan(Math.PI/4+g/2)),new e.Point(f,g)},unproject:function(a){var b=e.LatLng.RAD_TO_DEG,c=a.x*b,d=(2*Math.atan(Math.exp(a.y))-Math.PI/2)*b;return new e.LatLng(d,c)}},e.Projection.LonLat={project:function(a){return new e.Point(a.lng,a.lat)},unproject:function(a){return new e.LatLng(a.y,a.x)}},e.CRS={latLngToPoint:function(a,b){var c=this.projection.project(a),d=this.scale(b);return this.transformation._transform(c,d)},pointToLatLng:function(a,b){var c=this.scale(b),d=this.transformation.untransform(a,c);return this.projection.unproject(d)},project:function(a){return this.projection.project(a)},scale:function(a){return 256*Math.pow(2,a)},getSize:function(a){var b=this.scale(a);return e.point(b,b)}},e.CRS.Simple=e.extend({},e.CRS,{projection:e.Projection.LonLat,transformation:new e.Transformation(1,0,-1,0),scale:function(a){return Math.pow(2,a)}}),e.CRS.EPSG3857=e.extend({},e.CRS,{code:"EPSG:3857",projection:e.Projection.SphericalMercator,transformation:new e.Transformation(.5/Math.PI,.5,-.5/Math.PI,.5),project:function(a){var b=this.projection.project(a),c=6378137;return b.multiplyBy(c)}}),e.CRS.EPSG900913=e.extend({},e.CRS.EPSG3857,{code:"EPSG:900913"}),e.CRS.EPSG4326=e.extend({},e.CRS,{code:"EPSG:4326",projection:e.Projection.LonLat,transformation:new e.Transformation(1/360,.5,-1/360,.5)}),e.Map=e.Class.extend({includes:e.Mixin.Events,options:{crs:e.CRS.EPSG3857,fadeAnimation:e.DomUtil.TRANSITION&&!e.Browser.android23,trackResize:!0,markerZoomAnimation:e.DomUtil.TRANSITION&&e.Browser.any3d},initialize:function(a,b){b=e.setOptions(this,b),this._initContainer(a),this._initLayout(),this._onResize=e.bind(this._onResize,this),this._initEvents(),b.maxBounds&&this.setMaxBounds(b.maxBounds),b.center&&b.zoom!==c&&this.setView(e.latLng(b.center),b.zoom,{reset:!0}),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._tileLayersNum=0,this.callInitHooks(),this._addLayers(b.layers)},setView:function(a,b){return b=b===c?this.getZoom():b,this._resetView(e.latLng(a),this._limitZoom(b)),this},setZoom:function(a,b){return this._loaded?this.setView(this.getCenter(),a,{zoom:b}):(this._zoom=this._limitZoom(a),this)},zoomIn:function(a,b){return this.setZoom(this._zoom+(a||1),b)},zoomOut:function(a,b){return this.setZoom(this._zoom-(a||1),b)},setZoomAround:function(a,b,c){var d=this.getZoomScale(b),f=this.getSize().divideBy(2),g=a instanceof e.Point?a:this.latLngToContainerPoint(a),h=g.subtract(f).multiplyBy(1-1/d),i=this.containerPointToLatLng(f.add(h));return this.setView(i,b,{zoom:c})},fitBounds:function(a,b){b=b||{},a=a.getBounds?a.getBounds():e.latLngBounds(a);var c=e.point(b.paddingTopLeft||b.padding||[0,0]),d=e.point(b.paddingBottomRight||b.padding||[0,0]),f=this.getBoundsZoom(a,!1,c.add(d)),g=d.subtract(c).divideBy(2),h=this.project(a.getSouthWest(),f),i=this.project(a.getNorthEast(),f),j=this.unproject(h.add(i).divideBy(2).add(g),f);return f=b&&b.maxZoom?Math.min(b.maxZoom,f):f,this.setView(j,f,b)},fitWorld:function(a){return this.fitBounds([[-90,-180],[90,180]],a)},panTo:function(a,b){return this.setView(a,this._zoom,{pan:b})},panBy:function(a){return this.fire("movestart"),this._rawPanBy(e.point(a)),this.fire("move"),this.fire("moveend")},setMaxBounds:function(a){return a=e.latLngBounds(a),this.options.maxBounds=a,a?(this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds,this)):this.off("moveend",this._panInsideMaxBounds,this)},panInsideBounds:function(a,b){var c=this.getCenter(),d=this._limitCenter(c,this._zoom,a);return c.equals(d)?this:this.panTo(d,b)},addLayer:function(a){var b=e.stamp(a);return this._layers[b]?this:(this._layers[b]=a,!a.options||isNaN(a.options.maxZoom)&&isNaN(a.options.minZoom)||(this._zoomBoundLayers[b]=a,this._updateZoomLevels()),this.options.zoomAnimation&&e.TileLayer&&a instanceof e.TileLayer&&(this._tileLayersNum++,this._tileLayersToLoad++,a.on("load",this._onTileLayerLoad,this)),this._loaded&&this._layerAdd(a),this)},removeLayer:function(a){var b=e.stamp(a);return this._layers[b]?(this._loaded&&a.onRemove(this),delete this._layers[b],this._loaded&&this.fire("layerremove",{layer:a}),this._zoomBoundLayers[b]&&(delete this._zoomBoundLayers[b],this._updateZoomLevels()),this.options.zoomAnimation&&e.TileLayer&&a instanceof e.TileLayer&&(this._tileLayersNum--,this._tileLayersToLoad--,a.off("load",this._onTileLayerLoad,this)),this):this},hasLayer:function(a){return a?e.stamp(a)in this._layers:!1},eachLayer:function(a,b){for(var c in this._layers)a.call(b,this._layers[c]);return this},invalidateSize:function(a){if(!this._loaded)return this;a=e.extend({animate:!1,pan:!0},a===!0?{animate:!0}:a);var b=this.getSize();this._sizeChanged=!0,this._initialCenter=null;var c=this.getSize(),d=b.divideBy(2).round(),f=c.divideBy(2).round(),g=d.subtract(f);return g.x||g.y?(a.animate&&a.pan?this.panBy(g):(a.pan&&this._rawPanBy(g),this.fire("move"),a.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(e.bind(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:b,newSize:c})):this},addHandler:function(a,b){if(!b)return this;var c=this[a]=new b(this);return this._handlers.push(c),this.options[a]&&c.enable(),this},remove:function(){this._loaded&&this.fire("unload"),this._initEvents("off");try{delete this._container._leaflet}catch(a){this._container._leaflet=c}return this._clearPanes(),this._clearControlPos&&this._clearControlPos(),this._clearHandlers(),this},getCenter:function(){return this._checkIfLoaded(),this._initialCenter&&!this._moved()?this._initialCenter:this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var a=this.getPixelBounds(),b=this.unproject(a.getBottomLeft()),c=this.unproject(a.getTopRight());return new e.LatLngBounds(b,c)},getMinZoom:function(){return this.options.minZoom===c?this._layersMinZoom===c?0:this._layersMinZoom:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===c?this._layersMaxZoom===c?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(a,b,c){a=e.latLngBounds(a);var d,f=this.getMinZoom()-(b?1:0),g=this.getMaxZoom(),h=this.getSize(),i=a.getNorthWest(),j=a.getSouthEast(),k=!0;c=e.point(c||[0,0]);do f++,d=this.project(j,f).subtract(this.project(i,f)).add(c),k=b?d.x<h.x||d.y<h.y:h.contains(d);while(k&&g>=f);return k&&b?null:b?f:f-1},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new e.Point(this._container.clientWidth,this._container.clientHeight),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(){var a=this._getTopLeftPoint();return new e.Bounds(a,a.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._initialTopLeftPoint},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(a){var b=this.options.crs;return b.scale(a)/b.scale(this._zoom)},getScaleZoom:function(a){return this._zoom+Math.log(a)/Math.LN2},project:function(a,b){return b=b===c?this._zoom:b,this.options.crs.latLngToPoint(e.latLng(a),b)},unproject:function(a,b){return b=b===c?this._zoom:b,this.options.crs.pointToLatLng(e.point(a),b)},layerPointToLatLng:function(a){var b=e.point(a).add(this.getPixelOrigin());return this.unproject(b)},latLngToLayerPoint:function(a){var b=this.project(e.latLng(a))._round();return b._subtract(this.getPixelOrigin())},containerPointToLayerPoint:function(a){return e.point(a).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(a){return e.point(a).add(this._getMapPanePos())},containerPointToLatLng:function(a){var b=this.containerPointToLayerPoint(e.point(a));return this.layerPointToLatLng(b)},latLngToContainerPoint:function(a){return this.layerPointToContainerPoint(this.latLngToLayerPoint(e.latLng(a)))},mouseEventToContainerPoint:function(a){return e.DomEvent.getMousePosition(a,this._container)},mouseEventToLayerPoint:function(a){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(a))},mouseEventToLatLng:function(a){return this.layerPointToLatLng(this.mouseEventToLayerPoint(a))},_initContainer:function(a){var b=this._container=e.DomUtil.get(a);if(!b)throw new Error("Map container not found.");if(b._leaflet)throw new Error("Map container is already initialized.");b._leaflet=!0},_initLayout:function(){var a=this._container;e.DomUtil.addClass(a,"leaflet-container"+(e.Browser.touch?" leaflet-touch":"")+(e.Browser.retina?" leaflet-retina":"")+(e.Browser.ielt9?" leaflet-oldie":"")+(this.options.fadeAnimation?" leaflet-fade-anim":""));var b=e.DomUtil.getStyle(a,"position");"absolute"!==b&&"relative"!==b&&"fixed"!==b&&(a.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var a=this._panes={};this._mapPane=a.mapPane=this._createPane("leaflet-map-pane",this._container),this._tilePane=a.tilePane=this._createPane("leaflet-tile-pane",this._mapPane),a.objectsPane=this._createPane("leaflet-objects-pane",this._mapPane),a.shadowPane=this._createPane("leaflet-shadow-pane"),a.overlayPane=this._createPane("leaflet-overlay-pane"),a.markerPane=this._createPane("leaflet-marker-pane"),a.popupPane=this._createPane("leaflet-popup-pane");var b=" leaflet-zoom-hide";this.options.markerZoomAnimation||(e.DomUtil.addClass(a.markerPane,b),e.DomUtil.addClass(a.shadowPane,b),e.DomUtil.addClass(a.popupPane,b))},_createPane:function(a,b){return e.DomUtil.create("div",a,b||this._panes.objectsPane)},_clearPanes:function(){this._container.removeChild(this._mapPane)},_addLayers:function(a){a=a?e.Util.isArray(a)?a:[a]:[];for(var b=0,c=a.length;c>b;b++)this.addLayer(a[b])},_resetView:function(a,b,c,d){var f=this._zoom!==b;d||(this.fire("movestart"),f&&this.fire("zoomstart")),this._zoom=b,this._initialCenter=a,this._initialTopLeftPoint=this._getNewTopLeftPoint(a),c?this._initialTopLeftPoint._add(this._getMapPanePos()):e.DomUtil.setPosition(this._mapPane,new e.Point(0,0)),this._tileLayersToLoad=this._tileLayersNum;
var g=!this._loaded;this._loaded=!0,this.fire("viewreset",{hard:!c}),g&&(this.fire("load"),this.eachLayer(this._layerAdd,this)),this.fire("move"),(f||d)&&this.fire("zoomend"),this.fire("moveend",{hard:!c})},_rawPanBy:function(a){e.DomUtil.setPosition(this._mapPane,this._getMapPanePos().subtract(a))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_updateZoomLevels:function(){var a,b=1/0,d=-1/0,e=this._getZoomSpan();for(a in this._zoomBoundLayers){var f=this._zoomBoundLayers[a];isNaN(f.options.minZoom)||(b=Math.min(b,f.options.minZoom)),isNaN(f.options.maxZoom)||(d=Math.max(d,f.options.maxZoom))}a===c?this._layersMaxZoom=this._layersMinZoom=c:(this._layersMaxZoom=d,this._layersMinZoom=b),e!==this._getZoomSpan()&&this.fire("zoomlevelschange")},_panInsideMaxBounds:function(){this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(b){if(e.DomEvent){b=b||"on",e.DomEvent[b](this._container,"click",this._onMouseClick,this);var c,d,f=["dblclick","mousedown","mouseup","mouseenter","mouseleave","mousemove","contextmenu"];for(c=0,d=f.length;d>c;c++)e.DomEvent[b](this._container,f[c],this._fireMouseEvent,this);this.options.trackResize&&e.DomEvent[b](a,"resize",this._onResize,this)}},_onResize:function(){e.Util.cancelAnimFrame(this._resizeRequest),this._resizeRequest=e.Util.requestAnimFrame(function(){this.invalidateSize({debounceMoveend:!0})},this,!1,this._container)},_onMouseClick:function(a){!this._loaded||!a._simulated&&(this.dragging&&this.dragging.moved()||this.boxZoom&&this.boxZoom.moved())||e.DomEvent._skipped(a)||(this.fire("preclick"),this._fireMouseEvent(a))},_fireMouseEvent:function(a){if(this._loaded&&!e.DomEvent._skipped(a)){var b=a.type;if(b="mouseenter"===b?"mouseover":"mouseleave"===b?"mouseout":b,this.hasEventListeners(b)){"contextmenu"===b&&e.DomEvent.preventDefault(a);var c=this.mouseEventToContainerPoint(a),d=this.containerPointToLayerPoint(c),f=this.layerPointToLatLng(d);this.fire(b,{latlng:f,layerPoint:d,containerPoint:c,originalEvent:a})}}},_onTileLayerLoad:function(){this._tileLayersToLoad--,this._tileLayersNum&&!this._tileLayersToLoad&&this.fire("tilelayersload")},_clearHandlers:function(){for(var a=0,b=this._handlers.length;b>a;a++)this._handlers[a].disable()},whenReady:function(a,b){return this._loaded?a.call(b||this,this):this.on("load",a,b),this},_layerAdd:function(a){a.onAdd(this),this.fire("layeradd",{layer:a})},_getMapPanePos:function(){return e.DomUtil.getPosition(this._mapPane)},_moved:function(){var a=this._getMapPanePos();return a&&!a.equals([0,0])},_getTopLeftPoint:function(){return this.getPixelOrigin().subtract(this._getMapPanePos())},_getNewTopLeftPoint:function(a,b){var c=this.getSize()._divideBy(2);return this.project(a,b)._subtract(c)._round()},_latLngToNewLayerPoint:function(a,b,c){var d=this._getNewTopLeftPoint(c,b).add(this._getMapPanePos());return this.project(a,b)._subtract(d)},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(a){return this.latLngToLayerPoint(a).subtract(this._getCenterLayerPoint())},_limitCenter:function(a,b,c){if(!c)return a;var d=this.project(a,b),f=this.getSize().divideBy(2),g=new e.Bounds(d.subtract(f),d.add(f)),h=this._getBoundsOffset(g,c,b);return this.unproject(d.add(h),b)},_limitOffset:function(a,b){if(!b)return a;var c=this.getPixelBounds(),d=new e.Bounds(c.min.add(a),c.max.add(a));return a.add(this._getBoundsOffset(d,b))},_getBoundsOffset:function(a,b,c){var d=this.project(b.getNorthWest(),c).subtract(a.min),f=this.project(b.getSouthEast(),c).subtract(a.max),g=this._rebound(d.x,-f.x),h=this._rebound(d.y,-f.y);return new e.Point(g,h)},_rebound:function(a,b){return a+b>0?Math.round(a-b)/2:Math.max(0,Math.ceil(a))-Math.max(0,Math.floor(b))},_limitZoom:function(a){var b=this.getMinZoom(),c=this.getMaxZoom();return Math.max(b,Math.min(c,a))}}),e.map=function(a,b){return new e.Map(a,b)},e.Projection.Mercator={MAX_LATITUDE:85.0840591556,R_MINOR:6356752.314245179,R_MAJOR:6378137,project:function(a){var b=e.LatLng.DEG_TO_RAD,c=this.MAX_LATITUDE,d=Math.max(Math.min(c,a.lat),-c),f=this.R_MAJOR,g=this.R_MINOR,h=a.lng*b*f,i=d*b,j=g/f,k=Math.sqrt(1-j*j),l=k*Math.sin(i);l=Math.pow((1-l)/(1+l),.5*k);var m=Math.tan(.5*(.5*Math.PI-i))/l;return i=-f*Math.log(m),new e.Point(h,i)},unproject:function(a){for(var b,c=e.LatLng.RAD_TO_DEG,d=this.R_MAJOR,f=this.R_MINOR,g=a.x*c/d,h=f/d,i=Math.sqrt(1-h*h),j=Math.exp(-a.y/d),k=Math.PI/2-2*Math.atan(j),l=15,m=1e-7,n=l,o=.1;Math.abs(o)>m&&--n>0;)b=i*Math.sin(k),o=Math.PI/2-2*Math.atan(j*Math.pow((1-b)/(1+b),.5*i))-k,k+=o;return new e.LatLng(k*c,g)}},e.CRS.EPSG3395=e.extend({},e.CRS,{code:"EPSG:3395",projection:e.Projection.Mercator,transformation:function(){var a=e.Projection.Mercator,b=a.R_MAJOR,c=.5/(Math.PI*b);return new e.Transformation(c,.5,-c,.5)}()}),e.TileLayer=e.Class.extend({includes:e.Mixin.Events,options:{minZoom:0,maxZoom:18,tileSize:256,subdomains:"abc",errorTileUrl:"",attribution:"",zoomOffset:0,opacity:1,unloadInvisibleTiles:e.Browser.mobile,updateWhenIdle:e.Browser.mobile},initialize:function(a,b){b=e.setOptions(this,b),b.detectRetina&&e.Browser.retina&&b.maxZoom>0&&(b.tileSize=Math.floor(b.tileSize/2),b.zoomOffset++,b.minZoom>0&&b.minZoom--,this.options.maxZoom--),b.bounds&&(b.bounds=e.latLngBounds(b.bounds)),this._url=a;var c=this.options.subdomains;"string"==typeof c&&(this.options.subdomains=c.split(""))},onAdd:function(a){this._map=a,this._animated=a._zoomAnimated,this._initContainer(),a.on({viewreset:this._reset,moveend:this._update},this),this._animated&&a.on({zoomanim:this._animateZoom,zoomend:this._endZoomAnim},this),this.options.updateWhenIdle||(this._limitedUpdate=e.Util.limitExecByInterval(this._update,150,this),a.on("move",this._limitedUpdate,this)),this._reset(),this._update()},addTo:function(a){return a.addLayer(this),this},onRemove:function(a){this._container.parentNode.removeChild(this._container),a.off({viewreset:this._reset,moveend:this._update},this),this._animated&&a.off({zoomanim:this._animateZoom,zoomend:this._endZoomAnim},this),this.options.updateWhenIdle||a.off("move",this._limitedUpdate,this),this._container=null,this._map=null},bringToFront:function(){var a=this._map._panes.tilePane;return this._container&&(a.appendChild(this._container),this._setAutoZIndex(a,Math.max)),this},bringToBack:function(){var a=this._map._panes.tilePane;return this._container&&(a.insertBefore(this._container,a.firstChild),this._setAutoZIndex(a,Math.min)),this},getAttribution:function(){return this.options.attribution},getContainer:function(){return this._container},setOpacity:function(a){return this.options.opacity=a,this._map&&this._updateOpacity(),this},setZIndex:function(a){return this.options.zIndex=a,this._updateZIndex(),this},setUrl:function(a,b){return this._url=a,b||this.redraw(),this},redraw:function(){return this._map&&(this._reset({hard:!0}),this._update()),this},_updateZIndex:function(){this._container&&this.options.zIndex!==c&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(a,b){var c,d,e,f=a.children,g=-b(1/0,-1/0);for(d=0,e=f.length;e>d;d++)f[d]!==this._container&&(c=parseInt(f[d].style.zIndex,10),isNaN(c)||(g=b(g,c)));this.options.zIndex=this._container.style.zIndex=(isFinite(g)?g:0)+b(1,-1)},_updateOpacity:function(){var a,b=this._tiles;if(e.Browser.ielt9)for(a in b)e.DomUtil.setOpacity(b[a],this.options.opacity);else e.DomUtil.setOpacity(this._container,this.options.opacity)},_initContainer:function(){var a=this._map._panes.tilePane;if(!this._container){if(this._container=e.DomUtil.create("div","leaflet-layer"),this._updateZIndex(),this._animated){var b="leaflet-tile-container";this._bgBuffer=e.DomUtil.create("div",b,this._container),this._tileContainer=e.DomUtil.create("div",b,this._container)}else this._tileContainer=this._container;a.appendChild(this._container),this.options.opacity<1&&this._updateOpacity()}},_reset:function(a){for(var b in this._tiles)this.fire("tileunload",{tile:this._tiles[b]});this._tiles={},this._tilesToLoad=0,this.options.reuseTiles&&(this._unusedTiles=[]),this._tileContainer.innerHTML="",this._animated&&a&&a.hard&&this._clearBgBuffer(),this._initContainer()},_getTileSize:function(){var a=this._map,b=a.getZoom()+this.options.zoomOffset,c=this.options.maxNativeZoom,d=this.options.tileSize;return c&&b>c&&(d=Math.round(a.getZoomScale(b)/a.getZoomScale(c)*d)),d},_update:function(){if(this._map){var a=this._map,b=a.getPixelBounds(),c=a.getZoom(),d=this._getTileSize();if(!(c>this.options.maxZoom||c<this.options.minZoom)){var f=e.bounds(b.min.divideBy(d)._floor(),b.max.divideBy(d)._floor());this._addTilesFromCenterOut(f),(this.options.unloadInvisibleTiles||this.options.reuseTiles)&&this._removeOtherTiles(f)}}},_addTilesFromCenterOut:function(a){var c,d,f,g=[],h=a.getCenter();for(c=a.min.y;c<=a.max.y;c++)for(d=a.min.x;d<=a.max.x;d++)f=new e.Point(d,c),this._tileShouldBeLoaded(f)&&g.push(f);var i=g.length;if(0!==i){g.sort(function(a,b){return a.distanceTo(h)-b.distanceTo(h)});var j=b.createDocumentFragment();for(this._tilesToLoad||this.fire("loading"),this._tilesToLoad+=i,d=0;i>d;d++)this._addTile(g[d],j);this._tileContainer.appendChild(j)}},_tileShouldBeLoaded:function(a){if(a.x+":"+a.y in this._tiles)return!1;var b=this.options;if(!b.continuousWorld){var c=this._getWrapTileNum();if(b.noWrap&&(a.x<0||a.x>=c.x)||a.y<0||a.y>=c.y)return!1}if(b.bounds){var d=b.tileSize,e=a.multiplyBy(d),f=e.add([d,d]),g=this._map.unproject(e),h=this._map.unproject(f);if(b.continuousWorld||b.noWrap||(g=g.wrap(),h=h.wrap()),!b.bounds.intersects([g,h]))return!1}return!0},_removeOtherTiles:function(a){var b,c,d,e;for(e in this._tiles)b=e.split(":"),c=parseInt(b[0],10),d=parseInt(b[1],10),(c<a.min.x||c>a.max.x||d<a.min.y||d>a.max.y)&&this._removeTile(e)},_removeTile:function(a){var b=this._tiles[a];this.fire("tileunload",{tile:b,url:b.src}),this.options.reuseTiles?(e.DomUtil.removeClass(b,"leaflet-tile-loaded"),this._unusedTiles.push(b)):b.parentNode===this._tileContainer&&this._tileContainer.removeChild(b),e.Browser.android||(b.onload=null,b.src=e.Util.emptyImageUrl),delete this._tiles[a]},_addTile:function(a,b){var c=this._getTilePos(a),d=this._getTile();e.DomUtil.setPosition(d,c,e.Browser.chrome),this._tiles[a.x+":"+a.y]=d,this._loadTile(d,a),d.parentNode!==this._tileContainer&&b.appendChild(d)},_getZoomForUrl:function(){var a=this.options,b=this._map.getZoom();return a.zoomReverse&&(b=a.maxZoom-b),b+=a.zoomOffset,a.maxNativeZoom?Math.min(b,a.maxNativeZoom):b},_getTilePos:function(a){var b=this._map.getPixelOrigin(),c=this._getTileSize();return a.multiplyBy(c).subtract(b)},getTileUrl:function(a){return e.Util.template(this._url,e.extend({s:this._getSubdomain(a),z:a.z,x:a.x,y:a.y},this.options))},_getWrapTileNum:function(){var a=this._map.options.crs,b=a.getSize(this._map.getZoom());return b.divideBy(this._getTileSize())._floor()},_adjustTilePoint:function(a){var b=this._getWrapTileNum();this.options.continuousWorld||this.options.noWrap||(a.x=(a.x%b.x+b.x)%b.x),this.options.tms&&(a.y=b.y-a.y-1),a.z=this._getZoomForUrl()},_getSubdomain:function(a){var b=Math.abs(a.x+a.y)%this.options.subdomains.length;return this.options.subdomains[b]},_getTile:function(){if(this.options.reuseTiles&&this._unusedTiles.length>0){var a=this._unusedTiles.pop();return this._resetTile(a),a}return this._createTile()},_resetTile:function(){},_createTile:function(){var a=e.DomUtil.create("img","leaflet-tile");return a.style.width=a.style.height=this._getTileSize()+"px",a.galleryimg="no",a.onselectstart=a.onmousemove=e.Util.falseFn,e.Browser.ielt9&&this.options.opacity!==c&&e.DomUtil.setOpacity(a,this.options.opacity),e.Browser.mobileWebkit3d&&(a.style.WebkitBackfaceVisibility="hidden"),a},_loadTile:function(a,b){a._layer=this,a.onload=this._tileOnLoad,a.onerror=this._tileOnError,this._adjustTilePoint(b),a.src=this.getTileUrl(b),this.fire("tileloadstart",{tile:a,url:a.src})},_tileLoaded:function(){this._tilesToLoad--,this._animated&&e.DomUtil.addClass(this._tileContainer,"leaflet-zoom-animated"),this._tilesToLoad||(this.fire("load"),this._animated&&(clearTimeout(this._clearBgBufferTimer),this._clearBgBufferTimer=setTimeout(e.bind(this._clearBgBuffer,this),500)))},_tileOnLoad:function(){var a=this._layer;this.src!==e.Util.emptyImageUrl&&(e.DomUtil.addClass(this,"leaflet-tile-loaded"),a.fire("tileload",{tile:this,url:this.src})),a._tileLoaded()},_tileOnError:function(){var a=this._layer;a.fire("tileerror",{tile:this,url:this.src});var b=a.options.errorTileUrl;b&&(this.src=b),a._tileLoaded()}}),e.tileLayer=function(a,b){return new e.TileLayer(a,b)},e.TileLayer.WMS=e.TileLayer.extend({defaultWmsParams:{service:"WMS",request:"GetMap",version:"1.1.1",layers:"",styles:"",format:"image/jpeg",transparent:!1},initialize:function(a,b){this._url=a;var c=e.extend({},this.defaultWmsParams),d=b.tileSize||this.options.tileSize;c.width=c.height=b.detectRetina&&e.Browser.retina?2*d:d;for(var f in b)this.options.hasOwnProperty(f)||"crs"===f||(c[f]=b[f]);this.wmsParams=c,e.setOptions(this,b)},onAdd:function(a){this._crs=this.options.crs||a.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var b=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[b]=this._crs.code,e.TileLayer.prototype.onAdd.call(this,a)},getTileUrl:function(a){var b=this._map,c=this.options.tileSize,d=a.multiplyBy(c),f=d.add([c,c]),g=this._crs.project(b.unproject(d,a.z)),h=this._crs.project(b.unproject(f,a.z)),i=this._wmsVersion>=1.3&&this._crs===e.CRS.EPSG4326?[h.y,g.x,g.y,h.x].join(","):[g.x,h.y,h.x,g.y].join(","),j=e.Util.template(this._url,{s:this._getSubdomain(a)});return j+e.Util.getParamString(this.wmsParams,j,!0)+"&BBOX="+i},setParams:function(a,b){return e.extend(this.wmsParams,a),b||this.redraw(),this}}),e.tileLayer.wms=function(a,b){return new e.TileLayer.WMS(a,b)},e.TileLayer.Canvas=e.TileLayer.extend({options:{async:!1},initialize:function(a){e.setOptions(this,a)},redraw:function(){this._map&&(this._reset({hard:!0}),this._update());for(var a in this._tiles)this._redrawTile(this._tiles[a]);return this},_redrawTile:function(a){this.drawTile(a,a._tilePoint,this._map._zoom)},_createTile:function(){var a=e.DomUtil.create("canvas","leaflet-tile");return a.width=a.height=this.options.tileSize,a.onselectstart=a.onmousemove=e.Util.falseFn,a},_loadTile:function(a,b){a._layer=this,a._tilePoint=b,this._redrawTile(a),this.options.async||this.tileDrawn(a)},drawTile:function(){},tileDrawn:function(a){this._tileOnLoad.call(a)}}),e.tileLayer.canvas=function(a){return new e.TileLayer.Canvas(a)},e.ImageOverlay=e.Class.extend({includes:e.Mixin.Events,options:{opacity:1},initialize:function(a,b,c){this._url=a,this._bounds=e.latLngBounds(b),e.setOptions(this,c)},onAdd:function(a){this._map=a,this._image||this._initImage(),a._panes.overlayPane.appendChild(this._image),a.on("viewreset",this._reset,this),a.options.zoomAnimation&&e.Browser.any3d&&a.on("zoomanim",this._animateZoom,this),this._reset()},onRemove:function(a){a.getPanes().overlayPane.removeChild(this._image),a.off("viewreset",this._reset,this),a.options.zoomAnimation&&a.off("zoomanim",this._animateZoom,this)},addTo:function(a){return a.addLayer(this),this},setOpacity:function(a){return this.options.opacity=a,this._updateOpacity(),this},bringToFront:function(){return this._image&&this._map._panes.overlayPane.appendChild(this._image),this},bringToBack:function(){var a=this._map._panes.overlayPane;return this._image&&a.insertBefore(this._image,a.firstChild),this},setUrl:function(a){this._url=a,this._image.src=this._url},getAttribution:function(){return this.options.attribution},_initImage:function(){this._image=e.DomUtil.create("img","leaflet-image-layer"),this._map.options.zoomAnimation&&e.Browser.any3d?e.DomUtil.addClass(this._image,"leaflet-zoom-animated"):e.DomUtil.addClass(this._image,"leaflet-zoom-hide"),this._updateOpacity(),e.extend(this._image,{galleryimg:"no",onselectstart:e.Util.falseFn,onmousemove:e.Util.falseFn,onload:e.bind(this._onImageLoad,this),src:this._url})},_animateZoom:function(a){var b=this._map,c=this._image,d=b.getZoomScale(a.zoom),f=this._bounds.getNorthWest(),g=this._bounds.getSouthEast(),h=b._latLngToNewLayerPoint(f,a.zoom,a.center),i=b._latLngToNewLayerPoint(g,a.zoom,a.center)._subtract(h),j=h._add(i._multiplyBy(.5*(1-1/d)));c.style[e.DomUtil.TRANSFORM]=e.DomUtil.getTranslateString(j)+" scale("+d+") "},_reset:function(){var a=this._image,b=this._map.latLngToLayerPoint(this._bounds.getNorthWest()),c=this._map.latLngToLayerPoint(this._bounds.getSouthEast())._subtract(b);e.DomUtil.setPosition(a,b),a.style.width=c.x+"px",a.style.height=c.y+"px"},_onImageLoad:function(){this.fire("load")},_updateOpacity:function(){e.DomUtil.setOpacity(this._image,this.options.opacity)}}),e.imageOverlay=function(a,b,c){return new e.ImageOverlay(a,b,c)},e.Icon=e.Class.extend({options:{className:""},initialize:function(a){e.setOptions(this,a)},createIcon:function(a){return this._createIcon("icon",a)},createShadow:function(a){return this._createIcon("shadow",a)},_createIcon:function(a,b){var c=this._getIconUrl(a);if(!c){if("icon"===a)throw new Error("iconUrl not set in Icon options (see the docs).");return null}var d;return d=b&&"IMG"===b.tagName?this._createImg(c,b):this._createImg(c),this._setIconStyles(d,a),d},_setIconStyles:function(a,b){var c,d=this.options,f=e.point(d[b+"Size"]);c=e.point("shadow"===b?d.shadowAnchor||d.iconAnchor:d.iconAnchor),!c&&f&&(c=f.divideBy(2,!0)),a.className="leaflet-marker-"+b+" "+d.className,c&&(a.style.marginLeft=-c.x+"px",a.style.marginTop=-c.y+"px"),f&&(a.style.width=f.x+"px",a.style.height=f.y+"px")},_createImg:function(a,c){return c=c||b.createElement("img"),c.src=a,c},_getIconUrl:function(a){return e.Browser.retina&&this.options[a+"RetinaUrl"]?this.options[a+"RetinaUrl"]:this.options[a+"Url"]}}),e.icon=function(a){return new e.Icon(a)},e.Icon.Default=e.Icon.extend({options:{iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]},_getIconUrl:function(a){var b=a+"Url";if(this.options[b])return this.options[b];e.Browser.retina&&"icon"===a&&(a+="-2x");var c=e.Icon.Default.imagePath;if(!c)throw new Error("Couldn't autodetect L.Icon.Default.imagePath, set it manually.");return c+"/marker-"+a+".png"}}),e.Icon.Default.imagePath=function(){var a,c,d,e,f,g=b.getElementsByTagName("script"),h=/[\/^]leaflet[\-\._]?([\w\-\._]*)\.js\??/;for(a=0,c=g.length;c>a;a++)if(d=g[a].src,e=d.match(h))return f=d.split(h)[0],(f?f+"/":"")+"images"}(),e.Marker=e.Class.extend({includes:e.Mixin.Events,options:{icon:new e.Icon.Default,title:"",alt:"",clickable:!0,draggable:!1,keyboard:!0,zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250},initialize:function(a,b){e.setOptions(this,b),this._latlng=e.latLng(a)},onAdd:function(a){this._map=a,a.on("viewreset",this.update,this),this._initIcon(),this.update(),this.fire("add"),a.options.zoomAnimation&&a.options.markerZoomAnimation&&a.on("zoomanim",this._animateZoom,this)},addTo:function(a){return a.addLayer(this),this},onRemove:function(a){this.dragging&&this.dragging.disable(),this._removeIcon(),this._removeShadow(),this.fire("remove"),a.off({viewreset:this.update,zoomanim:this._animateZoom},this),this._map=null},getLatLng:function(){return this._latlng},setLatLng:function(a){return this._latlng=e.latLng(a),this.update(),this.fire("move",{latlng:this._latlng})},setZIndexOffset:function(a){return this.options.zIndexOffset=a,this.update(),this},setIcon:function(a){return this.options.icon=a,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup),this},update:function(){if(this._icon){var a=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(a)}return this},_initIcon:function(){var a=this.options,b=this._map,c=b.options.zoomAnimation&&b.options.markerZoomAnimation,d=c?"leaflet-zoom-animated":"leaflet-zoom-hide",f=a.icon.createIcon(this._icon),g=!1;f!==this._icon&&(this._icon&&this._removeIcon(),g=!0,a.title&&(f.title=a.title),a.alt&&(f.alt=a.alt)),e.DomUtil.addClass(f,d),a.keyboard&&(f.tabIndex="0"),this._icon=f,this._initInteraction(),a.riseOnHover&&e.DomEvent.on(f,"mouseover",this._bringToFront,this).on(f,"mouseout",this._resetZIndex,this);var h=a.icon.createShadow(this._shadow),i=!1;h!==this._shadow&&(this._removeShadow(),i=!0),h&&e.DomUtil.addClass(h,d),this._shadow=h,a.opacity<1&&this._updateOpacity();var j=this._map._panes;g&&j.markerPane.appendChild(this._icon),h&&i&&j.shadowPane.appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&e.DomEvent.off(this._icon,"mouseover",this._bringToFront).off(this._icon,"mouseout",this._resetZIndex),this._map._panes.markerPane.removeChild(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&this._map._panes.shadowPane.removeChild(this._shadow),this._shadow=null},_setPos:function(a){e.DomUtil.setPosition(this._icon,a),this._shadow&&e.DomUtil.setPosition(this._shadow,a),this._zIndex=a.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(a){this._icon.style.zIndex=this._zIndex+a},_animateZoom:function(a){var b=this._map._latLngToNewLayerPoint(this._latlng,a.zoom,a.center).round();this._setPos(b)},_initInteraction:function(){if(this.options.clickable){var a=this._icon,b=["dblclick","mousedown","mouseover","mouseout","contextmenu"];e.DomUtil.addClass(a,"leaflet-clickable"),e.DomEvent.on(a,"click",this._onMouseClick,this),e.DomEvent.on(a,"keypress",this._onKeyPress,this);for(var c=0;c<b.length;c++)e.DomEvent.on(a,b[c],this._fireMouseEvent,this);e.Handler.MarkerDrag&&(this.dragging=new e.Handler.MarkerDrag(this),this.options.draggable&&this.dragging.enable())}},_onMouseClick:function(a){var b=this.dragging&&this.dragging.moved();(this.hasEventListeners(a.type)||b)&&e.DomEvent.stopPropagation(a),b||(this.dragging&&this.dragging._enabled||!this._map.dragging||!this._map.dragging.moved())&&this.fire(a.type,{originalEvent:a,latlng:this._latlng})},_onKeyPress:function(a){13===a.keyCode&&this.fire("click",{originalEvent:a,latlng:this._latlng})},_fireMouseEvent:function(a){this.fire(a.type,{originalEvent:a,latlng:this._latlng}),"contextmenu"===a.type&&this.hasEventListeners(a.type)&&e.DomEvent.preventDefault(a),"mousedown"!==a.type?e.DomEvent.stopPropagation(a):e.DomEvent.preventDefault(a)},setOpacity:function(a){return this.options.opacity=a,this._map&&this._updateOpacity(),this},_updateOpacity:function(){e.DomUtil.setOpacity(this._icon,this.options.opacity),this._shadow&&e.DomUtil.setOpacity(this._shadow,this.options.opacity)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)}}),e.marker=function(a,b){return new e.Marker(a,b)},e.DivIcon=e.Icon.extend({options:{iconSize:[12,12],className:"leaflet-div-icon",html:!1},createIcon:function(a){var c=a&&"DIV"===a.tagName?a:b.createElement("div"),d=this.options;return c.innerHTML=d.html!==!1?d.html:"",d.bgPos&&(c.style.backgroundPosition=-d.bgPos.x+"px "+-d.bgPos.y+"px"),this._setIconStyles(c,"icon"),c},createShadow:function(){return null}}),e.divIcon=function(a){return new e.DivIcon(a)},e.Map.mergeOptions({closePopupOnClick:!0}),e.Popup=e.Class.extend({includes:e.Mixin.Events,options:{minWidth:50,maxWidth:300,autoPan:!0,closeButton:!0,offset:[0,7],autoPanPadding:[5,5],keepInView:!1,className:"",zoomAnimation:!0},initialize:function(a,b){e.setOptions(this,a),this._source=b,this._animated=e.Browser.any3d&&this.options.zoomAnimation,this._isOpen=!1},onAdd:function(a){this._map=a,this._container||this._initLayout();var b=a.options.fadeAnimation;b&&e.DomUtil.setOpacity(this._container,0),a._panes.popupPane.appendChild(this._container),a.on(this._getEvents(),this),this.update(),b&&e.DomUtil.setOpacity(this._container,1),this.fire("open"),a.fire("popupopen",{popup:this}),this._source&&this._source.fire("popupopen",{popup:this})},addTo:function(a){return a.addLayer(this),this},openOn:function(a){return a.openPopup(this),this},onRemove:function(a){a._panes.popupPane.removeChild(this._container),e.Util.falseFn(this._container.offsetWidth),a.off(this._getEvents(),this),a.options.fadeAnimation&&e.DomUtil.setOpacity(this._container,0),this._map=null,this.fire("close"),a.fire("popupclose",{popup:this}),this._source&&this._source.fire("popupclose",{popup:this})},getLatLng:function(){return this._latlng},setLatLng:function(a){return this._latlng=e.latLng(a),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(a){return this._content=a,this.update(),this},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},_getEvents:function(){var a={viewreset:this._updatePosition};return this._animated&&(a.zoomanim=this._zoomAnimation),("closeOnClick"in this.options?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(a.preclick=this._close),this.options.keepInView&&(a.moveend=this._adjustPan),a},_close:function(){this._map&&this._map.closePopup(this)},_initLayout:function(){var a,b="leaflet-popup",c=b+" "+this.options.className+" leaflet-zoom-"+(this._animated?"animated":"hide"),d=this._container=e.DomUtil.create("div",c);this.options.closeButton&&(a=this._closeButton=e.DomUtil.create("a",b+"-close-button",d),a.href="#close",a.innerHTML="&#215;",e.DomEvent.disableClickPropagation(a),e.DomEvent.on(a,"click",this._onCloseButtonClick,this));var f=this._wrapper=e.DomUtil.create("div",b+"-content-wrapper",d);e.DomEvent.disableClickPropagation(f),this._contentNode=e.DomUtil.create("div",b+"-content",f),e.DomEvent.disableScrollPropagation(this._contentNode),e.DomEvent.on(f,"contextmenu",e.DomEvent.stopPropagation),this._tipContainer=e.DomUtil.create("div",b+"-tip-container",d),this._tip=e.DomUtil.create("div",b+"-tip",this._tipContainer)},_updateContent:function(){if(this._content){if("string"==typeof this._content)this._contentNode.innerHTML=this._content;else{for(;this._contentNode.hasChildNodes();)this._contentNode.removeChild(this._contentNode.firstChild);this._contentNode.appendChild(this._content)}this.fire("contentupdate")}},_updateLayout:function(){var a=this._contentNode,b=a.style;b.width="",b.whiteSpace="nowrap";var c=a.offsetWidth;c=Math.min(c,this.options.maxWidth),c=Math.max(c,this.options.minWidth),b.width=c+1+"px",b.whiteSpace="",b.height="";var d=a.offsetHeight,f=this.options.maxHeight,g="leaflet-popup-scrolled";f&&d>f?(b.height=f+"px",e.DomUtil.addClass(a,g)):e.DomUtil.removeClass(a,g),this._containerWidth=this._container.offsetWidth},_updatePosition:function(){if(this._map){var a=this._map.latLngToLayerPoint(this._latlng),b=this._animated,c=e.point(this.options.offset);b&&e.DomUtil.setPosition(this._container,a),this._containerBottom=-c.y-(b?0:a.y),this._containerLeft=-Math.round(this._containerWidth/2)+c.x+(b?0:a.x),this._container.style.bottom=this._containerBottom+"px",this._container.style.left=this._containerLeft+"px"}},_zoomAnimation:function(a){var b=this._map._latLngToNewLayerPoint(this._latlng,a.zoom,a.center);e.DomUtil.setPosition(this._container,b)},_adjustPan:function(){if(this.options.autoPan){var a=this._map,b=this._container.offsetHeight,c=this._containerWidth,d=new e.Point(this._containerLeft,-b-this._containerBottom);this._animated&&d._add(e.DomUtil.getPosition(this._container));var f=a.layerPointToContainerPoint(d),g=e.point(this.options.autoPanPadding),h=e.point(this.options.autoPanPaddingTopLeft||g),i=e.point(this.options.autoPanPaddingBottomRight||g),j=a.getSize(),k=0,l=0;f.x+c+i.x>j.x&&(k=f.x+c-j.x+i.x),f.x-k-h.x<0&&(k=f.x-h.x),f.y+b+i.y>j.y&&(l=f.y+b-j.y+i.y),f.y-l-h.y<0&&(l=f.y-h.y),(k||l)&&a.fire("autopanstart").panBy([k,l])}},_onCloseButtonClick:function(a){this._close(),e.DomEvent.stop(a)}}),e.popup=function(a,b){return new e.Popup(a,b)},e.Map.include({openPopup:function(a,b,c){if(this.closePopup(),!(a instanceof e.Popup)){var d=a;a=new e.Popup(c).setLatLng(b).setContent(d)}return a._isOpen=!0,this._popup=a,this.addLayer(a)},closePopup:function(a){return a&&a!==this._popup||(a=this._popup,this._popup=null),a&&(this.removeLayer(a),a._isOpen=!1),this}}),e.Marker.include({openPopup:function(){return this._popup&&this._map&&!this._map.hasLayer(this._popup)&&(this._popup.setLatLng(this._latlng),this._map.openPopup(this._popup)),this},closePopup:function(){return this._popup&&this._popup._close(),this},togglePopup:function(){return this._popup&&(this._popup._isOpen?this.closePopup():this.openPopup()),this},bindPopup:function(a,b){var c=e.point(this.options.icon.options.popupAnchor||[0,0]);return c=c.add(e.Popup.prototype.options.offset),b&&b.offset&&(c=c.add(b.offset)),b=e.extend({offset:c},b),this._popupHandlersAdded||(this.on("click",this.togglePopup,this).on("remove",this.closePopup,this).on("move",this._movePopup,this),this._popupHandlersAdded=!0),a instanceof e.Popup?(e.setOptions(a,b),this._popup=a):this._popup=new e.Popup(b,this).setContent(a),this},setPopupContent:function(a){return this._popup&&this._popup.setContent(a),this},unbindPopup:function(){return this._popup&&(this._popup=null,this.off("click",this.togglePopup,this).off("remove",this.closePopup,this).off("move",this._movePopup,this),this._popupHandlersAdded=!1),this},getPopup:function(){return this._popup},_movePopup:function(a){this._popup.setLatLng(a.latlng)}}),e.LayerGroup=e.Class.extend({initialize:function(a){this._layers={};var b,c;if(a)for(b=0,c=a.length;c>b;b++)this.addLayer(a[b])},addLayer:function(a){var b=this.getLayerId(a);return this._layers[b]=a,this._map&&this._map.addLayer(a),this},removeLayer:function(a){var b=a in this._layers?a:this.getLayerId(a);return this._map&&this._layers[b]&&this._map.removeLayer(this._layers[b]),delete this._layers[b],this},hasLayer:function(a){return a?a in this._layers||this.getLayerId(a)in this._layers:!1},clearLayers:function(){return this.eachLayer(this.removeLayer,this),this},invoke:function(a){var b,c,d=Array.prototype.slice.call(arguments,1);for(b in this._layers)c=this._layers[b],c[a]&&c[a].apply(c,d);return this},onAdd:function(a){this._map=a,this.eachLayer(a.addLayer,a)},onRemove:function(a){this.eachLayer(a.removeLayer,a),this._map=null},addTo:function(a){return a.addLayer(this),this},eachLayer:function(a,b){for(var c in this._layers)a.call(b,this._layers[c]);return this},getLayer:function(a){return this._layers[a]},getLayers:function(){var a=[];for(var b in this._layers)a.push(this._layers[b]);return a},setZIndex:function(a){return this.invoke("setZIndex",a)},getLayerId:function(a){return e.stamp(a)}}),e.layerGroup=function(a){return new e.LayerGroup(a)},e.FeatureGroup=e.LayerGroup.extend({includes:e.Mixin.Events,statics:{EVENTS:"click dblclick mouseover mouseout mousemove contextmenu popupopen popupclose"},addLayer:function(a){return this.hasLayer(a)?this:("on"in a&&a.on(e.FeatureGroup.EVENTS,this._propagateEvent,this),e.LayerGroup.prototype.addLayer.call(this,a),this._popupContent&&a.bindPopup&&a.bindPopup(this._popupContent,this._popupOptions),this.fire("layeradd",{layer:a}))},removeLayer:function(a){return this.hasLayer(a)?(a in this._layers&&(a=this._layers[a]),a.off(e.FeatureGroup.EVENTS,this._propagateEvent,this),e.LayerGroup.prototype.removeLayer.call(this,a),this._popupContent&&this.invoke("unbindPopup"),this.fire("layerremove",{layer:a})):this},bindPopup:function(a,b){return this._popupContent=a,this._popupOptions=b,this.invoke("bindPopup",a,b)},openPopup:function(a){for(var b in this._layers){this._layers[b].openPopup(a);break}return this},setStyle:function(a){return this.invoke("setStyle",a)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var a=new e.LatLngBounds;return this.eachLayer(function(b){a.extend(b instanceof e.Marker?b.getLatLng():b.getBounds())}),a},_propagateEvent:function(a){a=e.extend({layer:a.target,target:this},a),this.fire(a.type,a)
}}),e.featureGroup=function(a){return new e.FeatureGroup(a)},e.Path=e.Class.extend({includes:[e.Mixin.Events],statics:{CLIP_PADDING:function(){var b=e.Browser.mobile?1280:2e3,c=(b/Math.max(a.outerWidth,a.outerHeight)-1)/2;return Math.max(0,Math.min(.5,c))}()},options:{stroke:!0,color:"#0033ff",dashArray:null,lineCap:null,lineJoin:null,weight:5,opacity:.5,fill:!1,fillColor:null,fillOpacity:.2,clickable:!0},initialize:function(a){e.setOptions(this,a)},onAdd:function(a){this._map=a,this._container||(this._initElements(),this._initEvents()),this.projectLatlngs(),this._updatePath(),this._container&&this._map._pathRoot.appendChild(this._container),this.fire("add"),a.on({viewreset:this.projectLatlngs,moveend:this._updatePath},this)},addTo:function(a){return a.addLayer(this),this},onRemove:function(a){a._pathRoot.removeChild(this._container),this.fire("remove"),this._map=null,e.Browser.vml&&(this._container=null,this._stroke=null,this._fill=null),a.off({viewreset:this.projectLatlngs,moveend:this._updatePath},this)},projectLatlngs:function(){},setStyle:function(a){return e.setOptions(this,a),this._container&&this._updateStyle(),this},redraw:function(){return this._map&&(this.projectLatlngs(),this._updatePath()),this}}),e.Map.include({_updatePathViewport:function(){var a=e.Path.CLIP_PADDING,b=this.getSize(),c=e.DomUtil.getPosition(this._mapPane),d=c.multiplyBy(-1)._subtract(b.multiplyBy(a)._round()),f=d.add(b.multiplyBy(1+2*a)._round());this._pathViewport=new e.Bounds(d,f)}}),e.Path.SVG_NS="http://www.w3.org/2000/svg",e.Browser.svg=!(!b.createElementNS||!b.createElementNS(e.Path.SVG_NS,"svg").createSVGRect),e.Path=e.Path.extend({statics:{SVG:e.Browser.svg},bringToFront:function(){var a=this._map._pathRoot,b=this._container;return b&&a.lastChild!==b&&a.appendChild(b),this},bringToBack:function(){var a=this._map._pathRoot,b=this._container,c=a.firstChild;return b&&c!==b&&a.insertBefore(b,c),this},getPathString:function(){},_createElement:function(a){return b.createElementNS(e.Path.SVG_NS,a)},_initElements:function(){this._map._initPathRoot(),this._initPath(),this._initStyle()},_initPath:function(){this._container=this._createElement("g"),this._path=this._createElement("path"),this.options.className&&e.DomUtil.addClass(this._path,this.options.className),this._container.appendChild(this._path)},_initStyle:function(){this.options.stroke&&(this._path.setAttribute("stroke-linejoin","round"),this._path.setAttribute("stroke-linecap","round")),this.options.fill&&this._path.setAttribute("fill-rule","evenodd"),this.options.pointerEvents&&this._path.setAttribute("pointer-events",this.options.pointerEvents),this.options.clickable||this.options.pointerEvents||this._path.setAttribute("pointer-events","none"),this._updateStyle()},_updateStyle:function(){this.options.stroke?(this._path.setAttribute("stroke",this.options.color),this._path.setAttribute("stroke-opacity",this.options.opacity),this._path.setAttribute("stroke-width",this.options.weight),this.options.dashArray?this._path.setAttribute("stroke-dasharray",this.options.dashArray):this._path.removeAttribute("stroke-dasharray"),this.options.lineCap&&this._path.setAttribute("stroke-linecap",this.options.lineCap),this.options.lineJoin&&this._path.setAttribute("stroke-linejoin",this.options.lineJoin)):this._path.setAttribute("stroke","none"),this.options.fill?(this._path.setAttribute("fill",this.options.fillColor||this.options.color),this._path.setAttribute("fill-opacity",this.options.fillOpacity)):this._path.setAttribute("fill","none")},_updatePath:function(){var a=this.getPathString();a||(a="M0 0"),this._path.setAttribute("d",a)},_initEvents:function(){if(this.options.clickable){(e.Browser.svg||!e.Browser.vml)&&e.DomUtil.addClass(this._path,"leaflet-clickable"),e.DomEvent.on(this._container,"click",this._onMouseClick,this);for(var a=["dblclick","mousedown","mouseover","mouseout","mousemove","contextmenu"],b=0;b<a.length;b++)e.DomEvent.on(this._container,a[b],this._fireMouseEvent,this)}},_onMouseClick:function(a){this._map.dragging&&this._map.dragging.moved()||this._fireMouseEvent(a)},_fireMouseEvent:function(a){if(this.hasEventListeners(a.type)){var b=this._map,c=b.mouseEventToContainerPoint(a),d=b.containerPointToLayerPoint(c),f=b.layerPointToLatLng(d);this.fire(a.type,{latlng:f,layerPoint:d,containerPoint:c,originalEvent:a}),"contextmenu"===a.type&&e.DomEvent.preventDefault(a),"mousemove"!==a.type&&e.DomEvent.stopPropagation(a)}}}),e.Map.include({_initPathRoot:function(){this._pathRoot||(this._pathRoot=e.Path.prototype._createElement("svg"),this._panes.overlayPane.appendChild(this._pathRoot),this.options.zoomAnimation&&e.Browser.any3d?(e.DomUtil.addClass(this._pathRoot,"leaflet-zoom-animated"),this.on({zoomanim:this._animatePathZoom,zoomend:this._endPathZoom})):e.DomUtil.addClass(this._pathRoot,"leaflet-zoom-hide"),this.on("moveend",this._updateSvgViewport),this._updateSvgViewport())},_animatePathZoom:function(a){var b=this.getZoomScale(a.zoom),c=this._getCenterOffset(a.center)._multiplyBy(-b)._add(this._pathViewport.min);this._pathRoot.style[e.DomUtil.TRANSFORM]=e.DomUtil.getTranslateString(c)+" scale("+b+") ",this._pathZooming=!0},_endPathZoom:function(){this._pathZooming=!1},_updateSvgViewport:function(){if(!this._pathZooming){this._updatePathViewport();var a=this._pathViewport,b=a.min,c=a.max,d=c.x-b.x,f=c.y-b.y,g=this._pathRoot,h=this._panes.overlayPane;e.Browser.mobileWebkit&&h.removeChild(g),e.DomUtil.setPosition(g,b),g.setAttribute("width",d),g.setAttribute("height",f),g.setAttribute("viewBox",[b.x,b.y,d,f].join(" ")),e.Browser.mobileWebkit&&h.appendChild(g)}}}),e.Path.include({bindPopup:function(a,b){return a instanceof e.Popup?this._popup=a:((!this._popup||b)&&(this._popup=new e.Popup(b,this)),this._popup.setContent(a)),this._popupHandlersAdded||(this.on("click",this._openPopup,this).on("remove",this.closePopup,this),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this._popup=null,this.off("click",this._openPopup).off("remove",this.closePopup),this._popupHandlersAdded=!1),this},openPopup:function(a){return this._popup&&(a=a||this._latlng||this._latlngs[Math.floor(this._latlngs.length/2)],this._openPopup({latlng:a})),this},closePopup:function(){return this._popup&&this._popup._close(),this},_openPopup:function(a){this._popup.setLatLng(a.latlng),this._map.openPopup(this._popup)}}),e.Browser.vml=!e.Browser.svg&&function(){try{var a=b.createElement("div");a.innerHTML='<v:shape adj="1"/>';var c=a.firstChild;return c.style.behavior="url(#default#VML)",c&&"object"==typeof c.adj}catch(d){return!1}}(),e.Path=e.Browser.svg||!e.Browser.vml?e.Path:e.Path.extend({statics:{VML:!0,CLIP_PADDING:.02},_createElement:function(){try{return b.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(a){return b.createElement("<lvml:"+a+' class="lvml">')}}catch(a){return function(a){return b.createElement("<"+a+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}}(),_initPath:function(){var a=this._container=this._createElement("shape");e.DomUtil.addClass(a,"leaflet-vml-shape"+(this.options.className?" "+this.options.className:"")),this.options.clickable&&e.DomUtil.addClass(a,"leaflet-clickable"),a.coordsize="1 1",this._path=this._createElement("path"),a.appendChild(this._path),this._map._pathRoot.appendChild(a)},_initStyle:function(){this._updateStyle()},_updateStyle:function(){var a=this._stroke,b=this._fill,c=this.options,d=this._container;d.stroked=c.stroke,d.filled=c.fill,c.stroke?(a||(a=this._stroke=this._createElement("stroke"),a.endcap="round",d.appendChild(a)),a.weight=c.weight+"px",a.color=c.color,a.opacity=c.opacity,a.dashStyle=c.dashArray?e.Util.isArray(c.dashArray)?c.dashArray.join(" "):c.dashArray.replace(/( *, *)/g," "):"",c.lineCap&&(a.endcap=c.lineCap.replace("butt","flat")),c.lineJoin&&(a.joinstyle=c.lineJoin)):a&&(d.removeChild(a),this._stroke=null),c.fill?(b||(b=this._fill=this._createElement("fill"),d.appendChild(b)),b.color=c.fillColor||c.color,b.opacity=c.fillOpacity):b&&(d.removeChild(b),this._fill=null)},_updatePath:function(){var a=this._container.style;a.display="none",this._path.v=this.getPathString()+" ",a.display=""}}),e.Map.include(e.Browser.svg||!e.Browser.vml?{}:{_initPathRoot:function(){if(!this._pathRoot){var a=this._pathRoot=b.createElement("div");a.className="leaflet-vml-container",this._panes.overlayPane.appendChild(a),this.on("moveend",this._updatePathViewport),this._updatePathViewport()}}}),e.Browser.canvas=function(){return!!b.createElement("canvas").getContext}(),e.Path=e.Path.SVG&&!a.L_PREFER_CANVAS||!e.Browser.canvas?e.Path:e.Path.extend({statics:{CANVAS:!0,SVG:!1},redraw:function(){return this._map&&(this.projectLatlngs(),this._requestUpdate()),this},setStyle:function(a){return e.setOptions(this,a),this._map&&(this._updateStyle(),this._requestUpdate()),this},onRemove:function(a){a.off("viewreset",this.projectLatlngs,this).off("moveend",this._updatePath,this),this.options.clickable&&(this._map.off("click",this._onClick,this),this._map.off("mousemove",this._onMouseMove,this)),this._requestUpdate(),this.fire("remove"),this._map=null},_requestUpdate:function(){this._map&&!e.Path._updateRequest&&(e.Path._updateRequest=e.Util.requestAnimFrame(this._fireMapMoveEnd,this._map))},_fireMapMoveEnd:function(){e.Path._updateRequest=null,this.fire("moveend")},_initElements:function(){this._map._initPathRoot(),this._ctx=this._map._canvasCtx},_updateStyle:function(){var a=this.options;a.stroke&&(this._ctx.lineWidth=a.weight,this._ctx.strokeStyle=a.color),a.fill&&(this._ctx.fillStyle=a.fillColor||a.color)},_drawPath:function(){var a,b,c,d,f,g;for(this._ctx.beginPath(),a=0,c=this._parts.length;c>a;a++){for(b=0,d=this._parts[a].length;d>b;b++)f=this._parts[a][b],g=(0===b?"move":"line")+"To",this._ctx[g](f.x,f.y);this instanceof e.Polygon&&this._ctx.closePath()}},_checkIfEmpty:function(){return!this._parts.length},_updatePath:function(){if(!this._checkIfEmpty()){var a=this._ctx,b=this.options;this._drawPath(),a.save(),this._updateStyle(),b.fill&&(a.globalAlpha=b.fillOpacity,a.fill()),b.stroke&&(a.globalAlpha=b.opacity,a.stroke()),a.restore()}},_initEvents:function(){this.options.clickable&&(this._map.on("mousemove",this._onMouseMove,this),this._map.on("click",this._onClick,this))},_onClick:function(a){this._containsPoint(a.layerPoint)&&this.fire("click",a)},_onMouseMove:function(a){this._map&&!this._map._animatingZoom&&(this._containsPoint(a.layerPoint)?(this._ctx.canvas.style.cursor="pointer",this._mouseInside=!0,this.fire("mouseover",a)):this._mouseInside&&(this._ctx.canvas.style.cursor="",this._mouseInside=!1,this.fire("mouseout",a)))}}),e.Map.include(e.Path.SVG&&!a.L_PREFER_CANVAS||!e.Browser.canvas?{}:{_initPathRoot:function(){var a,c=this._pathRoot;c||(c=this._pathRoot=b.createElement("canvas"),c.style.position="absolute",a=this._canvasCtx=c.getContext("2d"),a.lineCap="round",a.lineJoin="round",this._panes.overlayPane.appendChild(c),this.options.zoomAnimation&&(this._pathRoot.className="leaflet-zoom-animated",this.on("zoomanim",this._animatePathZoom),this.on("zoomend",this._endPathZoom)),this.on("moveend",this._updateCanvasViewport),this._updateCanvasViewport())},_updateCanvasViewport:function(){if(!this._pathZooming){this._updatePathViewport();var a=this._pathViewport,b=a.min,c=a.max.subtract(b),d=this._pathRoot;e.DomUtil.setPosition(d,b),d.width=c.x,d.height=c.y,d.getContext("2d").translate(-b.x,-b.y)}}}),e.LineUtil={simplify:function(a,b){if(!b||!a.length)return a.slice();var c=b*b;return a=this._reducePoints(a,c),a=this._simplifyDP(a,c)},pointToSegmentDistance:function(a,b,c){return Math.sqrt(this._sqClosestPointOnSegment(a,b,c,!0))},closestPointOnSegment:function(a,b,c){return this._sqClosestPointOnSegment(a,b,c)},_simplifyDP:function(a,b){var d=a.length,e=typeof Uint8Array!=c+""?Uint8Array:Array,f=new e(d);f[0]=f[d-1]=1,this._simplifyDPStep(a,f,b,0,d-1);var g,h=[];for(g=0;d>g;g++)f[g]&&h.push(a[g]);return h},_simplifyDPStep:function(a,b,c,d,e){var f,g,h,i=0;for(g=d+1;e-1>=g;g++)h=this._sqClosestPointOnSegment(a[g],a[d],a[e],!0),h>i&&(f=g,i=h);i>c&&(b[f]=1,this._simplifyDPStep(a,b,c,d,f),this._simplifyDPStep(a,b,c,f,e))},_reducePoints:function(a,b){for(var c=[a[0]],d=1,e=0,f=a.length;f>d;d++)this._sqDist(a[d],a[e])>b&&(c.push(a[d]),e=d);return f-1>e&&c.push(a[f-1]),c},clipSegment:function(a,b,c,d){var e,f,g,h=d?this._lastCode:this._getBitCode(a,c),i=this._getBitCode(b,c);for(this._lastCode=i;;){if(!(h|i))return[a,b];if(h&i)return!1;e=h||i,f=this._getEdgeIntersection(a,b,e,c),g=this._getBitCode(f,c),e===h?(a=f,h=g):(b=f,i=g)}},_getEdgeIntersection:function(a,b,c,d){var f=b.x-a.x,g=b.y-a.y,h=d.min,i=d.max;return 8&c?new e.Point(a.x+f*(i.y-a.y)/g,i.y):4&c?new e.Point(a.x+f*(h.y-a.y)/g,h.y):2&c?new e.Point(i.x,a.y+g*(i.x-a.x)/f):1&c?new e.Point(h.x,a.y+g*(h.x-a.x)/f):void 0},_getBitCode:function(a,b){var c=0;return a.x<b.min.x?c|=1:a.x>b.max.x&&(c|=2),a.y<b.min.y?c|=4:a.y>b.max.y&&(c|=8),c},_sqDist:function(a,b){var c=b.x-a.x,d=b.y-a.y;return c*c+d*d},_sqClosestPointOnSegment:function(a,b,c,d){var f,g=b.x,h=b.y,i=c.x-g,j=c.y-h,k=i*i+j*j;return k>0&&(f=((a.x-g)*i+(a.y-h)*j)/k,f>1?(g=c.x,h=c.y):f>0&&(g+=i*f,h+=j*f)),i=a.x-g,j=a.y-h,d?i*i+j*j:new e.Point(g,h)}},e.Polyline=e.Path.extend({initialize:function(a,b){e.Path.prototype.initialize.call(this,b),this._latlngs=this._convertLatLngs(a)},options:{smoothFactor:1,noClip:!1},projectLatlngs:function(){this._originalPoints=[];for(var a=0,b=this._latlngs.length;b>a;a++)this._originalPoints[a]=this._map.latLngToLayerPoint(this._latlngs[a])},getPathString:function(){for(var a=0,b=this._parts.length,c="";b>a;a++)c+=this._getPathPartStr(this._parts[a]);return c},getLatLngs:function(){return this._latlngs},setLatLngs:function(a){return this._latlngs=this._convertLatLngs(a),this.redraw()},addLatLng:function(a){return this._latlngs.push(e.latLng(a)),this.redraw()},spliceLatLngs:function(){var a=[].splice.apply(this._latlngs,arguments);return this._convertLatLngs(this._latlngs,!0),this.redraw(),a},closestLayerPoint:function(a){for(var b,c,d=1/0,f=this._parts,g=null,h=0,i=f.length;i>h;h++)for(var j=f[h],k=1,l=j.length;l>k;k++){b=j[k-1],c=j[k];var m=e.LineUtil._sqClosestPointOnSegment(a,b,c,!0);d>m&&(d=m,g=e.LineUtil._sqClosestPointOnSegment(a,b,c))}return g&&(g.distance=Math.sqrt(d)),g},getBounds:function(){return new e.LatLngBounds(this.getLatLngs())},_convertLatLngs:function(a,b){var c,d,f=b?a:[];for(c=0,d=a.length;d>c;c++){if(e.Util.isArray(a[c])&&"number"!=typeof a[c][0])return;f[c]=e.latLng(a[c])}return f},_initEvents:function(){e.Path.prototype._initEvents.call(this)},_getPathPartStr:function(a){for(var b,c=e.Path.VML,d=0,f=a.length,g="";f>d;d++)b=a[d],c&&b._round(),g+=(d?"L":"M")+b.x+" "+b.y;return g},_clipPoints:function(){var a,b,c,d=this._originalPoints,f=d.length;if(this.options.noClip)return void(this._parts=[d]);this._parts=[];var g=this._parts,h=this._map._pathViewport,i=e.LineUtil;for(a=0,b=0;f-1>a;a++)c=i.clipSegment(d[a],d[a+1],h,a),c&&(g[b]=g[b]||[],g[b].push(c[0]),(c[1]!==d[a+1]||a===f-2)&&(g[b].push(c[1]),b++))},_simplifyPoints:function(){for(var a=this._parts,b=e.LineUtil,c=0,d=a.length;d>c;c++)a[c]=b.simplify(a[c],this.options.smoothFactor)},_updatePath:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),e.Path.prototype._updatePath.call(this))}}),e.polyline=function(a,b){return new e.Polyline(a,b)},e.PolyUtil={},e.PolyUtil.clipPolygon=function(a,b){var c,d,f,g,h,i,j,k,l,m=[1,4,2,8],n=e.LineUtil;for(d=0,j=a.length;j>d;d++)a[d]._code=n._getBitCode(a[d],b);for(g=0;4>g;g++){for(k=m[g],c=[],d=0,j=a.length,f=j-1;j>d;f=d++)h=a[d],i=a[f],h._code&k?i._code&k||(l=n._getEdgeIntersection(i,h,k,b),l._code=n._getBitCode(l,b),c.push(l)):(i._code&k&&(l=n._getEdgeIntersection(i,h,k,b),l._code=n._getBitCode(l,b),c.push(l)),c.push(h));a=c}return a},e.Polygon=e.Polyline.extend({options:{fill:!0},initialize:function(a,b){e.Polyline.prototype.initialize.call(this,a,b),this._initWithHoles(a)},_initWithHoles:function(a){var b,c,d;if(a&&e.Util.isArray(a[0])&&"number"!=typeof a[0][0])for(this._latlngs=this._convertLatLngs(a[0]),this._holes=a.slice(1),b=0,c=this._holes.length;c>b;b++)d=this._holes[b]=this._convertLatLngs(this._holes[b]),d[0].equals(d[d.length-1])&&d.pop();a=this._latlngs,a.length>=2&&a[0].equals(a[a.length-1])&&a.pop()},projectLatlngs:function(){if(e.Polyline.prototype.projectLatlngs.call(this),this._holePoints=[],this._holes){var a,b,c,d;for(a=0,c=this._holes.length;c>a;a++)for(this._holePoints[a]=[],b=0,d=this._holes[a].length;d>b;b++)this._holePoints[a][b]=this._map.latLngToLayerPoint(this._holes[a][b])}},setLatLngs:function(a){return a&&e.Util.isArray(a[0])&&"number"!=typeof a[0][0]?(this._initWithHoles(a),this.redraw()):e.Polyline.prototype.setLatLngs.call(this,a)},_clipPoints:function(){var a=this._originalPoints,b=[];if(this._parts=[a].concat(this._holePoints),!this.options.noClip){for(var c=0,d=this._parts.length;d>c;c++){var f=e.PolyUtil.clipPolygon(this._parts[c],this._map._pathViewport);f.length&&b.push(f)}this._parts=b}},_getPathPartStr:function(a){var b=e.Polyline.prototype._getPathPartStr.call(this,a);return b+(e.Browser.svg?"z":"x")}}),e.polygon=function(a,b){return new e.Polygon(a,b)},function(){function a(a){return e.FeatureGroup.extend({initialize:function(a,b){this._layers={},this._options=b,this.setLatLngs(a)},setLatLngs:function(b){var c=0,d=b.length;for(this.eachLayer(function(a){d>c?a.setLatLngs(b[c++]):this.removeLayer(a)},this);d>c;)this.addLayer(new a(b[c++],this._options));return this},getLatLngs:function(){var a=[];return this.eachLayer(function(b){a.push(b.getLatLngs())}),a}})}e.MultiPolyline=a(e.Polyline),e.MultiPolygon=a(e.Polygon),e.multiPolyline=function(a,b){return new e.MultiPolyline(a,b)},e.multiPolygon=function(a,b){return new e.MultiPolygon(a,b)}}(),e.Rectangle=e.Polygon.extend({initialize:function(a,b){e.Polygon.prototype.initialize.call(this,this._boundsToLatLngs(a),b)},setBounds:function(a){this.setLatLngs(this._boundsToLatLngs(a))},_boundsToLatLngs:function(a){return a=e.latLngBounds(a),[a.getSouthWest(),a.getNorthWest(),a.getNorthEast(),a.getSouthEast()]}}),e.rectangle=function(a,b){return new e.Rectangle(a,b)},e.Circle=e.Path.extend({initialize:function(a,b,c){e.Path.prototype.initialize.call(this,c),this._latlng=e.latLng(a),this._mRadius=b},options:{fill:!0},setLatLng:function(a){return this._latlng=e.latLng(a),this.redraw()},setRadius:function(a){return this._mRadius=a,this.redraw()},projectLatlngs:function(){var a=this._getLngRadius(),b=this._latlng,c=this._map.latLngToLayerPoint([b.lat,b.lng-a]);this._point=this._map.latLngToLayerPoint(b),this._radius=Math.max(this._point.x-c.x,1)},getBounds:function(){var a=this._getLngRadius(),b=this._mRadius/40075017*360,c=this._latlng;return new e.LatLngBounds([c.lat-b,c.lng-a],[c.lat+b,c.lng+a])},getLatLng:function(){return this._latlng},getPathString:function(){var a=this._point,b=this._radius;return this._checkIfEmpty()?"":e.Browser.svg?"M"+a.x+","+(a.y-b)+"A"+b+","+b+",0,1,1,"+(a.x-.1)+","+(a.y-b)+" z":(a._round(),b=Math.round(b),"AL "+a.x+","+a.y+" "+b+","+b+" 0,23592600")},getRadius:function(){return this._mRadius},_getLatRadius:function(){return this._mRadius/40075017*360},_getLngRadius:function(){return this._getLatRadius()/Math.cos(e.LatLng.DEG_TO_RAD*this._latlng.lat)},_checkIfEmpty:function(){if(!this._map)return!1;var a=this._map._pathViewport,b=this._radius,c=this._point;return c.x-b>a.max.x||c.y-b>a.max.y||c.x+b<a.min.x||c.y+b<a.min.y}}),e.circle=function(a,b,c){return new e.Circle(a,b,c)},e.CircleMarker=e.Circle.extend({options:{radius:10,weight:2},initialize:function(a,b){e.Circle.prototype.initialize.call(this,a,null,b),this._radius=this.options.radius},projectLatlngs:function(){this._point=this._map.latLngToLayerPoint(this._latlng)},_updateStyle:function(){e.Circle.prototype._updateStyle.call(this),this.setRadius(this.options.radius)},setLatLng:function(a){return e.Circle.prototype.setLatLng.call(this,a),this._popup&&this._popup._isOpen&&this._popup.setLatLng(a),this},setRadius:function(a){return this.options.radius=this._radius=a,this.redraw()},getRadius:function(){return this._radius}}),e.circleMarker=function(a,b){return new e.CircleMarker(a,b)},e.Polyline.include(e.Path.CANVAS?{_containsPoint:function(a,b){var c,d,f,g,h,i,j,k=this.options.weight/2;for(e.Browser.touch&&(k+=10),c=0,g=this._parts.length;g>c;c++)for(j=this._parts[c],d=0,h=j.length,f=h-1;h>d;f=d++)if((b||0!==d)&&(i=e.LineUtil.pointToSegmentDistance(a,j[f],j[d]),k>=i))return!0;return!1}}:{}),e.Polygon.include(e.Path.CANVAS?{_containsPoint:function(a){var b,c,d,f,g,h,i,j,k=!1;if(e.Polyline.prototype._containsPoint.call(this,a,!0))return!0;for(f=0,i=this._parts.length;i>f;f++)for(b=this._parts[f],g=0,j=b.length,h=j-1;j>g;h=g++)c=b[g],d=b[h],c.y>a.y!=d.y>a.y&&a.x<(d.x-c.x)*(a.y-c.y)/(d.y-c.y)+c.x&&(k=!k);return k}}:{}),e.Circle.include(e.Path.CANVAS?{_drawPath:function(){var a=this._point;this._ctx.beginPath(),this._ctx.arc(a.x,a.y,this._radius,0,2*Math.PI,!1)},_containsPoint:function(a){var b=this._point,c=this.options.stroke?this.options.weight/2:0;return a.distanceTo(b)<=this._radius+c}}:{}),e.CircleMarker.include(e.Path.CANVAS?{_updateStyle:function(){e.Path.prototype._updateStyle.call(this)}}:{}),e.GeoJSON=e.FeatureGroup.extend({initialize:function(a,b){e.setOptions(this,b),this._layers={},a&&this.addData(a)},addData:function(a){var b,c,d,f=e.Util.isArray(a)?a:a.features;if(f){for(b=0,c=f.length;c>b;b++)d=f[b],(d.geometries||d.geometry||d.features||d.coordinates)&&this.addData(f[b]);return this}var g=this.options;if(!g.filter||g.filter(a)){var h=e.GeoJSON.geometryToLayer(a,g.pointToLayer,g.coordsToLatLng,g);return h.feature=e.GeoJSON.asFeature(a),h.defaultOptions=h.options,this.resetStyle(h),g.onEachFeature&&g.onEachFeature(a,h),this.addLayer(h)}},resetStyle:function(a){var b=this.options.style;b&&(e.Util.extend(a.options,a.defaultOptions),this._setLayerStyle(a,b))},setStyle:function(a){this.eachLayer(function(b){this._setLayerStyle(b,a)},this)},_setLayerStyle:function(a,b){"function"==typeof b&&(b=b(a.feature)),a.setStyle&&a.setStyle(b)}}),e.extend(e.GeoJSON,{geometryToLayer:function(a,b,c,d){var f,g,h,i,j="Feature"===a.type?a.geometry:a,k=j.coordinates,l=[];switch(c=c||this.coordsToLatLng,j.type){case"Point":return f=c(k),b?b(a,f):new e.Marker(f);case"MultiPoint":for(h=0,i=k.length;i>h;h++)f=c(k[h]),l.push(b?b(a,f):new e.Marker(f));return new e.FeatureGroup(l);case"LineString":return g=this.coordsToLatLngs(k,0,c),new e.Polyline(g,d);case"Polygon":if(2===k.length&&!k[1].length)throw new Error("Invalid GeoJSON object.");return g=this.coordsToLatLngs(k,1,c),new e.Polygon(g,d);case"MultiLineString":return g=this.coordsToLatLngs(k,1,c),new e.MultiPolyline(g,d);case"MultiPolygon":return g=this.coordsToLatLngs(k,2,c),new e.MultiPolygon(g,d);case"GeometryCollection":for(h=0,i=j.geometries.length;i>h;h++)l.push(this.geometryToLayer({geometry:j.geometries[h],type:"Feature",properties:a.properties},b,c,d));return new e.FeatureGroup(l);default:throw new Error("Invalid GeoJSON object.")}},coordsToLatLng:function(a){return new e.LatLng(a[1],a[0],a[2])},coordsToLatLngs:function(a,b,c){var d,e,f,g=[];for(e=0,f=a.length;f>e;e++)d=b?this.coordsToLatLngs(a[e],b-1,c):(c||this.coordsToLatLng)(a[e]),g.push(d);return g},latLngToCoords:function(a){var b=[a.lng,a.lat];return a.alt!==c&&b.push(a.alt),b},latLngsToCoords:function(a){for(var b=[],c=0,d=a.length;d>c;c++)b.push(e.GeoJSON.latLngToCoords(a[c]));return b},getFeature:function(a,b){return a.feature?e.extend({},a.feature,{geometry:b}):e.GeoJSON.asFeature(b)},asFeature:function(a){return"Feature"===a.type?a:{type:"Feature",properties:{},geometry:a}}});var g={toGeoJSON:function(){return e.GeoJSON.getFeature(this,{type:"Point",coordinates:e.GeoJSON.latLngToCoords(this.getLatLng())})}};e.Marker.include(g),e.Circle.include(g),e.CircleMarker.include(g),e.Polyline.include({toGeoJSON:function(){return e.GeoJSON.getFeature(this,{type:"LineString",coordinates:e.GeoJSON.latLngsToCoords(this.getLatLngs())})}}),e.Polygon.include({toGeoJSON:function(){var a,b,c,d=[e.GeoJSON.latLngsToCoords(this.getLatLngs())];if(d[0].push(d[0][0]),this._holes)for(a=0,b=this._holes.length;b>a;a++)c=e.GeoJSON.latLngsToCoords(this._holes[a]),c.push(c[0]),d.push(c);return e.GeoJSON.getFeature(this,{type:"Polygon",coordinates:d})}}),function(){function a(a){return function(){var b=[];return this.eachLayer(function(a){b.push(a.toGeoJSON().geometry.coordinates)}),e.GeoJSON.getFeature(this,{type:a,coordinates:b})}}e.MultiPolyline.include({toGeoJSON:a("MultiLineString")}),e.MultiPolygon.include({toGeoJSON:a("MultiPolygon")}),e.LayerGroup.include({toGeoJSON:function(){var b,c=this.feature&&this.feature.geometry,d=[];if(c&&"MultiPoint"===c.type)return a("MultiPoint").call(this);var f=c&&"GeometryCollection"===c.type;return this.eachLayer(function(a){a.toGeoJSON&&(b=a.toGeoJSON(),d.push(f?b.geometry:e.GeoJSON.asFeature(b)))}),f?e.GeoJSON.getFeature(this,{geometries:d,type:"GeometryCollection"}):{type:"FeatureCollection",features:d}}})}(),e.geoJson=function(a,b){return new e.GeoJSON(a,b)},e.DomEvent={addListener:function(a,b,c,d){var f,g,h,i=e.stamp(c),j="_leaflet_"+b+i;return a[j]?this:(f=function(b){return c.call(d||a,b||e.DomEvent._getEvent())},e.Browser.pointer&&0===b.indexOf("touch")?this.addPointerListener(a,b,f,i):(e.Browser.touch&&"dblclick"===b&&this.addDoubleTapListener&&this.addDoubleTapListener(a,f,i),"addEventListener"in a?"mousewheel"===b?(a.addEventListener("DOMMouseScroll",f,!1),a.addEventListener(b,f,!1)):"mouseenter"===b||"mouseleave"===b?(g=f,h="mouseenter"===b?"mouseover":"mouseout",f=function(b){return e.DomEvent._checkMouse(a,b)?g(b):void 0},a.addEventListener(h,f,!1)):"click"===b&&e.Browser.android?(g=f,f=function(a){return e.DomEvent._filterClick(a,g)},a.addEventListener(b,f,!1)):a.addEventListener(b,f,!1):"attachEvent"in a&&a.attachEvent("on"+b,f),a[j]=f,this))},removeListener:function(a,b,c){var d=e.stamp(c),f="_leaflet_"+b+d,g=a[f];return g?(e.Browser.pointer&&0===b.indexOf("touch")?this.removePointerListener(a,b,d):e.Browser.touch&&"dblclick"===b&&this.removeDoubleTapListener?this.removeDoubleTapListener(a,d):"removeEventListener"in a?"mousewheel"===b?(a.removeEventListener("DOMMouseScroll",g,!1),a.removeEventListener(b,g,!1)):"mouseenter"===b||"mouseleave"===b?a.removeEventListener("mouseenter"===b?"mouseover":"mouseout",g,!1):a.removeEventListener(b,g,!1):"detachEvent"in a&&a.detachEvent("on"+b,g),a[f]=null,this):this},stopPropagation:function(a){return a.stopPropagation?a.stopPropagation():a.cancelBubble=!0,e.DomEvent._skipped(a),this},disableScrollPropagation:function(a){var b=e.DomEvent.stopPropagation;return e.DomEvent.on(a,"mousewheel",b).on(a,"MozMousePixelScroll",b)},disableClickPropagation:function(a){for(var b=e.DomEvent.stopPropagation,c=e.Draggable.START.length-1;c>=0;c--)e.DomEvent.on(a,e.Draggable.START[c],b);return e.DomEvent.on(a,"click",e.DomEvent._fakeStop).on(a,"dblclick",b)},preventDefault:function(a){return a.preventDefault?a.preventDefault():a.returnValue=!1,this},stop:function(a){return e.DomEvent.preventDefault(a).stopPropagation(a)},getMousePosition:function(a,b){if(!b)return new e.Point(a.clientX,a.clientY);var c=b.getBoundingClientRect();return new e.Point(a.clientX-c.left-b.clientLeft,a.clientY-c.top-b.clientTop)},getWheelDelta:function(a){var b=0;return a.wheelDelta&&(b=a.wheelDelta/120),a.detail&&(b=-a.detail/3),b},_skipEvents:{},_fakeStop:function(a){e.DomEvent._skipEvents[a.type]=!0},_skipped:function(a){var b=this._skipEvents[a.type];return this._skipEvents[a.type]=!1,b},_checkMouse:function(a,b){var c=b.relatedTarget;if(!c)return!0;try{for(;c&&c!==a;)c=c.parentNode}catch(d){return!1}return c!==a},_getEvent:function(){var b=a.event;if(!b)for(var c=arguments.callee.caller;c&&(b=c.arguments[0],!b||a.Event!==b.constructor);)c=c.caller;return b},_filterClick:function(a,b){var c=a.timeStamp||a.originalEvent.timeStamp,d=e.DomEvent._lastClick&&c-e.DomEvent._lastClick;return d&&d>100&&500>d||a.target._simulatedClick&&!a._simulated?void e.DomEvent.stop(a):(e.DomEvent._lastClick=c,b(a))}},e.DomEvent.on=e.DomEvent.addListener,e.DomEvent.off=e.DomEvent.removeListener,e.Draggable=e.Class.extend({includes:e.Mixin.Events,statics:{START:e.Browser.touch?["touchstart","mousedown"]:["mousedown"],END:{mousedown:"mouseup",touchstart:"touchend",pointerdown:"touchend",MSPointerDown:"touchend"},MOVE:{mousedown:"mousemove",touchstart:"touchmove",pointerdown:"touchmove",MSPointerDown:"touchmove"}},initialize:function(a,b){this._element=a,this._dragStartTarget=b||a},enable:function(){if(!this._enabled){for(var a=e.Draggable.START.length-1;a>=0;a--)e.DomEvent.on(this._dragStartTarget,e.Draggable.START[a],this._onDown,this);this._enabled=!0}},disable:function(){if(this._enabled){for(var a=e.Draggable.START.length-1;a>=0;a--)e.DomEvent.off(this._dragStartTarget,e.Draggable.START[a],this._onDown,this);this._enabled=!1,this._moved=!1}},_onDown:function(a){if(this._moved=!1,!(a.shiftKey||1!==a.which&&1!==a.button&&!a.touches||(e.DomEvent.stopPropagation(a),e.Draggable._disabled||(e.DomUtil.disableImageDrag(),e.DomUtil.disableTextSelection(),this._moving)))){var c=a.touches?a.touches[0]:a;this._startPoint=new e.Point(c.clientX,c.clientY),this._startPos=this._newPos=e.DomUtil.getPosition(this._element),e.DomEvent.on(b,e.Draggable.MOVE[a.type],this._onMove,this).on(b,e.Draggable.END[a.type],this._onUp,this)}},_onMove:function(a){if(a.touches&&a.touches.length>1)return void(this._moved=!0);var c=a.touches&&1===a.touches.length?a.touches[0]:a,d=new e.Point(c.clientX,c.clientY),f=d.subtract(this._startPoint);(f.x||f.y)&&(e.Browser.touch&&Math.abs(f.x)+Math.abs(f.y)<3||(e.DomEvent.preventDefault(a),this._moved||(this.fire("dragstart"),this._moved=!0,this._startPos=e.DomUtil.getPosition(this._element).subtract(f),e.DomUtil.addClass(b.body,"leaflet-dragging"),this._lastTarget=a.target||a.srcElement,e.DomUtil.addClass(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(f),this._moving=!0,e.Util.cancelAnimFrame(this._animRequest),this._animRequest=e.Util.requestAnimFrame(this._updatePosition,this,!0,this._dragStartTarget)))},_updatePosition:function(){this.fire("predrag"),e.DomUtil.setPosition(this._element,this._newPos),this.fire("drag")},_onUp:function(){e.DomUtil.removeClass(b.body,"leaflet-dragging"),this._lastTarget&&(e.DomUtil.removeClass(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null);for(var a in e.Draggable.MOVE)e.DomEvent.off(b,e.Draggable.MOVE[a],this._onMove).off(b,e.Draggable.END[a],this._onUp);e.DomUtil.enableImageDrag(),e.DomUtil.enableTextSelection(),this._moved&&this._moving&&(e.Util.cancelAnimFrame(this._animRequest),this.fire("dragend",{distance:this._newPos.distanceTo(this._startPos)})),this._moving=!1}}),e.Handler=e.Class.extend({initialize:function(a){this._map=a},enable:function(){this._enabled||(this._enabled=!0,this.addHooks())},disable:function(){this._enabled&&(this._enabled=!1,this.removeHooks())},enabled:function(){return!!this._enabled}}),e.Map.mergeOptions({dragging:!0,inertia:!e.Browser.android23,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,inertiaThreshold:e.Browser.touch?32:18,easeLinearity:.25,worldCopyJump:!1}),e.Map.Drag=e.Handler.extend({addHooks:function(){if(!this._draggable){var a=this._map;this._draggable=new e.Draggable(a._mapPane,a._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),a.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDrag,this),a.on("viewreset",this._onViewReset,this),a.whenReady(this._onViewReset,this))}this._draggable.enable()},removeHooks:function(){this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},_onDragStart:function(){var a=this._map;a._panAnim&&a._panAnim.stop(),a.fire("movestart").fire("dragstart"),a.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(){if(this._map.options.inertia){var a=this._lastTime=+new Date,b=this._lastPos=this._draggable._newPos;
this._positions.push(b),this._times.push(a),a-this._times[0]>200&&(this._positions.shift(),this._times.shift())}this._map.fire("move").fire("drag")},_onViewReset:function(){var a=this._map.getSize()._divideBy(2),b=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=b.subtract(a).x,this._worldWidth=this._map.project([0,180]).x},_onPreDrag:function(){var a=this._worldWidth,b=Math.round(a/2),c=this._initialWorldOffset,d=this._draggable._newPos.x,e=(d-b+c)%a+b-c,f=(d+b+c)%a-b-c,g=Math.abs(e+c)<Math.abs(f+c)?e:f;this._draggable._newPos.x=g},_onDragEnd:function(a){var b=this._map,c=b.options,d=+new Date-this._lastTime,f=!c.inertia||d>c.inertiaThreshold||!this._positions[0];if(b.fire("dragend",a),f)b.fire("moveend");else{var g=this._lastPos.subtract(this._positions[0]),h=(this._lastTime+d-this._times[0])/1e3,i=c.easeLinearity,j=g.multiplyBy(i/h),k=j.distanceTo([0,0]),l=Math.min(c.inertiaMaxSpeed,k),m=j.multiplyBy(l/k),n=l/(c.inertiaDeceleration*i),o=m.multiplyBy(-n/2).round();o.x&&o.y?(o=b._limitOffset(o,b.options.maxBounds),e.Util.requestAnimFrame(function(){b.panBy(o,{duration:n,easeLinearity:i,noMoveStart:!0})})):b.fire("moveend")}}}),e.Map.addInitHook("addHandler","dragging",e.Map.Drag),e.Map.mergeOptions({doubleClickZoom:!0}),e.Map.DoubleClickZoom=e.Handler.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(a){var b=this._map,c=b.getZoom()+(a.originalEvent.shiftKey?-1:1);"center"===b.options.doubleClickZoom?b.setZoom(c):b.setZoomAround(a.containerPoint,c)}}),e.Map.addInitHook("addHandler","doubleClickZoom",e.Map.DoubleClickZoom),e.Map.mergeOptions({scrollWheelZoom:!0}),e.Map.ScrollWheelZoom=e.Handler.extend({addHooks:function(){e.DomEvent.on(this._map._container,"mousewheel",this._onWheelScroll,this),e.DomEvent.on(this._map._container,"MozMousePixelScroll",e.DomEvent.preventDefault),this._delta=0},removeHooks:function(){e.DomEvent.off(this._map._container,"mousewheel",this._onWheelScroll),e.DomEvent.off(this._map._container,"MozMousePixelScroll",e.DomEvent.preventDefault)},_onWheelScroll:function(a){var b=e.DomEvent.getWheelDelta(a);this._delta+=b,this._lastMousePos=this._map.mouseEventToContainerPoint(a),this._startTime||(this._startTime=+new Date);var c=Math.max(40-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(e.bind(this._performZoom,this),c),e.DomEvent.preventDefault(a),e.DomEvent.stopPropagation(a)},_performZoom:function(){var a=this._map,b=this._delta,c=a.getZoom();b=b>0?Math.ceil(b):Math.floor(b),b=Math.max(Math.min(b,4),-4),b=a._limitZoom(c+b)-c,this._delta=0,this._startTime=null,b&&("center"===a.options.scrollWheelZoom?a.setZoom(c+b):a.setZoomAround(this._lastMousePos,c+b))}}),e.Map.addInitHook("addHandler","scrollWheelZoom",e.Map.ScrollWheelZoom),e.extend(e.DomEvent,{_touchstart:e.Browser.msPointer?"MSPointerDown":e.Browser.pointer?"pointerdown":"touchstart",_touchend:e.Browser.msPointer?"MSPointerUp":e.Browser.pointer?"pointerup":"touchend",addDoubleTapListener:function(a,c,d){function f(a){var b;if(e.Browser.pointer?(o.push(a.pointerId),b=o.length):b=a.touches.length,!(b>1)){var c=Date.now(),d=c-(h||c);i=a.touches?a.touches[0]:a,j=d>0&&k>=d,h=c}}function g(a){if(e.Browser.pointer){var b=o.indexOf(a.pointerId);if(-1===b)return;o.splice(b,1)}if(j){if(e.Browser.pointer){var d,f={};for(var g in i)d=i[g],f[g]="function"==typeof d?d.bind(i):d;i=f}i.type="dblclick",c(i),h=null}}var h,i,j=!1,k=250,l="_leaflet_",m=this._touchstart,n=this._touchend,o=[];a[l+m+d]=f,a[l+n+d]=g;var p=e.Browser.pointer?b.documentElement:a;return a.addEventListener(m,f,!1),p.addEventListener(n,g,!1),e.Browser.pointer&&p.addEventListener(e.DomEvent.POINTER_CANCEL,g,!1),this},removeDoubleTapListener:function(a,c){var d="_leaflet_";return a.removeEventListener(this._touchstart,a[d+this._touchstart+c],!1),(e.Browser.pointer?b.documentElement:a).removeEventListener(this._touchend,a[d+this._touchend+c],!1),e.Browser.pointer&&b.documentElement.removeEventListener(e.DomEvent.POINTER_CANCEL,a[d+this._touchend+c],!1),this}}),e.extend(e.DomEvent,{POINTER_DOWN:e.Browser.msPointer?"MSPointerDown":"pointerdown",POINTER_MOVE:e.Browser.msPointer?"MSPointerMove":"pointermove",POINTER_UP:e.Browser.msPointer?"MSPointerUp":"pointerup",POINTER_CANCEL:e.Browser.msPointer?"MSPointerCancel":"pointercancel",_pointers:[],_pointerDocumentListener:!1,addPointerListener:function(a,b,c,d){switch(b){case"touchstart":return this.addPointerListenerStart(a,b,c,d);case"touchend":return this.addPointerListenerEnd(a,b,c,d);case"touchmove":return this.addPointerListenerMove(a,b,c,d);default:throw"Unknown touch event type"}},addPointerListenerStart:function(a,c,d,f){var g="_leaflet_",h=this._pointers,i=function(a){e.DomEvent.preventDefault(a);for(var b=!1,c=0;c<h.length;c++)if(h[c].pointerId===a.pointerId){b=!0;break}b||h.push(a),a.touches=h.slice(),a.changedTouches=[a],d(a)};if(a[g+"touchstart"+f]=i,a.addEventListener(this.POINTER_DOWN,i,!1),!this._pointerDocumentListener){var j=function(a){for(var b=0;b<h.length;b++)if(h[b].pointerId===a.pointerId){h.splice(b,1);break}};b.documentElement.addEventListener(this.POINTER_UP,j,!1),b.documentElement.addEventListener(this.POINTER_CANCEL,j,!1),this._pointerDocumentListener=!0}return this},addPointerListenerMove:function(a,b,c,d){function e(a){if(a.pointerType!==a.MSPOINTER_TYPE_MOUSE&&"mouse"!==a.pointerType||0!==a.buttons){for(var b=0;b<g.length;b++)if(g[b].pointerId===a.pointerId){g[b]=a;break}a.touches=g.slice(),a.changedTouches=[a],c(a)}}var f="_leaflet_",g=this._pointers;return a[f+"touchmove"+d]=e,a.addEventListener(this.POINTER_MOVE,e,!1),this},addPointerListenerEnd:function(a,b,c,d){var e="_leaflet_",f=this._pointers,g=function(a){for(var b=0;b<f.length;b++)if(f[b].pointerId===a.pointerId){f.splice(b,1);break}a.touches=f.slice(),a.changedTouches=[a],c(a)};return a[e+"touchend"+d]=g,a.addEventListener(this.POINTER_UP,g,!1),a.addEventListener(this.POINTER_CANCEL,g,!1),this},removePointerListener:function(a,b,c){var d="_leaflet_",e=a[d+b+c];switch(b){case"touchstart":a.removeEventListener(this.POINTER_DOWN,e,!1);break;case"touchmove":a.removeEventListener(this.POINTER_MOVE,e,!1);break;case"touchend":a.removeEventListener(this.POINTER_UP,e,!1),a.removeEventListener(this.POINTER_CANCEL,e,!1)}return this}}),e.Map.mergeOptions({touchZoom:e.Browser.touch&&!e.Browser.android23,bounceAtZoomLimits:!0}),e.Map.TouchZoom=e.Handler.extend({addHooks:function(){e.DomEvent.on(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){e.DomEvent.off(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(a){var c=this._map;if(a.touches&&2===a.touches.length&&!c._animatingZoom&&!this._zooming){var d=c.mouseEventToLayerPoint(a.touches[0]),f=c.mouseEventToLayerPoint(a.touches[1]),g=c._getCenterLayerPoint();this._startCenter=d.add(f)._divideBy(2),this._startDist=d.distanceTo(f),this._moved=!1,this._zooming=!0,this._centerOffset=g.subtract(this._startCenter),c._panAnim&&c._panAnim.stop(),e.DomEvent.on(b,"touchmove",this._onTouchMove,this).on(b,"touchend",this._onTouchEnd,this),e.DomEvent.preventDefault(a)}},_onTouchMove:function(a){var b=this._map;if(a.touches&&2===a.touches.length&&this._zooming){var c=b.mouseEventToLayerPoint(a.touches[0]),d=b.mouseEventToLayerPoint(a.touches[1]);this._scale=c.distanceTo(d)/this._startDist,this._delta=c._add(d)._divideBy(2)._subtract(this._startCenter),1!==this._scale&&(b.options.bounceAtZoomLimits||!(b.getZoom()===b.getMinZoom()&&this._scale<1||b.getZoom()===b.getMaxZoom()&&this._scale>1))&&(this._moved||(e.DomUtil.addClass(b._mapPane,"leaflet-touching"),b.fire("movestart").fire("zoomstart"),this._moved=!0),e.Util.cancelAnimFrame(this._animRequest),this._animRequest=e.Util.requestAnimFrame(this._updateOnMove,this,!0,this._map._container),e.DomEvent.preventDefault(a))}},_updateOnMove:function(){var a=this._map,b=this._getScaleOrigin(),c=a.layerPointToLatLng(b),d=a.getScaleZoom(this._scale);a._animateZoom(c,d,this._startCenter,this._scale,this._delta,!1,!0)},_onTouchEnd:function(){if(!this._moved||!this._zooming)return void(this._zooming=!1);var a=this._map;this._zooming=!1,e.DomUtil.removeClass(a._mapPane,"leaflet-touching"),e.Util.cancelAnimFrame(this._animRequest),e.DomEvent.off(b,"touchmove",this._onTouchMove).off(b,"touchend",this._onTouchEnd);var c=this._getScaleOrigin(),d=a.layerPointToLatLng(c),f=a.getZoom(),g=a.getScaleZoom(this._scale)-f,h=g>0?Math.ceil(g):Math.floor(g),i=a._limitZoom(f+h),j=a.getZoomScale(i)/this._scale;a._animateZoom(d,i,c,j)},_getScaleOrigin:function(){var a=this._centerOffset.subtract(this._delta).divideBy(this._scale);return this._startCenter.add(a)}}),e.Map.addInitHook("addHandler","touchZoom",e.Map.TouchZoom),e.Map.mergeOptions({tap:!0,tapTolerance:15}),e.Map.Tap=e.Handler.extend({addHooks:function(){e.DomEvent.on(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){e.DomEvent.off(this._map._container,"touchstart",this._onDown,this)},_onDown:function(a){if(a.touches){if(e.DomEvent.preventDefault(a),this._fireClick=!0,a.touches.length>1)return this._fireClick=!1,void clearTimeout(this._holdTimeout);var c=a.touches[0],d=c.target;this._startPos=this._newPos=new e.Point(c.clientX,c.clientY),d.tagName&&"a"===d.tagName.toLowerCase()&&e.DomUtil.addClass(d,"leaflet-active"),this._holdTimeout=setTimeout(e.bind(function(){this._isTapValid()&&(this._fireClick=!1,this._onUp(),this._simulateEvent("contextmenu",c))},this),1e3),e.DomEvent.on(b,"touchmove",this._onMove,this).on(b,"touchend",this._onUp,this)}},_onUp:function(a){if(clearTimeout(this._holdTimeout),e.DomEvent.off(b,"touchmove",this._onMove,this).off(b,"touchend",this._onUp,this),this._fireClick&&a&&a.changedTouches){var c=a.changedTouches[0],d=c.target;d&&d.tagName&&"a"===d.tagName.toLowerCase()&&e.DomUtil.removeClass(d,"leaflet-active"),this._isTapValid()&&this._simulateEvent("click",c)}},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_onMove:function(a){var b=a.touches[0];this._newPos=new e.Point(b.clientX,b.clientY)},_simulateEvent:function(c,d){var e=b.createEvent("MouseEvents");e._simulated=!0,d.target._simulatedClick=!0,e.initMouseEvent(c,!0,!0,a,1,d.screenX,d.screenY,d.clientX,d.clientY,!1,!1,!1,!1,0,null),d.target.dispatchEvent(e)}}),e.Browser.touch&&!e.Browser.pointer&&e.Map.addInitHook("addHandler","tap",e.Map.Tap),e.Map.mergeOptions({boxZoom:!0}),e.Map.BoxZoom=e.Handler.extend({initialize:function(a){this._map=a,this._container=a._container,this._pane=a._panes.overlayPane,this._moved=!1},addHooks:function(){e.DomEvent.on(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){e.DomEvent.off(this._container,"mousedown",this._onMouseDown),this._moved=!1},moved:function(){return this._moved},_onMouseDown:function(a){return this._moved=!1,!a.shiftKey||1!==a.which&&1!==a.button?!1:(e.DomUtil.disableTextSelection(),e.DomUtil.disableImageDrag(),this._startLayerPoint=this._map.mouseEventToLayerPoint(a),void e.DomEvent.on(b,"mousemove",this._onMouseMove,this).on(b,"mouseup",this._onMouseUp,this).on(b,"keydown",this._onKeyDown,this))},_onMouseMove:function(a){this._moved||(this._box=e.DomUtil.create("div","leaflet-zoom-box",this._pane),e.DomUtil.setPosition(this._box,this._startLayerPoint),this._container.style.cursor="crosshair",this._map.fire("boxzoomstart"));var b=this._startLayerPoint,c=this._box,d=this._map.mouseEventToLayerPoint(a),f=d.subtract(b),g=new e.Point(Math.min(d.x,b.x),Math.min(d.y,b.y));e.DomUtil.setPosition(c,g),this._moved=!0,c.style.width=Math.max(0,Math.abs(f.x)-4)+"px",c.style.height=Math.max(0,Math.abs(f.y)-4)+"px"},_finish:function(){this._moved&&(this._pane.removeChild(this._box),this._container.style.cursor=""),e.DomUtil.enableTextSelection(),e.DomUtil.enableImageDrag(),e.DomEvent.off(b,"mousemove",this._onMouseMove).off(b,"mouseup",this._onMouseUp).off(b,"keydown",this._onKeyDown)},_onMouseUp:function(a){this._finish();var b=this._map,c=b.mouseEventToLayerPoint(a);if(!this._startLayerPoint.equals(c)){var d=new e.LatLngBounds(b.layerPointToLatLng(this._startLayerPoint),b.layerPointToLatLng(c));b.fitBounds(d),b.fire("boxzoomend",{boxZoomBounds:d})}},_onKeyDown:function(a){27===a.keyCode&&this._finish()}}),e.Map.addInitHook("addHandler","boxZoom",e.Map.BoxZoom),e.Map.mergeOptions({keyboard:!0,keyboardPanOffset:80,keyboardZoomOffset:1}),e.Map.Keyboard=e.Handler.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,173]},initialize:function(a){this._map=a,this._setPanOffset(a.options.keyboardPanOffset),this._setZoomOffset(a.options.keyboardZoomOffset)},addHooks:function(){var a=this._map._container;-1===a.tabIndex&&(a.tabIndex="0"),e.DomEvent.on(a,"focus",this._onFocus,this).on(a,"blur",this._onBlur,this).on(a,"mousedown",this._onMouseDown,this),this._map.on("focus",this._addHooks,this).on("blur",this._removeHooks,this)},removeHooks:function(){this._removeHooks();var a=this._map._container;e.DomEvent.off(a,"focus",this._onFocus,this).off(a,"blur",this._onBlur,this).off(a,"mousedown",this._onMouseDown,this),this._map.off("focus",this._addHooks,this).off("blur",this._removeHooks,this)},_onMouseDown:function(){if(!this._focused){var c=b.body,d=b.documentElement,e=c.scrollTop||d.scrollTop,f=c.scrollLeft||d.scrollLeft;this._map._container.focus(),a.scrollTo(f,e)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanOffset:function(a){var b,c,d=this._panKeys={},e=this.keyCodes;for(b=0,c=e.left.length;c>b;b++)d[e.left[b]]=[-1*a,0];for(b=0,c=e.right.length;c>b;b++)d[e.right[b]]=[a,0];for(b=0,c=e.down.length;c>b;b++)d[e.down[b]]=[0,a];for(b=0,c=e.up.length;c>b;b++)d[e.up[b]]=[0,-1*a]},_setZoomOffset:function(a){var b,c,d=this._zoomKeys={},e=this.keyCodes;for(b=0,c=e.zoomIn.length;c>b;b++)d[e.zoomIn[b]]=a;for(b=0,c=e.zoomOut.length;c>b;b++)d[e.zoomOut[b]]=-a},_addHooks:function(){e.DomEvent.on(b,"keydown",this._onKeyDown,this)},_removeHooks:function(){e.DomEvent.off(b,"keydown",this._onKeyDown,this)},_onKeyDown:function(a){var b=a.keyCode,c=this._map;if(b in this._panKeys){if(c._panAnim&&c._panAnim._inProgress)return;c.panBy(this._panKeys[b]),c.options.maxBounds&&c.panInsideBounds(c.options.maxBounds)}else{if(!(b in this._zoomKeys))return;c.setZoom(c.getZoom()+this._zoomKeys[b])}e.DomEvent.stop(a)}}),e.Map.addInitHook("addHandler","keyboard",e.Map.Keyboard),e.Handler.MarkerDrag=e.Handler.extend({initialize:function(a){this._marker=a},addHooks:function(){var a=this._marker._icon;this._draggable||(this._draggable=new e.Draggable(a,a)),this._draggable.on("dragstart",this._onDragStart,this).on("drag",this._onDrag,this).on("dragend",this._onDragEnd,this),this._draggable.enable(),e.DomUtil.addClass(this._marker._icon,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off("dragstart",this._onDragStart,this).off("drag",this._onDrag,this).off("dragend",this._onDragEnd,this),this._draggable.disable(),e.DomUtil.removeClass(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_onDragStart:function(){this._marker.closePopup().fire("movestart").fire("dragstart")},_onDrag:function(){var a=this._marker,b=a._shadow,c=e.DomUtil.getPosition(a._icon),d=a._map.layerPointToLatLng(c);b&&e.DomUtil.setPosition(b,c),a._latlng=d,a.fire("move",{latlng:d}).fire("drag")},_onDragEnd:function(a){this._marker.fire("moveend").fire("dragend",a)}}),e.Control=e.Class.extend({options:{position:"topright"},initialize:function(a){e.setOptions(this,a)},getPosition:function(){return this.options.position},setPosition:function(a){var b=this._map;return b&&b.removeControl(this),this.options.position=a,b&&b.addControl(this),this},getContainer:function(){return this._container},addTo:function(a){this._map=a;var b=this._container=this.onAdd(a),c=this.getPosition(),d=a._controlCorners[c];return e.DomUtil.addClass(b,"leaflet-control"),-1!==c.indexOf("bottom")?d.insertBefore(b,d.firstChild):d.appendChild(b),this},removeFrom:function(a){var b=this.getPosition(),c=a._controlCorners[b];return c.removeChild(this._container),this._map=null,this.onRemove&&this.onRemove(a),this},_refocusOnMap:function(){this._map&&this._map.getContainer().focus()}}),e.control=function(a){return new e.Control(a)},e.Map.include({addControl:function(a){return a.addTo(this),this},removeControl:function(a){return a.removeFrom(this),this},_initControlPos:function(){function a(a,f){var g=c+a+" "+c+f;b[a+f]=e.DomUtil.create("div",g,d)}var b=this._controlCorners={},c="leaflet-",d=this._controlContainer=e.DomUtil.create("div",c+"control-container",this._container);a("top","left"),a("top","right"),a("bottom","left"),a("bottom","right")},_clearControlPos:function(){this._container.removeChild(this._controlContainer)}}),e.Control.Zoom=e.Control.extend({options:{position:"topleft",zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"-",zoomOutTitle:"Zoom out"},onAdd:function(a){var b="leaflet-control-zoom",c=e.DomUtil.create("div",b+" leaflet-bar");return this._map=a,this._zoomInButton=this._createButton(this.options.zoomInText,this.options.zoomInTitle,b+"-in",c,this._zoomIn,this),this._zoomOutButton=this._createButton(this.options.zoomOutText,this.options.zoomOutTitle,b+"-out",c,this._zoomOut,this),this._updateDisabled(),a.on("zoomend zoomlevelschange",this._updateDisabled,this),c},onRemove:function(a){a.off("zoomend zoomlevelschange",this._updateDisabled,this)},_zoomIn:function(a){this._map.zoomIn(a.shiftKey?3:1)},_zoomOut:function(a){this._map.zoomOut(a.shiftKey?3:1)},_createButton:function(a,b,c,d,f,g){var h=e.DomUtil.create("a",c,d);h.innerHTML=a,h.href="#",h.title=b;var i=e.DomEvent.stopPropagation;return e.DomEvent.on(h,"click",i).on(h,"mousedown",i).on(h,"dblclick",i).on(h,"click",e.DomEvent.preventDefault).on(h,"click",f,g).on(h,"click",this._refocusOnMap,g),h},_updateDisabled:function(){var a=this._map,b="leaflet-disabled";e.DomUtil.removeClass(this._zoomInButton,b),e.DomUtil.removeClass(this._zoomOutButton,b),a._zoom===a.getMinZoom()&&e.DomUtil.addClass(this._zoomOutButton,b),a._zoom===a.getMaxZoom()&&e.DomUtil.addClass(this._zoomInButton,b)}}),e.Map.mergeOptions({zoomControl:!0}),e.Map.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new e.Control.Zoom,this.addControl(this.zoomControl))}),e.control.zoom=function(a){return new e.Control.Zoom(a)},e.Control.Attribution=e.Control.extend({options:{position:"bottomright",prefix:'<a href="http://leafletjs.com" title="A JS library for interactive maps">Leaflet</a>'},initialize:function(a){e.setOptions(this,a),this._attributions={}},onAdd:function(a){this._container=e.DomUtil.create("div","leaflet-control-attribution"),e.DomEvent.disableClickPropagation(this._container);for(var b in a._layers)a._layers[b].getAttribution&&this.addAttribution(a._layers[b].getAttribution());return a.on("layeradd",this._onLayerAdd,this).on("layerremove",this._onLayerRemove,this),this._update(),this._container},onRemove:function(a){a.off("layeradd",this._onLayerAdd).off("layerremove",this._onLayerRemove)},setPrefix:function(a){return this.options.prefix=a,this._update(),this},addAttribution:function(a){return a?(this._attributions[a]||(this._attributions[a]=0),this._attributions[a]++,this._update(),this):void 0},removeAttribution:function(a){return a?(this._attributions[a]&&(this._attributions[a]--,this._update()),this):void 0},_update:function(){if(this._map){var a=[];for(var b in this._attributions)this._attributions[b]&&a.push(b);var c=[];this.options.prefix&&c.push(this.options.prefix),a.length&&c.push(a.join(", ")),this._container.innerHTML=c.join(" | ")}},_onLayerAdd:function(a){a.layer.getAttribution&&this.addAttribution(a.layer.getAttribution())},_onLayerRemove:function(a){a.layer.getAttribution&&this.removeAttribution(a.layer.getAttribution())}}),e.Map.mergeOptions({attributionControl:!0}),e.Map.addInitHook(function(){this.options.attributionControl&&(this.attributionControl=(new e.Control.Attribution).addTo(this))}),e.control.attribution=function(a){return new e.Control.Attribution(a)},e.Control.Scale=e.Control.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0,updateWhenIdle:!1},onAdd:function(a){this._map=a;var b="leaflet-control-scale",c=e.DomUtil.create("div",b),d=this.options;return this._addScales(d,b,c),a.on(d.updateWhenIdle?"moveend":"move",this._update,this),a.whenReady(this._update,this),c},onRemove:function(a){a.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(a,b,c){a.metric&&(this._mScale=e.DomUtil.create("div",b+"-line",c)),a.imperial&&(this._iScale=e.DomUtil.create("div",b+"-line",c))},_update:function(){var a=this._map.getBounds(),b=a.getCenter().lat,c=6378137*Math.PI*Math.cos(b*Math.PI/180),d=c*(a.getNorthEast().lng-a.getSouthWest().lng)/180,e=this._map.getSize(),f=this.options,g=0;e.x>0&&(g=d*(f.maxWidth/e.x)),this._updateScales(f,g)},_updateScales:function(a,b){a.metric&&b&&this._updateMetric(b),a.imperial&&b&&this._updateImperial(b)},_updateMetric:function(a){var b=this._getRoundNum(a);this._mScale.style.width=this._getScaleWidth(b/a)+"px",this._mScale.innerHTML=1e3>b?b+" m":b/1e3+" km"},_updateImperial:function(a){var b,c,d,e=3.2808399*a,f=this._iScale;e>5280?(b=e/5280,c=this._getRoundNum(b),f.style.width=this._getScaleWidth(c/b)+"px",f.innerHTML=c+" mi"):(d=this._getRoundNum(e),f.style.width=this._getScaleWidth(d/e)+"px",f.innerHTML=d+" ft")},_getScaleWidth:function(a){return Math.round(this.options.maxWidth*a)-10},_getRoundNum:function(a){var b=Math.pow(10,(Math.floor(a)+"").length-1),c=a/b;return c=c>=10?10:c>=5?5:c>=3?3:c>=2?2:1,b*c}}),e.control.scale=function(a){return new e.Control.Scale(a)},e.Control.Layers=e.Control.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0},initialize:function(a,b,c){e.setOptions(this,c),this._layers={},this._lastZIndex=0,this._handlingClick=!1;for(var d in a)this._addLayer(a[d],d);for(d in b)this._addLayer(b[d],d,!0)},onAdd:function(a){return this._initLayout(),this._update(),a.on("layeradd",this._onLayerChange,this).on("layerremove",this._onLayerChange,this),this._container},onRemove:function(a){a.off("layeradd",this._onLayerChange,this).off("layerremove",this._onLayerChange,this)},addBaseLayer:function(a,b){return this._addLayer(a,b),this._update(),this},addOverlay:function(a,b){return this._addLayer(a,b,!0),this._update(),this},removeLayer:function(a){var b=e.stamp(a);return delete this._layers[b],this._update(),this},_initLayout:function(){var a="leaflet-control-layers",b=this._container=e.DomUtil.create("div",a);b.setAttribute("aria-haspopup",!0),e.Browser.touch?e.DomEvent.on(b,"click",e.DomEvent.stopPropagation):e.DomEvent.disableClickPropagation(b).disableScrollPropagation(b);var c=this._form=e.DomUtil.create("form",a+"-list");if(this.options.collapsed){e.Browser.android||e.DomEvent.on(b,"mouseover",this._expand,this).on(b,"mouseout",this._collapse,this);var d=this._layersLink=e.DomUtil.create("a",a+"-toggle",b);d.href="#",d.title="Layers",e.Browser.touch?e.DomEvent.on(d,"click",e.DomEvent.stop).on(d,"click",this._expand,this):e.DomEvent.on(d,"focus",this._expand,this),e.DomEvent.on(c,"click",function(){setTimeout(e.bind(this._onInputClick,this),0)},this),this._map.on("click",this._collapse,this)}else this._expand();this._baseLayersList=e.DomUtil.create("div",a+"-base",c),this._separator=e.DomUtil.create("div",a+"-separator",c),this._overlaysList=e.DomUtil.create("div",a+"-overlays",c),b.appendChild(c)},_addLayer:function(a,b,c){var d=e.stamp(a);this._layers[d]={layer:a,name:b,overlay:c},this.options.autoZIndex&&a.setZIndex&&(this._lastZIndex++,a.setZIndex(this._lastZIndex))},_update:function(){if(this._container){this._baseLayersList.innerHTML="",this._overlaysList.innerHTML="";var a,b,c=!1,d=!1;for(a in this._layers)b=this._layers[a],this._addItem(b),d=d||b.overlay,c=c||!b.overlay;this._separator.style.display=d&&c?"":"none"}},_onLayerChange:function(a){var b=this._layers[e.stamp(a.layer)];if(b){this._handlingClick||this._update();var c=b.overlay?"layeradd"===a.type?"overlayadd":"overlayremove":"layeradd"===a.type?"baselayerchange":null;c&&this._map.fire(c,b)}},_createRadioElement:function(a,c){var d='<input type="radio" class="leaflet-control-layers-selector" name="'+a+'"';c&&(d+=' checked="checked"'),d+="/>";var e=b.createElement("div");return e.innerHTML=d,e.firstChild},_addItem:function(a){var c,d=b.createElement("label"),f=this._map.hasLayer(a.layer);a.overlay?(c=b.createElement("input"),c.type="checkbox",c.className="leaflet-control-layers-selector",c.defaultChecked=f):c=this._createRadioElement("leaflet-base-layers",f),c.layerId=e.stamp(a.layer),e.DomEvent.on(c,"click",this._onInputClick,this);var g=b.createElement("span");g.innerHTML=" "+a.name,d.appendChild(c),d.appendChild(g);var h=a.overlay?this._overlaysList:this._baseLayersList;return h.appendChild(d),d},_onInputClick:function(){var a,b,c,d=this._form.getElementsByTagName("input"),e=d.length;for(this._handlingClick=!0,a=0;e>a;a++)b=d[a],c=this._layers[b.layerId],b.checked&&!this._map.hasLayer(c.layer)?this._map.addLayer(c.layer):!b.checked&&this._map.hasLayer(c.layer)&&this._map.removeLayer(c.layer);this._handlingClick=!1,this._refocusOnMap()},_expand:function(){e.DomUtil.addClass(this._container,"leaflet-control-layers-expanded")},_collapse:function(){this._container.className=this._container.className.replace(" leaflet-control-layers-expanded","")}}),e.control.layers=function(a,b,c){return new e.Control.Layers(a,b,c)},e.PosAnimation=e.Class.extend({includes:e.Mixin.Events,run:function(a,b,c,d){this.stop(),this._el=a,this._inProgress=!0,this._newPos=b,this.fire("start"),a.style[e.DomUtil.TRANSITION]="all "+(c||.25)+"s cubic-bezier(0,0,"+(d||.5)+",1)",e.DomEvent.on(a,e.DomUtil.TRANSITION_END,this._onTransitionEnd,this),e.DomUtil.setPosition(a,b),e.Util.falseFn(a.offsetWidth),this._stepTimer=setInterval(e.bind(this._onStep,this),50)},stop:function(){this._inProgress&&(e.DomUtil.setPosition(this._el,this._getPos()),this._onTransitionEnd(),e.Util.falseFn(this._el.offsetWidth))},_onStep:function(){var a=this._getPos();return a?(this._el._leaflet_pos=a,void this.fire("step")):void this._onTransitionEnd()},_transformRe:/([-+]?(?:\d*\.)?\d+)\D*, ([-+]?(?:\d*\.)?\d+)\D*\)/,_getPos:function(){var b,c,d,f=this._el,g=a.getComputedStyle(f);if(e.Browser.any3d){if(d=g[e.DomUtil.TRANSFORM].match(this._transformRe),!d)return;b=parseFloat(d[1]),c=parseFloat(d[2])}else b=parseFloat(g.left),c=parseFloat(g.top);return new e.Point(b,c,!0)},_onTransitionEnd:function(){e.DomEvent.off(this._el,e.DomUtil.TRANSITION_END,this._onTransitionEnd,this),this._inProgress&&(this._inProgress=!1,this._el.style[e.DomUtil.TRANSITION]="",this._el._leaflet_pos=this._newPos,clearInterval(this._stepTimer),this.fire("step").fire("end"))}}),e.Map.include({setView:function(a,b,d){if(b=b===c?this._zoom:this._limitZoom(b),a=this._limitCenter(e.latLng(a),b,this.options.maxBounds),d=d||{},this._panAnim&&this._panAnim.stop(),this._loaded&&!d.reset&&d!==!0){d.animate!==c&&(d.zoom=e.extend({animate:d.animate},d.zoom),d.pan=e.extend({animate:d.animate},d.pan));var f=this._zoom!==b?this._tryAnimatedZoom&&this._tryAnimatedZoom(a,b,d.zoom):this._tryAnimatedPan(a,d.pan);if(f)return clearTimeout(this._sizeTimer),this}return this._resetView(a,b),this},panBy:function(a,b){if(a=e.point(a).round(),b=b||{},!a.x&&!a.y)return this;if(this._panAnim||(this._panAnim=new e.PosAnimation,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),b.noMoveStart||this.fire("movestart"),b.animate!==!1){e.DomUtil.addClass(this._mapPane,"leaflet-pan-anim");var c=this._getMapPanePos().subtract(a);this._panAnim.run(this._mapPane,c,b.duration||.25,b.easeLinearity)}else this._rawPanBy(a),this.fire("move").fire("moveend");return this},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){e.DomUtil.removeClass(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(a,b){var c=this._getCenterOffset(a)._floor();return(b&&b.animate)===!0||this.getSize().contains(c)?(this.panBy(c,b),!0):!1}}),e.PosAnimation=e.DomUtil.TRANSITION?e.PosAnimation:e.PosAnimation.extend({run:function(a,b,c,d){this.stop(),this._el=a,this._inProgress=!0,this._duration=c||.25,this._easeOutPower=1/Math.max(d||.5,.2),this._startPos=e.DomUtil.getPosition(a),this._offset=b.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(),this._complete())},_animate:function(){this._animId=e.Util.requestAnimFrame(this._animate,this),this._step()},_step:function(){var a=+new Date-this._startTime,b=1e3*this._duration;b>a?this._runFrame(this._easeOut(a/b)):(this._runFrame(1),this._complete())},_runFrame:function(a){var b=this._startPos.add(this._offset.multiplyBy(a));e.DomUtil.setPosition(this._el,b),this.fire("step")},_complete:function(){e.Util.cancelAnimFrame(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(a){return 1-Math.pow(1-a,this._easeOutPower)}}),e.Map.mergeOptions({zoomAnimation:!0,zoomAnimationThreshold:4}),e.DomUtil.TRANSITION&&e.Map.addInitHook(function(){this._zoomAnimated=this.options.zoomAnimation&&e.DomUtil.TRANSITION&&e.Browser.any3d&&!e.Browser.android23&&!e.Browser.mobileOpera,this._zoomAnimated&&e.DomEvent.on(this._mapPane,e.DomUtil.TRANSITION_END,this._catchTransitionEnd,this)}),e.Map.include(e.DomUtil.TRANSITION?{_catchTransitionEnd:function(a){this._animatingZoom&&a.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(a,b,c){if(this._animatingZoom)return!0;if(c=c||{},!this._zoomAnimated||c.animate===!1||this._nothingToAnimate()||Math.abs(b-this._zoom)>this.options.zoomAnimationThreshold)return!1;var d=this.getZoomScale(b),e=this._getCenterOffset(a)._divideBy(1-1/d),f=this._getCenterLayerPoint()._add(e);return c.animate===!0||this.getSize().contains(e)?(this.fire("movestart").fire("zoomstart"),this._animateZoom(a,b,f,d,null,!0),!0):!1},_animateZoom:function(a,b,c,d,f,g,h){h||(this._animatingZoom=!0),e.DomUtil.addClass(this._mapPane,"leaflet-zoom-anim"),this._animateToCenter=a,this._animateToZoom=b,e.Draggable&&(e.Draggable._disabled=!0),e.Util.requestAnimFrame(function(){this.fire("zoomanim",{center:a,zoom:b,origin:c,scale:d,delta:f,backwards:g})},this)},_onZoomTransitionEnd:function(){this._animatingZoom=!1,e.DomUtil.removeClass(this._mapPane,"leaflet-zoom-anim"),this._resetView(this._animateToCenter,this._animateToZoom,!0,!0),e.Draggable&&(e.Draggable._disabled=!1)}}:{}),e.TileLayer.include({_animateZoom:function(a){this._animating||(this._animating=!0,this._prepareBgBuffer());var b=this._bgBuffer,c=e.DomUtil.TRANSFORM,d=a.delta?e.DomUtil.getTranslateString(a.delta):b.style[c],f=e.DomUtil.getScaleString(a.scale,a.origin);b.style[c]=a.backwards?f+" "+d:d+" "+f},_endZoomAnim:function(){var a=this._tileContainer,b=this._bgBuffer;a.style.visibility="",a.parentNode.appendChild(a),e.Util.falseFn(b.offsetWidth),this._animating=!1},_clearBgBuffer:function(){var a=this._map;!a||a._animatingZoom||a.touchZoom._zooming||(this._bgBuffer.innerHTML="",this._bgBuffer.style[e.DomUtil.TRANSFORM]="")},_prepareBgBuffer:function(){var a=this._tileContainer,b=this._bgBuffer,c=this._getLoadedTilesPercentage(b),d=this._getLoadedTilesPercentage(a);return b&&c>.5&&.5>d?(a.style.visibility="hidden",void this._stopLoadingImages(a)):(b.style.visibility="hidden",b.style[e.DomUtil.TRANSFORM]="",this._tileContainer=b,b=this._bgBuffer=a,this._stopLoadingImages(b),void clearTimeout(this._clearBgBufferTimer))},_getLoadedTilesPercentage:function(a){var b,c,d=a.getElementsByTagName("img"),e=0;for(b=0,c=d.length;c>b;b++)d[b].complete&&e++;
return e/c},_stopLoadingImages:function(a){var b,c,d,f=Array.prototype.slice.call(a.getElementsByTagName("img"));for(b=0,c=f.length;c>b;b++)d=f[b],d.complete||(d.onload=e.Util.falseFn,d.onerror=e.Util.falseFn,d.src=e.Util.emptyImageUrl,d.parentNode.removeChild(d))}}),e.Map.include({_defaultLocateOptions:{watch:!1,setView:!1,maxZoom:1/0,timeout:1e4,maximumAge:0,enableHighAccuracy:!1},locate:function(a){if(a=this._locateOptions=e.extend(this._defaultLocateOptions,a),!navigator.geolocation)return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var b=e.bind(this._handleGeolocationResponse,this),c=e.bind(this._handleGeolocationError,this);return a.watch?this._locationWatchId=navigator.geolocation.watchPosition(b,c,a):navigator.geolocation.getCurrentPosition(b,c,a),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(a){var b=a.code,c=a.message||(1===b?"permission denied":2===b?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:b,message:"Geolocation error: "+c+"."})},_handleGeolocationResponse:function(a){var b=a.coords.latitude,c=a.coords.longitude,d=new e.LatLng(b,c),f=180*a.coords.accuracy/40075017,g=f/Math.cos(e.LatLng.DEG_TO_RAD*b),h=e.latLngBounds([b-f,c-g],[b+f,c+g]),i=this._locateOptions;if(i.setView){var j=Math.min(this.getBoundsZoom(h),i.maxZoom);this.setView(d,j)}var k={latlng:d,bounds:h,timestamp:a.timestamp};for(var l in a.coords)"number"==typeof a.coords[l]&&(k[l]=a.coords[l]);this.fire("locationfound",k)}})}(window,document);var LZMA=function(){function a(a,b){postMessage({action:3,callback_num:b,result:a})}function b(){return Zf}function c(){}function d(){return $f}function e(){}function f(){return _f}function g(){}function h(a,b){return a.detailMessage=b,a}function i(){return ag}function j(){}function k(a){return a}function l(){return bg}function m(){}function n(a,b){a[a.explicitLength++]=b}function o(a,b){a[a.explicitLength++]=b}function p(a){var b,c;return c=a.join(""),a.length=a.explicitLength=0,b=c,a[a.explicitLength++]=b,b}function q(a,b){var c=new Array(b);if(a>0)for(var d=[null,0,!1,[0,0]][a],e=0;b>e;++e)c[e]=d;return c}function r(){return this.arrayClass$}function s(a,b,c,d,e){var f;return f=q(e,d),w(),y(f,Kf,Lf),f.arrayClass$=a,f.typeId$=b,f.queryId$=c,f}function t(a,b,c,d){return w(),y(d,Kf,Lf),d.arrayClass$=a,d.typeId$=b,d.queryId$=c,d}function u(a,b,c){if(null!=c){if(a.queryId$>0&&!A(c.typeId$,a.queryId$))throw new Bb;if(a.queryId$<0&&(c.typeMarker$==tf||2==c.typeId$))throw new Bb}return a[b]=c}function v(){}function w(){w=tf,Kf=[],Lf=[],x(new v,Kf,Lf)}function x(a,b,c){var d,e=0;for(var f in a)(d=a[f])&&(b[e]=f,c[e]=d,++e)}function y(a,b,c){w();for(var d=0,e=b.length;e>d;++d)a[b[d]]=c[d]}function z(a,b){return a&&!!Vf[a][b]}function A(a,b){return a&&Vf[a][b]}function B(a,b){if(null!=a&&!A(a.typeId$,b))throw new Ib;return a}function C(a,b){return null!=a&&z(a.typeId$,b)}function D(a){return~~Math.max(Math.min(a,2147483647),-2147483648)}function E(a){return null!=a&&z(a.typeId$,2)?a:k(new m,a)}function F(a,b){var c,d;return c=a[1]+b[1],d=a[0]+b[0],J(d,c)}function G(a,b,c){return 0==b?a:0==c?a:F(a,J(b*c,0))}function H(a,b){return Q(~~Math.max(Math.min(a[1]/4294967296,2147483647),-2147483648)&~~Math.max(Math.min(b[1]/4294967296,2147483647),-2147483648),P(a)&P(b))}function I(a,b){var c,d;return a[0]==b[0]&&a[1]==b[1]?0:(c=a[1]<0,d=b[1]<0,c&&!d?-1:!c&&d?1:Y(a,b)[1]<0?-1:1)}function J(a,b){var c,d;for(b%=0x10000000000000000,a%=0x10000000000000000,c=b%4294967296,d=4294967296*Math.floor(a/4294967296),b=b-c+d,a=a-d+c;0>a;)a+=4294967296,b-=4294967296;for(;a>4294967295;)a-=4294967296,b+=4294967296;for(b%=0x10000000000000000;b>0x7fffffff00000000;)b-=0x10000000000000000;for(;-0x8000000000000000>b;)b+=0x10000000000000000;return[a,b]}function K(a,b){var c,d,e,f,g,h;if(0==b[0]&&0==b[1])throw wb(new yb,"/ by zero");if(0==a[0]&&0==a[1])return bb(),Uf;if(L(a,(bb(),Pf)))return L(b,Rf)||L(b,Qf)?Pf:(f=W(a,1),c=V(K(f,b),1),g=Y(a,R(b,c)),F(c,K(g,b)));if(L(b,Pf))return Uf;if(a[1]<0)return b[1]<0?K(T(a),T(b)):T(K(T(a),b));if(b[1]<0)return T(K(a,T(b)));for(h=Uf,g=a;I(g,b)>=0;)e=M(Math.floor(Z(g)/$(b))),0==e[0]&&0==e[1]&&(e=Rf),d=R(e,b),h=F(h,e),g=Y(g,d);return h}function L(a,b){return a[0]==b[0]&&a[1]==b[1]}function M(a){return isNaN(a)?(bb(),Uf):-0x8000000000000000>a?(bb(),Pf):a>=0x8000000000000000?(bb(),Of):a>0?J(Math.floor(a),0):J(Math.ceil(a),0)}function N(a){var b,c;return a>-129&&128>a?(b=a+128,c=(ab(),Mf)[b],null==c&&(c=Mf[b]=O(a)),c):O(a)}function O(a){return a>=0?[a,0]:[a+4294967296,-4294967296]}function P(a){return a[0]>=2147483648?~~Math.max(Math.min(a[0]-4294967296,2147483647),-2147483648):~~Math.max(Math.min(a[0],2147483647),-2147483648)}function Q(a,b){var c,d;return c=4294967296*a,d=b,0>b&&(d+=4294967296),[d,c]}function R(a,b){var c,d,e,f,g,h,i,j,k;return 0==a[0]&&0==a[1]?(bb(),Uf):0==b[0]&&0==b[1]?(bb(),Uf):L(a,(bb(),Pf))?S(b):L(b,Pf)?S(a):a[1]<0?b[1]<0?R(T(a),T(b)):T(R(T(a),b)):b[1]<0?T(R(a,T(b))):I(a,Tf)<0&&I(b,Tf)<0?J((a[1]+a[0])*(b[1]+b[0]),0):(e=a[1]%281474976710656,f=a[1]-e,c=a[0]%65536,d=a[0]-c,i=b[1]%281474976710656,j=b[1]-i,g=b[0]%65536,h=b[0]-g,k=Uf,k=G(k,f,g),k=G(k,e,h),k=G(k,e,g),k=G(k,d,i),k=G(k,d,h),k=G(k,d,g),k=G(k,c,j),k=G(k,c,i),k=G(k,c,h),k=G(k,c,g))}function S(a){return 1==(1&P(a))?(bb(),Pf):(bb(),Uf)}function T(a){var b,c;return L(a,(bb(),Pf))?Pf:(b=-a[1],c=-a[0],c>4294967295&&(c-=4294967296,b+=4294967296),0>c&&(c+=4294967296,b-=4294967296),[c,b])}function U(a){return 30>=a?1<<a:U(30)*U(a-30)}function V(a,b){var c,d,e,f;return b&=63,L(a,(bb(),Pf))?0==b?a:Uf:a[1]<0?T(V(T(a),b)):(f=U(b),d=a[1]*f%0x10000000000000000,e=a[0]*f,c=e-e%4294967296,d+=c,e-=c,d>=0x8000000000000000&&(d-=0x10000000000000000),[e,d])}function W(a,b){var c,d,e;return b&=63,e=U(b),c=a[1]/e,d=Math.floor(a[0]/e),J(d,c)}function X(a,b){var c;return b&=63,c=W(a,b),a[1]<0&&(c=F(c,V((bb(),Sf),63-b))),c}function Y(a,b){var c,d;return c=a[1]-b[1],d=a[0]-b[0],J(d,c)}function Z(a){var b,c,d;return c=D(Math.log(a[1])/(bb(),Nf)),48>=c?a[1]+a[0]:(b=c-48,d=(1<<b)-1,a[1]+(a[0]-d))}function $(a){var b,c,d;return c=D(Math.log(a[1])/(bb(),Nf)),48>=c?a[1]+a[0]:(b=c-48,d=(1<<b)-1,a[1]+(a[0]+d))}function _(a){var b,c,d,e,f,g;if(0==a[0]&&0==a[1])return"0";if(L(a,(bb(),Pf)))return"-9223372036854775808";if(a[1]<0)return"-"+_(T(a));for(c=a,e="";0!=c[0]||0!=c[1];){if(f=N(1e9),d=K(c,f),b=""+P(Y(c,R(d,f))),c=d,0!=c[0]||0!=c[1])for(g=9-b.length;g>0;--g)b="0"+b;e=b+e}return e}function ab(){ab=tf,Mf=s(dg,0,9,256,0)}function bb(){bb=tf,Nf=Math.log(2),Of=Jf,Pf=zf,Qf=N(-1),Rf=N(1),Sf=N(2),Tf=Gf,Uf=N(0)}function cb(){return eg}function db(){}function eb(a,b){return fb(a,b,0,b.length),a}function fb(a,b,c,d){return a.buf=b,a.pos=c,a.count=c+d,a.count>b.length&&(a.count=b.length),a}function gb(a){return a.pos>=a.count?-1:255&a.buf[a.pos++]}function hb(a,b,c,d){return a.pos>=a.count?-1:(d=Tb(d,a.count-a.pos),ac(a.buf,a.pos,b,c,d),a.pos+=d,d)}function ib(){return fg}function jb(){}function kb(){return hg}function lb(){}function mb(a){return a.buf=s(gg,0,-1,32,1),a}function nb(a,b){var c;b<=a.buf.length||(b=Sb(b,2*a.buf.length),c=s(gg,0,-1,b,1),ac(a.buf,0,c,0,a.buf.length),a.buf=c)}function ob(a){var b;return b=s(gg,0,-1,a.count,1),ac(a.buf,0,b,0,a.count),b}function pb(a,b){nb(a,a.count+1),a.buf[a.count++]=b<<24>>24}function qb(a,b,c,d){nb(a,a.count+d),ac(b,c,a.buf,a.count,d),a.count+=d}function rb(){return ig}function sb(){}function tb(a,b){return a.detailMessage=b,a}function ub(){return jg}function vb(){}function wb(a,b){return a.detailMessage=b,a}function xb(){return lg}function yb(){}function zb(a,b){return a.detailMessage=b,a}function Ab(){return mg}function Bb(){}function Cb(a,b){var c;return c=new Gb,c.typeName=a+b,c}function Db(a,b){var c;return c=new Gb,c.typeName=a+b,c}function Eb(a,b){var c;return c=new Gb,c.typeName=a+b,c}function Fb(){return og}function Gb(){}function Hb(){return pg}function Ib(){}function Jb(){return kg}function Kb(){}function Lb(a,b){return a.detailMessage=b,a}function Mb(){return qg}function Nb(){}function Ob(){return rg}function Pb(){}function Qb(){return sg}function Rb(){}function Sb(a,b){return a>b?a:b}function Tb(a,b){return b>a?a:b}function Ub(){return ug}function Vb(){}function Wb(a,b){return null==b?!1:String(a)==b}function Xb(a,b,c,d,e){var f;for(f=b;c>f;++f)d[e++]=a.charCodeAt(f)}function Yb(){return vg}function Zb(a){var b;return a.data=(b=[],b.explicitLength=0,b),a}function $b(){return wg}function _b(){}function ac(a,b,c,d,e){var f,g,h,i,j,k,l,m;if(null==a||null==c)throw new Vb;if(l=(a.typeMarker$==tf||2==a.typeId$?a.getClass$():cg).typeName,h=(c.typeMarker$==tf||2==c.typeId$?c.getClass$():cg).typeName,91!=l.charCodeAt(0)||91!=h.charCodeAt(0))throw zb(new Bb,"Must be array types");if(l.charCodeAt(1)!=h.charCodeAt(1))throw zb(new Bb,"Array types must match");if(m=a.length,i=c.length,0>b||0>d||0>e||b+e>m||d+e>i)throw new Rb;if(76!=l.charCodeAt(1)&&91!=l.charCodeAt(1)||Wb(l,h))for(j=0;e>j;++j)c[d+j]=a[b+j];else if(k=B(a,3),f=B(c,3),(null==a?null:a)===(null==c?null:c)&&d>b)for(b+=e,g=d+e;g-->d;)u(f,g,k[--b]);else for(g=d+e;g>d;)u(f,d++,k[b++])}function bc(a,b){if(!Vd(b,1<<a.dictionarySize))throw h(new j,"unexpected failure");if(!Yd(b,a.fb))throw h(new j,"unexpected failure");if(!Xd(b,a.matchFinder))throw h(new j,"unexpected failure");if(!Wd(b,a.lc,a.lp,a.pb))throw h(new j,"unexpected failure")}function cc(){return Xg}function dc(){}function ec(a){var b;try{return $c(a.chunker)}catch(b){if(b=E(b),C(b,10))return!1;throw b}}function fc(a,b,c,d,e){var f,g;if(!e)throw Lb(new Nb,"null mode");if(I(d,Af)<0)throw Lb(new Nb,"invalid length "+_(d));for(a.length_0=d,f=Id(new ce),bc(e,f),f._writeEndMark=!0,Zd(f,c),g=0;64>g;g+=8)pb(c,255&P(W(d,g)));a.chunker=(f._needReleaseMFStream=!1,f._inStream=b,f._finished=!1,Hd(f),f._rangeEncoder.Stream=c,Qd(f),Kd(f),Jd(f),f._lenEncoder._tableSize=f._numFastBytes+1-2,me(f._lenEncoder,1<<f._posStateBits),f._repMatchLenEncoder._tableSize=f._numFastBytes+1-2,me(f._repMatchLenEncoder,1<<f._posStateBits),void(f.nowPos64=Bf),Yc(new cd,f))}function gc(){return Yg}function hc(){}function ic(a,b,c){var d;a.output=mb(new sb);try{fc(a,eb(new jb,b),a.output,N(b.length),c)}catch(d){throw d=E(d),C(d,10)?h(new j,"impossible exception"):d}return a}function jc(){return Zg}function kc(){}function lc(a){var b,c;try{return $c(a.chunker)}catch(b){if(b=E(b),C(b,10))return c=b,a.exception=c,!1;throw b}}function mc(a,b,c){var d,e,f,g,h,i="";for(f=s(gg,0,-1,5,1),e=0;e<f.length;++e){if(g=gb(b),-1==g)throw tb(new vb,"truncated input");f[e]=g<<24>>24}if(d=gd(new md),!id(d,f))throw tb(new vb,"corrupted input");for(e=0;64>e;e+=8){if(g=gb(b),-1==g)throw tb(new vb,"truncated input");g=g.toString(16),1==g.length&&(g="0"+g),i=g+""+i}"ffffffffffffffffff"==i.toLowerCase()||0==i?a.length_0=Af:(h=parseInt(i,16),a.length_0=h>4294967295?Af:M(h)),a.chunker=ed(d,b,c,a.length_0)}function nc(){return $g}function oc(){}function pc(a,b){return a.output=mb(new sb),mc(a,eb(new jb,b),a.output),a}function qc(){return _g}function rc(){}function sc(a,b,c,d){var e;a._keepSizeBefore=b,a._keepSizeAfter=c,e=b+c+d,(null==a._bufferBase||a._blockSize!=e)&&(a._bufferBase=null,a._blockSize=e,a._bufferBase=s(gg,0,-1,a._blockSize,1)),a._pointerToLastSafePosition=a._blockSize-c}function tc(a,b){return a._bufferBase[a._bufferOffset+a._pos+b]}function uc(a,b,c,d){var e,f;for(a._streamEndWasReached&&a._pos+b+d>a._streamPos&&(d=a._streamPos-(a._pos+b)),++c,f=a._bufferOffset+a._pos+b,e=0;d>e&&a._bufferBase[f+e]==a._bufferBase[f+e-c];++e);return e}function vc(a){return a._streamPos-a._pos}function wc(a){var b,c,d;for(d=a._bufferOffset+a._pos-a._keepSizeBefore,d>0&&--d,c=a._bufferOffset+a._streamPos-d,b=0;c>b;++b)a._bufferBase[b]=a._bufferBase[d+b];a._bufferOffset-=d}function xc(a){var b;++a._pos,a._pos>a._posLimit&&(b=a._bufferOffset+a._pos,b>a._pointerToLastSafePosition&&wc(a),yc(a))}function yc(a){var b,c,d;if(!a._streamEndWasReached)for(;;){if(d=-a._bufferOffset+a._blockSize-a._streamPos,0==d)return;if(b=hb(a._stream,a._bufferBase,a._bufferOffset+a._streamPos,d),-1==b)return a._posLimit=a._streamPos,c=a._bufferOffset+a._posLimit,c>a._pointerToLastSafePosition&&(a._posLimit=a._pointerToLastSafePosition-a._bufferOffset),void(a._streamEndWasReached=!0);a._streamPos+=b,a._streamPos>=a._pos+a._keepSizeAfter&&(a._posLimit=a._streamPos-a._keepSizeAfter)}}function zc(a,b){a._bufferOffset+=b,a._posLimit-=b,a._pos-=b,a._streamPos-=b}function Ac(){return xg}function Bc(){}function Cc(){Cc=tf;var a,b,c;for(Wf=s(tg,0,-1,256,1),a=0;256>a;++a){for(c=a,b=0;8>b;++b)0!=(1&c)?c=c>>>1^-306674912:c>>>=1;Wf[a]=c}}function Dc(a,b,c,d,e){var f,g,h;return b>1073741567?!1:(a._cutValue=16+(d>>1),h=~~((b+c+d+e)/2)+256,sc(a,b+c,d+e,h),a._matchMaxLen=d,f=b+1,a._cyclicBufferSize!=f&&(a._son=s(tg,0,-1,2*(a._cyclicBufferSize=f),1)),g=65536,a.HASH_ARRAY&&(g=b-1,g|=g>>1,g|=g>>2,g|=g>>4,g|=g>>8,g>>=1,g|=65535,g>16777216&&(g>>=1),a._hashMask=g,++g,g+=a.kFixHashSize),g!=a._hashSizeSum&&(a._hash=s(tg,0,-1,a._hashSizeSum=g,1)),!0)}function Ec(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w;if(a._pos+a._matchMaxLen<=a._streamPos)p=a._matchMaxLen;else if(p=a._streamPos-a._pos,p<a.kMinMatchCheck)return Gc(a),0;for(s=0,q=a._pos>a._cyclicBufferSize?a._pos-a._cyclicBufferSize:0,d=a._bufferOffset+a._pos,r=1,j=0,k=0,a.HASH_ARRAY?(w=Wf[255&a._bufferBase[d]]^255&a._bufferBase[d+1],j=1023&w,w^=(255&a._bufferBase[d+2])<<8,k=65535&w,l=(w^Wf[255&a._bufferBase[d+3]]<<5)&a._hashMask):l=255&a._bufferBase[d]^(255&a._bufferBase[d+1])<<8,e=a._hash[a.kFixHashSize+l],a.HASH_ARRAY&&(f=a._hash[j],g=a._hash[1024+k],a._hash[j]=a._pos,a._hash[1024+k]=a._pos,f>q&&a._bufferBase[a._bufferOffset+f]==a._bufferBase[d]&&(b[s++]=r=2,b[s++]=a._pos-f-1),g>q&&a._bufferBase[a._bufferOffset+g]==a._bufferBase[d]&&(g==f&&(s-=2),b[s++]=r=3,b[s++]=a._pos-g-1,f=g),0!=s&&f==e&&(s-=2,r=1)),a._hash[a.kFixHashSize+l]=a._pos,u=(a._cyclicBufferPos<<1)+1,v=a._cyclicBufferPos<<1,n=o=a.kNumHashDirectBytes,0!=a.kNumHashDirectBytes&&e>q&&a._bufferBase[a._bufferOffset+e+a.kNumHashDirectBytes]!=a._bufferBase[d+a.kNumHashDirectBytes]&&(b[s++]=r=a.kNumHashDirectBytes,b[s++]=a._pos-e-1),c=a._cutValue;;){if(q>=e||0==c--){a._son[u]=a._son[v]=0;break}if(i=a._pos-e,h=(i<=a._cyclicBufferPos?a._cyclicBufferPos-i:a._cyclicBufferPos-i+a._cyclicBufferSize)<<1,t=a._bufferOffset+e,m=o>n?n:o,a._bufferBase[t+m]==a._bufferBase[d+m]){for(;++m!=p&&a._bufferBase[t+m]==a._bufferBase[d+m];);if(m>r&&(b[s++]=r=m,b[s++]=i-1,m==p)){a._son[v]=a._son[h],a._son[u]=a._son[h+1];break}}(255&a._bufferBase[t+m])<(255&a._bufferBase[d+m])?(a._son[v]=e,v=h+1,e=a._son[v],o=m):(a._son[u]=e,u=h,e=a._son[u],n=m)}return Gc(a),s}function Fc(a){var b;for(a._bufferOffset=0,a._pos=0,a._streamPos=0,a._streamEndWasReached=!1,yc(a),b=0;b<a._hashSizeSum;++b)a._hash[b]=0;a._cyclicBufferPos=0,zc(a,-1)}function Gc(a){var b;++a._cyclicBufferPos>=a._cyclicBufferSize&&(a._cyclicBufferPos=0),xc(a),1073741823==a._pos&&(b=a._pos-a._cyclicBufferSize,Hc(a._son,2*a._cyclicBufferSize,b),Hc(a._hash,a._hashSizeSum,b),zc(a,b))}function Hc(a,b,c){var d,e;for(d=0;b>d;++d)e=a[d],c>=e?e=0:e-=c,a[d]=e}function Ic(a,b){a.HASH_ARRAY=b>2,a.HASH_ARRAY?(a.kNumHashDirectBytes=0,a.kMinMatchCheck=4,a.kFixHashSize=66560):(a.kNumHashDirectBytes=2,a.kMinMatchCheck=3,a.kFixHashSize=0)}function Jc(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s;do{if(a._pos+a._matchMaxLen<=a._streamPos)n=a._matchMaxLen;else if(n=a._streamPos-a._pos,n<a.kMinMatchCheck){Gc(a);continue}for(o=a._pos>a._cyclicBufferSize?a._pos-a._cyclicBufferSize:0,d=a._bufferOffset+a._pos,a.HASH_ARRAY?(s=Wf[255&a._bufferBase[d]]^255&a._bufferBase[d+1],h=1023&s,a._hash[h]=a._pos,s^=(255&a._bufferBase[d+2])<<8,i=65535&s,a._hash[1024+i]=a._pos,j=(s^Wf[255&a._bufferBase[d+3]]<<5)&a._hashMask):j=255&a._bufferBase[d]^(255&a._bufferBase[d+1])<<8,e=a._hash[a.kFixHashSize+j],a._hash[a.kFixHashSize+j]=a._pos,q=(a._cyclicBufferPos<<1)+1,r=a._cyclicBufferPos<<1,l=m=a.kNumHashDirectBytes,c=a._cutValue;;){if(o>=e||0==c--){a._son[q]=a._son[r]=0;break}if(g=a._pos-e,f=(g<=a._cyclicBufferPos?a._cyclicBufferPos-g:a._cyclicBufferPos-g+a._cyclicBufferSize)<<1,p=a._bufferOffset+e,k=m>l?l:m,a._bufferBase[p+k]==a._bufferBase[d+k]){for(;++k!=n&&a._bufferBase[p+k]==a._bufferBase[d+k];);if(k==n){a._son[r]=a._son[f],a._son[q]=a._son[f+1];break}}(255&a._bufferBase[p+k])<(255&a._bufferBase[d+k])?(a._son[r]=e,r=f+1,e=a._son[r],m=k):(a._son[q]=e,q=f,e=a._son[q],l=k)}Gc(a)}while(0!=--b)}function Kc(){return yg}function Lc(){}function Mc(a,b,c){var d;for(d=a._pos-b-1,0>d&&(d+=a._windowSize);0!=c;--c)d>=a._windowSize&&(d=0),a._buffer[a._pos++]=a._buffer[d++],a._pos>=a._windowSize&&Oc(a)}function Nc(a,b){(null==a._buffer||a._windowSize!=b)&&(a._buffer=s(gg,0,-1,b,1)),a._windowSize=b,a._pos=0,a._streamPos=0}function Oc(a){var b;b=a._pos-a._streamPos,0!=b&&(qb(a._stream,a._buffer,a._streamPos,b),a._pos>=a._windowSize&&(a._pos=0),a._streamPos=a._pos)}function Pc(a,b){var c;return c=a._pos-b-1,0>c&&(c+=a._windowSize),a._buffer[c]}function Qc(a,b){b||(a._streamPos=0,a._pos=0)}function Rc(a,b){a._buffer[a._pos++]=b,a._pos>=a._windowSize&&Oc(a)}function Sc(a){Oc(a),a._stream=null}function Tc(a,b){Oc(a),a._stream=null,a._stream=b}function Uc(){return zg}function Vc(){}function Wc(a){return a-=2,4>a?a:3}function Xc(a){return 4>a?0:10>a?a-3:a-6}function Yc(a,b){return a.encoder=b,a.decoder=null,a.alive=!0,a}function Zc(a,b){return a.decoder=b,a.encoder=null,a.alive=!0,a}function $c(a){var b;if(!a.alive)throw new Pb;b=!0;try{return a.encoder?ad(a):_c(a),b=!1,a.alive}finally{b&&(a.alive=!1)}}function _c(a){var b;if(b=fd(a.decoder),-1==b)throw tb(new vb,"corrupted input");a.inBytesProcessed=Af,a.outBytesProcessed=a.decoder.nowPos64,(1==b||I(a.decoder.outSize,Bf)>=0&&I(a.decoder.nowPos64,a.decoder.outSize)>=0)&&(dd(a.decoder),a.alive=!1)}function ad(a){Gd(a.encoder,a.encoder.processedInSize,a.encoder.processedOutSize,a.encoder.finished),a.inBytesProcessed=a.encoder.processedInSize[0],a.encoder.finished[0]&&(Ud(a.encoder),a.alive=!1)}function bd(){return Ag}function cd(){}function dd(a){Oc(a.m_OutWindow),Sc(a.m_OutWindow),a.m_RangeDecoder.Stream=null}function ed(a,b,c,d){return a.m_RangeDecoder.Stream=b,Tc(a.m_OutWindow,c),hd(a),a.state=0,a.rep0=0,a.rep1=0,a.rep2=0,a.rep3=0,a.outSize=d,a.nowPos64=Bf,a.prevByte=0,Zc(new cd,a)}function fd(a){var b,c,d,e,f,g;if(g=P(a.nowPos64)&a.m_PosStateMask,0==Te(a.m_RangeDecoder,a.m_IsMatchDecoders,(a.state<<4)+g))b=ud(a.m_LiteralDecoder,P(a.nowPos64),a.prevByte),a.prevByte=a.state<7?yd(b,a.m_RangeDecoder):zd(b,a.m_RangeDecoder,Pc(a.m_OutWindow,a.rep0)),Rc(a.m_OutWindow,a.prevByte),a.state=Xc(a.state),a.nowPos64=F(a.nowPos64,Cf);else{if(1==Te(a.m_RangeDecoder,a.m_IsRepDecoders,a.state))d=0,0==Te(a.m_RangeDecoder,a.m_IsRepG0Decoders,a.state)?0==Te(a.m_RangeDecoder,a.m_IsRep0LongDecoders,(a.state<<4)+g)&&(a.state=a.state<7?9:11,d=1):(0==Te(a.m_RangeDecoder,a.m_IsRepG1Decoders,a.state)?c=a.rep1:(0==Te(a.m_RangeDecoder,a.m_IsRepG2Decoders,a.state)?c=a.rep2:(c=a.rep3,a.rep3=a.rep2),a.rep2=a.rep1),a.rep1=a.rep0,a.rep0=c),0==d&&(d=od(a.m_RepLenDecoder,a.m_RangeDecoder,g)+2,a.state=a.state<7?8:11);else if(a.rep3=a.rep2,a.rep2=a.rep1,a.rep1=a.rep0,d=2+od(a.m_LenDecoder,a.m_RangeDecoder,g),a.state=a.state<7?7:10,f=Fe(a.m_PosSlotDecoder[Wc(d)],a.m_RangeDecoder),f>=4){if(e=(f>>1)-1,a.rep0=(2|1&f)<<e,14>f)a.rep0+=He(a.m_PosDecoders,a.rep0-f-1,a.m_RangeDecoder,e);else if(a.rep0+=Ue(a.m_RangeDecoder,e-4)<<4,a.rep0+=Ge(a.m_PosAlignDecoder,a.m_RangeDecoder),a.rep0<0)return-1==a.rep0?1:-1}else a.rep0=f;if(I(N(a.rep0),a.nowPos64)>=0||a.rep0>=a.m_DictionarySizeCheck)return-1;Mc(a.m_OutWindow,a.rep0,d),a.nowPos64=F(a.nowPos64,N(d)),a.prevByte=Pc(a.m_OutWindow,0)}return 0}function gd(a){var b;for(a.m_OutWindow=new Vc,a.m_RangeDecoder=new Ye,a.m_IsMatchDecoders=s(Bg,0,-1,192,1),a.m_IsRepDecoders=s(Bg,0,-1,12,1),a.m_IsRepG0Decoders=s(Bg,0,-1,12,1),a.m_IsRepG1Decoders=s(Bg,0,-1,12,1),a.m_IsRepG2Decoders=s(Bg,0,-1,12,1),a.m_IsRep0LongDecoders=s(Bg,0,-1,192,1),a.m_PosSlotDecoder=s(Cg,0,7,4,0),a.m_PosDecoders=s(Bg,0,-1,114,1),a.m_PosAlignDecoder=Ee(new Je,4),a.m_LenDecoder=pd(new sd),a.m_RepLenDecoder=pd(new sd),a.m_LiteralDecoder=new xd,b=0;4>b;++b)a.m_PosSlotDecoder[b]=Ee(new Je,6);return a}function hd(a){var b;for(Qc(a.m_OutWindow,!1),We(a.m_IsMatchDecoders),We(a.m_IsRep0LongDecoders),We(a.m_IsRepDecoders),We(a.m_IsRepG0Decoders),We(a.m_IsRepG1Decoders),We(a.m_IsRepG2Decoders),We(a.m_PosDecoders),vd(a.m_LiteralDecoder),b=0;4>b;++b)We(a.m_PosSlotDecoder[b].Models);qd(a.m_LenDecoder),qd(a.m_RepLenDecoder),We(a.m_PosAlignDecoder.Models),Ve(a.m_RangeDecoder)}function id(a,b){var c,d,e,f,g,h,i;if(b.length<5)return!1;for(i=255&b[0],e=i%9,h=~~(i/9),f=h%5,g=~~(h/5),c=0,d=0;4>d;++d)c+=(255&b[1+d])<<8*d;return kd(a,e,f,g)?jd(a,c):!1}function jd(a,b){return 0>b?!1:(a.m_DictionarySize!=b&&(a.m_DictionarySize=b,a.m_DictionarySizeCheck=Sb(a.m_DictionarySize,1),Nc(a.m_OutWindow,Sb(a.m_DictionarySizeCheck,4096))),!0)}function kd(a,b,c,d){var e;return b>8||c>4||d>4?!1:(td(a.m_LiteralDecoder,c,b),e=1<<d,nd(a.m_LenDecoder,e),nd(a.m_RepLenDecoder,e),a.m_PosStateMask=e-1,!0)}function ld(){return Dg}function md(){}function nd(a,b){for(;a.m_NumPosStates<b;++a.m_NumPosStates)a.m_LowCoder[a.m_NumPosStates]=Ee(new Je,3),a.m_MidCoder[a.m_NumPosStates]=Ee(new Je,3)}function od(a,b,c){var d;return 0==Te(b,a.m_Choice,0)?Fe(a.m_LowCoder[c],b):(d=8,d+=0==Te(b,a.m_Choice,1)?Fe(a.m_MidCoder[c],b):8+Fe(a.m_HighCoder,b))}function pd(a){return a.m_Choice=s(Bg,0,-1,2,1),a.m_LowCoder=s(Cg,0,7,16,0),a.m_MidCoder=s(Cg,0,7,16,0),a.m_HighCoder=Ee(new Je,8),a}function qd(a){var b;for(We(a.m_Choice),b=0;b<a.m_NumPosStates;++b)We(a.m_LowCoder[b].Models),We(a.m_MidCoder[b].Models);We(a.m_HighCoder.Models)}function rd(){return Eg}function sd(){}function td(a,b,c){var d,e;if(null==a.m_Coders||a.m_NumPrevBits!=c||a.m_NumPosBits!=b)for(a.m_NumPosBits=b,a.m_PosMask=(1<<b)-1,a.m_NumPrevBits=c,e=1<<a.m_NumPrevBits+a.m_NumPosBits,a.m_Coders=s(Fg,0,4,e,0),d=0;e>d;++d)a.m_Coders[d]=Ad(new Cd)}function ud(a,b,c){return a.m_Coders[((b&a.m_PosMask)<<a.m_NumPrevBits)+((255&c)>>>8-a.m_NumPrevBits)]}function vd(a){var b,c;for(c=1<<a.m_NumPrevBits+a.m_NumPosBits,b=0;c>b;++b)We(a.m_Coders[b].m_Decoders)}function wd(){return Gg}function xd(){}function yd(a,b){var c;c=1;do c=c<<1|Te(b,a.m_Decoders,c);while(256>c);return c<<24>>24}function zd(a,b,c){var d,e,f;f=1;do if(e=c>>7&1,c<<=1,d=Te(b,a.m_Decoders,(1+e<<8)+f),f=f<<1|d,e!=d){for(;256>f;)f=f<<1|Te(b,a.m_Decoders,f);break}while(256>f);return f<<24>>24}function Ad(a){return a.m_Decoders=s(Bg,0,-1,768,1),a}function Bd(){return Hg}function Cd(){}function Dd(){Dd=tf;var a,b,c,d;for(Xf=s(gg,0,-1,2048,1),a=2,Xf[0]=0,Xf[1]=1,d=2;22>d;++d)for(c=1<<(d>>1)-1,b=0;c>b;++b,++a)Xf[a]=d<<24>>24}function Ed(a,b){var c,d,e,f;a._optimumEndIndex=b,e=a._optimum[b].PosPrev,d=a._optimum[b].BackPrev;do a._optimum[b].Prev1IsChar&&(Ae(a._optimum[e]),a._optimum[e].PosPrev=e-1,a._optimum[b].Prev2&&(a._optimum[e-1].Prev1IsChar=!1,a._optimum[e-1].PosPrev=a._optimum[b].PosPrev2,a._optimum[e-1].BackPrev=a._optimum[b].BackPrev2)),f=e,c=d,d=a._optimum[f].BackPrev,e=a._optimum[f].PosPrev,a._optimum[f].BackPrev=c,a._optimum[f].PosPrev=b,b=f;while(b>0);return a.backRes=a._optimum[0].BackPrev,a._optimumCurrentIndex=a._optimum[0].PosPrev,a._optimumCurrentIndex}function Fd(a){var b;for(a._state=0,a._previousByte=0,b=0;4>b;++b)a._repDistances[b]=0}function Gd(a,b,c,d){var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s;if(b[0]=Bf,c[0]=Bf,d[0]=!0,a._inStream&&(a._matchFinder._stream=a._inStream,Fc(a._matchFinder),a._needReleaseMFStream=!0,a._inStream=null),!a._finished){if(a._finished=!0,r=a.nowPos64,L(a.nowPos64,Bf)){if(0==vc(a._matchFinder))return void Ld(a,P(a.nowPos64));Sd(a),q=P(a.nowPos64)&a._posStateMask,$e(a._rangeEncoder,a._isMatch,(a._state<<4)+q,0),a._state=Xc(a._state),g=tc(a._matchFinder,-a._additionalOffset),ue(qe(a._literalEncoder,P(a.nowPos64),a._previousByte),a._rangeEncoder,g),a._previousByte=g,--a._additionalOffset,a.nowPos64=F(a.nowPos64,Cf)}if(0==vc(a._matchFinder))return void Ld(a,P(a.nowPos64));for(;;){if(k=Md(a,P(a.nowPos64)),n=a.backRes,q=P(a.nowPos64)&a._posStateMask,f=(a._state<<4)+q,1==k&&-1==n)$e(a._rangeEncoder,a._isMatch,f,0),g=tc(a._matchFinder,-a._additionalOffset),s=qe(a._literalEncoder,P(a.nowPos64),a._previousByte),a._state<7?ue(s,a._rangeEncoder,g):(m=tc(a._matchFinder,-a._repDistances[0]-1-a._additionalOffset),ve(s,a._rangeEncoder,m,g)),a._previousByte=g,a._state=Xc(a._state);else{if($e(a._rangeEncoder,a._isMatch,f,1),4>n){if($e(a._rangeEncoder,a._isRep,a._state,1),0==n?($e(a._rangeEncoder,a._isRepG0,a._state,0),1==k?$e(a._rangeEncoder,a._isRep0Long,f,0):$e(a._rangeEncoder,a._isRep0Long,f,1)):($e(a._rangeEncoder,a._isRepG0,a._state,1),1==n?$e(a._rangeEncoder,a._isRepG1,a._state,0):($e(a._rangeEncoder,a._isRepG1,a._state,1),$e(a._rangeEncoder,a._isRepG2,a._state,n-2))),1==k?a._state=a._state<7?9:11:(je(a._repMatchLenEncoder,a._rangeEncoder,k-2,q),a._state=a._state<7?8:11),h=a._repDistances[n],0!=n){for(j=n;j>=1;--j)a._repDistances[j]=a._repDistances[j-1];a._repDistances[0]=h}}else{for($e(a._rangeEncoder,a._isRep,a._state,0),a._state=a._state<7?7:10,je(a._lenEncoder,a._rangeEncoder,k-2,q),n-=4,p=_d(n),l=Wc(k),Le(a._posSlotEncoder[l],a._rangeEncoder,p),p>=4&&(i=(p>>1)-1,e=(2|1&p)<<i,o=n-e,14>p?Pe(a._posEncoders,e-p-1,a._rangeEncoder,i,o):(_e(a._rangeEncoder,o>>4,i-4),Ne(a._posAlignEncoder,a._rangeEncoder,15&o),++a._alignPriceCount)),h=n,j=3;j>=1;--j)a._repDistances[j]=a._repDistances[j-1];a._repDistances[0]=h,++a._matchPriceCount}a._previousByte=tc(a._matchFinder,k-1-a._additionalOffset)}if(a._additionalOffset-=k,a.nowPos64=F(a.nowPos64,N(k)),0==a._additionalOffset){if(a._matchPriceCount>=128&&Kd(a),a._alignPriceCount>=16&&Jd(a),b[0]=a.nowPos64,c[0]=bf(a._rangeEncoder),0==vc(a._matchFinder))return void Ld(a,P(a.nowPos64));if(I(Y(a.nowPos64,r),Ef)>=0)return a._finished=!1,void(d[0]=!1)}}}}function Hd(a){var b,c;a._matchFinder||(Cc(),b=new Lc,c=4,0==a._matchFinderType&&(c=2),Ic(b,c),a._matchFinder=b),pe(a._literalEncoder,a._numLiteralPosStateBits,a._numLiteralContextBits),(a._dictionarySize!=a._dictionarySizePrev||a._numFastBytesPrev!=a._numFastBytes)&&(Dc(a._matchFinder,a._dictionarySize,4096,a._numFastBytes,274),a._dictionarySizePrev=a._dictionarySize,a._numFastBytesPrev=a._numFastBytes)}function Id(a){var b;for(Dd(),a._repDistances=s(tg,0,-1,4,1),a._optimum=s(Ig,0,6,4096,0),a._rangeEncoder=(Ze(),new hf),a._isMatch=s(Bg,0,-1,192,1),a._isRep=s(Bg,0,-1,12,1),a._isRepG0=s(Bg,0,-1,12,1),a._isRepG1=s(Bg,0,-1,12,1),a._isRepG2=s(Bg,0,-1,12,1),a._isRep0Long=s(Bg,0,-1,192,1),a._posSlotEncoder=s(Jg,0,8,4,0),a._posEncoders=s(Bg,0,-1,114,1),a._posAlignEncoder=Ke(new Se,4),a._lenEncoder=ke(new oe),a._repMatchLenEncoder=ke(new oe),a._literalEncoder=new te,a._matchDistances=s(tg,0,-1,548,1),a._posSlotPrices=s(tg,0,-1,256,1),a._distancesPrices=s(tg,0,-1,512,1),a._alignPrices=s(tg,0,-1,16,1),a.reps=s(tg,0,-1,4,1),a.repLens=s(tg,0,-1,4,1),a.processedInSize=s(Kg,0,-1,1,3),a.processedOutSize=s(Kg,0,-1,1,3),a.finished=s(Lg,0,-1,1,2),a.properties=s(gg,0,-1,5,1),a.tempPrices=s(tg,0,-1,128,1),b=0;4096>b;++b)a._optimum[b]=new De;for(b=0;4>b;++b)a._posSlotEncoder[b]=Ke(new Se,6);return a}function Jd(a){var b;for(b=0;16>b;++b)a._alignPrices[b]=Oe(a._posAlignEncoder,b);a._alignPriceCount=0}function Kd(a){var b,c,d,e,f,g,h,i;for(e=4;128>e;++e)g=_d(e),d=(g>>1)-1,b=(2|1&g)<<d,a.tempPrices[e]=Qe(a._posEncoders,b-g-1,d,e-b);for(f=0;4>f;++f){for(c=a._posSlotEncoder[f],h=f<<6,g=0;g<a._distTableSize;++g)a._posSlotPrices[h+g]=Me(c,g);for(g=14;g<a._distTableSize;++g)a._posSlotPrices[h+g]+=(g>>1)-1-4<<6;for(i=128*f,e=0;4>e;++e)a._distancesPrices[i+e]=a._posSlotPrices[h+e];for(;128>e;++e)a._distancesPrices[i+e]=a._posSlotPrices[h+_d(e)]+a.tempPrices[e]}a._matchPriceCount=0}function Ld(a,b){Td(a),$d(a,b&a._posStateMask),af(a._rangeEncoder)}function Md(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z;if(a._optimumEndIndex!=a._optimumCurrentIndex)return o=a._optimum[a._optimumCurrentIndex].PosPrev-a._optimumCurrentIndex,a.backRes=a._optimum[a._optimumCurrentIndex].BackPrev,a._optimumCurrentIndex=a._optimum[a._optimumCurrentIndex].PosPrev,o;if(a._optimumCurrentIndex=a._optimumEndIndex=0,a._longestMatchWasFound?(n=a._longestMatchLength,a._longestMatchWasFound=!1):n=Sd(a),C=a._numDistancePairs,A=vc(a._matchFinder)+1,2>A)return a.backRes=-1,1;for(A>273&&(A=273),P=0,k=0;4>k;++k)a.reps[k]=a._repDistances[k],a.repLens[k]=uc(a._matchFinder,-1,a.reps[k],273),a.repLens[k]>a.repLens[P]&&(P=k);if(a.repLens[P]>=a._numFastBytes)return a.backRes=P,o=a.repLens[P],Rd(a,o-1),o;if(n>=a._numFastBytes)return a.backRes=a._matchDistances[C-1]+4,Rd(a,n-1),n;if(i=tc(a._matchFinder,-1),s=tc(a._matchFinder,-a._repDistances[0]-1-1),2>n&&i!=s&&a.repLens[P]<2)return a.backRes=-1,1;if(a._optimum[0].State=a._state,J=b&a._posStateMask,a._optimum[1].Price=(Ze(),Yf[a._isMatch[(a._state<<4)+J]>>>2]+xe(qe(a._literalEncoder,b,a._previousByte),a._state>=7,s,i)),Ae(a._optimum[1]),t=Yf[2048-a._isMatch[(a._state<<4)+J]>>>2],O=t+Yf[2048-a._isRep[a._state]>>>2],s==i&&(Q=O+Pd(a,a._state,J),Q<a._optimum[1].Price&&(a._optimum[1].Price=Q,Be(a._optimum[1]))),m=n>=a.repLens[P]?n:a.repLens[P],2>m)return a.backRes=a._optimum[1].BackPrev,1;a._optimum[1].PosPrev=0,a._optimum[0].Backs0=a.reps[0],a._optimum[0].Backs1=a.reps[1],a._optimum[0].Backs2=a.reps[2],a._optimum[0].Backs3=a.reps[3],l=m;do a._optimum[l--].Price=268435455;while(l>=2);for(k=0;4>k;++k)if(N=a.repLens[k],!(2>N)){L=O+Od(a,k,a._state,J);do f=L+le(a._repMatchLenEncoder,N-2,J),G=a._optimum[N],f<G.Price&&(G.Price=f,G.PosPrev=0,G.BackPrev=k,G.Prev1IsChar=!1);while(--N>=2)}if(z=t+Yf[a._isRep[a._state]>>>2],l=a.repLens[0]>=2?a.repLens[0]+1:2,n>=l){for(D=0;l>a._matchDistances[D];)D+=2;for(;j=a._matchDistances[D+1],f=z+Nd(a,j,l,J),G=a._optimum[l],f<G.Price&&(G.Price=f,G.PosPrev=0,G.BackPrev=j+4,G.Prev1IsChar=!1),l!=a._matchDistances[D]||(D+=2,D!=C);++l);}for(c=0;;){if(++c,c==m)return Ed(a,c);if(u=Sd(a),C=a._numDistancePairs,u>=a._numFastBytes)return a._longestMatchLength=u,a._longestMatchWasFound=!0,Ed(a,c);if(++b,I=a._optimum[c].PosPrev,a._optimum[c].Prev1IsChar?(--I,a._optimum[c].Prev2?(S=a._optimum[a._optimum[c].PosPrev2].State,S=a._optimum[c].BackPrev2<4?7>S?8:11:7>S?7:10):S=a._optimum[I].State,S=Xc(S)):S=a._optimum[I].State,I==c-1?S=0==a._optimum[c].BackPrev?7>S?9:11:Xc(S):(a._optimum[c].Prev1IsChar&&a._optimum[c].Prev2?(I=a._optimum[c].PosPrev2,H=a._optimum[c].BackPrev2,S=7>S?8:11):(H=a._optimum[c].BackPrev,S=4>H?7>S?8:11:7>S?7:10),F=a._optimum[I],4>H?0==H?(a.reps[0]=F.Backs0,a.reps[1]=F.Backs1,a.reps[2]=F.Backs2,a.reps[3]=F.Backs3):1==H?(a.reps[0]=F.Backs1,a.reps[1]=F.Backs0,a.reps[2]=F.Backs2,a.reps[3]=F.Backs3):2==H?(a.reps[0]=F.Backs2,a.reps[1]=F.Backs0,a.reps[2]=F.Backs1,a.reps[3]=F.Backs3):(a.reps[0]=F.Backs3,a.reps[1]=F.Backs0,a.reps[2]=F.Backs1,a.reps[3]=F.Backs2):(a.reps[0]=H-4,a.reps[1]=F.Backs0,a.reps[2]=F.Backs1,a.reps[3]=F.Backs2)),a._optimum[c].State=S,a._optimum[c].Backs0=a.reps[0],a._optimum[c].Backs1=a.reps[1],a._optimum[c].Backs2=a.reps[2],a._optimum[c].Backs3=a.reps[3],h=a._optimum[c].Price,i=tc(a._matchFinder,-1),s=tc(a._matchFinder,-a.reps[0]-1-1),J=b&a._posStateMask,d=h+Yf[a._isMatch[(S<<4)+J]>>>2]+xe(qe(a._literalEncoder,b,tc(a._matchFinder,-2)),S>=7,s,i),x=a._optimum[c+1],v=!1,d<x.Price&&(x.Price=d,x.PosPrev=c,x.BackPrev=-1,x.Prev1IsChar=!1,v=!0),t=h+Yf[2048-a._isMatch[(S<<4)+J]>>>2],O=t+Yf[2048-a._isRep[S]>>>2],s!=i||x.PosPrev<c&&0==x.BackPrev||(Q=O+(Yf[a._isRepG0[S]>>>2]+Yf[a._isRep0Long[(S<<4)+J]>>>2]),Q<=x.Price&&(x.Price=Q,x.PosPrev=c,x.BackPrev=0,x.Prev1IsChar=!1,v=!0)),B=vc(a._matchFinder)+1,B=B>4095-c?4095-c:B,A=B,!(2>A)){if(A>a._numFastBytes&&(A=a._numFastBytes),!v&&s!=i&&(U=Tb(B-1,a._numFastBytes),q=uc(a._matchFinder,0,a.reps[0],U),q>=2)){for(T=Xc(S),K=b+1&a._posStateMask,y=d+Yf[2048-a._isMatch[(T<<4)+K]>>>2]+Yf[2048-a._isRep[T]>>>2],E=c+1+q;E>m;)a._optimum[++m].Price=268435455;
f=y+(V=le(a._repMatchLenEncoder,q-2,K),V+Od(a,0,T,K)),G=a._optimum[E],f<G.Price&&(G.Price=f,G.PosPrev=c+1,G.BackPrev=0,G.Prev1IsChar=!0,G.Prev2=!1)}for(R=2,M=0;4>M;++M)if(p=uc(a._matchFinder,-1,a.reps[M],A),!(2>p)){r=p;do{for(;c+p>m;)a._optimum[++m].Price=268435455;f=O+(W=le(a._repMatchLenEncoder,p-2,J),W+Od(a,M,S,J)),G=a._optimum[c+p],f<G.Price&&(G.Price=f,G.PosPrev=c,G.BackPrev=M,G.Prev1IsChar=!1)}while(--p>=2);if(p=r,0==M&&(R=p+1),B>p&&(U=Tb(B-1-p,a._numFastBytes),q=uc(a._matchFinder,p,a.reps[M],U),q>=2)){for(T=7>S?8:11,K=b+p&a._posStateMask,e=O+(X=le(a._repMatchLenEncoder,p-2,J),X+Od(a,M,S,J))+Yf[a._isMatch[(T<<4)+K]>>>2]+xe(qe(a._literalEncoder,b+p,tc(a._matchFinder,p-1-1)),!0,tc(a._matchFinder,p-1-(a.reps[M]+1)),tc(a._matchFinder,p-1)),T=Xc(T),K=b+p+1&a._posStateMask,w=e+Yf[2048-a._isMatch[(T<<4)+K]>>>2],y=w+Yf[2048-a._isRep[T]>>>2],E=p+1+q;c+E>m;)a._optimum[++m].Price=268435455;f=y+(Y=le(a._repMatchLenEncoder,q-2,K),Y+Od(a,0,T,K)),G=a._optimum[c+E],f<G.Price&&(G.Price=f,G.PosPrev=c+p+1,G.BackPrev=0,G.Prev1IsChar=!0,G.Prev2=!0,G.PosPrev2=c,G.BackPrev2=M)}}if(u>A){for(u=A,C=0;u>a._matchDistances[C];C+=2);a._matchDistances[C]=u,C+=2}if(u>=R){for(z=t+Yf[a._isRep[S]>>>2];c+u>m;)a._optimum[++m].Price=268435455;for(D=0;R>a._matchDistances[D];)D+=2;for(p=R;;++p)if(g=a._matchDistances[D+1],f=z+Nd(a,g,p,J),G=a._optimum[c+p],f<G.Price&&(G.Price=f,G.PosPrev=c,G.BackPrev=g+4,G.Prev1IsChar=!1),p==a._matchDistances[D]){if(B>p&&(U=Tb(B-1-p,a._numFastBytes),q=uc(a._matchFinder,p,g,U),q>=2)){for(T=7>S?7:10,K=b+p&a._posStateMask,e=f+Yf[a._isMatch[(T<<4)+K]>>>2]+xe(qe(a._literalEncoder,b+p,tc(a._matchFinder,p-1-1)),!0,tc(a._matchFinder,p-(g+1)-1),tc(a._matchFinder,p-1)),T=Xc(T),K=b+p+1&a._posStateMask,w=e+Yf[2048-a._isMatch[(T<<4)+K]>>>2],y=w+Yf[2048-a._isRep[T]>>>2],E=p+1+q;c+E>m;)a._optimum[++m].Price=268435455;f=y+(Z=le(a._repMatchLenEncoder,q-2,K),Z+Od(a,0,T,K)),G=a._optimum[c+E],f<G.Price&&(G.Price=f,G.PosPrev=c+p+1,G.BackPrev=0,G.Prev1IsChar=!0,G.Prev2=!0,G.PosPrev2=c,G.BackPrev2=g+4)}if(D+=2,D==C)break}}}}}function Nd(a,b,c,d){var e,f;return e=Wc(c),f=128>b?a._distancesPrices[128*e+b]:a._posSlotPrices[(e<<6)+ae(b)]+a._alignPrices[15&b],f+le(a._lenEncoder,c-2,d)}function Od(a,b,c,d){var e;return 0==b?(Ze(),e=Yf[a._isRepG0[c]>>>2],e+=Yf[2048-a._isRep0Long[(c<<4)+d]>>>2]):(Ze(),e=Yf[2048-a._isRepG0[c]>>>2],1==b?e+=Yf[a._isRepG1[c]>>>2]:(e+=Yf[2048-a._isRepG1[c]>>>2],e+=ef(a._isRepG2[c],b-2))),e}function Pd(a,b,c){return Ze(),Yf[a._isRepG0[b]>>>2]+Yf[a._isRep0Long[(b<<4)+c]>>>2]}function Qd(a){var b;for(Fd(a),cf(a._rangeEncoder),ff(a._isMatch),ff(a._isRep0Long),ff(a._isRep),ff(a._isRepG0),ff(a._isRepG1),ff(a._isRepG2),ff(a._posEncoders),re(a._literalEncoder),b=0;4>b;++b)We(a._posSlotEncoder[b].Models);fe(a._lenEncoder,1<<a._posStateBits),fe(a._repMatchLenEncoder,1<<a._posStateBits),We(a._posAlignEncoder.Models),a._longestMatchWasFound=!1,a._optimumEndIndex=0,a._optimumCurrentIndex=0,a._additionalOffset=0}function Rd(a,b){b>0&&(Jc(a._matchFinder,b),a._additionalOffset+=b)}function Sd(a){var b;return b=0,a._numDistancePairs=Ec(a._matchFinder,a._matchDistances),a._numDistancePairs>0&&(b=a._matchDistances[a._numDistancePairs-2],b==a._numFastBytes&&(b+=uc(a._matchFinder,b-1,a._matchDistances[a._numDistancePairs-1],273-b))),++a._additionalOffset,b}function Td(a){a._matchFinder&&a._needReleaseMFStream&&(a._matchFinder._stream=null,a._needReleaseMFStream=!1)}function Ud(a){Td(a),a._rangeEncoder.Stream=null}function Vd(a,b){var c;if(1>b||b>536870912)return!1;for(a._dictionarySize=b,c=0;b>1<<c;++c);return a._distTableSize=2*c,!0}function Wd(a,b,c,d){return 0>c||c>4||0>b||b>8||0>d||d>4?!1:(a._numLiteralPosStateBits=c,a._numLiteralContextBits=b,a._posStateBits=d,a._posStateMask=(1<<a._posStateBits)-1,!0)}function Xd(a,b){var c;return 0>b||b>2?!1:(c=a._matchFinderType,a._matchFinderType=b,a._matchFinder&&c!=a._matchFinderType&&(a._dictionarySizePrev=-1,a._matchFinder=null),!0)}function Yd(a,b){return 5>b||b>273?!1:(a._numFastBytes=b,!0)}function Zd(a,b){var c;for(a.properties[0]=9*(5*a._posStateBits+a._numLiteralPosStateBits)+a._numLiteralContextBits<<24>>24,c=0;4>c;++c)a.properties[1+c]=a._dictionarySize>>8*c<<24>>24;qb(b,a.properties,0,5)}function $d(a,b){var c;a._writeEndMark&&($e(a._rangeEncoder,a._isMatch,(a._state<<4)+b,1),$e(a._rangeEncoder,a._isRep,a._state,0),a._state=a._state<7?7:10,je(a._lenEncoder,a._rangeEncoder,0,b),c=Wc(2),Le(a._posSlotEncoder[c],a._rangeEncoder,63),_e(a._rangeEncoder,67108863,26),Ne(a._posAlignEncoder,a._rangeEncoder,15))}function _d(a){return 2048>a?Xf[a]:2097152>a?Xf[a>>10]+20:Xf[a>>20]+40}function ae(a){return 131072>a?Xf[a>>6]+12:134217728>a?Xf[a>>16]+32:Xf[a>>26]+52}function be(){return Mg}function ce(){}function de(a,b,c,d){8>c?($e(b,a._choice,0,0),Le(a._lowCoder[d],b,c)):(c-=8,$e(b,a._choice,0,1),8>c?($e(b,a._choice,1,0),Le(a._midCoder[d],b,c)):($e(b,a._choice,1,1),Le(a._highCoder,b,c-8)))}function ee(a){var b;for(a._choice=s(Bg,0,-1,2,1),a._lowCoder=s(Jg,0,8,16,0),a._midCoder=s(Jg,0,8,16,0),a._highCoder=Ke(new Se,8),b=0;16>b;++b)a._lowCoder[b]=Ke(new Se,3),a._midCoder[b]=Ke(new Se,3);return a}function fe(a,b){var c;for(ff(a._choice),c=0;b>c;++c)We(a._lowCoder[c].Models),We(a._midCoder[c].Models);We(a._highCoder.Models)}function ge(a,b,c,d,e){var f,g,h,i,j;for(Ze(),f=Yf[a._choice[0]>>>2],g=Yf[2048-a._choice[0]>>>2],h=g+Yf[a._choice[1]>>>2],i=g+Yf[2048-a._choice[1]>>>2],j=0,j=0;8>j;++j){if(j>=c)return;d[e+j]=f+Me(a._lowCoder[b],j)}for(;16>j;++j){if(j>=c)return;d[e+j]=h+Me(a._midCoder[b],j-8)}for(;c>j;++j)d[e+j]=i+Me(a._highCoder,j-8-8)}function he(){return Qg}function ie(){}function je(a,b,c,d){de(a,b,c,d),0==--a._counters[d]&&(ge(a,d,a._tableSize,a._prices,272*d),a._counters[d]=a._tableSize)}function ke(a){return ee(a),a._prices=s(tg,0,-1,4352,1),a._counters=s(tg,0,-1,16,1),a}function le(a,b,c){return a._prices[272*c+b]}function me(a,b){var c;for(c=0;b>c;++c)ge(a,c,a._tableSize,a._prices,272*c),a._counters[c]=a._tableSize}function ne(){return Rg}function oe(){}function pe(a,b,c){var d,e;if(null==a.m_Coders||a.m_NumPrevBits!=c||a.m_NumPosBits!=b)for(a.m_NumPosBits=b,a.m_PosMask=(1<<b)-1,a.m_NumPrevBits=c,e=1<<a.m_NumPrevBits+a.m_NumPosBits,a.m_Coders=s(Ng,0,5,e,0),d=0;e>d;++d)a.m_Coders[d]=we(new ze)}function qe(a,b,c){return a.m_Coders[((b&a.m_PosMask)<<a.m_NumPrevBits)+((255&c)>>>8-a.m_NumPrevBits)]}function re(a){var b,c;for(c=1<<a.m_NumPrevBits+a.m_NumPosBits,b=0;c>b;++b)ff(a.m_Coders[b].m_Encoders)}function se(){return Og}function te(){}function ue(a,b,c){var d,e,f;for(e=1,f=7;f>=0;--f)d=c>>f&1,$e(b,a.m_Encoders,e,d),e=e<<1|d}function ve(a,b,c,d){var e,f,g,h,i,j;for(f=1,i=!0,g=7;g>=0;--g)e=d>>g&1,j=f,i&&(h=c>>g&1,j+=1+h<<8,i=h==e),$e(b,a.m_Encoders,j,e),f=f<<1|e}function we(a){return a.m_Encoders=s(Bg,0,-1,768,1),a}function xe(a,b,c,d){var e,f,g,h,i;if(i=0,f=1,g=7,b)for(;g>=0;--g)if(h=c>>g&1,e=d>>g&1,i+=ef(a.m_Encoders[(1+h<<8)+f],e),f=f<<1|e,h!=e){--g;break}for(;g>=0;--g)e=d>>g&1,i+=ef(a.m_Encoders[f],e),f=f<<1|e;return i}function ye(){return Pg}function ze(){}function Ae(a){a.BackPrev=-1,a.Prev1IsChar=!1}function Be(a){a.BackPrev=0,a.Prev1IsChar=!1}function Ce(){return Sg}function De(){}function Ee(a,b){return a.NumBitLevels=b,a.Models=s(Bg,0,-1,1<<b,1),a}function Fe(a,b){var c,d;for(d=1,c=a.NumBitLevels;0!=c;--c)d=(d<<1)+Te(b,a.Models,d);return d-(1<<a.NumBitLevels)}function Ge(a,b){var c,d,e,f;for(e=1,f=0,d=0;d<a.NumBitLevels;++d)c=Te(b,a.Models,e),e<<=1,e+=c,f|=c<<d;return f}function He(a,b,c,d){var e,f,g,h;for(g=1,h=0,f=0;d>f;++f)e=Te(c,a,b+g),g<<=1,g+=e,h|=e<<f;return h}function Ie(){return Tg}function Je(){}function Ke(a,b){return a.NumBitLevels=b,a.Models=s(Bg,0,-1,1<<b,1),a}function Le(a,b,c){var d,e,f;for(f=1,e=a.NumBitLevels;0!=e;)--e,d=c>>>e&1,$e(b,a.Models,f,d),f=f<<1|d}function Me(a,b){var c,d,e,f;for(f=0,e=1,d=a.NumBitLevels;0!=d;)--d,c=b>>>d&1,f+=ef(a.Models[e],c),e=(e<<1)+c;return f}function Ne(a,b,c){var d,e,f;for(f=1,e=0;e<a.NumBitLevels;++e)d=1&c,$e(b,a.Models,f,d),f=f<<1|d,c>>=1}function Oe(a,b){var c,d,e,f;for(f=0,e=1,d=a.NumBitLevels;0!=d;--d)c=1&b,b>>>=1,f+=ef(a.Models[e],c),e=e<<1|c;return f}function Pe(a,b,c,d,e){var f,g,h;for(h=1,g=0;d>g;++g)f=1&e,$e(c,a,b+h,f),h=h<<1|f,e>>=1}function Qe(a,b,c,d){var e,f,g,h;for(h=0,g=1,f=c;0!=f;--f)e=1&d,d>>>=1,Ze(),h+=Yf[(2047&(a[b+g]-e^-e))>>>2],g=g<<1|e;return h}function Re(){return Ug}function Se(){}function Te(a,b,c){var d,e;return e=b[c],d=(a.Range>>>11)*e,(-2147483648^a.Code)<(-2147483648^d)?(a.Range=d,b[c]=e+(2048-e>>>5)<<16>>16,0==(-16777216&a.Range)&&(a.Code=a.Code<<8|gb(a.Stream),a.Range<<=8),0):(a.Range-=d,a.Code-=d,b[c]=e-(e>>>5)<<16>>16,0==(-16777216&a.Range)&&(a.Code=a.Code<<8|gb(a.Stream),a.Range<<=8),1)}function Ue(a,b){var c,d,e;for(d=0,c=b;0!=c;--c)a.Range>>>=1,e=a.Code-a.Range>>>31,a.Code-=a.Range&e-1,d=d<<1|1-e,0==(-16777216&a.Range)&&(a.Code=a.Code<<8|gb(a.Stream),a.Range<<=8);return d}function Ve(a){var b;for(a.Code=0,a.Range=-1,b=0;5>b;++b)a.Code=a.Code<<8|gb(a.Stream)}function We(a){var b;for(b=0;b<a.length;++b)a[b]=1024}function Xe(){return Vg}function Ye(){}function Ze(){Ze=tf;var a,b,c,d;for(Yf=s(tg,0,-1,512,1),b=8;b>=0;--b)for(d=1<<9-b-1,a=1<<9-b,c=d;a>c;++c)Yf[c]=(b<<6)+(a-c<<6>>>9-b-1)}function $e(a,b,c,d){var e,f;f=b[c],e=(a.Range>>>11)*f,0==d?(a.Range=e,b[c]=f+(2048-f>>>5)<<16>>16):(a.Low=F(a.Low,H(N(e),If)),a.Range-=e,b[c]=f-(f>>>5)<<16>>16),0==(-16777216&a.Range)&&(a.Range<<=8,df(a))}function _e(a,b,c){var d;for(d=c-1;d>=0;--d)a.Range>>>=1,1==(b>>>d&1)&&(a.Low=F(a.Low,N(a.Range))),0==(-16777216&a.Range)&&(a.Range<<=8,df(a))}function af(a){var b;for(b=0;5>b;++b)df(a)}function bf(a){return F(F(N(a._cacheSize),a._position),Df)}function cf(a){a._position=Bf,a.Low=Bf,a.Range=-1,a._cacheSize=1,a._cache=0}function df(a){var b,c;if(b=P(X(a.Low,32)),0!=b||I(a.Low,Hf)<0){a._position=F(a._position,N(a._cacheSize)),c=a._cache;do pb(a.Stream,c+b),c=255;while(0!=--a._cacheSize);a._cache=P(a.Low)>>>24}++a._cacheSize,a.Low=V(H(a.Low,Ff),8)}function ef(a,b){return Ze(),Yf[(2047&(a-b^-b))>>>2]}function ff(a){Ze();var b;for(b=0;b<a.length;++b)a[b]=1024}function gf(){return Wg}function hf(){}function jf(a){var b,c,d,e,f;for(b=Zb(new _b),c=0;c<a.length;++c)if(d=255&a[c],0==(128&d)){if(0==d)throw Lb(new Nb,"invalid UTF-8");o(b.data,String.fromCharCode(65535&d))}else if(192==(224&d)){if(c+1>=a.length)throw Lb(new Nb,"invalid UTF-8");if(e=255&a[++c],128!=(192&e))throw Lb(new Nb,"invalid UTF-8");n(b.data,String.fromCharCode((31&d)<<6&65535|63&e))}else{if(224!=(240&d))throw Lb(new Nb,"invalid UTF-8");if(c+2>=a.length)throw Lb(new Nb,"invalid UTF-8");if(e=255&a[++c],128!=(192&e))throw Lb(new Nb,"invalid UTF-8");if(f=255&a[++c],128!=(192&f))throw Lb(new Nb,"invalid UTF-8");o(b.data,String.fromCharCode(65535&((15&d)<<12|(63&e)<<6|63&f)))}return p(b.data)}function kf(a){var b,c,d,e,f,g,h;for(h=a.length,g=s(ng,0,-1,h,1),Xb(a,0,h,g,0),c=g,e=0,f=0;f<a.length;++f)b=c[f],b>=1&&127>=b?++e:e+=0==b||b>=128&&2047>=b?2:3;for(d=s(gg,0,-1,e,1),e=0,f=0;f<a.length;++f)b=c[f],b>=1&&127>=b?d[e++]=b<<24>>24:0==b||b>=128&&2047>=b?(d[e++]=(192|b>>6&31)<<24>>24,d[e++]=(128|63&b)<<24>>24):(d[e++]=(224|b>>12&15)<<24>>24,d[e++]=(128|b>>6&63)<<24>>24,d[e++]=(128|63&b)<<24>>24);return d}function lf(a){return a}function mf(a){return a[1]+a[0]}function nf(){function b(){var i;for(d=(new Date).getTime();ec(h.c);)if(c=mf(h.c.chunker.inBytesProcessed)/mf(h.c.length_0),(new Date).getTime()-d>200)return g?g(c):"undefined"!=typeof e&&a(c,e),setTimeout(b,0),!1;g?g(1):"undefined"!=typeof e&&a(1,e),i=ob(h.c.output).slice(0),f?f(i):"undefined"!=typeof e&&postMessage({action:xf,callback_num:e,result:i})}var c,d,e,f,g,h=lf(new qf),i=arguments[0],j=arguments[1];"function"==typeof arguments[2]?(f=arguments[2],"function"==typeof arguments[3]&&(g=arguments[3])):e=arguments[2],h.mode=bh(j),h.c=ic(new kc,kf(i),h.mode),g?g(0):"undefined"!=typeof e&&a(0,e),setTimeout(b,1)}function of(){function b(){var d;for(e=(new Date).getTime();lc(i.d);)if(c=mf(i.d.chunker.decoder.nowPos64)/mf(i.d.length_0),(new Date).getTime()-e>200)return h?h(c):"undefined"!=typeof f&&a(c,f),setTimeout(b,0),!1;h?h(1):"undefined"!=typeof f&&a(1,f),d=jf(ob(i.d.output)),g?g(d):"undefined"!=typeof f&&postMessage({action:yf,callback_num:f,result:d})}var c,d,e,f,g,h,i=lf(new qf),j=arguments[0];"function"==typeof arguments[1]?(g=arguments[1],"function"==typeof arguments[2]&&(h=arguments[2])):f=arguments[1],d=t(gg,0,-1,j),i.d=pc(new rc,d),h?h(0):"undefined"!=typeof f&&a(0,f),setTimeout(b,0)}function pf(){return ah}function qf(){}function rf(){!!$stats&&$stats({moduleName:uf,subSystem:"startup",evtGroup:"moduleStartup",millis:(new Date).getTime(),type:"onModuleLoadStart",className:"org.dellroad.lzma.demo.client.LZMADemo"})}function sf(a,b,c){if(uf=b,vf=c,a)try{rf()}catch(d){a(b)}else rf()}function tf(){}var uf,vf,wf,xf=1,yf=2,zf=[0,-0x8000000000000000],Af=[4294967295,-4294967296],Bf=[0,0],Cf=[1,0],Df=[4,0],Ef=[4096,0],Ff=[16777215,0],Gf=[16777216,0],Hf=[4278190080,0],If=[4294967295,0],Jf=[4294967295,0x7fffffff00000000];wf=c.prototype={},wf.getClass$=b,wf.typeMarker$=tf,wf.typeId$=1,wf=e.prototype=new c,wf.getClass$=d,wf.typeId$=3,wf.detailMessage=null,wf=g.prototype=new e,wf.getClass$=f,wf.typeId$=4,wf=j.prototype=new g,wf.getClass$=i,wf.typeId$=5,wf=m.prototype=new j,wf.getClass$=l,wf.typeId$=6,wf=v.prototype=new c,wf.getClass$=r,wf.typeId$=0,wf.arrayClass$=null,wf.length=0,wf.queryId$=0;var Kf,Lf,Mf,Nf,Of,Pf,Qf,Rf,Sf,Tf,Uf,Vf=[{},{},{1:1},{2:1},{2:1},{2:1},{2:1},{2:1,10:1},{2:1},{2:1},{2:1},{2:1},{2:1},{2:1,11:1},{2:1},{2:1},{2:1},{4:1},{5:1},{6:1},{7:1},{8:1},{9:1}];wf=db.prototype=new c,wf.getClass$=cb,wf.typeId$=0,wf=jb.prototype=new db,wf.getClass$=ib,wf.typeId$=0,wf.buf=null,wf.count=0,wf.pos=0,wf=lb.prototype=new c,wf.getClass$=kb,wf.typeId$=0,wf=sb.prototype=new lb,wf.getClass$=rb,wf.typeId$=0,wf.buf=null,wf.count=0,wf=vb.prototype=new g,wf.getClass$=ub,wf.typeId$=7,wf=yb.prototype=new j,wf.getClass$=xb,wf.typeId$=8,wf=Bb.prototype=new j,wf.getClass$=Ab,wf.typeId$=9,wf=Gb.prototype=new c,wf.getClass$=Fb,wf.typeId$=0,wf.typeName=null,wf=Ib.prototype=new j,wf.getClass$=Hb,wf.typeId$=12,wf=Kb.prototype=new c,wf.getClass$=Jb,wf.typeId$=0,wf=Nb.prototype=new j,wf.getClass$=Mb,wf.typeId$=13,wf=Pb.prototype=new j,wf.getClass$=Ob,wf.typeId$=14,wf=Rb.prototype=new j,wf.getClass$=Qb,wf.typeId$=15,wf=Vb.prototype=new j,wf.getClass$=Ub,wf.typeId$=16,wf=String.prototype,wf.getClass$=Yb,wf.typeId$=2,wf=_b.prototype=new c,wf.getClass$=$b,wf.typeId$=0,wf=dc.prototype=new Kb,wf.getClass$=cc,wf.typeId$=0,wf.dictionarySize=0,wf.fb=0,wf.lc=0,wf.lp=0,wf.matchFinder=0,wf.pb=0,wf=hc.prototype=new c,wf.getClass$=gc,wf.typeId$=0,wf.chunker=null,wf=kc.prototype=new hc,wf.getClass$=jc,wf.typeId$=0,wf.output=null,wf=oc.prototype=new c,wf.getClass$=nc,wf.typeId$=0,wf.chunker=null,wf.exception=null,wf.length_0=Bf,wf=rc.prototype=new oc,wf.getClass$=qc,wf.typeId$=0,wf.output=null,wf=Bc.prototype=new c,wf.getClass$=Ac,wf.typeId$=0,wf._blockSize=0,wf._bufferBase=null,wf._bufferOffset=0,wf._keepSizeAfter=0,wf._keepSizeBefore=0,wf._pointerToLastSafePosition=0,wf._pos=0,wf._posLimit=0,wf._stream=null,wf._streamEndWasReached=!1,wf._streamPos=0,wf=Lc.prototype=new Bc,wf.getClass$=Kc,wf.typeId$=0,wf.HASH_ARRAY=!0,wf._cutValue=255,wf._cyclicBufferPos=0,wf._cyclicBufferSize=0,wf._hash=null,wf._hashMask=0,wf._hashSizeSum=0,wf._matchMaxLen=0,wf._son=null,wf.kFixHashSize=66560,wf.kMinMatchCheck=4,wf.kNumHashDirectBytes=0;var Wf;wf=Vc.prototype=new c,wf.getClass$=Uc,wf.typeId$=0,wf._buffer=null,wf._pos=0,wf._stream=null,wf._streamPos=0,wf._windowSize=0,wf=cd.prototype=new c,wf.getClass$=bd,wf.typeId$=0,wf.alive=!1,wf.decoder=null,wf.encoder=null,wf=md.prototype=new c,wf.getClass$=ld,wf.typeId$=0,wf.m_DictionarySize=-1,wf.m_DictionarySizeCheck=-1,wf.m_PosStateMask=0,wf.nowPos64=Bf,wf.outSize=Bf,wf.prevByte=0,wf.rep0=0,wf.rep1=0,wf.rep2=0,wf.rep3=0,wf.state=0,wf=sd.prototype=new c,wf.getClass$=rd,wf.typeId$=0,wf.m_NumPosStates=0,wf=xd.prototype=new c,wf.getClass$=wd,wf.typeId$=0,wf.m_Coders=null,wf.m_NumPosBits=0,wf.m_NumPrevBits=0,wf.m_PosMask=0,wf=Cd.prototype=new c,wf.getClass$=Bd,wf.typeId$=17,wf=ce.prototype=new c,wf.getClass$=be,wf.typeId$=0,wf._additionalOffset=0,wf._alignPriceCount=0,wf._dictionarySize=4194304,wf._dictionarySizePrev=-1,wf._distTableSize=44,wf._finished=!1,wf._inStream=null,wf._longestMatchLength=0,wf._longestMatchWasFound=!1,wf._matchFinder=null,wf._matchFinderType=1,wf._matchPriceCount=0,wf._needReleaseMFStream=!1,wf._numDistancePairs=0,wf._numFastBytes=32,wf._numFastBytesPrev=-1,wf._numLiteralContextBits=3,wf._numLiteralPosStateBits=0,wf._optimumCurrentIndex=0,wf._optimumEndIndex=0,wf._posStateBits=2,wf._posStateMask=3,wf._previousByte=0,wf._state=0,wf._writeEndMark=!1,wf.backRes=0,wf.nowPos64=Bf;var Xf;wf=ie.prototype=new c,wf.getClass$=he,wf.typeId$=0,wf=oe.prototype=new ie,wf.getClass$=ne,wf.typeId$=0,wf._tableSize=0,wf=te.prototype=new c,wf.getClass$=se,wf.typeId$=0,wf.m_Coders=null,wf.m_NumPosBits=0,wf.m_NumPrevBits=0,wf.m_PosMask=0,wf=ze.prototype=new c,wf.getClass$=ye,wf.typeId$=18,wf=De.prototype=new c,wf.getClass$=Ce,wf.typeId$=19,wf.BackPrev=0,wf.BackPrev2=0,wf.Backs0=0,wf.Backs1=0,wf.Backs2=0,wf.Backs3=0,wf.PosPrev=0,wf.PosPrev2=0,wf.Prev1IsChar=!1,wf.Prev2=!1,wf.Price=0,wf.State=0,wf=Je.prototype=new c,wf.getClass$=Ie,wf.typeId$=20,wf.Models=null,wf.NumBitLevels=0,wf=Se.prototype=new c,wf.getClass$=Re,wf.typeId$=21,wf.Models=null,wf.NumBitLevels=0,wf=Ye.prototype=new c,wf.getClass$=Xe,wf.typeId$=0,wf.Code=0,wf.Range=0,wf.Stream=null,wf=hf.prototype=new c,wf.getClass$=gf,wf.typeId$=0,wf.Low=Bf,wf.Range=0,wf.Stream=null,wf._cache=0,wf._cacheSize=0,wf._position=Bf;var Yf;wf=qf.prototype=new c,wf.getClass$=pf,wf.typeId$=0,wf.c=null,wf.d=null;var Zf=Db("java.lang.","Object"),$f=Db("java.lang.","Throwable"),_f=Db("java.lang.","Exception"),ag=Db("java.lang.","RuntimeException"),bg=Db("com.google.gwt.core.client.","JavaScriptException"),cg=Db("com.google.gwt.core.client.","JavaScriptObject$"),dg=Cb("","[[D"),eg=Db("java.io.","InputStream"),fg=Db("java.io.","ByteArrayInputStream"),gg=Cb("","[B"),hg=Db("java.io.","OutputStream"),ig=Db("java.io.","ByteArrayOutputStream"),jg=Db("java.io.","IOException"),kg=Db("java.lang.","Enum"),lg=Db("java.lang.","ArithmeticException"),mg=Db("java.lang.","ArrayStoreException"),ng=Cb("","[C"),og=Db("java.lang.","Class"),pg=Db("java.lang.","ClassCastException"),qg=Db("java.lang.","IllegalArgumentException"),rg=Db("java.lang.","IllegalStateException"),sg=Db("java.lang.","IndexOutOfBoundsException"),tg=Cb("","[I"),ug=Db("java.lang.","NullPointerException"),vg=Db("java.lang.","String"),wg=Db("java.lang.","StringBuilder"),xg=Db("org.dellroad.lzma.client.SevenZip.Compression.LZ.","InWindow"),yg=Db("org.dellroad.lzma.client.SevenZip.Compression.LZ.","BinTree"),zg=Db("org.dellroad.lzma.client.SevenZip.Compression.LZ.","OutWindow"),Ag=Db("org.dellroad.lzma.client.SevenZip.Compression.LZMA.","Chunker"),Bg=Cb("","[S"),Cg=Cb("[Lorg.dellroad.lzma.client.SevenZip.Compression.RangeCoder.","BitTreeDecoder;"),Dg=Db("org.dellroad.lzma.client.SevenZip.Compression.LZMA.","Decoder"),Eg=Db("org.dellroad.lzma.client.SevenZip.Compression.LZMA.","Decoder$LenDecoder"),Fg=Cb("[Lorg.dellroad.lzma.client.SevenZip.Compression.LZMA.","Decoder$LiteralDecoder$Decoder2;"),Gg=Db("org.dellroad.lzma.client.SevenZip.Compression.LZMA.","Decoder$LiteralDecoder"),Hg=Db("org.dellroad.lzma.client.SevenZip.Compression.LZMA.","Decoder$LiteralDecoder$Decoder2"),Ig=Cb("[Lorg.dellroad.lzma.client.SevenZip.Compression.LZMA.","Encoder$Optimal;"),Jg=Cb("[Lorg.dellroad.lzma.client.SevenZip.Compression.RangeCoder.","BitTreeEncoder;"),Kg=Cb("","[J"),Lg=Cb("","[Z"),Mg=Db("org.dellroad.lzma.client.SevenZip.Compression.LZMA.","Encoder"),Ng=Cb("[Lorg.dellroad.lzma.client.SevenZip.Compression.LZMA.","Encoder$LiteralEncoder$Encoder2;"),Og=Db("org.dellroad.lzma.client.SevenZip.Compression.LZMA.","Encoder$LiteralEncoder"),Pg=Db("org.dellroad.lzma.client.SevenZip.Compression.LZMA.","Encoder$LiteralEncoder$Encoder2"),Qg=Db("org.dellroad.lzma.client.SevenZip.Compression.LZMA.","Encoder$LenEncoder"),Rg=Db("org.dellroad.lzma.client.SevenZip.Compression.LZMA.","Encoder$LenPriceTableEncoder"),Sg=Db("org.dellroad.lzma.client.SevenZip.Compression.LZMA.","Encoder$Optimal"),Tg=Db("org.dellroad.lzma.client.SevenZip.Compression.RangeCoder.","BitTreeDecoder"),Ug=Db("org.dellroad.lzma.client.SevenZip.Compression.RangeCoder.","BitTreeEncoder"),Vg=Db("org.dellroad.lzma.client.SevenZip.Compression.RangeCoder.","Decoder"),Wg=Db("org.dellroad.lzma.client.SevenZip.Compression.RangeCoder.","Encoder"),Xg=Eb("org.dellroad.lzma.client.","CompressionMode"),Yg=Db("org.dellroad.lzma.client.","LZMACompressor"),Zg=Db("org.dellroad.lzma.client.","LZMAByteArrayCompressor"),$g=Db("org.dellroad.lzma.client.","LZMADecompressor"),_g=Db("org.dellroad.lzma.client.","LZMAByteArrayDecompressor"),ah=Db("org.dellroad.lzma.demo.client.","LZMADemo");sf(function(){},"lzma_demo","");var bh=function(){function a(a){return!isNaN(parseFloat(a))&&isFinite(a)}var b=[{dictionarySize:16,fb:64,matchFinder:0,lc:3,lp:0,pb:2},{dictionarySize:20,fb:64,matchFinder:0,lc:3,lp:0,pb:2},{dictionarySize:19,fb:64,matchFinder:1,lc:3,lp:0,pb:2},{dictionarySize:20,fb:64,matchFinder:1,lc:3,lp:0,pb:2},{dictionarySize:21,fb:128,matchFinder:1,lc:3,lp:0,pb:2},{dictionarySize:22,fb:128,matchFinder:1,lc:3,lp:0,pb:2},{dictionarySize:23,fb:128,matchFinder:1,lc:3,lp:0,pb:2},{dictionarySize:24,fb:255,matchFinder:1,lc:3,lp:0,pb:2},{dictionarySize:25,fb:255,matchFinder:1,lc:3,lp:0,pb:2}];return function(c){return a(c)?1>c?c=1:c>9&&(c=9):c=1,b[c-1]}}();return{compress:nf,decompress:of}}();this.LZMA=LZMA,function(a){function b(b){var c=b||window.event,d=[].slice.call(arguments,1),e=0,f=0,g=0;return b=a.event.fix(c),b.type="mousewheel",c.wheelDelta&&(e=c.wheelDelta/120),c.detail&&(e=-c.detail/3),g=e,void 0!==c.axis&&c.axis===c.HORIZONTAL_AXIS&&(g=0,f=-1*e),void 0!==c.wheelDeltaY&&(g=c.wheelDeltaY/120),void 0!==c.wheelDeltaX&&(f=-1*c.wheelDeltaX/120),d.unshift(b,e,f,g),(a.event.dispatch||a.event.handle).apply(this,d)}var c=["DOMMouseScroll","mousewheel"];if(a.event.fixHooks)for(var d=c.length;d;)a.event.fixHooks[c[--d]]=a.event.mouseHooks;a.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var a=c.length;a;)this.addEventListener(c[--a],b,!1);else this.onmousewheel=b},teardown:function(){if(this.removeEventListener)for(var a=c.length;a;)this.removeEventListener(c[--a],b,!1);else this.onmousewheel=null}},a.fn.extend({mousewheel:function(a){return a?this.bind("mousewheel",a):this.trigger("mousewheel")},unmousewheel:function(a){return this.unbind("mousewheel",a)}})}(jQuery);var Mustache;!function(a){"undefined"!=typeof module&&"undefined"!=typeof module.exports?module.exports=a:"function"==typeof define?define(a):Mustache=a}(function(){function a(a,b){return RegExp.prototype.test.call(a,b)}function b(b){return!a(u,b)}function c(a){var b=a.replace(z,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)});return'"'+b+'"'}function d(a){return a.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function e(a){return String(a).replace(/[&<>"'\/]/g,function(a){return A[a]})}function f(a){this.string=a,this.tail=a,this.pos=0}function g(a,b){this.view=a,this.parent=b,this.clearCache()}function h(){this.clearCache()}function i(a,b){for(var d,e,f,g=['""'],h=0,j=a.length;j>h;++h)switch(d=a[h],d.type){case"#":case"^":e="#"===d.type?"_section":"_inverted",g.push("r."+e+"("+c(d.value)+", c, function (c, r) {\n  "+i(d.tokens,!0)+"\n})");break;case"{":case"&":case"name":f="name"===d.type?"true":"false",g.push("r._name("+c(d.value)+", c, "+f+")");break;case">":g.push("r._partial("+c(d.value)+", c)");break;case"text":g.push(c(d.value))}return g="return "+g.join(" + ")+";",b?g:new Function("c, r",g)}function j(a){if(2===a.length)return[new RegExp(d(a[0])+"\\s*"),new RegExp("\\s*"+d(a[1]))];throw new Error("Invalid tags: "+a.join(" "))}function k(a){for(var b,c,d=[],e=d,f=[],g=0;g<a.length;++g)switch(b=a[g],b.type){case"#":case"^":b.tokens=[],f.push(b),e.push(b),e=b.tokens;break;case"/":if(0===f.length)throw new Error("Unopened section: "+b.value);if(c=f.pop(),c.value!==b.value)throw new Error("Unclosed section: "+c.value);e=f.length>0?f[f.length-1].tokens:d;break;default:e.push(b)}if(c=f.pop())throw new Error("Unclosed section: "+c.value);return d}function l(a){for(var b,c=0;c<a.length;++c){var d=a[c];b&&"text"===b.type&&"text"===d.type?(b.value+=d.value,a.splice(c--,1)):b=d}}function m(a,c){c=c||r.tags;for(var e,g,h,i=j(c),m=new f(a),n=[],o=[],p=!1,q=!1,u=function(){if(p&&!q)for(;o.length;)n.splice(o.pop(),1);else o=[];p=!1,q=!1};!m.eos();){if(g=m.scanUntil(i[0]))for(var y=0,z=g.length;z>y;++y)h=g.charAt(y),b(h)?o.push(n.length):q=!0,n.push({type:"text",value:h}),"\n"===h&&u();if(!m.scan(i[0]))break;if(p=!0,e=m.scan(x)||"name",m.scan(s),"="===e)g=m.scanUntil(v),m.scan(v),m.scanUntil(i[1]);else if("{"===e){var A=new RegExp("\\s*"+d("}"+c[1]));g=m.scanUntil(A),m.scan(w),m.scanUntil(i[1])}else g=m.scanUntil(i[1]);if(!m.scan(i[1]))throw new Error("Unclosed tag at "+m.pos);n.push({type:e,value:g}),("name"===e||"{"===e||"&"===e)&&(q=!0),"="===e&&(c=g.split(t),i=j(c))}return l(n),k(n)}function n(){B.clearCache()}function o(a,b){return B.compile(a,b)}function p(a,b,c){return B.compilePartial(a,b,c)}function q(a,b,c){if(c)for(var d in c)p(d,c[d]);return B.render(a,b)}var r={};r.name="mustache.js",r.version="0.5.2",r.tags=["{{","}}"],r.parse=m,r.clearCache=n,r.compile=o,r.compilePartial=p,r.render=q,r.Scanner=f,r.Context=g,r.Renderer=h,r.to_html=function(a,b,c,d){var e=q(a,b,c);return"function"!=typeof d?e:void d(e)};var s=/\s*/,t=/\s+/,u=/\S/,v=/\s*=/,w=/\s*\}/,x=/#|\^|\/|>|\{|&|=|!/,y=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)},z=/[\x00-\x2F\x3A-\x40\x5B-\x60\x7B-\xFF\u2028\u2029]/gm,A={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};r.isWhitespace=b,r.isArray=y,r.quote=c,r.escapeRe=d,r.escapeHtml=e,f.prototype.eos=function(){return""===this.tail},f.prototype.scan=function(a){var b=this.tail.match(a);return b&&0===b.index?(this.tail=this.tail.substring(b[0].length),this.pos+=b[0].length,b[0]):""},f.prototype.scanUntil=function(a){var b,c=this.tail.search(a);switch(c){case-1:b=this.tail,this.pos+=this.tail.length,this.tail="";break;case 0:b="";break;default:b=this.tail.substring(0,c),this.tail=this.tail.substring(c),this.pos+=c}return b},g.make=function(a){return a instanceof g?a:new g(a)},g.prototype.clearCache=function(){this._cache={}},g.prototype.push=function(a){return new g(a,this)},g.prototype.lookup=function(a){var b=this._cache[a];if(!b){if("."===a)b=this.view;else for(var c=this;c;){if(a.indexOf(".")>0){var d=a.split("."),e=0;for(b=c.view;b&&e<d.length;)b=b[d[e++]]}else b=c.view[a];if(null!=b)break;c=c.parent}this._cache[a]=b}return"function"==typeof b&&(b=b.call(this.view)),b},h.prototype.clearCache=function(){this._cache={},this._partialCache={}},h.prototype.compile=function(a,b){"string"==typeof a&&(a=m(a,b));var c=i(a),d=this;return function(a){return c(g.make(a),d)}},h.prototype.compilePartial=function(a,b,c){return this._partialCache[a]=this.compile(b,c),this._partialCache[a]},h.prototype.render=function(a,b){var c=this._cache[a];return c||(c=this.compile(a),this._cache[a]=c),c(b)},h.prototype._section=function(a,b,c){var d=b.lookup(a);switch(typeof d){case"object":if(y(d)){for(var e="",f=0,g=d.length;g>f;++f)e+=c(b.push(d[f]),this);return e}return d?c(b.push(d),this):"";case"function":var h=c(b,this),i=this,j=function(a){return i.render(a,b)};return d.call(b.view,h,j)||"";default:if(d)return c(b,this)}return""},h.prototype._inverted=function(a,b,c){var d=b.lookup(a);return null==d||d===!1||y(d)&&0===d.length?c(b,this):""},h.prototype._partial=function(a,b){var c=this._partialCache[a];return c?c(b):""},h.prototype._name=function(a,b,c){var d=b.lookup(a);"function"==typeof d&&(d=d.call(b.view));var f=null==d?"":String(d);return c?e(f):f};var B=new h;return r}()),function(a){function b(){this===e.elem&&(e.pos=[-260,-260],e.elem=!1,f=3)}var c,d,e={pos:[-260,-260]},f=3,g=document,h=g.documentElement,i=g.body;a.event.special.mwheelIntent={setup:function(){var c=a(this).bind("mousewheel",a.event.special.mwheelIntent.handler);return this!==g&&this!==h&&this!==i&&c.bind("mouseleave",b),c=null,!0},teardown:function(){return a(this).unbind("mousewheel",a.event.special.mwheelIntent.handler).unbind("mouseleave",b),!0},handler:function(b){var g=[b.clientX,b.clientY];return this===e.elem||Math.abs(e.pos[0]-g[0])>f||Math.abs(e.pos[1]-g[1])>f?(e.elem=this,e.pos=g,f=250,clearTimeout(d),d=setTimeout(function(){f=10},200),clearTimeout(c),c=setTimeout(function(){f=3},1500),b=a.extend({},b,{type:"mwheelIntent"}),a.event.handle.apply(this,arguments)):void 0}},a.fn.extend({mwheelIntent:function(a){return a?this.bind("mwheelIntent",a):this.trigger("mwheelIntent")},unmwheelIntent:function(a){return this.unbind("mwheelIntent",a)}}),a(function(){i=g.body,a(g).bind("mwheelIntent.mwheelIntentDefault",a.noop)})}(jQuery),function(a,b,c){"undefined"!=typeof module&&module.exports?module.exports=c():"function"==typeof define&&define.amd?define(c):b[a]=c()}("reqwest",this,function(){function handleReadyState(a,b,c){return function(){return a._aborted?c(a.request):void(a.request&&4==a.request[readyState]&&(a.request.onreadystatechange=noop,twoHundo.test(a.request.status)?b(a.request):c(a.request)))}}function setHeaders(a,b){var c,d=b.headers||{};d.Accept=d.Accept||defaultHeaders.accept[b.type]||defaultHeaders.accept["*"],b.crossOrigin||d[requestedWith]||(d[requestedWith]=defaultHeaders.requestedWith),d[contentType]||(d[contentType]=b.contentType||defaultHeaders.contentType);for(c in d)d.hasOwnProperty(c)&&a.setRequestHeader(c,d[c])}function setCredentials(a,b){"undefined"!=typeof b.withCredentials&&"undefined"!=typeof a.withCredentials&&(a.withCredentials=!!b.withCredentials)}function generalCallback(a){lastValue=a}function urlappend(a,b){return a+(/\?/.test(a)?"&":"?")+b}function handleJsonp(a,b,c,d){var e=uniqid++,f=a.jsonpCallback||"callback",g=a.jsonpCallbackName||reqwest.getcallbackPrefix(e),h=new RegExp("((^|\\?|&)"+f+")=([^&]+)"),i=d.match(h),j=doc.createElement("script"),k=0,l=-1!==navigator.userAgent.indexOf("MSIE 10.0"),m=-1!==navigator.userAgent.indexOf("MSIE 9.0");return i?"?"===i[3]?d=d.replace(h,"$1="+g):g=i[3]:d=urlappend(d,f+"="+g),win[g]=generalCallback,j.type="text/javascript",j.src=d,j.async=!0,"undefined"==typeof j.onreadystatechange||l||m||(j.event="onclick",j.htmlFor=j.id="_reqwest_"+e),j.onload=j.onreadystatechange=function(){return j[readyState]&&"complete"!==j[readyState]&&"loaded"!==j[readyState]||k?!1:(j.onload=j.onreadystatechange=null,j.onclick&&j.onclick(),a.success&&a.success(lastValue),lastValue=void 0,head.removeChild(j),void(k=1))},head.appendChild(j),{abort:function(){j.onload=j.onreadystatechange=null,a.error&&a.error({},"Request is aborted: timeout",{}),lastValue=void 0,head.removeChild(j),k=1}}}function getRequest(a,b){var c,d=this.o,e=(d.method||"GET").toUpperCase(),f="string"==typeof d?d:d.url,g=d.processData!==!1&&d.data&&"string"!=typeof d.data?reqwest.toQueryString(d.data):d.data||null;return"jsonp"!=d.type&&"GET"!=e||!g||(f=urlappend(f,g),g=null),"jsonp"==d.type?handleJsonp(d,a,b,f):(c=xhr(),c.open(e,f,!0),setHeaders(c,d),setCredentials(c,d),c.onreadystatechange=handleReadyState(this,a,b),d.before&&d.before(c),c.send(g),c)}function Reqwest(a,b){this.o=a,this.fn=b,init.apply(this,arguments)}function setType(a){var b=a.match(/\.(json|jsonp|html|xml)(\?|$)/);return b?b[1]:"js"}function init(o,fn){function complete(a){for(o.timeout&&clearTimeout(self.timeout),self.timeout=null;self._completeHandlers.length>0;)self._completeHandlers.shift()(a)}function success(resp){var r=resp.responseText;if(r)switch(type){case"json":try{resp=win.JSON?win.JSON.parse(r):eval("("+r+")")}catch(err){return error(resp,"Could not parse JSON in response",err)}break;case"js":resp=eval(r);break;case"html":resp=r;break;case"xml":resp=resp.responseXML&&resp.responseXML.parseError&&resp.responseXML.parseError.errorCode&&resp.responseXML.parseError.reason?null:resp.responseXML
}for(self._responseArgs.resp=resp,self._fulfilled=!0,fn(resp);self._fulfillmentHandlers.length>0;)self._fulfillmentHandlers.shift()(resp);complete(resp)}function error(a,b,c){for(self._responseArgs.resp=a,self._responseArgs.msg=b,self._responseArgs.t=c,self._erred=!0;self._errorHandlers.length>0;)self._errorHandlers.shift()(a,b,c);complete(a)}this.url="string"==typeof o?o:o.url,this.timeout=null,this._fulfilled=!1,this._fulfillmentHandlers=[],this._errorHandlers=[],this._completeHandlers=[],this._erred=!1,this._responseArgs={};var self=this,type=o.type||setType(this.url);fn=fn||function(){},o.timeout&&(this.timeout=setTimeout(function(){self.abort()},o.timeout)),o.success&&this._fulfillmentHandlers.push(function(){o.success.apply(o,arguments)}),o.error&&this._errorHandlers.push(function(){o.error.apply(o,arguments)}),o.complete&&this._completeHandlers.push(function(){o.complete.apply(o,arguments)}),this.request=getRequest.call(this,success,error)}function reqwest(a,b){return new Reqwest(a,b)}function normalize(a){return a?a.replace(/\r?\n/g,"\r\n"):""}function serial(a,b){var c,d,e,f,g=a.name,h=a.tagName.toLowerCase(),i=function(a){a&&!a.disabled&&b(g,normalize(a.attributes.value&&a.attributes.value.specified?a.value:a.text))};if(!a.disabled&&g)switch(h){case"input":/reset|button|image|file/i.test(a.type)||(c=/checkbox/i.test(a.type),d=/radio/i.test(a.type),e=a.value,(!(c||d)||a.checked)&&b(g,normalize(c&&""===e?"on":e)));break;case"textarea":b(g,normalize(a.value));break;case"select":if("select-one"===a.type.toLowerCase())i(a.selectedIndex>=0?a.options[a.selectedIndex]:null);else for(f=0;a.length&&f<a.length;f++)a.options[f].selected&&i(a.options[f])}}function eachFormElement(){var a,b,c=this,d=function(a,b){var d,e,f;for(d=0;d<b.length;d++)for(f=a[byTag](b[d]),e=0;e<f.length;e++)serial(f[e],c)};for(b=0;b<arguments.length;b++)a=arguments[b],/input|select|textarea/i.test(a.tagName)&&serial(a,c),d(a,["input","select","textarea"])}function serializeQueryString(){return reqwest.toQueryString(reqwest.serializeArray.apply(null,arguments))}function serializeHash(){var a={};return eachFormElement.apply(function(b,c){b in a?(a[b]&&!isArray(a[b])&&(a[b]=[a[b]]),a[b].push(c)):a[b]=c},arguments),a}function getValue(a){return"function"==typeof a?a():a}var win=window,doc=document,twoHundo=/^20\d$/,byTag="getElementsByTagName",readyState="readyState",contentType="Content-Type",requestedWith="X-Requested-With",head=doc[byTag]("head")[0],uniqid=0,callbackPrefix="reqwest_"+ +new Date,lastValue,xmlHttpRequest="XMLHttpRequest",noop=function(){},isArray="function"==typeof Array.isArray?Array.isArray:function(a){return a instanceof Array},defaultHeaders={contentType:"application/x-www-form-urlencoded",requestedWith:xmlHttpRequest,accept:{"*":"text/javascript, text/html, application/xml, text/xml, */*",xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript",js:"application/javascript, text/javascript"}},xhr=win[xmlHttpRequest]?function(){return new XMLHttpRequest}:function(){return new ActiveXObject("Microsoft.XMLHTTP")};return Reqwest.prototype={abort:function(){this._aborted=!0,this.request.abort()},retry:function(){init.call(this,this.o,this.fn)},then:function(a,b){return this._fulfilled?a(this._responseArgs.resp):this._erred?b(this._responseArgs.resp,this._responseArgs.msg,this._responseArgs.t):(this._fulfillmentHandlers.push(a),this._errorHandlers.push(b)),this},always:function(a){return this._fulfilled||this._erred?a(this._responseArgs.resp):this._completeHandlers.push(a),this},fail:function(a){return this._erred?a(this._responseArgs.resp,this._responseArgs.msg,this._responseArgs.t):this._errorHandlers.push(a),this}},reqwest.serializeArray=function(){var a=[];return eachFormElement.apply(function(b,c){a.push({name:b,value:c})},arguments),a},reqwest.serialize=function(){if(0===arguments.length)return"";var a,b,c=Array.prototype.slice.call(arguments,0);return a=c.pop(),a&&a.nodeType&&c.push(a)&&(a=null),a&&(a=a.type),b="map"==a?serializeHash:"array"==a?reqwest.serializeArray:serializeQueryString,b.apply(null,c)},reqwest.toQueryString=function(a){var b,c,d,e="",f=encodeURIComponent,g=function(a,b){e+=f(a)+"="+f(b)+"&"};if(isArray(a))for(b=0;a&&b<a.length;b++)g(a[b].name,a[b].value);else for(c in a)if(Object.hasOwnProperty.call(a,c))if(d=a[c],isArray(d))for(b=0;b<d.length;b++)g(c,d[b]);else g(c,a[c]);return e.replace(/&$/,"").replace(/%20/g,"+")},reqwest.getcallbackPrefix=function(){return callbackPrefix},reqwest.compat=function(a,b){return a&&(a.type&&(a.method=a.type)&&delete a.type,a.dataType&&(a.type=a.dataType),a.jsonpCallback&&(a.jsonpCallbackName=getValue(a.jsonpCallback))&&delete a.jsonpCallback,a.jsonp&&(a.jsonpCallback=a.jsonp)),new Reqwest(a,b)},reqwest})(function(a,b,c){function d(a,c){var d,e=b.createElement(a||"div");for(d in c)e[d]=c[d];return e}function e(a){for(var b=1,c=arguments.length;c>b;b++)a.appendChild(arguments[b]);return a}function f(a,b,c,d){var e=["opacity",b,~~(100*a),c,d].join("-"),f=.01+c/d*100,g=Math.max(1-(1-a)/b*(100-f),a),h=k.substring(0,k.indexOf("Animation")).toLowerCase(),i=h&&"-"+h+"-"||"";return m[e]||(n.insertRule("@"+i+"keyframes "+e+"{0%{opacity:"+g+"}"+f+"%{opacity:"+a+"}"+(f+.01)+"%{opacity:1}"+(f+b)%100+"%{opacity:"+a+"}100%{opacity:"+g+"}}",0),m[e]=1),e}function g(a,b){var d,e,f=a.style;if(f[b]!==c)return b;for(b=b.charAt(0).toUpperCase()+b.slice(1),e=0;e<l.length;e++)if(d=l[e]+b,f[d]!==c)return d}function h(a,b){for(var c in b)a.style[g(a,c)||c]=b[c];return a}function i(a){for(var b=1;b<arguments.length;b++){var d=arguments[b];for(var e in d)a[e]===c&&(a[e]=d[e])}return a}function j(a){for(var b={x:a.offsetLeft,y:a.offsetTop};a=a.offsetParent;)b.x+=a.offsetLeft,b.y+=a.offsetTop;return b}var k,l=["webkit","Moz","ms","O"],m={},n=function(){var a=d("style");return e(b.getElementsByTagName("head")[0],a),a.sheet||a.styleSheet}(),o={lines:12,length:7,width:5,radius:10,rotate:0,color:"#000",speed:1,trail:100,opacity:.25,fps:20,zIndex:2e9,className:"spinner",top:"auto",left:"auto"},p=function q(a){return this.spin?void(this.opts=i(a||{},q.defaults,o)):new q(a)};p.defaults={},i(p.prototype,{spin:function(a){this.stop();var b,c,e=this,f=e.opts,g=e.el=h(d(0,{className:f.className}),{position:"relative",zIndex:f.zIndex}),i=f.radius+f.length+f.width;if(a&&(a.insertBefore(g,a.firstChild||null),c=j(a),b=j(g),h(g,{left:("auto"==f.left?c.x-b.x+(a.offsetWidth>>1):f.left+i)+"px",top:("auto"==f.top?c.y-b.y+(a.offsetHeight>>1):f.top+i)+"px"})),g.setAttribute("aria-role","progressbar"),e.lines(g,e.opts),!k){var l=0,m=f.fps,n=m/f.speed,o=(1-f.opacity)/(n*f.trail/100),p=n/f.lines;!function q(){l++;for(var a=f.lines;a;a--){var b=Math.max(1-(l+a*p)%n*o,f.opacity);e.opacity(g,f.lines-a,b,f)}e.timeout=e.el&&setTimeout(q,~~(1e3/m))}()}return e},stop:function(){var a=this.el;return a&&(clearTimeout(this.timeout),a.parentNode&&a.parentNode.removeChild(a),this.el=c),this},lines:function(a,b){function c(a,c){return h(d(),{position:"absolute",width:b.length+b.width+"px",height:b.width+"px",background:a,boxShadow:c,transformOrigin:"left",transform:"rotate("+~~(360/b.lines*i+b.rotate)+"deg) translate("+b.radius+"px,0)",borderRadius:(b.width>>1)+"px"})}for(var g,i=0;i<b.lines;i++)g=h(d(),{position:"absolute",top:1+~(b.width/2)+"px",transform:b.hwaccel?"translate3d(0,0,0)":"",opacity:b.opacity,animation:k&&f(b.opacity,b.trail,i,b.lines)+" "+1/b.speed+"s linear infinite"}),b.shadow&&e(g,h(c("#000","0 0 4px #000"),{top:"2px"})),e(a,e(g,c(b.color,"0 0 1px rgba(0,0,0,.1)")));return a},opacity:function(a,b,c){b<a.childNodes.length&&(a.childNodes[b].style.opacity=c)}}),!function(){function a(a,b){return d("<"+a+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',b)}var b=h(d("group"),{behavior:"url(#default#VML)"});!g(b,"transform")&&b.adj?(n.addRule(".spin-vml","behavior:url(#default#VML)"),p.prototype.lines=function(b,c){function d(){return h(a("group",{coordsize:j+" "+j,coordorigin:-i+" "+-i}),{width:j,height:j})}function f(b,f,g){e(l,e(h(d(),{rotation:360/c.lines*b+"deg",left:~~f}),e(h(a("roundrect",{arcsize:1}),{width:i,height:c.width,left:c.radius,top:-c.width>>1,filter:g}),a("fill",{color:c.color,opacity:c.opacity}),a("stroke",{opacity:0}))))}var g,i=c.length+c.width,j=2*i,k=2*-(c.width+c.length)+"px",l=h(d(),{position:"absolute",top:k,left:k});if(c.shadow)for(g=1;g<=c.lines;g++)f(g,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(g=1;g<=c.lines;g++)f(g);return e(b,l)},p.prototype.opacity=function(a,b,c,d){var e=a.firstChild;d=d.shadow&&d.lines||0,e&&b+d<e.childNodes.length&&(e=e.childNodes[b+d],e=e&&e.firstChild,e=e&&e.firstChild,e&&(e.opacity=c))}):k=g(b,"animation")}(),a.Spinner=p})(window,document),function(){var a=this,b=a._,c={},d=Array.prototype,e=Object.prototype,f=Function.prototype,g=d.push,h=d.slice,i=d.concat,j=e.toString,k=e.hasOwnProperty,l=d.forEach,m=d.map,n=d.reduce,o=d.reduceRight,p=d.filter,q=d.every,r=d.some,s=d.indexOf,t=d.lastIndexOf,u=Array.isArray,v=Object.keys,w=f.bind,x=function(a){return a instanceof x?a:this instanceof x?void(this._wrapped=a):new x(a)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=x),exports._=x):a._=x,x.VERSION="1.4.4";var y=x.each=x.forEach=function(a,b,d){if(null!=a)if(l&&a.forEach===l)a.forEach(b,d);else if(a.length===+a.length){for(var e=0,f=a.length;f>e;e++)if(b.call(d,a[e],e,a)===c)return}else for(var g in a)if(x.has(a,g)&&b.call(d,a[g],g,a)===c)return};x.map=x.collect=function(a,b,c){var d=[];return null==a?d:m&&a.map===m?a.map(b,c):(y(a,function(a,e,f){d[d.length]=b.call(c,a,e,f)}),d)};var z="Reduce of empty array with no initial value";x.reduce=x.foldl=x.inject=function(a,b,c,d){var e=arguments.length>2;if(null==a&&(a=[]),n&&a.reduce===n)return d&&(b=x.bind(b,d)),e?a.reduce(b,c):a.reduce(b);if(y(a,function(a,f,g){e?c=b.call(d,c,a,f,g):(c=a,e=!0)}),!e)throw new TypeError(z);return c},x.reduceRight=x.foldr=function(a,b,c,d){var e=arguments.length>2;if(null==a&&(a=[]),o&&a.reduceRight===o)return d&&(b=x.bind(b,d)),e?a.reduceRight(b,c):a.reduceRight(b);var f=a.length;if(f!==+f){var g=x.keys(a);f=g.length}if(y(a,function(h,i,j){i=g?g[--f]:--f,e?c=b.call(d,c,a[i],i,j):(c=a[i],e=!0)}),!e)throw new TypeError(z);return c},x.find=x.detect=function(a,b,c){var d;return A(a,function(a,e,f){return b.call(c,a,e,f)?(d=a,!0):void 0}),d},x.filter=x.select=function(a,b,c){var d=[];return null==a?d:p&&a.filter===p?a.filter(b,c):(y(a,function(a,e,f){b.call(c,a,e,f)&&(d[d.length]=a)}),d)},x.reject=function(a,b,c){return x.filter(a,function(a,d,e){return!b.call(c,a,d,e)},c)},x.every=x.all=function(a,b,d){b||(b=x.identity);var e=!0;return null==a?e:q&&a.every===q?a.every(b,d):(y(a,function(a,f,g){return(e=e&&b.call(d,a,f,g))?void 0:c}),!!e)};var A=x.some=x.any=function(a,b,d){b||(b=x.identity);var e=!1;return null==a?e:r&&a.some===r?a.some(b,d):(y(a,function(a,f,g){return e||(e=b.call(d,a,f,g))?c:void 0}),!!e)};x.contains=x.include=function(a,b){return null==a?!1:s&&a.indexOf===s?-1!=a.indexOf(b):A(a,function(a){return a===b})},x.invoke=function(a,b){var c=h.call(arguments,2),d=x.isFunction(b);return x.map(a,function(a){return(d?b:a[b]).apply(a,c)})},x.pluck=function(a,b){return x.map(a,function(a){return a[b]})},x.where=function(a,b,c){return x.isEmpty(b)?c?null:[]:x[c?"find":"filter"](a,function(a){for(var c in b)if(b[c]!==a[c])return!1;return!0})},x.findWhere=function(a,b){return x.where(a,b,!0)},x.max=function(a,b,c){if(!b&&x.isArray(a)&&a[0]===+a[0]&&65535>a.length)return Math.max.apply(Math,a);if(!b&&x.isEmpty(a))return-1/0;var d={computed:-1/0,value:-1/0};return y(a,function(a,e,f){var g=b?b.call(c,a,e,f):a;g>=d.computed&&(d={value:a,computed:g})}),d.value},x.min=function(a,b,c){if(!b&&x.isArray(a)&&a[0]===+a[0]&&65535>a.length)return Math.min.apply(Math,a);if(!b&&x.isEmpty(a))return 1/0;var d={computed:1/0,value:1/0};return y(a,function(a,e,f){var g=b?b.call(c,a,e,f):a;d.computed>g&&(d={value:a,computed:g})}),d.value},x.shuffle=function(a){var b,c=0,d=[];return y(a,function(a){b=x.random(c++),d[c-1]=d[b],d[b]=a}),d};var B=function(a){return x.isFunction(a)?a:function(b){return b[a]}};x.sortBy=function(a,b,c){var d=B(b);return x.pluck(x.map(a,function(a,b,e){return{value:a,index:b,criteria:d.call(c,a,b,e)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;if(c!==d){if(c>d||void 0===c)return 1;if(d>c||void 0===d)return-1}return a.index<b.index?-1:1}),"value")};var C=function(a,b,c,d){var e={},f=B(b||x.identity);return y(a,function(b,g){var h=f.call(c,b,g,a);d(e,h,b)}),e};x.groupBy=function(a,b,c){return C(a,b,c,function(a,b,c){(x.has(a,b)?a[b]:a[b]=[]).push(c)})},x.countBy=function(a,b,c){return C(a,b,c,function(a,b){x.has(a,b)||(a[b]=0),a[b]++})},x.sortedIndex=function(a,b,c,d){c=null==c?x.identity:B(c);for(var e=c.call(d,b),f=0,g=a.length;g>f;){var h=f+g>>>1;e>c.call(d,a[h])?f=h+1:g=h}return f},x.toArray=function(a){return a?x.isArray(a)?h.call(a):a.length===+a.length?x.map(a,x.identity):x.values(a):[]},x.size=function(a){return null==a?0:a.length===+a.length?a.length:x.keys(a).length},x.first=x.head=x.take=function(a,b,c){return null==a?void 0:null==b||c?a[0]:h.call(a,0,b)},x.initial=function(a,b,c){return h.call(a,0,a.length-(null==b||c?1:b))},x.last=function(a,b,c){return null==a?void 0:null==b||c?a[a.length-1]:h.call(a,Math.max(a.length-b,0))},x.rest=x.tail=x.drop=function(a,b,c){return h.call(a,null==b||c?1:b)},x.compact=function(a){return x.filter(a,x.identity)};var D=function(a,b,c){return y(a,function(a){x.isArray(a)?b?g.apply(c,a):D(a,b,c):c.push(a)}),c};x.flatten=function(a,b){return D(a,b,[])},x.without=function(a){return x.difference(a,h.call(arguments,1))},x.uniq=x.unique=function(a,b,c,d){x.isFunction(b)&&(d=c,c=b,b=!1);var e=c?x.map(a,c,d):a,f=[],g=[];return y(e,function(c,d){(b?d&&g[g.length-1]===c:x.contains(g,c))||(g.push(c),f.push(a[d]))}),f},x.union=function(){return x.uniq(i.apply(d,arguments))},x.intersection=function(a){var b=h.call(arguments,1);return x.filter(x.uniq(a),function(a){return x.every(b,function(b){return x.indexOf(b,a)>=0})})},x.difference=function(a){var b=i.apply(d,h.call(arguments,1));return x.filter(a,function(a){return!x.contains(b,a)})},x.zip=function(){for(var a=h.call(arguments),b=x.max(x.pluck(a,"length")),c=Array(b),d=0;b>d;d++)c[d]=x.pluck(a,""+d);return c},x.object=function(a,b){if(null==a)return{};for(var c={},d=0,e=a.length;e>d;d++)b?c[a[d]]=b[d]:c[a[d][0]]=a[d][1];return c},x.indexOf=function(a,b,c){if(null==a)return-1;var d=0,e=a.length;if(c){if("number"!=typeof c)return d=x.sortedIndex(a,b),a[d]===b?d:-1;d=0>c?Math.max(0,e+c):c}if(s&&a.indexOf===s)return a.indexOf(b,c);for(;e>d;d++)if(a[d]===b)return d;return-1},x.lastIndexOf=function(a,b,c){if(null==a)return-1;var d=null!=c;if(t&&a.lastIndexOf===t)return d?a.lastIndexOf(b,c):a.lastIndexOf(b);for(var e=d?c:a.length;e--;)if(a[e]===b)return e;return-1},x.range=function(a,b,c){1>=arguments.length&&(b=a||0,a=0),c=arguments[2]||1;for(var d=Math.max(Math.ceil((b-a)/c),0),e=0,f=Array(d);d>e;)f[e++]=a,a+=c;return f},x.bind=function(a,b){if(a.bind===w&&w)return w.apply(a,h.call(arguments,1));var c=h.call(arguments,2);return function(){return a.apply(b,c.concat(h.call(arguments)))}},x.partial=function(a){var b=h.call(arguments,1);return function(){return a.apply(this,b.concat(h.call(arguments)))}},x.bindAll=function(a){var b=h.call(arguments,1);return 0===b.length&&(b=x.functions(a)),y(b,function(b){a[b]=x.bind(a[b],a)}),a},x.memoize=function(a,b){var c={};return b||(b=x.identity),function(){var d=b.apply(this,arguments);return x.has(c,d)?c[d]:c[d]=a.apply(this,arguments)}},x.delay=function(a,b){var c=h.call(arguments,2);return setTimeout(function(){return a.apply(null,c)},b)},x.defer=function(a){return x.delay.apply(x,[a,1].concat(h.call(arguments,1)))},x.throttle=function(a,b){var c,d,e,f,g=0,h=function(){g=new Date,e=null,f=a.apply(c,d)};return function(){var i=new Date,j=b-(i-g);return c=this,d=arguments,0>=j?(clearTimeout(e),e=null,g=i,f=a.apply(c,d)):e||(e=setTimeout(h,j)),f}},x.debounce=function(a,b,c){var d,e;return function(){var f=this,g=arguments,h=function(){d=null,c||(e=a.apply(f,g))},i=c&&!d;return clearTimeout(d),d=setTimeout(h,b),i&&(e=a.apply(f,g)),e}},x.once=function(a){var b,c=!1;return function(){return c?b:(c=!0,b=a.apply(this,arguments),a=null,b)}},x.wrap=function(a,b){return function(){var c=[a];return g.apply(c,arguments),b.apply(this,c)}},x.compose=function(){var a=arguments;return function(){for(var b=arguments,c=a.length-1;c>=0;c--)b=[a[c].apply(this,b)];return b[0]}},x.after=function(a,b){return 0>=a?b():function(){return 1>--a?b.apply(this,arguments):void 0}},x.keys=v||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var b=[];for(var c in a)x.has(a,c)&&(b[b.length]=c);return b},x.values=function(a){var b=[];for(var c in a)x.has(a,c)&&b.push(a[c]);return b},x.pairs=function(a){var b=[];for(var c in a)x.has(a,c)&&b.push([c,a[c]]);return b},x.invert=function(a){var b={};for(var c in a)x.has(a,c)&&(b[a[c]]=c);return b},x.functions=x.methods=function(a){var b=[];for(var c in a)x.isFunction(a[c])&&b.push(c);return b.sort()},x.extend=function(a){return y(h.call(arguments,1),function(b){if(b)for(var c in b)a[c]=b[c]}),a},x.pick=function(a){var b={},c=i.apply(d,h.call(arguments,1));return y(c,function(c){c in a&&(b[c]=a[c])}),b},x.omit=function(a){var b={},c=i.apply(d,h.call(arguments,1));for(var e in a)x.contains(c,e)||(b[e]=a[e]);return b},x.defaults=function(a){return y(h.call(arguments,1),function(b){if(b)for(var c in b)null==a[c]&&(a[c]=b[c])}),a},x.clone=function(a){return x.isObject(a)?x.isArray(a)?a.slice():x.extend({},a):a},x.tap=function(a,b){return b(a),a};var E=function(a,b,c,d){if(a===b)return 0!==a||1/a==1/b;if(null==a||null==b)return a===b;a instanceof x&&(a=a._wrapped),b instanceof x&&(b=b._wrapped);var e=j.call(a);if(e!=j.call(b))return!1;switch(e){case"[object String]":return a==b+"";case"[object Number]":return a!=+a?b!=+b:0==a?1/a==1/b:a==+b;case"[object Date]":case"[object Boolean]":return+a==+b;case"[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if("object"!=typeof a||"object"!=typeof b)return!1;for(var f=c.length;f--;)if(c[f]==a)return d[f]==b;c.push(a),d.push(b);var g=0,h=!0;if("[object Array]"==e){if(g=a.length,h=g==b.length)for(;g--&&(h=E(a[g],b[g],c,d)););}else{var i=a.constructor,k=b.constructor;if(i!==k&&!(x.isFunction(i)&&i instanceof i&&x.isFunction(k)&&k instanceof k))return!1;for(var l in a)if(x.has(a,l)&&(g++,!(h=x.has(b,l)&&E(a[l],b[l],c,d))))break;if(h){for(l in b)if(x.has(b,l)&&!g--)break;h=!g}}return c.pop(),d.pop(),h};x.isEqual=function(a,b){return E(a,b,[],[])},x.isEmpty=function(a){if(null==a)return!0;if(x.isArray(a)||x.isString(a))return 0===a.length;for(var b in a)if(x.has(a,b))return!1;return!0},x.isElement=function(a){return!(!a||1!==a.nodeType)},x.isArray=u||function(a){return"[object Array]"==j.call(a)},x.isObject=function(a){return a===Object(a)},y(["Arguments","Function","String","Number","Date","RegExp"],function(a){x["is"+a]=function(b){return j.call(b)=="[object "+a+"]"}}),x.isArguments(arguments)||(x.isArguments=function(a){return!(!a||!x.has(a,"callee"))}),"function"!=typeof/./&&(x.isFunction=function(a){return"function"==typeof a}),x.isFinite=function(a){return isFinite(a)&&!isNaN(parseFloat(a))},x.isNaN=function(a){return x.isNumber(a)&&a!=+a},x.isBoolean=function(a){return a===!0||a===!1||"[object Boolean]"==j.call(a)},x.isNull=function(a){return null===a},x.isUndefined=function(a){return void 0===a},x.has=function(a,b){return k.call(a,b)},x.noConflict=function(){return a._=b,this},x.identity=function(a){return a},x.times=function(a,b,c){for(var d=Array(a),e=0;a>e;e++)d[e]=b.call(c,e);return d},x.random=function(a,b){return null==b&&(b=a,a=0),a+Math.floor(Math.random()*(b-a+1))};var F={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};F.unescape=x.invert(F.escape);var G={escape:RegExp("["+x.keys(F.escape).join("")+"]","g"),unescape:RegExp("("+x.keys(F.unescape).join("|")+")","g")};x.each(["escape","unescape"],function(a){x[a]=function(b){return null==b?"":(""+b).replace(G[a],function(b){return F[a][b]})}}),x.result=function(a,b){if(null==a)return null;var c=a[b];return x.isFunction(c)?c.call(a):c},x.mixin=function(a){y(x.functions(a),function(b){var c=x[b]=a[b];x.prototype[b]=function(){var a=[this._wrapped];return g.apply(a,arguments),L.call(this,c.apply(x,a))}})};var H=0;x.uniqueId=function(a){var b=++H+"";return a?a+b:b},x.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var I=/(.)^/,J={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},K=/\\|'|\r|\n|\t|\u2028|\u2029/g;x.template=function(a,b,c){var d;c=x.defaults({},c,x.templateSettings);var e=RegExp([(c.escape||I).source,(c.interpolate||I).source,(c.evaluate||I).source].join("|")+"|$","g"),f=0,g="__p+='";a.replace(e,function(b,c,d,e,h){return g+=a.slice(f,h).replace(K,function(a){return"\\"+J[a]}),c&&(g+="'+\n((__t=("+c+"))==null?'':_.escape(__t))+\n'"),d&&(g+="'+\n((__t=("+d+"))==null?'':__t)+\n'"),e&&(g+="';\n"+e+"\n__p+='"),f=h+b.length,b}),g+="';\n",c.variable||(g="with(obj||{}){\n"+g+"}\n"),g="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+g+"return __p;\n";try{d=Function(c.variable||"obj","_",g)}catch(h){throw h.source=g,h}if(b)return d(b,x);var i=function(a){return d.call(this,a,x)};return i.source="function("+(c.variable||"obj")+"){\n"+g+"}",i},x.chain=function(a){return x(a).chain()};var L=function(a){return this._chain?x(a).chain():a};x.mixin(x),y(["pop","push","reverse","shift","sort","splice","unshift"],function(a){var b=d[a];x.prototype[a]=function(){var c=this._wrapped;return b.apply(c,arguments),"shift"!=a&&"splice"!=a||0!==c.length||delete c[0],L.call(this,c)}}),y(["concat","join","slice"],function(a){var b=d[a];x.prototype[a]=function(){return L.call(this,b.apply(this._wrapped,arguments))}}),x.extend(x.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}.call(this),!function(a,b,c){b[a]=c(a,b)}("bean",this,function(a,b){var c=window,d=b[a],e=/over|out/,f=/[^\.]*(?=\..*)\.|.*/,g=/\..*/,h="addEventListener",i="attachEvent",j="removeEventListener",k="detachEvent",l=document||{},m=l.documentElement||{},n=m[h],o=n?h:i,p=Array.prototype.slice,q=/click|mouse(?!(.*wheel|scroll))|menu|drag|drop/i,r=/mouse.*(wheel|scroll)/i,s=/^text/i,t=/^touch|^gesture/i,u={one:1},v=function(a,b,c){for(c=0;c<b.length;c++)a[b[c]]=1;return a}({},("click dblclick mouseup mousedown contextmenu mousewheel mousemultiwheel DOMMouseScroll mouseover mouseout mousemove selectstart selectend keydown keypress keyup orientationchange focus blur change reset select submit load unload beforeunload resize move DOMContentLoaded readystatechange error abort scroll "+(n?"show input invalid touchstart touchmove touchend touchcancel gesturestart gesturechange gestureend MSPointerUp MSPointerDown MSPointerCancel MSPointerMove MSPointerOver MSPointerOut message readystatechange pageshow pagehide popstate hashchange offline online afterprint beforeprint dragstart dragenter dragover dragleave drag drop dragend loadstart progress suspend emptied stalled loadmetadata loadeddata canplay canplaythrough playing waiting seeking seeked ended durationchange timeupdate play pause ratechange volumechange cuechange checking noupdate downloading cached updateready obsolete ":"")).split(" ")),w=function(){function a(a,b){for(;null!==(b=b.parentNode);)if(b===a)return!0;return!1}function b(b){var c=b.relatedTarget;return c?c!==this&&"xul"!==c.prefix&&!/document/.test(this.toString())&&!a(this,c):null===c}return{mouseenter:{base:"mouseover",condition:b},mouseleave:{base:"mouseout",condition:b},mousewheel:{base:/Firefox/.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel"}}}(),x=function(){var a="altKey attrChange attrName bubbles cancelable ctrlKey currentTarget detail eventPhase getModifierState isTrusted metaKey relatedNode relatedTarget shiftKey srcElement target timeStamp type view which".split(" "),b=a.concat("button buttons clientX clientY dataTransfer fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" ")),c=b.concat("wheelDelta wheelDeltaX wheelDeltaY wheelDeltaZ axis".split(" ")),d=a.concat("char charCode key keyCode keyIdentifier keyLocation".split(" ")),f=a.concat(["data"]),g=a.concat("touches targetTouches changedTouches scale rotation".split(" ")),h="preventDefault",i=function(a){return function(){a[h]?a[h]():a.returnValue=!1}},j="stopPropagation",k=function(a){return function(){a[j]?a[j]():a.cancelBubble=!0}},n=function(a){return function(){a[h](),a[j](),a.stopped=!0}},o=function(a,b,c){var d,e;for(d=c.length;d--;)e=c[d],!(e in b)&&e in a&&(b[e]=a[e])};return function(p,u){var v={originalEvent:p,isNative:u};if(!p)return v;var w,x=p.type,y=p.target||p.srcElement;return v[h]=i(p),v[j]=k(p),v.stop=n(v),v.target=y&&3===y.nodeType?y.parentNode:y,u&&(-1!==x.indexOf("key")?(w=d,v.keyCode=p.which||p.keyCode):q.test(x)?(w=b,v.rightClick=3===p.which||2===p.button,v.pos={x:0,y:0},p.pageX||p.pageY?(v.clientX=p.pageX,v.clientY=p.pageY):(p.clientX||p.clientY)&&(v.clientX=p.clientX+l.body.scrollLeft+m.scrollLeft,v.clientY=p.clientY+l.body.scrollTop+m.scrollTop),e.test(x)&&(v.relatedTarget=p.relatedTarget||p[("mouseover"===x?"from":"to")+"Element"])):t.test(x)?w=g:r.test(x)?w=c:s.test(x)&&(w=f),o(p,v,w||a)),v}}(),y=function(a,b){return n||b||a!==l&&a!==c?a:m},z=function(){function a(a,b,c,d,e){this.element=a,this.type=b,this.handler=c,this.original=d,this.namespaces=e,this.custom=w[b],this.isNative=v[b]&&a[o],this.eventType=n||this.isNative?b:"propertychange",this.customType=!n&&!this.isNative&&b,this.target=y(a,this.isNative),this.eventSupport=this.target[o]}return a.prototype={inNamespaces:function(a){var b,c;if(!a)return!0;if(!this.namespaces)return!1;for(b=a.length;b--;)for(c=this.namespaces.length;c--;)if(a[b]===this.namespaces[c])return!0;return!1},matches:function(a,b,c){return!(this.element!==a||b&&this.original!==b||c&&this.handler!==c)}},a}(),A=function(){var a={},b=function(c,d,e,f,g){if(d&&"*"!==d){var h,i=0,j=a["$"+d],k="*"===c;if(!j)return;for(h=j.length;h>i;i++)if((k||j[i].matches(c,e,f))&&!g(j[i],j,i,d))return}else for(var l in a)"$"===l.charAt(0)&&b(c,l.substr(1),e,f,g)},c=function(b,c,d){var e,f=a["$"+c];if(f)for(e=f.length;e--;)if(f[e].matches(b,d,null))return!0;return!1},d=function(a,c,d){var e=[];return b(a,c,d,null,function(a){return e.push(a)}),e},e=function(b){return(a["$"+b.type]||(a["$"+b.type]=[])).push(b),b},f=function(c){b(c.element,c.type,null,c.handler,function(b,c,d){return c.splice(d,1),0===c.length&&delete a["$"+b.type],!1})},g=function(){var b,c=[];for(b in a)"$"===b.charAt(0)&&(c=c.concat(a[b]));return c};return{has:c,get:d,put:e,del:f,entries:g}}(),B=n?function(a,b,c,d){a[d?h:j](b,c,!1)}:function(a,b,c,d,e){e&&d&&null===a["_on"+e]&&(a["_on"+e]=0),a[d?i:k]("on"+b,c)},C=function(a,b,d){return function(e){return e=x(e||((this.ownerDocument||this.document||this).parentWindow||c).event,!0),b.apply(a,[e].concat(d))}},D=function(a,b,d,e,f,g){return function(h){(e?e.apply(this,arguments):n?!0:h&&h.propertyName==="_on"+d||!h)&&(h&&(h=x(h||((this.ownerDocument||this.document||this).parentWindow||c).event,g)),b.apply(a,!h||f&&0!==f.length?p.call(arguments,h?0:1).concat(f):arguments))}},E=function(a,b,c,d,e){return function(){a(b,c,e),d.apply(this,arguments)}},F=function(a,b,c,d){var e,f,h,i=b&&b.replace(g,""),j=A.get(a,i,c);for(e=0,f=j.length;f>e;e++)j[e].inNamespaces(d)&&((h=j[e]).eventSupport&&B(h.target,h.eventType,h.handler,!1,h.type),A.del(h))},G=function(a,b,c,d,e){var h,i=b.replace(g,""),j=b.replace(f,"").split(".");return A.has(a,i,c)?a:("unload"===i&&(c=E(F,a,i,c,d)),w[i]&&(w[i].condition&&(c=D(a,c,i,w[i].condition,!0)),i=w[i].base||i),h=A.put(new z(a,i,c,d,j[0]&&j)),h.handler=h.isNative?C(a,h.handler,e):D(a,h.handler,i,!1,e,!1),void(h.eventSupport&&B(h.target,h.eventType,h.handler,!0,h.customType)))},H=function(a,b,c){return function(d){var e,f,g="string"==typeof a?c(a,this):a;for(e=d.target;e&&e!==this;e=e.parentNode)for(f=g.length;f--;)if(g[f]===e)return b.apply(e,arguments)}},I=function(a,b,c){var d,e,h,i,j=F,k=b&&"string"==typeof b;if(k&&b.indexOf(" ")>0){for(b=b.split(" "),i=b.length;i--;)I(a,b[i],c);return a}if(e=k&&b.replace(g,""),e&&w[e]&&(e=w[e].type),!b||k)(h=k&&b.replace(f,""))&&(h=h.split(".")),j(a,e,c,h);else if("function"==typeof b)j(a,null,b);else for(d in b)b.hasOwnProperty(d)&&I(a,d,b[d]);return a},J=function(a,b,c,d,e){var f,g,h,i,j=c,k=c&&"string"==typeof c;if(b&&!c&&"object"==typeof b)for(f in b)b.hasOwnProperty(f)&&J.apply(this,[a,f,b[f]]);else for(i=arguments.length>3?p.call(arguments,3):[],g=(k?c:b).split(" "),k&&(c=H(b,j=d,e))&&(i=p.call(i,1)),this===u&&(c=E(I,a,b,c,j)),h=g.length;h--;)G(a,g[h],c,j,i);return a},K=function(){return J.apply(u,arguments)},L=n?function(a,b,d){var e=l.createEvent(a?"HTMLEvents":"UIEvents");e[a?"initEvent":"initUIEvent"](b,!0,!0,c,1),d.dispatchEvent(e)}:function(a,b,c){c=y(c,a),a?c.fireEvent("on"+b,l.createEventObject()):c["_on"+b]++},M=function(a,b,c){var d,e,h,i,j,k=b.split(" ");for(d=k.length;d--;)if(b=k[d].replace(g,""),(i=k[d].replace(f,""))&&(i=i.split(".")),i||c||!a[o])for(j=A.get(a,b),c=[!1].concat(c),e=0,h=j.length;h>e;e++)j[e].inNamespaces(i)&&j[e].handler.apply(a,c);else L(v[b],b,a);return a},N=function(a,b,c){for(var d=0,e=A.get(b,c),f=e.length;f>d;d++)e[d].original&&J(a,e[d].type,e[d].original);return a},O={add:J,one:K,remove:I,clone:N,fire:M,noConflict:function(){return b[a]=d,this}};if(c[i]){var P=function(){var a,b=A.entries();for(a in b)b[a].type&&"unload"!==b[a].type&&I(b[a].element,b[a].type);c[k]("onunload",P),c.CollectGarbage&&c.CollectGarbage()};c[i]("onunload",P)}return O});var html4={};html4.atype={NONE:0,URI:1,URI_FRAGMENT:11,SCRIPT:2,STYLE:3,ID:4,IDREF:5,IDREFS:6,GLOBAL_NAME:7,LOCAL_NAME:8,CLASSES:9,FRAME_TARGET:10},html4.ATTRIBS={"*::class":9,"*::dir":0,"*::id":4,"*::lang":0,"*::onclick":2,"*::ondblclick":2,"*::onkeydown":2,"*::onkeypress":2,"*::onkeyup":2,"*::onload":2,"*::onmousedown":2,"*::onmousemove":2,"*::onmouseout":2,"*::onmouseover":2,"*::onmouseup":2,"*::style":3,"*::title":0,"a::accesskey":0,"a::coords":0,"a::href":1,"a::hreflang":0,"a::name":7,"a::onblur":2,"a::onfocus":2,"a::rel":0,"a::rev":0,"a::shape":0,"a::tabindex":0,"a::target":10,"a::type":0,"area::accesskey":0,"area::alt":0,"area::coords":0,"area::href":1,"area::nohref":0,"area::onblur":2,"area::onfocus":2,"area::shape":0,"area::tabindex":0,"area::target":10,"bdo::dir":0,"blockquote::cite":1,"br::clear":0,"button::accesskey":0,"button::disabled":0,"button::name":8,"button::onblur":2,"button::onfocus":2,"button::tabindex":0,"button::type":0,"button::value":0,"canvas::height":0,"canvas::width":0,"caption::align":0,"col::align":0,"col::char":0,"col::charoff":0,"col::span":0,"col::valign":0,"col::width":0,"colgroup::align":0,"colgroup::char":0,"colgroup::charoff":0,"colgroup::span":0,"colgroup::valign":0,"colgroup::width":0,"del::cite":1,"del::datetime":0,"dir::compact":0,"div::align":0,"dl::compact":0,"font::color":0,"font::face":0,"font::size":0,"form::accept":0,"form::action":1,"form::autocomplete":0,"form::enctype":0,"form::method":0,"form::name":7,"form::onreset":2,"form::onsubmit":2,"form::target":10,"h1::align":0,"h2::align":0,"h3::align":0,"h4::align":0,"h5::align":0,"h6::align":0,"hr::align":0,"hr::noshade":0,"hr::size":0,"hr::width":0,"iframe::align":0,"iframe::frameborder":0,"iframe::height":0,"iframe::marginheight":0,"iframe::marginwidth":0,"iframe::width":0,"img::align":0,"img::alt":0,"img::border":0,"img::height":0,"img::hspace":0,"img::ismap":0,"img::name":7,"img::src":1,"img::usemap":11,"img::vspace":0,"img::width":0,"input::accept":0,"input::accesskey":0,"input::align":0,"input::alt":0,"input::autocomplete":0,"input::checked":0,"input::disabled":0,"input::ismap":0,"input::maxlength":0,"input::name":8,"input::onblur":2,"input::onchange":2,"input::onfocus":2,"input::onselect":2,"input::readonly":0,"input::size":0,"input::src":1,"input::tabindex":0,"input::type":0,"input::usemap":11,"input::value":0,"ins::cite":1,"ins::datetime":0,"label::accesskey":0,"label::for":5,"label::onblur":2,"label::onfocus":2,"legend::accesskey":0,"legend::align":0,"li::type":0,"li::value":0,"map::name":7,"menu::compact":0,"ol::compact":0,"ol::start":0,"ol::type":0,"optgroup::disabled":0,"optgroup::label":0,"option::disabled":0,"option::label":0,"option::selected":0,"option::value":0,"p::align":0,"pre::width":0,"q::cite":1,"select::disabled":0,"select::multiple":0,"select::name":8,"select::onblur":2,"select::onchange":2,"select::onfocus":2,"select::size":0,"select::tabindex":0,"table::align":0,"table::bgcolor":0,"table::border":0,"table::cellpadding":0,"table::cellspacing":0,"table::frame":0,"table::rules":0,"table::summary":0,"table::width":0,"tbody::align":0,"tbody::char":0,"tbody::charoff":0,"tbody::valign":0,"td::abbr":0,"td::align":0,"td::axis":0,"td::bgcolor":0,"td::char":0,"td::charoff":0,"td::colspan":0,"td::headers":6,"td::height":0,"td::nowrap":0,"td::rowspan":0,"td::scope":0,"td::valign":0,"td::width":0,"textarea::accesskey":0,"textarea::cols":0,"textarea::disabled":0,"textarea::name":8,"textarea::onblur":2,"textarea::onchange":2,"textarea::onfocus":2,"textarea::onselect":2,"textarea::readonly":0,"textarea::rows":0,"textarea::tabindex":0,"tfoot::align":0,"tfoot::char":0,"tfoot::charoff":0,"tfoot::valign":0,"th::abbr":0,"th::align":0,"th::axis":0,"th::bgcolor":0,"th::char":0,"th::charoff":0,"th::colspan":0,"th::headers":6,"th::height":0,"th::nowrap":0,"th::rowspan":0,"th::scope":0,"th::valign":0,"th::width":0,"thead::align":0,"thead::char":0,"thead::charoff":0,"thead::valign":0,"tr::align":0,"tr::bgcolor":0,"tr::char":0,"tr::charoff":0,"tr::valign":0,"ul::compact":0,"ul::type":0},html4.eflags={OPTIONAL_ENDTAG:1,EMPTY:2,CDATA:4,RCDATA:8,UNSAFE:16,FOLDABLE:32,SCRIPT:64,STYLE:128},html4.ELEMENTS={a:0,abbr:0,acronym:0,address:0,applet:16,area:2,b:0,base:18,basefont:18,bdo:0,big:0,blockquote:0,body:49,br:2,button:0,canvas:0,caption:0,center:0,cite:0,code:0,col:2,colgroup:1,dd:1,del:0,dfn:0,dir:0,div:0,dl:0,dt:1,em:0,fieldset:0,font:0,form:0,frame:18,frameset:16,h1:0,h2:0,h3:0,h4:0,h5:0,h6:0,head:49,hr:2,html:49,i:0,iframe:4,img:2,input:2,ins:0,isindex:18,kbd:0,label:0,legend:0,li:1,link:18,map:0,menu:0,meta:18,nobr:0,noembed:4,noframes:20,noscript:20,object:16,ol:0,optgroup:0,option:1,p:1,param:18,pre:0,q:0,s:0,samp:0,script:84,select:0,small:0,span:0,strike:0,strong:0,style:148,sub:0,sup:0,table:0,tbody:1,td:1,textarea:8,tfoot:1,th:1,thead:1,title:24,tr:1,tt:0,u:0,ul:0,"var":0},html4.ueffects={NOT_LOADED:0,SAME_DOCUMENT:1,NEW_DOCUMENT:2},html4.URIEFFECTS={"a::href":2,"area::href":2,"blockquote::cite":0,"body::background":1,"del::cite":0,"form::action":2,"img::src":1,"input::src":1,"ins::cite":0,"q::cite":0},html4.ltypes={UNSANDBOXED:2,SANDBOXED:1,DATA:0},html4.LOADERTYPES={"a::href":2,"area::href":2,"blockquote::cite":2,"body::background":1,"del::cite":2,"form::action":2,"img::src":1,"input::src":1,"ins::cite":2,"q::cite":2};
var html=function(a){function b(a){if(a=k(a),l.hasOwnProperty(a))return l[a];var b=a.match(n);return b?String.fromCharCode(parseInt(b[1],10)):(b=a.match(o))?String.fromCharCode(parseInt(b[1],16)):""}function c(a,c){return b(c)}function d(a){return a.replace(p,"")}function e(a){return a.replace(q,c)}function f(a){return a.replace(r,"&amp;").replace(t,"&lt;").replace(u,"&gt;").replace(v,"&#34;").replace(w,"&#61;")}function g(a){return a.replace(s,"&amp;$1").replace(t,"&lt;").replace(u,"&gt;")}function h(b){return function(c,f){c=String(c);var h=null,i=!1,j=[],l=void 0,m=void 0,n=void 0;for(b.startDoc&&b.startDoc(f);c;){var o=c.match(i?x:y);if(c=c.substring(o[0].length),i){if(o[1]){var p,q=k(o[1]);if(o[2]){var r=o[3];switch(r.charCodeAt(0)){case 34:case 39:r=r.substring(1,r.length-1)}p=e(d(r))}else p=q;j.push(q,p)}else if(o[4]){if(void 0!==m&&(n?b.startTag&&b.startTag(l,j,f):b.endTag&&b.endTag(l,f)),n&&m&(a.eflags.CDATA|a.eflags.RCDATA)){h=null===h?k(c):h.substring(h.length-c.length);var s=h.indexOf("</"+l);0>s&&(s=c.length),s&&(m&a.eflags.CDATA?b.cdata&&b.cdata(c.substring(0,s),f):b.rcdata&&b.rcdata(g(c.substring(0,s)),f),c=c.substring(s))}l=m=n=void 0,j.length=0,i=!1}}else if(o[1])b.pcdata&&b.pcdata(o[0],f);else if(o[3])n=!o[2],i=!0,l=k(o[3]),m=a.ELEMENTS.hasOwnProperty(l)?a.ELEMENTS[l]:void 0;else if(o[4])b.pcdata&&b.pcdata(o[4],f);else if(o[5]&&b.pcdata){var t=o[5];b.pcdata("<"===t?"&lt;":">"===t?"&gt;":"&amp;",f)}}b.endDoc&&b.endDoc(f)}}function i(b){var c,d;return h({startDoc:function(){c=[],d=!1},startTag:function(e,g,h){if(!d&&a.ELEMENTS.hasOwnProperty(e)){var i=a.ELEMENTS[e];if(!(i&a.eflags.FOLDABLE)){if(i&a.eflags.UNSAFE)return void(d=!(i&a.eflags.EMPTY));if(g=b(e,g)){i&a.eflags.EMPTY||c.push(e),h.push("<",e);for(var j=0,k=g.length;k>j;j+=2){var l=g[j],m=g[j+1];null!==m&&void 0!==m&&h.push(" ",l,'="',f(m),'"')}h.push(">")}}}},endTag:function(b,e){if(d)return void(d=!1);if(a.ELEMENTS.hasOwnProperty(b)){var f=a.ELEMENTS[b];if(!(f&(a.eflags.UNSAFE|a.eflags.EMPTY|a.eflags.FOLDABLE))){var g;if(f&a.eflags.OPTIONAL_ENDTAG)for(g=c.length;--g>=0;){var h=c[g];if(h===b)break;if(!(a.ELEMENTS[h]&a.eflags.OPTIONAL_ENDTAG))return}else for(g=c.length;--g>=0&&c[g]!==b;);if(0>g)return;for(var i=c.length;--i>g;){var h=c[i];a.ELEMENTS[h]&a.eflags.OPTIONAL_ENDTAG||e.push("</",h,">")}c.length=g,e.push("</",b,">")}}},pcdata:function(a,b){d||b.push(a)},rcdata:function(a,b){d||b.push(a)},cdata:function(a,b){d||b.push(a)},endDoc:function(a){for(var b=c.length;--b>=0;)a.push("</",c[b],">");c.length=0}})}function j(b,c,d){var e=[];return i(function(b,e){for(var f=0;f<e.length;f+=2){var g,h=e[f],i=e[f+1],j=null;if(g=b+"::"+h,(a.ATTRIBS.hasOwnProperty(g)||(g="*::"+h,a.ATTRIBS.hasOwnProperty(g)))&&(j=a.ATTRIBS[g]),null!==j)switch(j){case a.atype.NONE:break;case a.atype.SCRIPT:case a.atype.STYLE:i=null;break;case a.atype.ID:case a.atype.IDREF:case a.atype.IDREFS:case a.atype.GLOBAL_NAME:case a.atype.LOCAL_NAME:case a.atype.CLASSES:i=d?d(i):i;break;case a.atype.URI:var k=(""+i).match(z);i=k&&(!k[1]||m.test(k[1]))?c&&c(i):null;break;case a.atype.URI_FRAGMENT:i&&"#"===i.charAt(0)?(i=d?d(i):i,i&&(i="#"+i)):i=null;break;default:i=null}else i=null;e[f+1]=i}return e})(b,e),e.join("")}var k;k="script"==="SCRIPT".toLowerCase()?function(a){return a.toLowerCase()}:function(a){return a.replace(/[A-Z]/g,function(a){return String.fromCharCode(32|a.charCodeAt(0))})};var l={lt:"<",gt:">",amp:"&",nbsp:"",quot:'"',apos:"'"},m=/^(?:https?|mailto|data)$/i,n=/^#(\d+)$/,o=/^#x([0-9A-Fa-f]+)$/,p=/\0/g,q=/&(#\d+|#x[0-9A-Fa-f]+|\w+);/g,r=/&/g,s=/&([^a-z#]|#(?:[^0-9x]|x(?:[^0-9a-f]|$)|$)|$)/gi,t=/</g,u=/>/g,v=/\"/g,w=/\=/g,x=new RegExp("^\\s*(?:(?:([a-z][a-z-]*)(\\s*=\\s*(\"[^\"]*\"|'[^']*'|(?=[a-z][a-z-]*\\s*=)|[^>\"'\\s]*))?)|(/?>)|[\\s\\S][^a-z\\s>]*)","i"),y=new RegExp("^(?:&(\\#[0-9]+|\\#[x][0-9a-f]+|\\w+);|<!--[\\s\\S]*?-->|<!\\w[^>]*>|<\\?[^>*]*>|<(/)?([a-z][a-z0-9]*)|([^<&>]+)|([<&>]))","i"),z=new RegExp("^(?:([^:/?#]+):)?");return{escapeAttrib:f,makeHtmlSanitizer:i,makeSaxParser:h,normalizeRCData:g,sanitize:j,unescapeEntities:e}}(html4),html_sanitize=html.sanitize;"undefined"!=typeof window&&(window.html=html,window.html_sanitize=html_sanitize),html4.ATTRIBS["*::style"]=0,html4.ELEMENTS.style=0,html4.ATTRIBS["a::target"]=0,html4.ELEMENTS.video=0,html4.ATTRIBS["video::src"]=0,html4.ATTRIBS["video::poster"]=0,html4.ATTRIBS["video::controls"]=0,html4.ELEMENTS.audio=0,html4.ATTRIBS["audio::src"]=0,html4.ATTRIBS["video::autoplay"]=0,html4.ATTRIBS["video::controls"]=0;var Mustache="undefined"!=typeof module&&module.exports||{};!function(a){function b(a){return s.test(a)}function c(a){return String(a).replace(/[&<>"'\/]/g,function(a){return v[a]||a})}function d(a,b,c,d){d=d||"<template>";for(var e,f=b.split("\n"),g=Math.max(c-3,0),h=Math.min(f.length,c+3),i=f.slice(g,h),j=0,k=i.length;k>j;++j)e=j+g+1,i[j]=(e===c?" >> ":"    ")+i[j];return a.template=b,a.line=c,a.file=d,a.message=[d+":"+c,i.join("\n"),"",a.message].join("\n"),a}function e(a,b,c){if("."===a)return b[b.length-1];for(var d,e,f,g,h=a.split("."),i=h.length-1,j=h[i],k=b.length;k;){for(g=b.slice(0),e=b[--k],f=0;i>f&&(e=e[h[f++]],null!=e);)g.push(e);if(e&&"object"==typeof e&&j in e){d=e[j];break}}return"function"==typeof d&&(d=d.call(g[g.length-1])),null==d?c:d}function f(a,b,c,d){var f="",g=e(a,b);if(d)(null==g||g===!1||l(g)&&0===g.length)&&(f+=c());else if(l(g))q(g,function(a){b.push(a),f+=c(),b.pop()});else if("object"==typeof g)b.push(g),f+=c(),b.pop();else if("function"==typeof g){var h=b[b.length-1],i=function(a){return k(a,h)};f+=g.call(h,c(),i)||""}else g&&(f+=c());return f}function g(c,e){e=e||{};for(var f,g,h,i,j,k=e.tags||a.tags,l=k[0],m=k[k.length-1],n=['var buffer = "";',"\nvar line = 1;","\ntry {",'\nbuffer += "'],o=[],p=!1,q=!1,s=function(){if(!p||q||e.space)o=[];else for(;o.length;)n.splice(o.pop(),1);p=!1,q=!1},t=[],u=function(a){k=r(a).split(/\s+/),g=k[0],h=k[k.length-1]},v=function(a){n.push('";',f,'\nvar partial = partials["'+r(a)+'"];',"\nif (partial) {","\n  buffer += render(partial,stack[stack.length - 1],partials);","\n}",'\nbuffer += "')},w=function(a,b){var g=r(a);if(""===g)throw d(new Error("Section name may not be empty"),c,B,e.file);t.push({name:g,inverted:b}),n.push('";',f,'\nvar name = "'+g+'";',"\nvar callback = (function () {","\n  return function () {",'\n    var buffer = "";','\nbuffer += "')},x=function(a){w(a,!0)},y=function(a){var b=r(a),f=0!=t.length&&t[t.length-1].name;if(!f||b!=f)throw d(new Error('Section named "'+b+'" was never opened'),c,B,e.file);var g=t.pop();n.push('";',"\n    return buffer;","\n  };","\n})();"),n.push(g.inverted?"\nbuffer += renderSection(name,stack,callback,true);":"\nbuffer += renderSection(name,stack,callback);"),n.push('\nbuffer += "')},z=function(a){n.push('";',f,'\nbuffer += lookup("'+r(a)+'",stack,"");','\nbuffer += "')},A=function(a){n.push('";',f,'\nbuffer += escapeHTML(lookup("'+r(a)+'",stack,""));','\nbuffer += "')},B=1,C=0,D=c.length;D>C;++C)if(c.slice(C,C+l.length)===l){switch(C+=l.length,i=c.substr(C,1),f="\nline = "+B+";",g=l,h=m,p=!0,i){case"!":C++,j=null;break;case"=":C++,m="="+m,j=u;break;case">":C++,j=v;break;case"#":C++,j=w;break;case"^":C++,j=x;break;case"/":C++,j=y;break;case"{":m="}"+m;case"&":C++,q=!0,j=z;break;default:q=!0,j=A}var E=c.indexOf(m,C);if(-1===E)throw d(new Error('Tag "'+l+'" was not closed properly'),c,B,e.file);var F=c.substring(C,E);j&&j(F);for(var G=0;~(G=F.indexOf("\n",G));)B++,G++;C=E+m.length-1,l=g,m=h}else switch(i=c.substr(C,1)){case'"':case"\\":q=!0,n.push("\\"+i);break;case"\r":break;case"\n":o.push(n.length),n.push("\\n"),s(),B++;break;default:b(i)?o.push(n.length):q=!0,n.push(i)}if(0!=t.length)throw d(new Error('Section "'+t[t.length-1].name+'" was not closed properly'),c,B,e.file);s(),n.push('";',"\nreturn buffer;","\n} catch (e) { throw {error: e, line: line}; }");var H=n.join("").replace(/buffer \+= "";\n/g,"");return e.debug&&("undefined"!=typeof console&&console.log?console.log(H):"function"==typeof print&&print(H)),H}function h(a,b){var h="view,partials,stack,lookup,escapeHTML,renderSection,render",i=g(a,b),j=new Function(h,i);return function(g,h){h=h||{};var i=[g];try{return j(g,h,i,e,c,f,k)}catch(l){throw d(l.error,a,l.line,b.file)}}}function i(){w={}}function j(a,b){return b=b||{},b.cache!==!1?(w[a]||(w[a]=h(a,b)),w[a]):h(a,b)}function k(a,b,c){return j(a)(b,c)}a.name="mustache.js",a.version="0.5.0-dev",a.tags=["{{","}}"],a.parse=g,a.compile=j,a.render=k,a.clearCache=i,a.to_html=function(a,b,c,d){var e=k(a,b,c);return"function"!=typeof d?e:void d(e)};var l,m=Object.prototype.toString,n=Array.isArray,o=Array.prototype.forEach,p=String.prototype.trim;l=n?n:function(a){return"[object Array]"===m.call(a)};var q;q=o?function(a,b,c){return o.call(a,b,c)}:function(a,b,c){for(var d=0,e=a.length;e>d;++d)b.call(c,a[d],d,a)};var r,s=/^\s*$/;if(p)r=function(a){return null==a?"":p.call(a)};else{var t,u;b("")?(t=/^\s+/,u=/\s+$/):(t=/^[\s\xA0]+/,u=/[\s\xA0]+$/),r=function(a){return null==a?"":String(a).replace(t,"").replace(u,"")}}var v={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},w={}}(Mustache),function(a,b,c){b[a]=c()}("reqwest",this,function(){function handleReadyState(a,b,c){return function(){return a._aborted?c(a.request):void(a.request&&4==a.request[readyState]&&(a.request.onreadystatechange=noop,twoHundo.test(a.request.status)?b(a.request):c(a.request)))}}function setHeaders(a,b){var c,d=b.headers||{};d.Accept=d.Accept||defaultHeaders.accept[b.type]||defaultHeaders.accept["*"],b.crossOrigin||d[requestedWith]||(d[requestedWith]=defaultHeaders.requestedWith),d[contentType]||(d[contentType]=b.contentType||defaultHeaders.contentType);for(c in d)d.hasOwnProperty(c)&&a.setRequestHeader(c,d[c])}function setCredentials(a,b){"undefined"!=typeof b.withCredentials&&"undefined"!=typeof a.withCredentials&&(a.withCredentials=!!b.withCredentials)}function generalCallback(a){lastValue=a}function urlappend(a,b){return a+(/\?/.test(a)?"&":"?")+b}function handleJsonp(a,b,c,d){var e=uniqid++,f=a.jsonpCallback||"callback",g=a.jsonpCallbackName||reqwest.getcallbackPrefix(e),h=new RegExp("((^|\\?|&)"+f+")=([^&]+)"),i=d.match(h),j=doc.createElement("script"),k=0,l=-1!==navigator.userAgent.indexOf("MSIE 10.0");return i?"?"===i[3]?d=d.replace(h,"$1="+g):g=i[3]:d=urlappend(d,f+"="+g),win[g]=generalCallback,j.type="text/javascript","undefined"==typeof j.onreadystatechange||l||(j.event="onclick",j.htmlFor=j.id="_reqwest_"+e),j.onload=j.onreadystatechange=function(){return j[readyState]&&"complete"!==j[readyState]&&"loaded"!==j[readyState]||k?!1:(j.onload=j.onreadystatechange=null,j.onclick&&j.onclick(),a.success&&a.success(lastValue),lastValue=void 0,head.removeChild(j),void(k=1))},j.src=d,j.async=!0,head.appendChild(j),{abort:function(){j.onload=j.onreadystatechange=null,a.error&&a.error({},"Request is aborted: timeout",{}),lastValue=void 0,head.removeChild(j),k=1}}}function getRequest(a,b){var c,d=this.o,e=(d.method||"GET").toUpperCase(),f="string"==typeof d?d:d.url,g=d.processData!==!1&&d.data&&"string"!=typeof d.data?reqwest.toQueryString(d.data):d.data||null;return"jsonp"!=d.type&&"GET"!=e||!g||(f=urlappend(f,g),g=null),"jsonp"==d.type?handleJsonp(d,a,b,f):(c=xhr(),c.open(e,f,!0),setHeaders(c,d),setCredentials(c,d),c.onreadystatechange=handleReadyState(this,a,b),d.before&&d.before(c),c.send(g),c)}function Reqwest(a,b){this.o=a,this.fn=b,init.apply(this,arguments)}function setType(a){var b=a.match(/\.(json|jsonp|html|xml)(\?|$)/);return b?b[1]:"js"}function init(o,fn){function complete(a){for(o.timeout&&clearTimeout(self.timeout),self.timeout=null;self._completeHandlers.length>0;)self._completeHandlers.shift()(a)}function success(resp){var r=resp.responseText;if(r)switch(type){case"json":try{resp=win.JSON?win.JSON.parse(r):eval("("+r+")")}catch(err){return error(resp,"Could not parse JSON in response",err)}break;case"js":resp=eval(r);break;case"html":resp=r;break;case"xml":resp=resp.responseXML&&resp.responseXML.parseError&&resp.responseXML.parseError.errorCode&&resp.responseXML.parseError.reason?null:resp.responseXML}for(self._responseArgs.resp=resp,self._fulfilled=!0,fn(resp);self._fulfillmentHandlers.length>0;)self._fulfillmentHandlers.shift()(resp);complete(resp)}function error(a,b,c){for(self._responseArgs.resp=a,self._responseArgs.msg=b,self._responseArgs.t=c,self._erred=!0;self._errorHandlers.length>0;)self._errorHandlers.shift()(a,b,c);complete(a)}this.url="string"==typeof o?o:o.url,this.timeout=null,this._fulfilled=!1,this._fulfillmentHandlers=[],this._errorHandlers=[],this._completeHandlers=[],this._erred=!1,this._responseArgs={};var self=this,type=o.type||setType(this.url);fn=fn||function(){},o.timeout&&(this.timeout=setTimeout(function(){self.abort()},o.timeout)),o.success&&this._fulfillmentHandlers.push(function(){o.success.apply(o,arguments)}),o.error&&this._errorHandlers.push(function(){o.error.apply(o,arguments)}),o.complete&&this._completeHandlers.push(function(){o.complete.apply(o,arguments)}),this.request=getRequest.call(this,success,error)}function reqwest(a,b){return new Reqwest(a,b)}function normalize(a){return a?a.replace(/\r?\n/g,"\r\n"):""}function serial(a,b){var c,d,e,f,g=a.name,h=a.tagName.toLowerCase(),i=function(a){a&&!a.disabled&&b(g,normalize(a.attributes.value&&a.attributes.value.specified?a.value:a.text))};if(!a.disabled&&g)switch(h){case"input":/reset|button|image|file/i.test(a.type)||(c=/checkbox/i.test(a.type),d=/radio/i.test(a.type),e=a.value,(!(c||d)||a.checked)&&b(g,normalize(c&&""===e?"on":e)));break;case"textarea":b(g,normalize(a.value));break;case"select":if("select-one"===a.type.toLowerCase())i(a.selectedIndex>=0?a.options[a.selectedIndex]:null);else for(f=0;a.length&&f<a.length;f++)a.options[f].selected&&i(a.options[f])}}function eachFormElement(){var a,b,c=this,d=function(a,b){var d,e,f;for(d=0;d<b.length;d++)for(f=a[byTag](b[d]),e=0;e<f.length;e++)serial(f[e],c)};for(b=0;b<arguments.length;b++)a=arguments[b],/input|select|textarea/i.test(a.tagName)&&serial(a,c),d(a,["input","select","textarea"])}function serializeQueryString(){return reqwest.toQueryString(reqwest.serializeArray.apply(null,arguments))}function serializeHash(){var a={};return eachFormElement.apply(function(b,c){b in a?(a[b]&&!isArray(a[b])&&(a[b]=[a[b]]),a[b].push(c)):a[b]=c},arguments),a}var win=window,doc=document,twoHundo=/^20\d$/,byTag="getElementsByTagName",readyState="readyState",contentType="Content-Type",requestedWith="X-Requested-With",head=doc[byTag]("head")[0],uniqid=0,callbackPrefix="reqwest_"+ +new Date,lastValue,xmlHttpRequest="XMLHttpRequest",noop=function(){},isArray="function"==typeof Array.isArray?Array.isArray:function(a){return a instanceof Array},defaultHeaders={contentType:"application/x-www-form-urlencoded",requestedWith:xmlHttpRequest,accept:{"*":"text/javascript, text/html, application/xml, text/xml, */*",xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript",js:"application/javascript, text/javascript"}},xhr=win[xmlHttpRequest]?function(){return new XMLHttpRequest}:function(){return new ActiveXObject("Microsoft.XMLHTTP")};return Reqwest.prototype={abort:function(){this._aborted=!0,this.request.abort()},retry:function(){init.call(this,this.o,this.fn)},then:function(a,b){return this._fulfilled?a(this._responseArgs.resp):this._erred?b(this._responseArgs.resp,this._responseArgs.msg,this._responseArgs.t):(this._fulfillmentHandlers.push(a),this._errorHandlers.push(b)),this},always:function(a){return this._fulfilled||this._erred?a(this._responseArgs.resp):this._completeHandlers.push(a),this},fail:function(a){return this._erred?a(this._responseArgs.resp,this._responseArgs.msg,this._responseArgs.t):this._errorHandlers.push(a),this}},reqwest.serializeArray=function(){var a=[];return eachFormElement.apply(function(b,c){a.push({name:b,value:c})},arguments),a},reqwest.serialize=function(){if(0===arguments.length)return"";var a,b,c=Array.prototype.slice.call(arguments,0);return a=c.pop(),a&&a.nodeType&&c.push(a)&&(a=null),a&&(a=a.type),b="map"==a?serializeHash:"array"==a?reqwest.serializeArray:serializeQueryString,b.apply(null,c)},reqwest.toQueryString=function(a){var b,c,d,e="",f=encodeURIComponent,g=function(a,b){e+=f(a)+"="+f(b)+"&"};if(isArray(a))for(b=0;a&&b<a.length;b++)g(a[b].name,a[b].value);else for(c in a)if(Object.hasOwnProperty.call(a,c))if(d=a[c],isArray(d))for(b=0;b<d.length;b++)g(c,d[b]);else g(c,a[c]);return e.replace(/&$/,"").replace(/%20/g,"+")},reqwest.getcallbackPrefix=function(){return callbackPrefix},reqwest.compat=function(a,b){return a&&(a.type&&(a.method=a.type)&&delete a.type,a.dataType&&(a.type=a.dataType),a.jsonpCallback&&(a.jsonpCallbackName=a.jsonpCallback)&&delete a.jsonpCallback,a.jsonp&&(a.jsonpCallback=a.jsonp)),new Reqwest(a,b)},reqwest}),wax=wax||{},wax.attribution=function(){var a={},b=document.createElement("div");return b.className="map-attribution",a.content=function(a){return"undefined"==typeof a?b.innerHTML:(b.innerHTML=wax.u.sanitize(a),this)},a.element=function(){return b},a.init=function(){return this},a},wax=wax||{},wax.bwdetect=function(a,b){function c(){wax.bw=-1;var a=new Image;a.src=f;var b=!0,c=setTimeout(function(){b&&-1==wax.bw&&(d.bw(0),b=!1)},e);a.onload=function(){b&&-1==wax.bw&&(clearTimeout(c),d.bw(1),b=!1)}}var d={},e=a.threshold||400,f="http://a.tiles.mapbox.com/mapbox/1.0.0/blue-marble-topo-bathy-jul/0/0/0.png?preventcache="+ +new Date,g=1,h=void 0===a.auto?!0:a.auto;return d.bw=function(a){if(!arguments.length)return g;wax.bwlisteners&&wax.bwlisteners.length&&function(){for(listeners=wax.bwlisteners,wax.bwlisteners=[],i=0;listeners>i;i++)listeners[i](a)}(),wax.bw=a,g!=(g=a)&&b(a)},d.add=function(){return h&&c(),this},-1==wax.bw?(wax.bwlisteners=wax.bwlisteners||[],wax.bwlisteners.push(d.bw)):void 0!==wax.bw?d.bw(wax.bw):d.add(),d},wax.formatter=function(x){var formatter={},f;if(x&&"string"==typeof x)try{eval("f = "+x)}catch(e){console&&console.log(e)}else f=x&&"function"==typeof x?x:function(){};return formatter.format=function(a,b){try{return wax.u.sanitize(f(a,b))}catch(c){console&&console.log(c)}},formatter},wax.gi=function(a,b){function c(a){return a>=93&&a--,a>=35&&a--,a-=32}b=b||{};var d={},e=b.resolution||4,f=b.tileSize||256;return d.grid_tile=function(){return a},d.getKey=function(b,d){return a&&a.grid&&!(0>d||0>b||Math.floor(d)>=f||Math.floor(b)>=f)?c(a.grid[Math.floor(d/e)].charCodeAt(Math.floor(b/e))):void 0},d.gridFeature=function(b,c){var d=this.getKey(b,c),e=a.keys;return e&&e[d]&&a.data[e[d]]?a.data[e[d]]:void 0},d.tileFeature=function(b,c,d){if(a){var e=wax.u.offset(d);return feature=this.gridFeature(b-e.left,c-e.top)}},d},wax.gm=function(){function a(a){return"string"==typeof a&&(a=[a]),function(b){if(b){var c=new RegExp(e.tileRegexp()),d=c.exec(b);if(d)return a[parseInt(d[2],10)%a.length].replace(/\{z\}/g,d[1]).replace(/\{x\}/g,d[2]).replace(/\{y\}/g,d[3])}}}var b,c,d=4,e={},f=function(a){return a?a.replace(/(\.png|\.jpg|\.jpeg)(\d*)/,".grid.json"):void 0};return e.tileRegexp=function(){var a=b.tiles[0],c=a.indexOf("?");-1!==c&&(a=a.substr(0,c)),a=a.replace(/[\(\)\?\$\*\+\^]/g,"."),0===a.indexOf("https")?a=a.replace(":443","[:0-9]*"):0===a.indexOf("http")&&(a=a.replace(":80","[:0-9]*"));var d="";if(b.tiles.length>1)for(var e=b.tiles[0],f=b.tiles[1],g=0;g<e.length;++g)d+=e.charAt(g)!=f.charAt(g)?".":a.charAt(g)||"";else d=a;return d.replace(/\{x\}/,"(\\d+)").replace(/\{y\}/,"(\\d+)").replace(/\{z\}/,"(\\d+)")},e.formatter=function(a){return arguments.length?(c=wax.formatter(a),e):c},e.template=function(a){return arguments.length?(c=wax.template(a),e):c},e.gridUrl=function(b){return arguments.length?(f=b?"function"==typeof b?b:a(b):function(){return null},e):f},e.getGrid=function(a,b){var g=f(a);return c&&g?(wax.request.get(g,function(a,e){return a?b(a,null):void b(null,wax.gi(e,{formatter:c,resolution:d}))}),e):b(null,null)},e.tilejson=function(a){return arguments.length?(a.template?e.template(a.template):a.formatter?e.formatter(a.formatter):c=void 0,e.gridUrl(a.grids),a.resolution&&(d=a.resolution),b=a,e):b},e},wax=wax||{},wax.hash=function(a){function b(){return location.hash.substring(1)}function c(a){var b=window.location;b.replace(b.toString().replace(b.hash||/$/,"#"+a))}function d(b){for(var c=b.split("/"),d=0;d<c.length;d++)if(c[d]=Number(c[d]),isNaN(c[d]))return!0;return c.length<3?!0:void(3==c.length&&a.setCenterZoom(c))}function e(){var b=a.getCenterZoom();g!==b&&(g=b,c(g))}function f(a){a!==g&&d(g=a)&&e()}a=a||{};var g,h={},i=wax.u.throttle(e,500);return h.add=function(){return f(b()),a.bindChange(i),h},h.remove=function(){return a.unbindChange(i),h},h},wax=wax||{},wax.interaction=function(){function a(a){for(var b=i(),c=new RegExp(n.tileRegexp()),d=0;d<b.length;d++)if(a){var e=b[d][0]<=a.y&&b[d][0]+256>a.y&&b[d][1]<=a.x&&b[d][1]+256>a.x;if(e&&c.exec(b[d][2].src))return b[d][2]}return!1}function b(){return q?(window.clearTimeout(q),q=null,!0):!1}function c(a){if(!p){var b="MSPointerMove"!=a.type?a:a.originalEvent,c=wax.u.eventoffset(b);o.screen_feature(c,function(b){b?bean.fire(o,"on",{parent:l(),data:b,formatter:n.formatter().format,e:a}):bean.fire(o,"off")})}}function d(a){p=!0;var b="MSPointerDown"!=a.type?a:a.originalEvent;h=wax.u.eventoffset(b),"mousedown"===a.type?(bean.add(document.body,"click",g),bean.add(document.body,"mouseup",e)):"touchstart"===a.type&&1===a.touches.length?(bean.fire(o,"off"),bean.add(l(),t)):"MSPointerDown"===a.originalEvent.type&&a.originalEvent.touches&&1===a.originalEvent.touches.length&&(bean.fire(o,"off"),bean.add(l(),u))}function e(){p=!1}function f(){bean.remove(l(),t),bean.remove(l(),u),p=!1}function g(a){var c={},d="MSPointerMove"!=a.type&&"MSPointerUp"!=a.type?a:a.originalEvent,e=wax.u.eventoffset(d);p=!1;for(var f in d)c[f]=d[f];return c.changedTouches=[],bean.remove(document.body,"mouseup",g),bean.remove(l(),t),bean.remove(l(),u),"touchend"===a.type?o.click(a,h):e&&("MSPointerMove"===c.type||"MSPointerUp"===c.type?o.click(c,e):Math.round(e.y/r)===Math.round(h.y/r)&&Math.round(e.x/r)===Math.round(h.x/r)&&(q?b():q=window.setTimeout(function(){q=null,o.click(c,e)},150))),g}var h,i,j,k,l,m,n=wax.gm(),o={},p=!1,q=null,r=4,s={mousemove:c,touchstart:d,mousedown:d},t={touchend:g,touchmove:g,touchcancel:f},u={MSPointerUp:g,MSPointerMove:g,MSPointerCancel:f};return o.click=function(a,b){o.screen_feature(b,function(b){b&&bean.fire(o,"on",{parent:l(),data:b,formatter:n.formatter().format,e:a})})},o.screen_feature=function(b,c){var d=a(b);d||c(null),n.getGrid(d.src,function(a,e){if(a||!e)return c(null);var f=e.tileFeature(b.x,b.y,d);c(f)})},o.attach=function(a){return arguments.length?(j=a,o):j},o.detach=function(a){return arguments.length?(k=a,o):k},o.map=function(a){return arguments.length?(m=a,j&&j(m),bean.add(l(),s),bean.add(l(),"touchstart",d),bean.add(l(),"MSPointerDown",d),o):m},o.grid=function(a){return arguments.length?(i=a,o):i},o.remove=function(){return k&&k(m),bean.remove(l(),s),bean.fire(o,"remove"),o},o.tilejson=function(a){return arguments.length?(n.tilejson(a),o):n.tilejson()},o.formatter=function(){return n.formatter()},o.on=function(a,b){return bean.add(o,a,b),o},o.off=function(a,b){return bean.remove(o,a,b),o},o.gridmanager=function(a){return arguments.length?(n=a,o):n},o.parent=function(a){return l=a,o},o};var wax=wax||{};wax.location=function(){function a(a){if("mousemove"!==a.e.type&&a.e.type){var b=a.formatter({format:"location"},a.data);b&&(window.location.href=b)}}var b={};return b.events=function(){return{on:a}},b};var wax=wax||{};if(wax.request={cache:{},locks:{},promises:{},get:function(a,b){if(this.cache[a])return b(this.cache[a][0],this.cache[a][1]);if(this.promises[a]=this.promises[a]||[],this.promises[a].push(b),!this.locks[a]){var c=this;this.locks[a]=!0,reqwest({url:a+(~a.indexOf("?")?"&":"?")+"callback=grid",type:"jsonp",jsonpCallback:"callback",success:function(b){c.locks[a]=!1,c.cache[a]=[null,b];for(var d=0;d<c.promises[a].length;d++)c.promises[a][d](c.cache[a][0],c.cache[a][1])},error:function(b){c.locks[a]=!1,c.cache[a]=[b,null];for(var d=0;d<c.promises[a].length;d++)c.promises[a][d](c.cache[a][0],c.cache[a][1])}})}}},wax.template=function(a){var b={};return b.format=function(b,c){var d={};for(var e in c)d[e]=c[e];return b.format&&(d["__"+b.format+"__"]=!0),wax.u.sanitize(Mustache.to_html(a,d))},b},!wax)var wax={};wax.tilejson=function(a,b){reqwest({url:a+(~a.indexOf("?")?"&":"?")+"callback=grid",type:"jsonp",jsonpCallback:"callback",success:b,error:b})};var wax=wax||{};wax.u={offset:function(a){var b=a.offsetWidth||parseInt(a.style.width,10),c=a.offsetHeight||parseInt(a.style.height,10),d=document.body,e=0,f=0,g=function(a){if(a!==d&&a!==document.documentElement){e+=a.offsetTop,f+=a.offsetLeft;var b=a.style.transform||a.style.WebkitTransform||a.style.OTransform||a.style.MozTransform||a.style.msTransform;if(b){var c;if(c=b.match(/translate\((.+)px, (.+)px\)/))e+=parseInt(c[2],10),f+=parseInt(c[1],10);else if(c=b.match(/translate3d\((.+)px, (.+)px, (.+)px\)/))e+=parseInt(c[2],10),f+=parseInt(c[1],10);else if(c=b.match(/matrix3d\(([\-\d,\s]+)\)/)){var g=c[1].split(",");e+=parseInt(g[13],10),f+=parseInt(g[12],10)}else(c=b.match(/matrix\(.+, .+, .+, .+, (.+), (.+)\)/))&&(e+=parseInt(c[2],10),f+=parseInt(c[1],10))}}};if("undefined"!=typeof a.getBoundingClientRect){var h=document.body,i=a.ownerDocument.documentElement,j=document.clientTop||h.clientTop||0,k=document.clientLeft||h.clientLeft||0,l=window.pageYOffset||i.scrollTop,m=window.pageXOffset||i.scrollLeft,n=a.getBoundingClientRect();e=n.top+l-j,f=n.left+m-k}else{g(a);try{for(;a=a.offsetParent;)g(a)}catch(o){}}e+=d.offsetTop,f+=d.offsetLeft,e+=d.parentNode.offsetTop,f+=d.parentNode.offsetLeft;var p=document.defaultView?window.getComputedStyle(d.parentNode,null):d.parentNode.currentStyle;return d.parentNode.offsetTop===parseInt(p.marginTop,10)||isNaN(parseInt(p.marginTop,10))||(e+=parseInt(p.marginTop,10),f+=parseInt(p.marginLeft,10)),{top:e,left:f,height:c,width:b}},$:function(a){return"string"==typeof a?document.getElementById(a):a},eventoffset:function(a){return a||(a=window.event),"MSPointerMove"==a.type||"MSPointerDown"==a.type||"MSPointerUp"==a.type?{x:a.pageX+window.pageXOffset,y:a.pageY+window.pageYOffset}:a.pageX||a.pageY?{x:a.pageX,y:a.pageY}:a.clientX||a.clientY?{x:a.clientX,y:a.clientY}:a.touches&&1===a.touches.length?{x:a.touches[0].pageX,y:a.touches[0].pageY}:void 0},limit:function(a,b,c){var d;return function(){var e=this,f=arguments,g=function(){d=null,a.apply(e,f)};c&&clearTimeout(d),(c||!d)&&(d=setTimeout(g,b))}},throttle:function(a,b){return this.limit(a,b,!1)},sanitize:function(a){function b(a){return/^(https?:\/\/|data:image)/.test(a)?a:void 0}function c(a){return a}return a?html_sanitize(a,b,c):""}},wax=wax||{},wax.leaf=wax.leaf||{},wax.leaf.hash=function(a){return wax.hash({getCenterZoom:function(){var b=a.getCenter(),c=a.getZoom(),d=Math.max(0,Math.ceil(Math.log(c)/Math.LN2));return[c,b.lat.toFixed(d),b.lng.toFixed(d)].join("/")},setCenterZoom:function(b){a.setView(new L.LatLng(b[1],b[2]),b[0])},bindChange:function(b){a.on("moveend",b)},unbindChange:function(b){a.off("moveend",b)}})},wax=wax||{},wax.leaf=wax.leaf||{},wax.leaf.interaction=function(){function a(){g=!0}function b(){return!g&&e?e:e=function(a){var b=[];for(var c in a)if(a[c]._tiles)for(var d in a[c]._tiles){var e=a[c]._tiles[d];if(e.src){var f=wax.u.offset(e);b.push([f.top,f.left,e])}}return b}(f._layers)}function c(b){if(!arguments.length)return f;f=b;for(var c=["moveend"],d=0;d<c.length;d++)f.on(c[d],a)}function d(b){if(!arguments.length)return f;f=b;for(var c=["moveend"],d=0;d<c.length;d++)f.off(c[d],a)}var e,f,g=!1;return wax.interaction().attach(c).detach(d).parent(function(){return f._container}).grid(b)},wax=wax||{},wax.leaf=wax.leaf||{},wax.leaf.connector=L.TileLayer.extend({initialize:function(a){a=a||{},a.minZoom=a.minzoom||0,a.maxZoom=a.maxzoom||22,L.TileLayer.prototype.initialize.call(this,a.tiles[0],a)}}),wax=wax||{},wax.g=wax.g||{},wax.g.attribution=function(a,b){b=b||{};var c,d={};return d.element=function(){return c.element()},d.appendTo=function(a){return wax.u.$(a).appendChild(c.element()),this},d.init=function(){return c=wax.attribution(),c.content(b.attribution),c.element().className="map-attribution map-g",this},d.init()},wax=wax||{},wax.g=wax.g||{},wax.g.bwdetect=function(a,b){b=b||{};var c=b.png||".png128",d=b.jpg||".jpg70";if(!a.mapTypes["mb-low"]){for(var e=a.mapTypes.mb,f={tiles:[],scheme:e.options.scheme,blankImage:e.options.blankImage,minzoom:e.minZoom,maxzoom:e.maxZoom,name:e.name,description:e.description},g=0;g<e.options.tiles.length;g++)f.tiles.push(e.options.tiles[g].replace(".png",c).replace(".jpg",d));m.mapTypes.set("mb-low",new wax.g.connector(f))}return wax.bwdetect(b,function(b){a.setMapTypeId(b?"mb":"mb-low")})},wax=wax||{},wax.g=wax.g||{},wax.g.hash=function(a){return wax.hash({getCenterZoom:function(){var b=a.getCenter(),c=a.getZoom(),d=Math.max(0,Math.ceil(Math.log(c)/Math.LN2));return[c.toFixed(2),b.lat().toFixed(d),b.lng().toFixed(d)].join("/")},setCenterZoom:function(b){a.setCenter(new google.maps.LatLng(b[1],b[2])),a.setZoom(b[0])},bindChange:function(b){google.maps.event.addListener(a,"idle",b)},unbindChange:function(b){google.maps.event.removeListener(a,"idle",b)}})},wax=wax||{},wax.g=wax.g||{},wax.g.interaction=function(){function a(){g=!0}function b(){if(!g&&e)return e;e=[];var a=f.getZoom(),b=(wax.u.offset(f.getDiv()),function(b){if(b.interactive)for(var c in b.cache)if(c.split("/")[0]==a){var d=wax.u.offset(b.cache[c]);e.push([d.top,d.left,b.cache[c]])}});for(var c in f.mapTypes)b(f.mapTypes[c]);return f.overlayMapTypes.forEach(b),e}function c(b){return arguments.length?(f=b,h=google.maps.event.addListener(f,"tileloaded",a),void(i=google.maps.event.addListener(f,"idle",a))):f}function d(){h&&google.maps.event.removeListener(h),i&&google.maps.event.removeListener(i)}var e,f,g=!1,h=null,i=null;return wax.interaction().attach(c).detach(d).parent(function(){return f.getDiv()}).grid(b)};var wax=wax||{};wax.g=wax.g||{},wax.g.connector=function(a){a=a||{},this.options={tiles:a.tiles,scheme:a.scheme||"xyz",blankImage:a.blankImage||"data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="},this.opacity=a.opacity||0,this.minZoom=a.minzoom||0,this.maxZoom=a.maxzoom||22,this.name=a.name||"",this.description=a.description||"",this.interactive=!0,this.tileSize=new google.maps.Size(256,256),this.cache={}},wax.g.connector.prototype.getTile=function(a,b){var c=b+"/"+a.x+"/"+a.y;if(!this.cache[c]){var d=this.cache[c]=new Image(256,256);this.cache[c].src=this.getTileUrl(a,b),this.cache[c].setAttribute("gTileKey",c),this.cache[c].setAttribute("style","opacity: "+this.opacity+"; filter: alpha(opacity="+100*this.opacity+");"),this.cache[c].onerror=function(){d.style.display="none"}}return this.cache[c]},wax.g.connector.prototype.releaseTile=function(a){var b=a.getAttribute("gTileKey");this.cache[b]&&delete this.cache[b],a.parentNode&&a.parentNode.removeChild(a)},wax.g.connector.prototype.getTileUrl=function(a,b){var c=Math.pow(2,b),d="tms"===this.options.scheme?c-1-a.y:a.y,e=a.x%c;return e=0>e?a.x%c+c:e,0>d?this.options.blankImage:this.options.tiles[parseInt(e+d,10)%this.options.tiles.length].replace(/\{z\}/g,b).replace(/\{x\}/g,e).replace(/\{y\}/g,d)},root.Mustache=Mustache,function(){function CartoDBLayerCommon(){this.visible=!0}function GeometryView(){}function Map(a){var b=this;this.options=_.defaults(a,{ajax:window.$?window.$.ajax:reqwest.compat,pngParams:["map_key","api_key","cache_policy","updated_at"],gridParams:["map_key","api_key","cache_policy","updated_at"],cors:this.isCORSSupported(),btoa:this.isBtoaSupported()?this._encodeBase64Native:this._encodeBase64,MAX_GET_SIZE:2033,force_cors:!1,instanciateCallback:function(){return"_cdbc_"+b._callbackName()}}),this.layerToken=null,this.urls=null,this.silent=!1,this.interactionEnabled=[],this._layerTokenQueue=[],this._timeout=-1,this._queue=[],this._waiting=!1,this.lastTimeUpdated=null,this._refreshTimer=-1
}function NamedMap(a,b){Map.call(this,b),this.options.pngParams.push("auth_token"),this.options.gridParams.push("auth_token"),this.endPoint=Map.BASE_URL+"/named/"+a.name,this.JSONPendPoint=Map.BASE_URL+"/named/"+a.name+"/jsonp",this.layers=_.clone(a.layers)||[];for(var c=0;c<this.layers.length;++c){var d=this.layers[c];d.options=d.options||{hidden:!1},d.options.layer_name=d.layer_name}this.named_map=a,this.stat_tag=a.stat_tag;var e=a.auth_token||b.auth_token;e&&this.setAuthToken(e)}function LayerDefinition(a,b){Map.call(this,b),this.endPoint=Map.BASE_URL,this.setLayerDefinition(a,{silent:!0})}function SubLayer(a,b){this._parent=a,this._position=b,this._added=!0,this._bindInteraction(),Backbone.Model&&(this.infowindow=new Backbone.Model(this._parent.getLayer(this._position).infowindow),this.infowindow.bind("change",function(){var a=this._parent.getLayer(this._position);a.infowindow=this.infowindow.toJSON(),this._parent.setLayer(this._position,a)},this))}var $=root.$,jQuery=root.jQuery,L=root.L,Mustache=root.Mustache,Backbone=root.Backbone,_=root._;if(function(){function a(){}var b=Array.prototype.slice,c=(Array.prototype.splice,/\s+/),d=Backbone.Events={on:function(a,b,d){var e,f,g,h,i;if(!b)return this;for(a=a.split(c),e=this._callbacks||(this._callbacks={});f=a.shift();)i=e[f],g=i?i.tail:{},g.next=h={},g.context=d,g.callback=b,e[f]={tail:h,next:i?i.next:g};return this},off:function(a,b,d){var f,g,h,i,j,k;if(g=this._callbacks){if(!(a||b||d))return delete this._callbacks,this;for(a=a?a.split(c):e.keys(g);f=a.shift();)if(h=g[f],delete g[f],h&&(b||d))for(i=h.tail;(h=h.next)!==i;)j=h.callback,k=h.context,(b&&j!==b||d&&k!==d)&&this.on(f,j,k);return this}},trigger:function(a){var d,e,f,g,h,i,j;if(!(f=this._callbacks))return this;for(i=f.all,a=a.split(c),j=b.call(arguments,1);d=a.shift();){if(e=f[d])for(g=e.tail;(e=e.next)!==g;)e.callback.apply(e.context||this,j);if(e=i)for(g=e.tail,h=[d].concat(j);(e=e.next)!==g;)e.callback.apply(e.context||this,h)}return this}};if(d.bind=d.on,d.unbind=d.off,void 0===cartodb._Promise&&(a.prototype=d,a.prototype.done=function(a){return this.on("done",a)},a.prototype.error=function(a){return this.on("error",a)},cartodb._Promise=a),"undefined"==typeof e)var e={extend:function(a,b){for(var c in b)a[c]=b[c];return a},defaults:function(a,b){for(var c in b)void 0==a[c]&&(a[c]=b[c]);return a},isFunction:function(a){return"function"==typeof a}}}(),function(){function a(){}function b(a){var b=a.host||"cartodb.com",c=a.protocol||"https";return c+"://"+a.user+"."+b+"/api/v1/viz/"+a.table+"/viz.json"}function c(a,c){var d=null;return void 0!==a.layers||void 0!==(a.kind||a.type)?void _.defer(function(){c(a)}):(void 0!==a.table&&void 0!==a.user?d=b(a):a.indexOf&&0===a.indexOf("http")&&(d=a),void(d?cdb.vis.Loader.get(d,c):_.defer(function(){c(null)})))}_.extend(a.prototype,Backbone.Events,{done:function(a){return this.bind("done",a)},error:function(a){return this.bind("error",a)}}),cdb._Promise=a;cartodb.createLayer=function(b,d,e,f){var g,h,i=new a;if(e=e||{},void 0===b)throw new TypeError("map should be provided");if(void 0===d)throw new TypeError("layer should be provided");var j=arguments,k=j[j.length-1];return _.isFunction(k)&&(f=k),i.addTo=function(a,b){return i.on("done",function(){h.addLayerToMap(g,a,b)}),i},c(d,function(a){function c(){g=k.createLayer(d,{no_base_layer:!0});var a,c=/Android|webOS|iPhone|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),h=e.mobile_layout&&c||e.force_mobile;return g?(e.infowindow&&k.addInfowindow(g),e.tooltip&&k.addTooltip(g),e.legends&&k.addLegends([d],c&&e.mobile_layout||e.force_mobile),e.time_slider&&"torque"===g.model.get("type")&&(h||k.addTimeSlider(g),a=g),h&&(e.mapView=b.viz.mapView,k.addOverlay({type:"mobile",layerView:g,overlays:[],torqueLayer:a,options:e})),f&&f(g),void i.trigger("done",g)):(i.trigger("error","layer not supported"),i)}var d;if(!a)return void i.trigger("error");if(a.layers){a.layers.length<2&&i.trigger("error","visualization file does not contain layer info");var j=void 0===e.layerIndex?1:e.layerIndex;if(a.layers.length<=j)return void i.trigger("error","layerIndex out of bounds");d=a.layers[j]}else d=a;if(!d)return void i.trigger("error");if(e&&!_.isFunction(e)&&(d.options=d.options||{},_.extend(d.options,e)),e=_.defaults(e,{infowindow:!0,https:!1,legends:!0,time_slider:!0,tooltip:!0}),"undefined"!=typeof b.overlayMapTypes)h=cdb.geo.GoogleMapsMapView;else{if(!(b instanceof L.Map||window.L&&b instanceof window.L.Map))return i.trigger("error","cartodb.js can't guess the map type"),i;h=cdb.geo.LeafletMapView}var k=b.viz;if(!k){var l=new h({map_object:b,map:new cdb.geo.Map});b.viz=k=new cdb.vis.Vis({mapView:l}),k.updated_at=a.updated_at,k.https=e.https}k.checkModules([d])?c():k.loadModules([d],function(){c()})}),i}}(),function(){function a(b){if(cartodb===this||window===this)return new a(b);if(!b.user)throw new Error("user should be provided");var c=new String(window.location.protocol);if(c=c.slice(0,c.length-1),"file"==c&&(c="https"),this.ajax=b.ajax||("undefined"!=typeof jQuery?jQuery.ajax:reqwest),!this.ajax)throw new Error("jQuery or reqwest should be loaded");this.options=_.defaults(b,{version:"v2",protocol:c,jsonp:"undefined"!=typeof jQuery?!jQuery.support.cors:!1})}var b=this;b.cartodb=b.cartodb||{},a.prototype._host=function(){var a=this.options;if(a&&a.completeDomain)return a.completeDomain+"/api/"+a.version+"/sql";var b=a.host||"cartodb.com",c=a.protocol||"https";return c+"://"+a.user+"."+b+"/api/"+a.version+"/sql"},a.prototype.execute=function(a,b,c,d){var e=1024,f=new cartodb._Promise;if(!a)throw new TypeError("sql should not be null");var g=arguments,h=g[g.length-1];_.isFunction(h)&&(d=h),c=_.defaults(c||{},this.options);var i={type:"get",dataType:"json",crossDomain:!0};void 0!==c.cache&&(i.cache=c.cache),c.jsonp&&(delete i.crossDomain,c.jsonpCallback&&(i.jsonpCallback=c.jsonpCallback),i.dataType="jsonp");var j="156543.03515625",k="ST_MakeEnvelope(-20037508.5,-20037508.5,20037508.5,20037508.5,3857)";a=a.replace("!bbox!",k).replace("!pixel_width!",j).replace("!pixel_height!",j);var l=Mustache.render(a,b),m=l.length<e,n=["format","dp","api_key"];if(c.extra_params&&(n=n.concat(c.extra_params)),i.url=this._host(),m){var o="q="+encodeURIComponent(l);for(var p in n){var q=n[p],r=c[q];r&&(o+="&"+q+"="+r)}i.url+="?"+o}else{var s={q:l};for(var p in n){var q=n[p],r=c[q];r&&(s[q]=r)}i.data=s,"undefined"!=typeof jQuery?i.type="post":i.method="post"}var t=c.success,u=c.error;return t&&delete c.success,u&&delete u.success,i.error=function(a){var b=a.responseText||a.response,c=b&&JSON.parse(b);f.trigger("error",c&&c.error,a),u&&u(a)},i.success=function(a,b,c){void 0==b&&(b=a.status,c=a,a=JSON.parse(a.response)),f.trigger("done",a,b,c),t&&t(a,b,c),d&&d(a)},delete c.jsonp,this.ajax(_.extend(i,c)),f},a.prototype.getBounds=function(a,b,c,d){var e=new cartodb._Promise,f=arguments,g=f[f.length-1];_.isFunction(g)&&(d=g);var h="SELECT ST_XMin(ST_Extent(the_geom)) as minx,       ST_YMin(ST_Extent(the_geom)) as miny,       ST_XMax(ST_Extent(the_geom)) as maxx,       ST_YMax(ST_Extent(the_geom)) as maxy from ({{{ sql }}}) as subq";return a=Mustache.render(a,b),this.execute(h,{sql:a},c).done(function(a){if(a.rows&&a.rows.length>0&&null!=a.rows[0].maxx){var b=a.rows[0],c=-85.0511,f=85.0511,g=-179,h=179,i=function(a,b,c){return b>a?b:a>c?c:a},j=i(b.maxx,g,h),k=i(b.minx,g,h),l=i(b.maxy,c,f),m=i(b.miny,c,f),n=[[l,j],[m,k]];e.trigger("done",n),d&&d(n)}}).error(function(a){e.trigger("error",a)}),e},a.prototype.table=function(a){function b(){b.fetch.apply(b,arguments)}var c,d,e,f,g=a,h=[],i=this;return b.fetch=function(a){a=a||{};var c=arguments,d=c[c.length-1];_.isFunction(d)&&(callback=d,1===c.length&&(a={})),i.execute(b.sql(),a,callback)},b.sql=function(){var a="select";return a+=h.length?" "+h.join(",")+" ":" * ",a+="from "+g,c&&(a+=" where "+c),d&&(a+=" limit "+d),e&&(a+=" order by "+e),f&&(a+=" "+f),a},b.filter=function(a){return c=a,b},b.order_by=function(a){return e=a,b},b.asc=function(){return f="asc",b},b.desc=function(){return f="desc",b},b.columns=function(a){return h=a,b},b.limit=function(a){return d=a,b},b},b.cartodb.SQL=a}(),function(){var a=this;a.cartodb=a.cartodb||{};var b={tiler_domain:"cartodb.com",tiler_port:"80",tiler_protocol:"http",subdomains:["{s}"],extra_params:{cache_policy:"persist"}},c=function(a){if(_.defaults(a,b),!a.sublayers)throw new Error("sublayers should be passed");if(!a.user_name)throw new Error("username should be passed");a.layer_definition=LayerDefinition.layerDefFromSubLayers(a.sublayers),a.ajax=reqwest.compat,LayerDefinition.call(this,a.layer_definition,a)};_.extend(c.prototype,LayerDefinition.prototype),a.cartodb.Tiles=c,c.getTiles=function(a,b){var d=new c(a);return d.getTiles(b),d}}(),function(){cartodb.createVis=function(a,b,c,d){if(!a)throw new TypeError("a DOM element should be provided");var e=arguments,f=e[e.length-1];_.isFunction(f)&&(d=f),a="string"==typeof a?document.getElementById(a):a;var g=new cartodb.vis.Vis({el:a});return b&&(g.load(b,c),d&&g.done(d)),g}}(),function(){var a=this,b=a.cdb={};b.VERSION="3.11.24-dev",b.DEBUG=!1,b.CARTOCSS_VERSIONS={"2.0.0":"","2.1.0":""},b.CARTOCSS_DEFAULT_VERSION="2.1.1",b.CDB_HOST={http:"api.cartocdn.com",https:"cartocdn.global.ssl.fastly.net"},a.cdb.config={},a.cdb.core={},a.cdb.geo={},a.cdb.geo.ui={},a.cdb.geo.geocoder={},a.cdb.ui={},a.cdb.ui.common={},a.cdb.vis={},a.cdb.decorators={},a.JST=a.JST||{},a.cartodb=b,b.files=["../vendor/jquery.min.js","../vendor/underscore-min.js","../vendor/json2.js","../vendor/backbone.js","../vendor/leaflet.js","../vendor/wax.cartodb.js","../vendor/GeoJSON.js","../vendor/jscrollpane.js","../vendor/mousewheel.js","../vendor/mwheelIntent.js","../vendor/spin.js","../vendor/lzma.js","core/decorator.js","core/config.js","core/log.js","core/profiler.js","core/template.js","core/model.js","core/view.js","geo/geocoder.js","geo/geometry.js","geo/map.js","geo/ui/text.js","geo/ui/annotation.js","geo/ui/image.js","geo/ui/share.js","geo/ui/zoom.js","geo/ui/zoom_info.js","geo/ui/legend.js","geo/ui/switcher.js","geo/ui/infowindow.js","geo/ui/header.js","geo/ui/search.js","geo/ui/layer_selector.js","geo/ui/mobile.js","geo/ui/tiles_loader.js","geo/ui/infobox.js","geo/ui/tooltip.js","geo/ui/fullscreen.js","geo/layer_definition.js","geo/common.js","geo/leaflet/leaflet_base.js","geo/leaflet/leaflet_plainlayer.js","geo/leaflet/leaflet_tiledlayer.js","geo/leaflet/leaflet_gmaps_tiledlayer.js","geo/leaflet/leaflet_wmslayer.js","geo/leaflet/leaflet_cartodb_layergroup.js","geo/leaflet/leaflet_cartodb_layer.js","geo/leaflet/leaflet.js","geo/gmaps/gmaps_base.js","geo/gmaps/gmaps_baselayer.js","geo/gmaps/gmaps_plainlayer.js","geo/gmaps/gmaps_tiledlayer.js","geo/gmaps/gmaps_cartodb_layergroup.js","geo/gmaps/gmaps_cartodb_layer.js","geo/gmaps/gmaps.js","ui/common/dialog.js","ui/common/share.js","ui/common/notification.js","ui/common/table.js","ui/common/dropdown.js","vis/vis.js","vis/overlays.js","vis/layers.js","api/layers.js","api/sql.js","api/vis.js"],b.init=function(c){var d=b.Class=function(){};_.extend(d.prototype,Backbone.Events),b._loadJST(),a.cdb.god=new Backbone.Model,c&&c()},b.load=function(a,c){var d=0,e=function(){var f=document.createElement("script");f.src=a+b.files[d],document.body.appendChild(f),++d,d==b.files.length?c&&(f.onload=c):f.onload=e};e()}}(),function(){Config=Backbone.Model.extend({VERSION:2,initialize:function(){this.modules=new Backbone.Collection,this.modules.bind("add",function(){this.trigger("moduleLoaded")},this)},REPORT_ERROR_URL:"/api/v0/error",ERROR_TRACK_ENABLED:!1,getSqlApiUrl:function(){var a=this.get("sql_api_protocol")+"://"+this.get("user_name")+"."+this.get("sql_api_domain")+":"+this.get("sql_api_port");return a}}),cdb.config=new Config,cdb.config.set({cartodb_attributions:"CartoDB <a href='http://cartodb.com/attributions' target='_blank'>attribution</a>",cartodb_logo_link:"http://www.cartodb.com"})}(),cdb.decorators.elder=function(){var a=Backbone.Router.extend,b=function(a,b){var c=null;if(null!=this.parent){var d=this.parent;this.parent=this.parent.parent;var b=Array.prototype.slice.call(arguments,1);d.hasOwnProperty(a)?c=d[a].apply(this,b):(b.splice(0,0,a),c=d.elder.apply(this,b)),this.parent=d}return c},c=function(c,d){var e=a.call(this,c,d);return e.prototype.parent=this.prototype,e.prototype.elder=function(a){var c=Array.prototype.slice.call(arguments,1);return a?(c.splice(0,0,a),b.apply(this,c)):e.prototype.parent},e},d=function(a){a.extend=c,a.prototype.elder=function(){},a.prototype.parent=null};return d}(),cdb.decorators.elder(Backbone.Model),cdb.decorators.elder(Backbone.View),cdb.decorators.elder(Backbone.Collection),window.JSON||(window.JSON={stringify:function(a){if("number"==typeof a||"boolean"==typeof a)return a.toString();if("string"==typeof a)return'"'+a.toString()+'"';if(_.isArray(a)){var b="[";for(var c in a)c>0&&(b+=", "),b+=JSON.stringify(a[c]);return b+="]"}var b="{";for(var d in a)a.hasOwnProperty(d)&&(b+='"'+d+'": '+JSON.stringify(a[d]));return b+="}"},parse:function(param){return eval(param)}}),function(){cdb.core.Error=Backbone.Model.extend({url:cdb.config.REPORT_ERROR_URL,initialize:function(){this.set({browser:JSON.stringify($.browser)})}}),cdb.core.ErrorList=Backbone.Collection.extend({model:cdb.core.Error,enableTrack:function(){var a=window.onerror;window.onerror=function(b,c,d){cdb.errors.create({msg:b,url:c,line:d}),a&&a.apply(window,arguments)}}}),cdb.errors=new cdb.core.ErrorList,cdb.config.ERROR_TRACK_ENABLED&&cdb.errors.enableTrack();var a=function(){};if(a.prototype.error=function(){},a.prototype.log=function(){},"undefined"!=typeof console){_console=console;try{_console.log.apply(_console,["cartodb.js "+cartodb.VERSION])}catch(b){_console=new a}}else _console=new a;cdb.core.Log=Backbone.Model.extend({error:function(){_console.error.apply(_console,arguments),cdb.config.ERROR_TRACK_ENABLED&&cdb.errors.create({msg:Array.prototype.slice.call(arguments).join("")})},log:function(){_console.log.apply(_console,arguments)},info:function(){_console.log.apply(_console,arguments)},debug:function(){_console.log.apply(_console,arguments)}})}(),cdb.log=new cdb.core.Log({tag:"cdb"}),function(){cdb._debugCallbacks=function(a){var b=a._callbacks;for(var c in b){var d=b[c];console.log(" * ",c);for(var e=d.tail;(d=d.next)!==e;)console.log("    - ",d.context,d.context&&d.context.el||"none")}};cdb.core.Model=Backbone.Model.extend({initialize:function(a){return _.bindAll(this,"fetch","save","retrigger"),Backbone.Model.prototype.initialize.call(this,a)},fetch:function(a){var b=this;this.trigger("loadModelStarted"),$.when(this.elder("fetch",a)).done(function(a){b.trigger("loadModelCompleted",a)}).fail(function(a){b.trigger("loadModelFailed",a)})},setIdAttribute:function(a){this.idAttribute=a},retrigger:function(a,b,c){c||(c=a);var d=this;b.bind&&b.bind(a,function(){d.trigger(c)},d)},save:function(a,b){var c=this;b&&b.silent||this.trigger("saving");var d=Backbone.Model.prototype.save.apply(this,arguments);return $.when(d).done(function(){b&&b.silent||c.trigger("saved")}).fail(function(){b&&b.silent||c.trigger("errorSaving")}),d}})}(),function(a){function b(){}function c(a){this.t0=null,this.name=a,this.count=0}var d=1024;b.metrics={},b._backend=null,b.get=function(a){return b.metrics[a]||{max:0,min:Number.MAX_VALUE,avg:0,total:0,count:0,last:0,history:"undefined"!=typeof Float32Array?new Float32Array(d):[]}},b.backend=function(a){b._backend=a},b.new_value=function(a,c,e,f){e=e||"i";var g=b.metrics[a]=b.get(a);if(g.max=Math.max(g.max,c),g.min=Math.min(g.min,c),g.total+=c,++g.count,g.avg=g.total/g.count,g.history[g.count%d]=c,f){var h=(new Date).getTime();h-g.last>1e3&&(b._backend&&b._backend([e,a,g.avg]),g.last=h)}else b._backend&&b._backend([e,a,c])},b.print_stats=function(){for(k in b.metrics){var a=b.metrics[k];console.log(" === "+k+" === "),console.log(" max: "+a.max),console.log(" min: "+a.min),console.log(" avg: "+a.avg),console.log(" count: "+a.count),console.log(" total: "+a.total)}},c.prototype={start:function(){return this.t0=+new Date,this},_elapsed:function(){return+new Date-this.t0},end:function(a){null!==this.t0&&(b.new_value(this.name,this._elapsed(),"t",a),this.t0=null)},inc:function(a){a=void 0===a?1:a,b.new_value(this.name,a,"i")},dec:function(a){a=void 0===a?1:a,b.new_value(this.name,a,"d")},mark:function(){if(++this.count,null===this.t0)return void this.start();var a=this._elapsed();a>1&&(b.new_value(this.name,this.count),this.count=0,this.start())}},b.metric=function(a){return new c(a)},a.Profiler=b}(cdb.core),cdb.core.Template=Backbone.Model.extend({initialize:function(){this.bind("change",this._invalidate),this._invalidate()},url:function(){return this.get("template_url")},parse:function(a){return{template:a}},_invalidate:function(){this.compiled=null,this.get("template_url")&&this.fetch()},compile:function(){var a=this.get("type")||"underscore",b=cdb.core.Template.compilers[a];return b?b(this.get("template")):(cdb.log.error("can't get rendered for "+a),null)},render:function(a){var b=this.compiled=this.compiled||this.get("compiled")||this.compile(),c=b(a);return c},asFunction:function(){return _.bind(this.render,this)}},{compilers:{underscore:_.template,mustache:"undefined"==typeof Mustache?null:Mustache.compile},compile:function(a,b){var c=new cdb.core.Template({template:a,type:b||"underscore"});return _.bind(c.render,c)}}),cdb.core.TemplateList=Backbone.Collection.extend({model:cdb.core.Template,getTemplate:function(a){this.namespace&&(a=this.namespace+a);var b=this.find(function(b){return b.get("name")===a});return b?_.bind(b.render,b):(cdb.log.error(a+" not found"),null)}}),cdb.templates=new cdb.core.TemplateList,cdb._loadJST=function(){void 0!==typeof window.JST&&cdb.templates.reset(_(JST).map(function(a,b){return{name:b,compiled:a}}))},function(){var a=cdb.core.View=Backbone.View.extend({classLabel:"cdb.core.View",constructor:function(b){this._models=[],this._subviews={},Backbone.View.call(this,b),a.viewCount++,a.views[this.cid]=this,this._created_at=new Date,cdb.core.Profiler.new_value("total_views",a.viewCount)},add_related_model:function(a){if(!a)throw"added non valid model";this._models.push(a)},addView:function(a){this._subviews[a.cid]=a,a._parent=this},removeView:function(a){delete this._subviews[a.cid]},clearSubViews:function(){_(this._subviews).each(function(a){a.clean()}),this._subviews={}},clean:function(){var b=this;return this.trigger("clean"),this.clearSubViews(),this._parent&&(this._parent.removeView(this),this._parent=null),this.remove(),this.unbind(),this.model&&this.model.unbind&&this.model.unbind(null,null,this),_(this._models).each(function(a){a.unbind(null,null,b)}),this._models=[],a.viewCount--,delete a.views[this.cid],this},getTemplate:function(a){return this.options.template?_.template(this.options.template):cdb.templates.getTemplate(a)},show:function(){this.$el.show()},hide:function(){this.$el.hide()},retrigger:function(a,b,c){c||(c=a);var d=this;b.bind&&b.bind(a,function(){d.trigger(c)},d),this.add_related_model(b)},killEvent:function(a){a&&a.preventDefault&&a.preventDefault(),a&&a.stopPropagation&&a.stopPropagation()},cleanTooltips:function(){this.$(".tipsy").remove()}},{viewCount:0,views:{},extendEvents:function(a){return function(){return _.extend(a,this.constructor.__super__.events)}},runChecker:function(){_.each(cdb.core.View.views,function(a){_.each(a,function(b,c){"_parent"!==c&&a.hasOwnProperty(c)&&b instanceof cdb.core.View&&void 0===a._subviews[b.cid]&&(console.log("========="),console.log("untracked view: "),console.log(b.el),console.log("parent"),console.log(a.el),console.log(" "))})})}})}(),CartoDBLayerCommon.prototype={show:function(){this.setOpacity(void 0===this.options.previous_opacity?.99:this.options.previous_opacity),delete this.options.previous_opacity,this._interactionDisabled=!1,this.visible=!0},hide:function(){void 0==this.options.previous_opacity&&(this.options.previous_opacity=this.options.opacity),this.setOpacity(0),this._interactionDisabled=!0,this.visible=!1},toggle:function(){return this.isVisible()?this.hide():this.show(),this.isVisible()},isVisible:function(){return this.visible},setInteraction:function(a,b){void 0==b&&(b=a,a=0);var c;if(this.interactionEnabled[a]=b,b){if(this.urls){var d=this.getLayerIndexByNumber(+a),e=this._tileJSONfromTiles(d,this.urls);c=this.interaction[a],c&&c.remove();var f=this;this.interaction[a]=this.interactionClass().map(this.options.map).tilejson(e).on("on",function(b){f._interactionDisabled||(b.layer=+a,f._manageOnEvents(f.options.map,b))}).on("off",function(b){f._interactionDisabled||(b=b||{},b.layer=+a,f._manageOffEvents(f.options.map,b))})}}else c=this.interaction[a],c&&(c.remove(),this.interaction[a]=null);return this},setOptions:function(a){if("object"!=typeof a||a.length)throw new Error(a+" options must be an object");_.extend(this.options,a);var a=this.options;this.options.query=this.options.query||"select * from "+this.options.table_name,this.options.query_wrapper&&(this.options.query=_.template(this.options.query_wrapper)({sql:this.options.query})),this.setSilent(!0),a.interaction&&this.setInteraction(a.interaction),a.opacity&&this.setOpacity(a.opacity),a.query&&this.setQuery(a.query.replace(/\{\{table_name\}\}/g,this.options.table_name)),a.tile_style&&this.setCartoCSS(a.tile_style.replace(new RegExp(a.table_name,"g"),"layer0")),a.cartocss&&this.setCartoCSS(a.cartocss),a.interactivity&&this.setInteractivity(a.interactivity),a.visible?this.show():this.hide(),this.setSilent(!1),this._definitionUpdated()},_getLayerDefinition:function(){var a,b,c,d={},e=this.options;a=e.query||"select * from "+e.table_name,e.query_wrapper&&(a=_.template(e.query_wrapper)({sql:a})),b=e.tile_style,c=e.cartocss_version||"2.1.0";for(var f in e.extra_params){var g=e.extra_params[f];d[f]=g.replace?g.replace(/\{\{table_name\}\}/g,e.table_name):g}return a=a.replace(/\{\{table_name\}\}/g,e.table_name),b=b.replace(/\{\{table_name\}\}/g,e.table_name),b=b.replace(new RegExp(e.table_name,"g"),"layer0"),{sql:a,cartocss:b,cartocss_version:c,params:d,interactivity:e.interactivity}},error:function(){},tilesOk:function(){},_clearInteraction:function(){for(var a in this.interactionEnabled)this.interactionEnabled.hasOwnProperty(a)&&this.interactionEnabled[a]&&this.setInteraction(a,!1)},_reloadInteraction:function(){for(var a in this.interactionEnabled)this.interactionEnabled.hasOwnProperty(a)&&this.interactionEnabled[a]&&(this.setInteraction(a,!1),this.setInteraction(a,!0))},_checkTiles:function(){{var a={z:4,x:6,y:6},b=this;new Image,this._tileJSON()}getTiles(function(d){var e=d.tiles[0].replace(/\{z\}/g,a.z).replace(/\{x\}/g,a.x).replace(/\{y\}/g,a.y);this.options.ajax({method:"get",url:e,crossDomain:!0,success:function(){b.tilesOk(),clearTimeout(c)},error:function(a){clearTimeout(c),b.error(a.responseText&&JSON.parse(a.responseText))}})});var c=setTimeout(function(){clearTimeout(c),b.error("tile timeout")},3e4)}},cdb.geo.common={},cdb.geo.common.CartoDBLogo={isWadusAdded:function(a,b){for(var c=[],d=new RegExp("\\b"+b+"\\b"),e=a.getElementsByTagName("*"),f=0,g=e.length;g>f;f++)d.test(e[f].className)&&c.push(e[f]);return c.length>0},isRetinaBrowser:function(){return"devicePixelRatio"in window&&window.devicePixelRatio>1||"matchMedia"in window&&window.matchMedia("(min-resolution:144dpi)")&&window.matchMedia("(min-resolution:144dpi)").matches},addWadus:function(a,b,c){var d=this;setTimeout(function(){if(!d.isWadusAdded(c,"cartodb-logo")){var b=document.createElement("div"),e=d.isRetinaBrowser();b.setAttribute("class","cartodb-logo"),b.setAttribute("style","position:absolute; bottom:0; left:0; display:block; border:none; z-index:1000000;");var f=-1===location.protocol.indexOf("https")?"http":"https",g=cdb.config.get("cartodb_logo_link");b.innerHTML="<a href='"+g+"' target='_blank'><img width='71' height='29' src='"+f+"://cartodb.s3.amazonaws.com/static/new_logo"+(e?"@2x":"")+".png' style='position:absolute; bottom:"+(a.bottom||0)+"px; left:"+(a.left||0)+"px; display:block; width:71px!important; height:29px!important; border:none; outline:none;' alt='CartoDB' title='CartoDB' />",c.appendChild(b)}},b||0)}},cdb.geo.geocoder.YAHOO={keys:{app_id:"nLQPTdTV34FB9L3yK2dCXydWXRv3ZKzyu_BdCSrmCBAM1HgGErsCyCbBbVP2Yg--"},geocode:function(a,b){a=a.toLowerCase().replace(//g,"e").replace(//g,"a").replace(//g,"i").replace(//g,"o").replace(//g,"u").replace(/ /g,"+");var c="";-1===location.protocol.indexOf("http")&&(c="http:"),$.getJSON(c+"//query.yahooapis.com/v1/public/yql?q="+encodeURIComponent('SELECT * FROM json WHERE url="http://where.yahooapis.com/geocode?q='+a+"&appid="+this.keys.app_id+'&flags=JX"')+"&format=json&callback=?",function(a){var c=[];if(a&&a.query&&a.query.results&&a.query.results.json&&a.query.results.json.ResultSet&&"0"!=a.query.results.json.ResultSet.Found){var d;d=_.isArray(a.query.results.json.ResultSet.Results)?a.query.results.json.ResultSet.Results:[a.query.results.json.ResultSet.Results];for(var e in d){var f,g=d[e];f={lat:g.latitude,lon:g.longitude},g.boundingbox&&(f.boundingbox=g.boundingbox),c.push(f)}}b(c)})}},cdb.geo.geocoder.NOKIA={keys:{app_id:"KuYppsdXZznpffJsKT24",app_code:"A7tBPacePg9Mj_zghvKt9Q"},geocode:function(a,b){a=a.toLowerCase().replace(//g,"e").replace(//g,"a").replace(//g,"i").replace(//g,"o").replace(//g,"u").replace(/ /g,"+");var c="";-1===location.protocol.indexOf("http")&&(c="http:"),$.getJSON(c+"//places.nlp.nokia.com/places/v1/discover/search/?q="+encodeURIComponent(a)+"&app_id="+this.keys.app_id+"&app_code="+this.keys.app_code+"&Accept-Language=en-US&at=0,0&callback=?",function(a){var c=[];if(a&&a.results&&a.results.items&&a.results.items.length>0){var d=a.results.items;for(var e in d){var f,g=d[e];f={lat:g.position[0],lon:g.position[1]},g.bbox&&(f.boundingbox={north:g.bbox[3],south:g.bbox[1],east:g.bbox[2],west:g.bbox[0]}),c.push(f)}}b(c)})}},cdb.geo.Geometry=cdb.core.Model.extend({isPoint:function(){var a=this.get("geojson").type;return a&&"point"===a.toLowerCase()?!0:!1}}),cdb.geo.Geometries=Backbone.Collection.extend({}),_.extend(GeometryView.prototype,Backbone.Events,{edit:function(){throw new Error("to be implemented")}}),function(){function a(a){var b=this,c=["click","dblclick","mousedown","mouseover","mouseout","dragstart","drag","dragend"];this._eventHandlers={},this.model=a,this.points=[];_.clone(a.get("style"))||{};this.geom=new GeoJSON(a.get("geojson"),{icon:{url:cdb.config.get("assets_url")+"/images/layout/default_marker.png",anchor:{x:10,y:10}},raiseOnDrag:!1,crossOnDrag:!1});var d;for(d=0;d<c.length;++d){var e=c[d];google.maps.event.addListener(this.geom,e,b._eventHandler(e))}this.bind("dragend",function(b,c){a.set({geojson:{type:"Point",coordinates:[c[1],c[0]]}})})}function b(a){function b(a){google.maps.event.addListener(a,"insert_at",c._updateModel)}var c=this;this._eventHandlers={},this.model=a,this.points=[];var d=_.clone(a.get("style"))||{};this.geom=new GeoJSON(a.get("geojson"),d),_.bindAll(this,"_updateModel");var c=this;if(this.geom.getPaths){var e=this.geom.getPaths();if(e&&e[0])for(var f=0;f<e.length;++f)b(e[f]);else b(e),google.maps.event.addListener(this.geom,"mouseup",this._updateModel)}else if(this.geom.length)for(var f=0;f<this.geom.length;++f)b(this.geom[f].getPath()),google.maps.event.addListener(this.geom[f],"mouseup",this._updateModel);else b(this.geom.getPath()),google.maps.event.addListener(this.geom,"mouseup",this._updateModel)}a.prototype=new GeometryView,a.prototype._eventHandler=function(a){var b=this,c=this._eventHandlers[a];return c||(c=function(c){var d=c.latLng,e=[d.lat(),d.lng()];b.trigger(a,c,e)},this._eventHandlers[a]=c),c},a.prototype.edit=function(a){this.geom.setDraggable(a)},b.prototype=new GeometryView,b.getGeoJSON=function(a,c){function d(a){return[a.lng(),a.lat()]}function e(a){for(var b=[],c=0;c<a.length;++c)b.push(d(a.getAt(c)));return b}if(a.length&&1!=a.length){for(var f=[],g=0;g<a.length;++g)f.push(b.getGeoJSON(a[g],c).coordinates[0]);return{type:c,coordinates:f}}var h,i=a.length?a[0]:a;if("Point"==c)h=d(i.getPosition());else if("MultiPoint"==c)h=[d(i.getPosition())];else if("Polygon"==c)h=[e(i.getPath())],h[0].push(d(i.getPath().getAt(0)));else if("MultiPolygon"==c){h=[];for(var j=0;j<i.getPaths().length;++j){var f=e(i.getPaths().getAt(j));f.push(d(i.getPaths().getAt(j).getAt(0))),h.push(f)}h=[h]}else"LineString"==c?h=e(i.getPath()):"MultiLineString"==c&&(h=[e(i.getPath())]);return{type:c,coordinates:h}},b.prototype._updateModel=function(){var a=this;setTimeout(function(){a.model.set("geojson",b.getGeoJSON(a.geom,a.model.get("geojson").type))},100)},b.prototype.edit=function(a){for(var c=this.geom.length?this.geom:[this.geom],d=0;d<c.length;++d)c[d].setEditable(a);a||this.model.set("geojson",b.getGeoJSON(this.geom,this.model.get("geojson").type))},cdb.geo.gmaps=cdb.geo.gmaps||{},cdb.geo.gmaps.PointView=a,cdb.geo.gmaps.PathView=b}(),"undefined"!=typeof google&&"undefined"!=typeof google.maps){var DEFAULT_MAP_STYLE=[{stylers:[{saturation:-65},{gamma:1.52}]},{featureType:"administrative",stylers:[{saturation:-95},{gamma:2.26}]},{featureType:"water",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"administrative.locality",stylers:[{visibility:"off"}]},{featureType:"road",stylers:[{visibility:"simplified"},{saturation:-99},{gamma:2.22}]},{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road.arterial",stylers:[{visibility:"off"}]},{featureType:"road.local",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"transit",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi",stylers:[{saturation:-55}]}];cdb.geo.GoogleMapsMapView=cdb.geo.MapView.extend({layerTypeMap:{tiled:cdb.geo.GMapsTiledLayerView,cartodb:cdb.geo.GMapsCartoDBLayerView,carto:cdb.geo.GMapsCartoDBLayerView,plain:cdb.geo.GMapsPlainLayerView,gmapsbase:cdb.geo.GMapsBaseLayerView,layergroup:cdb.geo.GMapsCartoDBLayerGroupView,namedmap:cdb.geo.GMapsCartoDBNamedMapView,torque:function(a,b){return new cdb.geo.GMapsTorqueLayerView(a,b)},wms:cdb.geo.LeafLetWMSLayerView},initialize:function(){_.bindAll(this,"_ready"),this._isReady=!1;var a=this;cdb.geo.MapView.prototype.initialize.call(this);var b=this.map.getViewBounds();b&&this.showBounds(b);var c=this.map.get("center");if(this.options.map_object){this.map_googlemaps=this.options.map_object,this.setElement(this.map_googlemaps.getDiv());var d=a.map_googlemaps.getCenter();a._setModelProperty({center:[d.lat(),d.lng()]}),a._setModelProperty({zoom:a.map_googlemaps.getZoom()}),a.map.unset("view_bounds_sw",{silent:!0}),a.map.unset("view_bounds_ne",{silent:!0})}else this.map_googlemaps=new google.maps.Map(this.el,{center:new google.maps.LatLng(c[0],c[1]),zoom:this.map.get("zoom"),minZoom:this.map.get("minZoom"),maxZoom:this.map.get("maxZoom"),disableDefaultUI:!0,scrollwheel:this.map.get("scrollwheel"),mapTypeControl:!1,mapTypeId:google.maps.MapTypeId.ROADMAP,backgroundColor:"white",tilt:0}),this.map.bind("change:maxZoom",function(){a.map_googlemaps.setOptions({maxZoom:a.map.get("maxZoom")})},this),this.map.bind("change:minZoom",function(){a.map_googlemaps.setOptions({minZoom:a.map.get("minZoom")})},this);this.map.geometries.bind("add",this._addGeometry,this),this.map.geometries.bind("remove",this._removeGeometry,this),this._bindModel(),this._addLayers(),google.maps.event.addListener(this.map_googlemaps,"center_changed",function(){var b=a.map_googlemaps.getCenter();a._setModelProperty({center:[b.lat(),b.lng()]})}),google.maps.event.addListener(this.map_googlemaps,"zoom_changed",function(){a._setModelProperty({zoom:a.map_googlemaps.getZoom()})}),google.maps.event.addListener(this.map_googlemaps,"click",function(b){a.trigger("click",b,[b.latLng.lat(),b.latLng.lng()])}),google.maps.event.addListener(this.map_googlemaps,"dblclick",function(b){a.trigger("dblclick",b)}),this.map.layers.bind("add",this._addLayer,this),this.map.layers.bind("remove",this._removeLayer,this),this.map.layers.bind("reset",this._addLayers,this),this.map.layers.bind("change:type",this._swicthLayerView,this),this.projector=new cdb.geo.CartoDBLayerGroupGMaps.Projector(this.map_googlemaps),this.projector.draw=this._ready
},_ready:function(){this.projector.draw=function(){},this.trigger("ready"),this._isReady=!0},_setScrollWheel:function(a,b){this.map_googlemaps.setOptions({scrollwheel:b})},_setZoom:function(a,b){b=b||0,this.map_googlemaps.setZoom(b)},_setCenter:function(a,b){var c=new google.maps.LatLng(b[0],b[1]);this.map_googlemaps.setCenter(c)},createLayer:function(a){var b,c=this.layerTypeMap[a.get("type").toLowerCase()];if(c)try{b=new c(a,this.map_googlemaps)}catch(d){cdb.log.error("MAP: error creating layer"+a.get("type")+" "+d)}else cdb.log.error("MAP: "+a.get("type")+" can't be created");return b},_addLayer:function(a,b,c){c=c||{};var d,e=this;if(d=this.createLayer(a)){if(this.layers[a.cid]=d,d){var f=_(this.layers).filter(function(a){return!!a.getTile}).length-1,g=1===_.keys(this.layers).length||c&&0===c.index;if(g&&!c.no_base_layer){var h=d.model;"GMapsBase"===h.get("type")?d._update():(d.isBase=!0,d._update())}else f-=1,f=Math.max(0,f),d.getTile?(d.gmapsLayer||cdb.log.error("gmaps layer can't be null"),e.map_googlemaps.overlayMapTypes.setAt(f,d.gmapsLayer)):d.gmapsLayer.setMap(e.map_googlemaps);void 0!==c&&c.silent||this.trigger("newLayerView",d,a,this)}else cdb.log.error("layer type not supported");var i=a.get("attribution");if(i){var j=this.map.get("attribution")||[];_.contains(j,i)||j.push(i),this.map.set({attribution:j})}return d}},pixelToLatLon:function(a){return this.projector.fromContainerPixelToLatLng(new google.maps.Point(a[0],a[1]))},latLonToPixel:function(a){return this.projector.latLngToPixel(new google.maps.LatLng(a[0],a[1]))},getSize:function(){return{x:this.$el.width(),y:this.$el.height()}},panBy:function(a){var b=this.map.get("center"),c=this.latLonToPixel(b);a.x+=c.x,a.y+=c.y;var d=this.projector.pixelToLatLng(a);this.map.setCenter([d.lat(),d.lng()])},getBounds:function(){if(this._isReady){var a=this.map_googlemaps.getBounds(),b=a.getSouthWest(),c=a.getNorthEast();return[[b.lat(),b.lng()],[c.lat(),c.lng()]]}return[[0,0],[0,0]]},setAttribution:function(a){var b=document.getElementById("cartodb-gmaps-attribution"),c=a.get("attribution").join(", ");b&&b.parentNode.removeChild(b);var d=this.map_googlemaps.getDiv(),e=document.createElement("div");e.setAttribute("id","cartodb-gmaps-attribution"),e.setAttribute("class","gmaps"),d.appendChild(e),e.innerHTML=c},setCursor:function(a){this.map_googlemaps.setOptions({draggableCursor:a})},_addGeomToMap:function(a){var b=cdb.geo.GoogleMapsMapView.createGeometry(a);if(b.geom.length)for(var c=0;c<b.geom.length;++c)b.geom[c].setMap(this.map_googlemaps);else b.geom.setMap(this.map_googlemaps);return b},_removeGeomFromMap:function(a){if(a.geom.length)for(var b=0;b<a.geom.length;++b)a.geom[b].setMap(null);else a.geom.setMap(null)},getNativeMap:function(){return this.map_googlemaps},invalidateSize:function(){google.maps.event.trigger(this.map_googlemaps,"resize")}},{addLayerToMap:function(a,b,c){c=c||0,a||cdb.log.error("gmaps layer can't be null"),a.getTile?b.overlayMapTypes.setAt(c,a):a.setMap(b)},createGeometry:function(a){return a.isPoint()?new cdb.geo.gmaps.PointView(a):new cdb.geo.gmaps.PathView(a)}})}!function(){if("undefined"!=typeof google&&"undefined"!=typeof google.maps){var a=function(a,b,c){this.gmapsLayer=b,this.map=this.gmapsMap=c,this.model=a,this.model.bind("change",this._update,this),this.type=a.get("type")||a.get("kind"),this.type=this.type.toLowerCase()};_.extend(a.prototype,Backbone.Events),_.extend(a.prototype,{_searchLayerIndex:function(){var a=this,b=-1;return this.gmapsMap.overlayMapTypes.forEach(function(c,d){c==a&&(b=d)}),b},remove:function(){if(!this.isBase){var a=this._searchLayerIndex();a>=0?this.gmapsMap.overlayMapTypes.removeAt(a):this.gmapsLayer.setMap&&this.gmapsLayer.setMap(null),this.model.unbind(null,null,this),this.unbind()}},refreshView:function(){if(this.isBase){var a="_baseLayer";this.gmapsMap.setMapTypeId(null),this.gmapsMap.mapTypes.set(a,this.gmapsLayer),this.gmapsMap.setMapTypeId(a)}else{var b=this._searchLayerIndex();b>=0&&this.gmapsMap.overlayMapTypes.setAt(b,this)}},reload:function(){this.refreshView()},_update:function(){this.refreshView()}}),cdb.geo.GMapsLayerView=a}}(),function(){if("undefined"!=typeof google&&"undefined"!=typeof google.maps){var a=function(a,b){cdb.geo.GMapsLayerView.call(this,a,null,b)};_.extend(a.prototype,cdb.geo.GMapsLayerView.prototype,{_update:function(){var a=this.model,b={roadmap:google.maps.MapTypeId.ROADMAP,gray_roadmap:google.maps.MapTypeId.ROADMAP,dark_roadmap:google.maps.MapTypeId.ROADMAP,hybrid:google.maps.MapTypeId.HYBRID,satellite:google.maps.MapTypeId.SATELLITE,terrain:google.maps.MapTypeId.TERRAIN};this.gmapsMap.setOptions({mapTypeId:b[a.get("base_type")]}),this.gmapsMap.setOptions({styles:a.get("style")||DEFAULT_MAP_STYLE})},remove:function(){}}),cdb.geo.GMapsBaseLayerView=a}}(),function(){if("undefined"!=typeof google&&"undefined"!=typeof google.maps){var a=function(a){this.setMap(a)};a.prototype=new google.maps.OverlayView,a.prototype.draw=function(){},a.prototype.latLngToPixel=function(a){var b=this.getProjection();return b?b.fromLatLngToContainerPixel(a):[0,0]},a.prototype.pixelToLatLng=function(a){var b=this.getProjection();return b?b.fromContainerPixelToLatLng(a):[0,0]};var b=function(a){var b={query:"SELECT * FROM {{table_name}}",opacity:.99,attribution:"CartoDB",opacity:1,debug:!1,visible:!0,added:!1,extra_params:{},layer_definition_version:"1.0.0"};if(this.options=_.defaults(a,b),!a.table_name||!a.user_name||!a.tile_style)throw"cartodb-gmaps needs at least a CartoDB table name, user_name and tile_style";this.options.layer_definition={version:this.options.layer_definition_version,layers:[{type:"cartodb",options:this._getLayerDefinition(),infowindow:this.options.infowindow}]},cdb.geo.CartoDBLayerGroupGMaps.call(this,this.options),this.setOptions(this.options)};_.extend(b.prototype,cdb.geo.CartoDBLayerGroupGMaps.prototype),b.prototype.setQuery=function(a,b){void 0===b&&(b=a,a=0),b=b||"select * from "+this.options.table_name,LayerDefinition.prototype.setQuery.call(this,a,b)},cdb.geo.CartoDBLayerGMaps=b;var c=function(a,b){var c=this;_.bindAll(this,"featureOut","featureOver","featureClick"),a.attributes.attribution=cdb.config.get("cartodb_attributions");var d=_.clone(a.attributes);d.map=b;var e=d.featureOver,f=d.featureOut,g=d.featureClick;d.featureOver=function(){e&&e.apply(this,arguments),c.featureOver&&c.featureOver.apply(this,arguments)},d.featureOut=function(){f&&f.apply(this,arguments),c.featureOut&&c.featureOut.apply(this,arguments)},d.featureClick=function(){g&&g.apply(this,arguments),c.featureClick&&c.featureClick.apply(d,arguments)},cdb.geo.CartoDBLayerGMaps.call(this,d),cdb.geo.GMapsLayerView.call(this,a,this,b)};cdb.geo.GMapsCartoDBLayerView=c,_.extend(c.prototype,cdb.geo.CartoDBLayerGMaps.prototype,cdb.geo.GMapsLayerView.prototype,{_update:function(){this.setOptions(this.model.attributes)},reload:function(){this.model.invalidate()},remove:function(){cdb.geo.GMapsLayerView.prototype.remove.call(this),this.clear()},featureOver:function(a,b,c,d){this.trigger("featureOver",a,[b.lat(),b.lng()],c,d,0)},featureOut:function(a){this.trigger("featureOut",a)},featureClick:function(a,b,c,d){this.trigger("featureClick",a,[b.lat(),b.lng()],c,d,0)},error:function(a){this.model&&(this.model.trigger("error",a?a.error:"unknown error"),this.model.trigger("tileError",a?a.error:"unknown error"))},tilesOk:function(){this.model.trigger("tileOk")},loading:function(){this.trigger("loading")},finishLoading:function(){this.trigger("load")}})}}(),function(){function a(a,b){var c=Math.round(100*b);a.style.filter=c>=99?f:"alpha(opacity="+b+");"}function b(){}function c(a){var b=function(b,c){var d=this,e=[];_.bindAll(this,"featureOut","featureOver","featureClick"),b.attributes.attribution=cdb.config.get("cartodb_attributions");var f=_.clone(b.attributes);f.map=c;var g,h=f.featureOver,i=f.featureOut,j=f.featureClick,k=-1;f.featureOver=function(a,b,c,f,i){e[i]||d.trigger("layerenter",a,b,c,f,i),e[i]=1,h&&h.apply(this,arguments),d.featureOver&&d.featureOver.apply(this,arguments),a.timeStamp===g&&clearTimeout(k),k=setTimeout(function(){d.trigger("mouseover",a,b,c,f,i),d.trigger("layermouseover",a,b,c,f,i)},0),g=a.timeStamp},f.featureOut=function(a,b){e[b]&&d.trigger("layermouseout",b),e[b]=0,_.any(e)||d.trigger("mouseout"),i&&i.apply(this,arguments),d.featureOut&&d.featureOut.apply(this,arguments)},f.featureClick=_.debounce(function(){j&&j.apply(this,arguments),d.featureClick&&d.featureClick.apply(f,arguments)},10),a.call(this,f),cdb.geo.GMapsLayerView.call(this,b,this,c)};return _.extend(b.prototype,cdb.geo.GMapsLayerView.prototype,a.prototype,{_update:function(){this.setOptions(this.model.attributes)},reload:function(){this.model.invalidate()},remove:function(){cdb.geo.GMapsLayerView.prototype.remove.call(this),this.clear()},featureOver:function(a,b,c,d,e){this.trigger("featureOver",a,[b.lat(),b.lng()],c,d,e)},featureOut:function(a,b){this.trigger("featureOut",a,b)},featureClick:function(a,b,c,d,e){this.trigger("featureClick",a,[b.lat(),b.lng()],c,d,e)},error:function(a){this.model&&(this.model.trigger("error",a?a.errors:"unknown error"),this.model.trigger("tileError",a?a.errors:"unknown error"))},ok:function(){this.model.trigger("tileOk")},tilesOk:function(){this.model.trigger("tileOk")},loading:function(){this.trigger("loading")},finishLoading:function(){this.trigger("load")}}),b}if("undefined"!=typeof google&&"undefined"!=typeof google.maps){var d=function(a){this.setMap(a)};d.prototype=new google.maps.OverlayView,d.prototype.draw=function(){},d.prototype.latLngToPixel=function(a){var b=this.getProjection();return b?b.fromLatLngToContainerPixel(a):[0,0]},d.prototype.pixelToLatLng=function(a){var b=this.getProjection();return b?b.fromContainerPixelToLatLng(a):[0,0]};var e={opacity:.99,attribution:"CartoDB",debug:!1,visible:!0,added:!1,tiler_domain:"cartodb.com",tiler_port:"80",tiler_protocol:"http",sql_api_domain:"cartodb.com",sql_api_port:"80",sql_api_protocol:"http",extra_params:{},cdn_url:null,subdomains:null},f="progid:DXImageTransform.Microsoft.gradient(startColorstr=#00FFFFFF,endColorstr=#00FFFFFF)",g=function(a){if(this.options=_.defaults(a,e),this.tiles=0,this.tilejson=null,this.interaction=[],!a.named_map&&!a.sublayers)throw new Error("cartodb-gmaps needs at least the named_map");0!=this.options.cartodb_logo&&cdb.geo.common.CartoDBLogo.addWadus({left:74,bottom:8},2e3,this.options.map.getDiv()),wax.g.connector.call(this,a),_.extend(this.options,a),this.projector=new d(a.map),NamedMap.call(this,this.options.named_map,this.options),CartoDBLayerCommon.call(this),this.update()},h=function(a){if(this.options=_.defaults(a,e),this.tiles=0,this.tilejson=null,this.interaction=[],!a.layer_definition&&!a.sublayers)throw new Error("cartodb-leaflet needs at least the layer_definition or sublayer list");a.layer_definition||(a.layer_definition=LayerDefinition.layerDefFromSubLayers(a.sublayers)),0!=this.options.cartodb_logo&&cdb.geo.common.CartoDBLogo.addWadus({left:74,bottom:8},2e3,this.options.map.getDiv()),wax.g.connector.call(this,a),_.extend(this.options,a),this.projector=new d(a.map),LayerDefinition.call(this,a.layer_definition,this.options),CartoDBLayerCommon.call(this),this.update()};b.prototype.setOpacity=function(b){if(isNaN(b)||b>1||0>b)throw new Error(b+" is not a valid value, should be in [0, 1] range");this.opacity=this.options.opacity=b;for(var c in this.cache){var d=this.cache[c];d.style.opacity=b,a(d,b)}},b.prototype.setAttribution=function(){},b.prototype.getTile=function(b,c,d){var e="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",f=this,g="ActiveXObject"in window,h=g&&!document.addEventListener;if(this.options.added=!0,null===this.tilejson){var i=c+"/"+b.x+"/"+b.y,j=this.cache[i]=new Image(256,256);return j.src=e,j.setAttribute("gTileKey",i),j.style.opacity=this.options.opacity,j}var k=wax.g.connector.prototype.getTile.call(this,b,c,d);h&&a(k,this.options.opacity),k.style.opacity=this.options.opacity,0===this.tiles&&this.loading&&this.loading(),this.tiles++;var l=cartodb.core.Profiler.metric("cartodb-js.tile.png.load.time").start(),m=function(){l.end(),f.tiles--,0===f.tiles&&f.finishLoading&&f.finishLoading()};return k.onload=m,k.onerror=function(){cartodb.core.Profiler.metric("cartodb-js.tile.png.error").inc(),m()},k},b.prototype.onAdd=function(){},b.prototype.clear=function(){this._clearInteraction(),self.finishLoading&&self.finishLoading()},b.prototype.update=function(a){var b=this;this.loading&&this.loading(),this.getTiles(function(c,d){c?(b.tilejson=c,b.options.tiles=c.tiles,b.tiles=0,b.cache={},b._reloadInteraction(),b.refreshView(),b.ok&&b.ok(),a&&a()):b.error&&b.error(d)})},b.prototype.refreshView=function(){var a=this,b=this.options.map;b.overlayMapTypes.forEach(function(c,d){return c==a?void b.overlayMapTypes.setAt(d,a):void 0})},b.prototype.onLayerDefinitionUpdated=function(){this.update()},b.prototype._checkLayer=function(){if(!this.options.added)throw new Error("the layer is not still added to the map")},b.prototype._findPos=function(a,b){var c;c=curtop=0;var d,e,f=a.getDiv();b.e.changedTouches&&b.e.changedTouches.length>0?(d=b.e.changedTouches[0].clientX+window.scrollX,e=b.e.changedTouches[0].clientY+window.scrollY):(d=b.e.clientX,e=b.e.clientY);do c+=f.offsetLeft,curtop+=f.offsetTop;while(f=f.offsetParent);return new google.maps.Point(d-c,e-curtop)},b.prototype._manageOffEvents=function(a,b){return this.options.featureOut?this.options.featureOut&&this.options.featureOut(b.e,b.layer):void 0},b.prototype._manageOnEvents=function(a,b){var c=this._findPos(a,b),d=this.projector.pixelToLatLng(c),e=b.e.type.toLowerCase();switch(e){case"mousemove":if(this.options.featureOver)return this.options.featureOver(b.e,d,c,b.data,b.layer);break;case"click":case"touchend":case"mspointerup":this.options.featureClick&&this.options.featureClick(b.e,d,c,b.data,b.layer)}},h.Projector=d,h.prototype=new wax.g.connector,_.extend(h.prototype,LayerDefinition.prototype,b.prototype,CartoDBLayerCommon.prototype),h.prototype.interactionClass=wax.g.interaction,g.prototype=new wax.g.connector,_.extend(g.prototype,NamedMap.prototype,b.prototype,CartoDBLayerCommon.prototype),g.prototype.interactionClass=wax.g.interaction,cdb.geo.CartoDBLayerGroupGMaps=h,cdb.geo.CartoDBNamedMapGMaps=g,cdb.geo.GMapsCartoDBLayerGroupView=c(h),cdb.geo.GMapsCartoDBNamedMapView=c(g),cdb.geo.CartoDBNamedMapGMaps=g}}(),function(){if("undefined"!=typeof google&&"undefined"!=typeof google.maps){var a=function(a,b){this.color=a.get("color"),cdb.geo.GMapsLayerView.call(this,a,this,b)};_.extend(a.prototype,cdb.geo.GMapsLayerView.prototype,{_update:function(){this.color=this.model.get("color"),this.refreshView()},getTile:function(){var a=document.createElement("div");return a.style.width=this.tileSize.x,a.style.height=this.tileSize.y,a["background-color"]=this.color,a},tileSize:new google.maps.Size(256,256),maxZoom:100,minZoom:0,name:"plain layer",alt:"plain layer"}),cdb.geo.GMapsPlainLayerView=a}}(),function(){if("undefined"!=typeof google&&"undefined"!=typeof google.maps){var a=function(a,b){cdb.geo.GMapsLayerView.call(this,a,this,b),this.tileSize=new google.maps.Size(256,256),this.opacity=1,this.isPng=!0,this.maxZoom=22,this.minZoom=0,this.name="cartodb tiled layer",google.maps.ImageMapType.call(this,this)};_.extend(a.prototype,cdb.geo.GMapsLayerView.prototype,google.maps.ImageMapType.prototype,{getTileUrl:function(a,b){var c=a.y,d=1<<b;if(0>c||c>=d)return null;var e=a.x;(0>e||e>=d)&&(e=(e%d+d)%d),this.model.get("tms")&&(c=d-c-1);var f=this.model.get("urlTemplate");return f.replace("{x}",e).replace("{y}",c).replace("{z}",b)}}),cdb.geo.GMapsTiledLayerView=a}}(),function(){if("undefined"!=typeof google&&"undefined"!=typeof google.maps){var a=function(a,b){var c=a.get("extra_params");a.attributes.attribution=cdb.config.get("cartodb_attributions"),cdb.geo.GMapsLayerView.call(this,a,this,b);var d=this._getQuery(a);torque.GMapsTorqueLayer.call(this,{table:a.get("table_name"),user:a.get("user_name"),column:a.get("property"),blendmode:a.get("torque-blend-mode"),resolution:1,countby:"count(cartodb_id)",sql_api_domain:a.get("sql_api_domain"),sql_api_protocol:a.get("sql_api_protocol"),sql_api_port:a.get("sql_api_port"),tiler_protocol:a.get("tiler_protocol"),tiler_domain:a.get("tiler_domain"),tiler_port:a.get("tiler_port"),stat_tag:a.get("stat_tag"),animationDuration:a.get("torque-duration"),steps:a.get("torque-steps"),sql:d,visible:a.get("visible"),extra_params:{api_key:c?c.map_key:""},map:b,cartodb_logo:a.get("cartodb_logo"),attribution:a.get("attribution"),cdn_url:a.get("no_cdn")?null:a.get("cdn_url")||cdb.CDB_HOST,cartocss:a.get("cartocss")||a.get("tile_style"),named_map:a.get("named_map"),auth_token:a.get("auth_token"),no_cdn:a.get("no_cdn")}),a.get("visible")&&this.play()};_.extend(a.prototype,cdb.geo.GMapsLayerView.prototype,torque.GMapsTorqueLayer.prototype,{_update:function(){var a=this.model.changedAttributes();a!==!1&&(a.tile_style&&this.setCartoCSS(this.model.get("tile_style")),("query"in a||"query_wrapper"in a)&&this.setSQL(this._getQuery(this.model)),"visible"in a&&(this.model.get("visible")?this.show():this.hide()))},_getQuery:function(a){var b=a.get("query"),c=a.get("query_wrapper");return c&&(b=_.template(c)({sql:b||"select * from "+a.get("table_name")})),b},refreshView:function(){},onAdd:function(){torque.GMapsTorqueLayer.prototype.onAdd.apply(this),0!=this.options.cartodb_logo&&cdb.geo.common.CartoDBLogo.addWadus({left:74,bottom:8},2e3,this.map.getDiv())},onTilesLoaded:function(){Backbone.Events.trigger.call(this,"load")},onTilesLoading:function(){Backbone.Events.trigger.call(this,"loading")}}),cdb.geo.GMapsTorqueLayerView=a}}(),Map.BASE_URL="/api/v1/map",Map.EMPTY_GIF="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",LayerDefinition.layerDefFromSubLayers=function(a){if(!a||void 0===a.length)throw new Error("sublayers should be an array");for(var b={version:"1.0.0",stat_tag:"API",layers:[]},c=0;c<a.length;++c)b.layers.push({type:"cartodb",options:a[c]});return b},Map.prototype={isCORSSupported:function(){return"withCredentials"in new XMLHttpRequest},isBtoaSupported:function(){return"function"==typeof window.btoa},getLayerCount:function(){return this.layers.length},_encodeBase64Native:function(a){return btoa(a)},_callbackName:function(){return cartodb.uniqueCallbackName(JSON.stringify(this.toJSON()))},getLayerIndexByNumber:function(a){for(var b={},c=0,d=0;d<this.layers.length;++d){var e=this.layers[d];b[d]=c,e.options&&!e.options.hidden&&++c}return b[a]},getLayerNumberByIndex:function(a){for(var b=[],c=0;c<this.layers.length;++c){var d=this.layers[c];d.options&&!d.options.hidden&&b.push(c)}return a>=b.length?-1:+b[a]},visibleLayers:function(){for(var a=[],b=0;b<this.layers.length;++b){var c=this.layers[b];c.options.hidden||a.push(c)}return a},_encodeBase64:function(a){var b,c,d,e,f,g,h,i,j="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",k=0,l=0,m="",n=[];if(!a)return a;do b=a.charCodeAt(k++),c=a.charCodeAt(k++),d=a.charCodeAt(k++),i=b<<16|c<<8|d,e=i>>18&63,f=i>>12&63,g=i>>6&63,h=63&i,n[l++]=j.charAt(e)+j.charAt(f)+j.charAt(g)+j.charAt(h);while(k<a.length);m=n.join("");var o=a.length%3;return(o?m.slice(0,o-3):m)+"===".slice(o||3)},_array2hex:function(a){for(var b=[],c=0;c<a.length;++c)b.push(String.fromCharCode(a[c]+128));return this.options.btoa(b.join(""))},getLayerToken:function(a){function b(a,b){for(var d;d=c._layerTokenQueue.pop();)d(a,b)}var c=this;clearTimeout(this._timeout),this._queue.push(b),this._layerTokenQueue.push(a),this._timeout=setTimeout(function(){c._getLayerToken(b)},4)},_requestFinished:function(){var a=this;if(this._waiting=!1,this.lastTimeUpdated=(new Date).getTime(),clearTimeout(this._refreshTimer),this._refreshTimer=setTimeout(function(){a.invalidate()},this.options.refreshTime||72e5),this._queue.length){var b=this._queue[this._queue.length-1];this._getLayerToken(b)}},_requestPOST:function(a,b){var c=this,d=this.options.ajax,e=cartodb.core.Profiler.metric("cartodb-js.layergroup.post.time").start();d({crossOrigin:!0,type:"POST",method:"POST",dataType:"json",contentType:"application/json",url:this._tilerHost()+this.endPoint+(a.length?"?"+a.join("&"):""),data:JSON.stringify(this.toJSON()),success:function(a){e.end(),0===c._queue.length&&b(a),c._requestFinished()},error:function(a){e.end(),cartodb.core.Profiler.metric("cartodb-js.layergroup.post.error").inc();var d={errors:["unknow error"]};0===a.status&&(d={errors:["connection error"]});try{d=JSON.parse(a.responseText)}catch(f){}0===c._queue.length&&b(null,d),c._requestFinished()}})},_getCompressor:function(a){var b=this;return this.options.compressor?this.options.compressor:(a=a||JSON.stringify(this.toJSON()),!this.options.force_compress&&a.length<this.options.MAX_GET_SIZE?function(a,b,c){c("config="+encodeURIComponent(a))}:function(a,c,d){a=JSON.stringify({config:a}),LZMA.compress(a,c,function(a){d("lzma="+encodeURIComponent(b._array2hex(a)))})})},_requestGET:function(a,b){var c=this,d=this.options.ajax,e=JSON.stringify(this.toJSON()),f=this._getCompressor(e),g=c.JSONPendPoint||c.endPoint;f(e,3,function(e){a.push(e);var f=cartodb.core.Profiler.metric("cartodb-js.layergroup.get.time").start(),h=c.options.dynamic_cdn?c._host():c._tilerHost();d({dataType:"jsonp",url:h+g+"?"+a.join("&"),jsonpCallback:c.options.instanciateCallback,cache:!!c.options.instanciateCallback,success:function(a){f.end(),0===c._queue.length&&(a.error?(cartodb.core.Profiler.metric("cartodb-js.layergroup.get.error").inc(),b(null,a.error)):b(a)),c._requestFinished()},error:function(){f.end(),cartodb.core.Profiler.metric("cartodb-js.layergroup.get.error").inc();var a={errors:["unknow error"]};try{a=JSON.parse(xhr.responseText)}catch(d){}0===c._queue.length&&b(null,a),c._requestFinished()}})})},_getLayerToken:function(a){var b=[];if(a=a||function(){},this._waiting)return this;if(this._queue=[],!this.named_map&&0===this.visibleLayers().length)return void a(null);var c=this.options.extra_params||{},d=this.options.map_key||this.options.api_key||c.map_key||c.api_key;if(d&&b.push("map_key="+d),c.auth_token)if(_.isArray(c.auth_token))for(var e=0,f=c.auth_token.length;f>e;e++)b.push("auth_token[]="+c.auth_token[e]);else b.push("auth_token="+c.auth_token);this.stat_tag&&b.push("stat_tag="+this.stat_tag),this._waiting=!0;var g=null;return g=this._usePOST()?this._requestPOST:this._requestGET,g.call(this,b,a),this},_usePOST:function(){if(this.options.cors){if(this.options.force_cors)return!0;var a=JSON.stringify(this.toJSON());if(a.length<this.options.MAX_GET_SIZE)return!1}return!1},getLayer:function(a){return _.clone(this.layers[a])},invalidate:function(){this.layerToken=null,this.urls=null,this.onLayerDefinitionUpdated()},setLayer:function(a,b){if(a<this.getLayerCount()&&a>=0){if(b.options.hidden){var c=this.interactionEnabled[a];c&&(b.interaction=!0,this.setInteraction(a,!1))}else this.layers[a].interaction&&(this.setInteraction(a,!0),delete this.layers[a].interaction);this.layers[a]=_.clone(b)}return this.invalidate(),this},getTiles:function(a){var b=this;return b.layerToken?(a&&a(b._layerGroupTiles(b.layerToken,b.options.extra_params)),this):(this.getLayerToken(function(c,d){if(c){if(b.layerToken=c.layergroupid,c.cdn_url){var e=b.options.cdn_url=b.options.cdn_url||{};e.http=c.cdn_url.http||e.http,e.https=c.cdn_url.https||e.https}b.urls=b._layerGroupTiles(c.layergroupid,b.options.extra_params),a&&a(b.urls)}else{if(0===b.visibleLayers().length)return void(a&&a({tiles:[Map.EMPTY_GIF],grids:[]}));a&&a(null,d)}}),this)},isHttps:function(){return"https"===this.options.tiler_protocol},_layerGroupTiles:function(a,b){var c=this.options.subdomains||["0","1","2","3"];this.isHttps()&&(c=[null]);for(var d="/{z}/{x}/{y}",e=[],f=[],g=this._encodeParams(b,this.options.pngParams),h=0;h<c.length;++h){var i=c[h],j=this._host(i)+Map.BASE_URL+"/"+a;f.push(j+d+".png"+(g?"?"+g:""));for(var k=this._encodeParams(b,this.options.gridParams),l=0;l<this.layers.length;++l)e[l]=e[l]||[],e[l].push(j+"/"+l+d+".grid.json"+(k?"?"+k:""))}return{tiles:f,grids:e}},_cleanInteractivity:function(a){if(a){"string"==typeof a&&(a=a.split(","));for(var b=0;b<a.length;++b)a[b]=a[b].replace(/ /g,"");return a}},onLayerDefinitionUpdated:function(){},setSilent:function(a){this.silent=a},_definitionUpdated:function(){this.silent||this.invalidate()},_tileJSONfromTiles:function(a,b,c){function d(a){for(var b=[],c=0;c<a.length;++c)b.push(a[c].replace("{s}",e[c%e.length]));return b}c=c||{};var e=c.subdomains||["0","1","2","3"];return{tilejson:"2.0.0",scheme:"xyz",grids:d(b.grids[a]),tiles:d(b.tiles),formatter:function(a,b){return b}}},getTileJSON:function(a,b){a=void 0==a?0:a;var c=this;this.getTiles(function(d){return d?void(b&&b(c._tileJSONfromTiles(a,d))):void b(null)})},_encodeParams:function(a,b){if(!a)return"";var c=[];b=b||_.keys(a);for(var d in b){var e=b[d],f=a[e];if(f)if(_.isArray(f))for(var g=0,h=f.length;h>g;g++)c.push(e+"[]="+encodeURIComponent(f[g]));else{var i=encodeURIComponent(f);i=i.replace(/%7Bx%7D/g,"{x}").replace(/%7By%7D/g,"{y}").replace(/%7Bz%7D/g,"{z}"),c.push(e+"="+i)}}return c.join("&")},_tilerHost:function(){var a=this.options;return a.tiler_protocol+"://"+(a.user_name?a.user_name+".":"")+a.tiler_domain+(""!=a.tiler_port?":"+a.tiler_port:"")},_host:function(a){var b=this.options;if(b.no_cdn)return this._tilerHost();var c=b.tiler_protocol+"://";a&&(c+=a+".");var d=b.cdn_url||cdb.CDB_HOST;if(!d.http&&!d.https)throw new Error("cdn_host should contain http and/or https entries");return c+=d[b.tiler_protocol]+"/"+b.user_name},getTooltipData:function(a){return this.layers[a].tooltip},getInfowindowData:function(a){var b,c=this.layers[a].infowindow;return!c&&this.options.layer_definition&&(b=this.options.layer_definition.layers[a])&&(c=b.infowindow),c&&c.fields&&c.fields.length>0?c:null},containInfowindow:function(){for(var a=this.options.layer_definition.layers,b=0;b<a.length;++b){var c=a[b].infowindow;if(c&&c.fields&&c.fields.length>0)return!0}return!1},containTooltip:function(){for(var a=this.options.layer_definition.layers,b=0;b<a.length;++b){var c=a[b].tooltip;if(c&&c.fields&&c.fields.length)return!0}return!1},getSubLayer:function(a){var b=this.layers[a];return b.sub=b.sub||new SubLayer(this,a),b.sub},getSubLayerCount:function(){return this.getLayerCount()},getSubLayers:function(){for(var a=[],b=0;b<this.getSubLayerCount();++b)a.push(this.getSubLayer(b));return a}},NamedMap.prototype=_.extend({},Map.prototype,{setAuthToken:function(a){if(!this.isHttps())throw new Error("https must be used when auth_token is set");return this.options.extra_params=this.options.extra_params||{},this.options.extra_params.auth_token=a,this.invalidate(),this},setParams:function(a,b){var c;2===arguments.length?(c={},c[a]=b):c=a,this.named_map.params||(this.named_map.params={});for(var d in c)void 0===c[d]||null===c[d]?delete this.named_map.params[d]:this.named_map.params[d]=c[d];return this.invalidate(),this},toJSON:function(){for(var a=this.named_map.params||{},b=0;b<this.layers.length;++b){var c=this.layers[b];a["layer"+b]=c.options.hidden?0:1}return a},containInfowindow:function(){for(var a=this.layers||[],b=0;b<a.length;++b){var c=a[b].infowindow;if(c&&c.fields&&c.fields.length>0)return!0}return!1},containTooltip:function(){for(var a=this.layers||[],b=0;b<a.length;++b){var c=a[b].tooltip;if(c)return!0}return!1},_attributesUrl:function(a,b){var c=this.options.dynamic_cdn?this._host():this._tilerHost(),d=[c,Map.BASE_URL.slice(1),this.layerToken,a,"attributes",b].join("/"),e=this.options.extra_params||{},f=e.auth_token;if(f)if(_.isArray(f)){for(var g=[],h=0,i=f.length;i>h;h++)g.push("auth_token[]="+f[h]);d+="?"+g.join("&")}else d+="?auth_token="+f;return d},fetchAttributes:function(a,b,c,d){this._attrCallbackName=this._attrCallbackName||this._callbackName();var e=this.options.ajax,f=cartodb.core.Profiler.metric("cartodb-js.named_map.attributes.time").start();e({dataType:"jsonp",url:this._attributesUrl(a,b),jsonpCallback:"_cdbi_layer_attributes_"+this._attrCallbackName,cache:!0,success:function(a){f.end(),d(a)},error:function(){f.end(),cartodb.core.Profiler.metric("cartodb-js.named_map.attributes.error").inc(),d(null)}})},setSQL:function(){throw new Error("SQL is read-only in NamedMaps")},setCartoCSS:function(){throw new Error("cartocss is read-only in NamedMaps")},getCartoCSS:function(){throw new Error("cartocss can't be accessed in NamedMaps")},getSQL:function(){throw new Error("SQL can't be accessed in NamedMaps")},setLayer:function(a,b){var c={sql:1,cartocss:1,interactivity:1};for(var d in b.options)if(d in c)throw delete b.options[d],new Error(d+" is read-only in NamedMaps");return Map.prototype.setLayer.call(this,a,b)},removeLayer:function(){throw new Error("sublayers are read-only in Named Maps")},createSubLayer:function(){throw new Error("sublayers are read-only in Named Maps")},addLayer:function(){throw new Error("sublayers are read-only in Named Maps")},getLayerIndexByNumber:function(a){return+a}}),LayerDefinition.prototype=_.extend({},Map.prototype,{setLayerDefinition:function(a,b){b=b||{},this.version=a.version||"1.0.0",this.stat_tag=a.stat_tag,this.layers=_.clone(a.layers),b.silent||this._definitionUpdated()},toJSON:function(){var a={};a.version=this.version,this.stat_tag&&(a.stat_tag=this.stat_tag),a.layers=[];for(var b=this.visibleLayers(),c=0;c<b.length;++c){var d=b[c];a.layers.push({type:"cartodb",options:{sql:d.options.sql,cartocss:d.options.cartocss,cartocss_version:d.options.cartocss_version||"2.1.0",interactivity:this._cleanInteractivity(d.options.interactivity)}})}return a},removeLayer:function(a){return a<this.getLayerCount()&&a>=0&&(this.layers.splice(a,1),this.interactionEnabled.splice(a,1),this._reorderSubLayers(),this.invalidate()),this},_reorderSubLayers:function(){for(var a=0;a<this.layers.length;++a){var b=this.layers[a];b.sub&&b.sub._setPosition(a)}},addLayer:function(a,b){if(b=void 0===b?this.getLayerCount():b,b<=this.getLayerCount()&&b>=0){if(!a.sql||!a.cartocss)throw new Error("layer definition should contain at least a sql and a cartocss");this.layers.splice(b,0,{type:"cartodb",options:a}),this._definitionUpdated()}return this},setInteractivity:function(a,b){if(void 0===b&&(b=a,a=0),a>=this.getLayerCount()&&0>a)throw new Error("layer does not exist");"string"==typeof b&&(b=b.split(","));for(var c=0;c<b.length;++c)b[c]=b[c].replace(/ /g,"");return this.layers[a].options.interactivity=b,this._definitionUpdated(),this},setQuery:function(a,b){void 0===b&&(b=a,a=0),this.layers[a].options.sql=b,this._definitionUpdated()},getQuery:function(a){return a=a||0,this.layers[a].options.sql},setCartoCSS:function(a,b,c){void 0===c&&(c=b,b=a,a=0),c=c||cartodb.CARTOCSS_DEFAULT_VERSION,this.layers[a].options.cartocss=b,this.layers[a].options.cartocss_version=c,this._definitionUpdated()},createSubLayer:function(a){return this.addLayer(a),this.getSubLayer(this.getLayerCount()-1)},_getSqlApi:function(a){a=a||{};var b=a.sql_api_port,c=a.sql_api_domain+(b?":"+b:""),d=a.sql_api_protocol,e="v1";-1!==c.indexOf("cartodb.com")&&(c="cartodb.com",e="v2");var f=new cartodb.SQL({user:a.user_name,protocol:d,host:c,version:e});return f},fetchAttributes:function(a,b,c,d){var e=this.getLayer(a),f=this._getSqlApi(this.options);this._attrCallbackName=this._attrCallbackName||this._callbackName(),c=_.map(c,function(a){return'"'+a+'"'}).join(",");var g=cartodb.core.Profiler.metric("cartodb-js.layergroup.attributes.time").start();f.execute("select {{{ fields }}} from ({{{ sql }}}) as _cartodbjs_alias where cartodb_id = {{{ cartodb_id }}}",{fields:c,cartodb_id:b,sql:e.options.sql},{cache:!0,jsonpCallback:"_cdbi_layer_attributes_"+this._attrCallbackName,jsonp:!0}).done(function(a){return g.end(),0===a.rows.length?void d(null):void d(a.rows[0])}).error(function(){g.end(),cartodb.core.Profiler.metric("cartodb-js.layergroup.attributes.error").inc(),d(null)})}}),SubLayer.prototype={remove:function(){this._check(),this._parent.removeLayer(this._position),this._unbindInteraction(),this._added=!1
},toggle:function(){return this.get("hidden")?this.show():this.hide(),!this.get("hidden")},show:function(){this.get("hidden")&&this.set({hidden:!1})},hide:function(){this.get("hidden")||this.set({hidden:!0})},setSQL:function(a){return this.set({sql:a})},setCartoCSS:function(a){return this.set({cartocss:a})},setInteractivity:function(a){return this.set({interactivity:a})},getSQL:function(){return this.get("sql")},getCartoCSS:function(){return this.get("cartocss")},setInteraction:function(a){this._parent.setInteraction(this._position,a)},get:function(a){this._check();var b=this._parent.getLayer(this._position);return b.options[a]},set:function(a){this._check();var b=this._parent.getLayer(this._position),c=b.options;for(var d in a)c[d]=a[d];return this._parent.setLayer(this._position,b),this},unset:function(a){var b=this._parent.getLayer(this._position);delete b.options[a],this._parent.setLayer(this._position,b)},_check:function(){if(!this._added)throw"sublayer was removed"},_unbindInteraction:function(){this._parent.off&&this._parent.off(null,null,this)},_bindInteraction:function(){if(this._parent.on){var a=this,b=function(b,c){c=c||b,a._parent.on(b,function(){var b=Array.prototype.slice.call(arguments);parseInt(b[b.length-1],10)==a._position&&a.trigger.apply(a,[c].concat(b))},a)};b("featureOver"),b("featureOut"),b("featureClick"),b("layermouseover","mouseover"),b("layermouseout","mouseout")}},_setPosition:function(a){this._position=a}},_.extend(SubLayer.prototype,Backbone.Events),cartodb._makeCRCTable=function(){for(var a,b=[],c=0;256>c;++c){a=c;for(var d=0;8>d;++d)a=1&a?3988292384^a>>>1:a>>>1;b[c]=a}return b},cartodb.crc32=function(a){for(var b=cartodb._crcTable||(cartodb._crcTable=cartodb._makeCRCTable()),c=-1,d=0,e=a.length;e>d;++d)c=c>>>8^b[255&(c^a.charCodeAt(d))];return(-1^c)>>>0},cartodb.uniqueCallbackName=function(a){return cartodb._callback_c=cartodb._callback_c||0,++cartodb._callback_c,cartodb.crc32(a)+"_"+cartodb._callback_c},function(){function a(a){var b=this,c=["click","dblclick","mousedown","mouseover","mouseout","dragstart","drag","dragend"];this._eventHandlers={},this.model=a,this.points=[],this.geom=L.GeoJSON.geometryToLayer(a.get("geojson"),function(a,d){var e,f=L.marker(d,{icon:L.icon({iconUrl:cdb.config.get("assets_url")+"/images/layout/default_marker.png",iconAnchor:[11,11]})});for(e=0;e<c.length;++e){var g=c[e];f.on(g,b._eventHandler(g))}return f}),this.bind("dragend",function(b,c){a.set({geojson:{type:"Point",coordinates:[c[1],c[0]]}})})}function b(a){this._eventHandlers={},this.model=a,this.points=[],this.geom=L.GeoJSON.geometryToLayer(a.get("geojson")),this.geom.setStyle(a.get("style"))}a.prototype=new GeometryView,a.prototype.edit=function(){this.geom.dragging.enable()},a.prototype._eventHandler=function(a){var b=this,c=this._eventHandlers[a];return c||(c=function(c){var d=c.target.getLatLng(),e=[d.lat,d.lng];b.trigger(a,c.originalEvent,e)},this._eventHandlers[a]=c),c},b.prototype=new GeometryView,b.prototype._leafletLayers=function(){return this.geom.getLayers?this.geom.getLayers():[this.geom]},b.prototype.enableEdit=function(){var a=this,b=this._leafletLayers();_.each(b,function(b){b.setStyle(a.model.get("style")),b.on("edit",function(){a.model.set("geojson",a.geom.toGeoJSON().geometry)},a)})},b.prototype.disableEdit=function(){var a=this,b=this._leafletLayers();_.each(b,function(b){b.off("edit",null,a)})},b.prototype.edit=function(a){var b=this,c=a?"enable":"disable",d=this._leafletLayers();_.each(d,function(d){d.editing[c](),a?b.enableEdit():b.disableEdit()})},cdb.geo.leaflet=cdb.geo.leaflet||{},cdb.geo.leaflet.PointView=a,cdb.geo.leaflet.PathView=b}(),function(){"undefined"!=typeof L&&(cdb.geo.LeafletMapView=cdb.geo.MapView.extend({initialize:function(){_.bindAll(this,"_addLayer","_removeLayer","_setZoom","_setCenter","_setView"),cdb.geo.MapView.prototype.initialize.call(this);var a=this,b=this.map.get("center"),c={zoomControl:!1,center:new L.LatLng(b[0],b[1]),zoom:this.map.get("zoom"),minZoom:this.map.get("minZoom"),maxZoom:this.map.get("maxZoom")};if(this.map.get("bounding_box_ne"),this.options.map_object){this.map_leaflet=this.options.map_object,this.setElement(this.map_leaflet.getContainer());var d=a.map_leaflet.getCenter();a._setModelProperty({center:[d.lat,d.lng]}),a._setModelProperty({zoom:a.map_leaflet.getZoom()}),a.map.unset("view_bounds_sw",{silent:!0}),a.map.unset("view_bounds_ne",{silent:!0})}else this.map_leaflet=new L.Map(this.el,c),this.map_leaflet.attributionControl.setPrefix(""),0==this.map.get("scrollwheel")&&this.map_leaflet.scrollWheelZoom.disable();this.map.bind("set_view",this._setView,this),this.map.layers.bind("add",this._addLayer,this),this.map.layers.bind("remove",this._removeLayer,this),this.map.layers.bind("reset",this._addLayers,this),this.map.layers.bind("change:type",this._swicthLayerView,this),this.map.geometries.bind("add",this._addGeometry,this),this.map.geometries.bind("remove",this._removeGeometry,this),this._bindModel(),this._addLayers(),this.map_leaflet.on("layeradd",function(b){this.trigger("layeradd",b,a)},this),this.map_leaflet.on("zoomstart",function(){a.trigger("zoomstart")}),this.map_leaflet.on("click",function(b){a.trigger("click",b.originalEvent,[b.latlng.lat,b.latlng.lng])}),this.map_leaflet.on("dblclick",function(b){a.trigger("dblclick",b.originalEvent)}),this.map_leaflet.on("zoomend",function(){a._setModelProperty({zoom:a.map_leaflet.getZoom()}),a.trigger("zoomend")},this),this.map_leaflet.on("move",function(){var b=a.map_leaflet.getCenter();a._setModelProperty({center:[b.lat,b.lng]})}),this.map_leaflet.on("drag",function(){var b=a.map_leaflet.getCenter();a._setModelProperty({center:[b.lat,b.lng]}),a.trigger("drag")},this),this.map.bind("change:maxZoom",function(){L.Util.setOptions(a.map_leaflet,{maxZoom:a.map.get("maxZoom")})},this),this.map.bind("change:minZoom",function(){L.Util.setOptions(a.map_leaflet,{minZoom:a.map.get("minZoom")})},this),this.trigger("ready");var e=this.map.getViewBounds();e&&this.showBounds(e)},clean:function(){L.DomEvent.off(window,"resize",this.map_leaflet._onResize,this.map_leaflet);for(var a in this.layers){var b=this.layers[a];b.remove(),delete this.layers[a]}cdb.core.View.prototype.clean.call(this)},_setScrollWheel:function(a,b){b?this.map_leaflet.scrollWheelZoom.enable():this.map_leaflet.scrollWheelZoom.disable()},_setZoom:function(){this._setView()},_setCenter:function(){this._setView()},_setView:function(){this.map_leaflet.setView(this.map.get("center"),this.map.get("zoom")||0)},_addGeomToMap:function(a){var b=cdb.geo.LeafletMapView.createGeometry(a);return b.geom.addTo(this.map_leaflet),b},_removeGeomFromMap:function(a){this.map_leaflet.removeLayer(a.geom)},createLayer:function(a){return cdb.geo.LeafletMapView.createLayer(a,this.map_leaflet)},_addLayer:function(a,b,c){var d,e=this;if(d=cdb.geo.LeafletMapView.createLayer(a,this.map_leaflet)){var f=!c||void 0===c.index||c.index===_.size(this.layers);if(!f)for(var g in this.layers)this.map_leaflet.removeLayer(this.layers[g]);this.layers[a.cid]=d,f?(cdb.geo.LeafletMapView.addLayerToMap(d,e.map_leaflet),d.setZIndex&&d.setZIndex(a.get("order"))):this.map.layers.each(function(a){var b=e.layers[a.cid];b&&(cdb.geo.LeafletMapView.addLayerToMap(b,e.map_leaflet),b.setZIndex&&b.setZIndex(a.get("order")))});var h=a.get("attribution");if(h){var i=this.map.get("attribution")||[];_.contains(i,h)||i.push(h),this.map.set({attribution:i})}return void 0!=c&&c.silent||this.trigger("newLayerView",d,a,this),d}},pixelToLatLon:function(a){var b=this.map_leaflet.containerPointToLatLng([a[0],a[1]]);return b},latLonToPixel:function(a){var b=this.map_leaflet.latLngToLayerPoint(new L.LatLng(a[0],a[1]));return this.map_leaflet.layerPointToContainerPoint(b)},getBounds:function(){var a=this.map_leaflet.getBounds(),b=a.getSouthWest(),c=a.getNorthEast();return[[b.lat,b.lng],[c.lat,c.lng]]},setAttribution:function(){},getSize:function(){return this.map_leaflet.getSize()},panBy:function(a){this.map_leaflet.panBy(new L.Point(a.x,a.y))},setCursor:function(a){$(this.map_leaflet.getContainer()).css("cursor",a)},getNativeMap:function(){return this.map_leaflet},invalidateSize:function(){this.map_leaflet.invalidateSize({pan:!1}),this.map_leaflet.setView(this.map.get("center"),this.map.get("zoom")||0,{animate:!1})}},{layerTypeMap:{tiled:cdb.geo.LeafLetTiledLayerView,wms:cdb.geo.LeafLetWMSLayerView,cartodb:cdb.geo.LeafLetLayerCartoDBView,carto:cdb.geo.LeafLetLayerCartoDBView,plain:cdb.geo.LeafLetPlainLayerView,gmapsbase:cdb.geo.LeafLetGmapsTiledLayerView,layergroup:cdb.geo.LeafLetCartoDBLayerGroupView,namedmap:cdb.geo.LeafLetCartoDBNamedMapView,torque:function(a,b){return new cdb.geo.LeafLetTorqueLayer(a,b)}},createLayer:function(a,b){var c=null,d=this.layerTypeMap[a.get("type").toLowerCase()];if(d)try{c=new d(a,b)}catch(e){cdb.log.error("MAP: error creating layer"+a.get("type")+" "+e)}else cdb.log.error("MAP: "+a.get("type")+" can't be created");return c},addLayerToMap:function(a,b,c){b.addLayer(a.leafletLayer),void 0!==c&&v.setZIndex&&v.setZIndex(c)},createGeometry:function(a){return a.isPoint()?new cdb.geo.leaflet.PointView(a):new cdb.geo.leaflet.PathView(a)}}),L.Icon.Default.imagePath=function(){var a,b,c,d,e=document.getElementsByTagName("script"),f=/\/?cartodb[\-\._]?([\w\-\._]*)\.js\??/;for(a=0,b=e.length;b>a;a++)if(c=e[a].src,d=c.match(f)){var g=c.split("/");return delete g[g.length-1],g.join("/")+"themes/css/images"}}())}(),function(){var a=function(a,b,c){this.leafletLayer=b,this.leafletMap=c,this.model=a,this.model.bind("change",this._modelUpdated,this),this.type=a.get("type")||a.get("kind"),this.type=this.type.toLowerCase()};_.extend(a.prototype,Backbone.Events),_.extend(a.prototype,{remove:function(){this.leafletMap.removeLayer(this.leafletLayer),this.model.unbind(null,null,this),this.unbind()},reload:function(){this.leafletLayer.redraw()}}),cdb.geo.LeafLetLayerView=a}(),function(){if("undefined"!=typeof L){L.CartoDBLayer=L.CartoDBGroupLayer.extend({options:{query:"SELECT * FROM {{table_name}}",opacity:.99,attribution:"CartoDB",debug:!1,visible:!0,added:!1,extra_params:{},layer_definition_version:"1.0.0"},initialize:function(a){if(L.Util.setOptions(this,a),!a.table_name||!a.user_name||!a.tile_style)throw"cartodb-leaflet needs at least a CartoDB table name, user_name and tile_style";L.CartoDBGroupLayer.prototype.initialize.call(this,{layer_definition:{version:this.options.layer_definition_version,layers:[{type:"cartodb",options:this._getLayerDefinition(),infowindow:this.options.infowindow}]}}),this.setOptions(this.options)},setQuery:function(a,b){void 0===b&&(b=a,a=0),b=b||"select * from "+this.options.table_name,LayerDefinition.prototype.setQuery.call(this,a,b)},isVisible:function(){return this.visible},isAdded:function(){return this.options.added}});var a=L.CartoDBLayer.extend({initialize:function(a,b){var c=this;_.bindAll(this,"featureOut","featureOver","featureClick"),a.attributes.attribution=cdb.config.get("cartodb_attributions");var d=_.clone(a.attributes);d.map=b;var e=d.featureOver,f=d.featureOut,g=d.featureClick;d.featureOver=function(){e&&e.apply(this,arguments),c.featureOver&&c.featureOver.apply(this,arguments)},d.featureOut=function(){f&&f.apply(this,arguments),c.featureOut&&c.featureOut.apply(this,arguments)},d.featureClick=function(){g&&g.apply(this,arguments),c.featureClick&&c.featureClick.apply(d,arguments)},a.bind("change:visible",function(){c.model.get("visible")?c.show():c.hide()},this),L.CartoDBLayer.prototype.initialize.call(this,d),cdb.geo.LeafLetLayerView.call(this,a,this,b)},_modelUpdated:function(){var a=_.clone(this.model.attributes);this.leafletLayer.setOptions(a)},featureOver:function(a,b,c,d){this.trigger("featureOver",a,[b.lat,b.lng],c,d,0)},featureOut:function(a){this.trigger("featureOut",a,0)},featureClick:function(a,b,c,d){this.trigger("featureClick",a,[b.lat,b.lng],c,d,0)},reload:function(){this.model.invalidate()},error:function(a){this.trigger("error",a?a.error:"unknown error"),this.model.trigger("tileError",a?a.error:"unknown error")},tilesOk:function(){this.model.trigger("tileOk")},includes:[cdb.geo.LeafLetLayerView.prototype,Backbone.Events]});cdb.geo.LeafLetLayerCartoDBView=a}}(),function(){function a(a){var b=a.extend({includes:[cdb.geo.LeafLetLayerView.prototype,Backbone.Events],initialize:function(b,c){var d=this,e=[];b.attributes.attribution=cdb.config.get("cartodb_attributions");var f=_.clone(b.attributes);f.map=c;var g,h=f.featureOver,i=f.featureOut,j=f.featureClick,k=-1;f.featureOver=function(a,b,c,f,i){e[i]||d.trigger("layerenter",a,b,c,f,i),e[i]=1,h&&h.apply(this,arguments),d.featureOver&&d.featureOver.apply(d,arguments),a.timeStamp===g&&clearTimeout(k),k=setTimeout(function(){d.trigger("mouseover",a,b,c,f,i),d.trigger("layermouseover",a,b,c,f,i)},0),g=a.timeStamp},f.featureOut=function(a,b){e[b]&&d.trigger("layermouseout",b),e[b]=0,_.any(e)||d.trigger("mouseout"),i&&i.apply(this,arguments),d.featureOut&&d.featureOut.apply(d,arguments)},f.featureClick=_.debounce(function(){j&&j.apply(d,arguments),d.featureClick&&d.featureClick.apply(d,arguments)},10),a.prototype.initialize.call(this,f),cdb.geo.LeafLetLayerView.call(this,b,this,c)},featureOver:function(a,b,c,d,e){this.trigger("featureOver",a,[b.lat,b.lng],c,d,e)},featureOut:function(a,b){this.trigger("featureOut",a,b)},featureClick:function(a,b,c,d,e){this.trigger("featureClick",a,[b.lat,b.lng],c,d,e)},error:function(a){this.trigger("error",a?a.errors:"unknown error"),this.model.trigger("error",a?a.errors:"unknown error")},ok:function(){this.model.trigger("tileOk")},onLayerDefinitionUpdated:function(){this.__update()}});return b}"undefined"!=typeof L&&(L.CartoDBGroupLayerBase=L.TileLayer.extend({interactionClass:wax.leaf.interaction,includes:[cdb.geo.LeafLetLayerView.prototype,CartoDBLayerCommon.prototype],options:{opacity:.99,attribution:"CartoDB",debug:!1,visible:!0,added:!1,tiler_domain:"cartodb.com",tiler_port:"80",tiler_protocol:"http",sql_api_domain:"cartodb.com",sql_api_port:"80",sql_api_protocol:"http",maxZoom:30,extra_params:{},cdn_url:null,subdomains:null},initialize:function(a){if(a=a||{},L.Util.setOptions(this,a),!a.layer_definition&&!a.sublayers)throw new Error("cartodb-leaflet needs at least the layer_definition or sublayer list");a.layer_definition||(this.options.layer_definition=LayerDefinition.layerDefFromSubLayers(a.sublayers)),LayerDefinition.call(this,this.options.layer_definition,this.options),this.fire=this.trigger,CartoDBLayerCommon.call(this),L.TileLayer.prototype.initialize.call(this),this.interaction=[],this.addProfiling()},addProfiling:function(){this.bind("tileloadstart",function(a){var b=this.tileStats||(this.tileStats={});b[a.tile.src]=cartodb.core.Profiler.metric("cartodb-js.tile.png.load.time").start()});var a=function(a){var b=this.tileStats&&this.tileStats[a.tile.src];b&&b.end()};this.bind("tileload",a),this.bind("tileerror",function(b){cartodb.core.Profiler.metric("cartodb-js.tile.png.error").inc(),a(b)})},getTileUrl:function(a){var b="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7";this._adjustTilePoint(a);var c=[b];this.tilejson&&(c=this.tilejson.tiles);var d=(a.x+a.y)%c.length;return L.Util.template(c[d],L.Util.extend({z:this._getZoomForUrl(),x:a.x,y:a.y},this.options))},setOpacity:function(a){if(isNaN(a)||a>1||0>a)throw new Error(a+" is not a valid value");this.options.opacity=Math.min(a,.99),this.options.visible&&(L.TileLayer.prototype.setOpacity.call(this,this.options.opacity),this.fire("updated"))},onAdd:function(a){var b=this;this.options.map=a,0!=this.options.cartodb_logo&&cdb.geo.common.CartoDBLogo.addWadus({left:8,bottom:8},0,a._container),this.__update(function(){var c=L.stamp(b);a._layers[c]&&(L.TileLayer.prototype.onAdd.call(b,a),b.fire("added"),b.options.added=!0)})},onRemove:function(a){this.options.added&&(this.options.added=!1,L.TileLayer.prototype.onRemove.call(this,a))},__update:function(a){var b=this;this.fire("updated"),this.fire("loading");this.options.map;this.getTiles(function(c,d){c?(b.tilejson=c,b.setUrl(b.tilejson.tiles[0]),b._reloadInteraction(),b.ok&&b.ok(),a&&a()):(b.error&&b.error(d),a&&a())})},_checkLayer:function(){if(!this.options.added)throw new Error("the layer is not still added to the map")},setAttribution:function(a){this._checkLayer(),this.map.attributionControl.removeAttribution(this.options.attribution),this.options.attribution=a,this.map.attributionControl.addAttribution(this.options.attribution),this.options.attribution=this.options.attribution,this.tilejson.attribution=this.options.attribution,this.fire("updated")},_manageOnEvents:function(a,b){var c=this._findPos(a,b),d=a.layerPointToLatLng(c),e=b.e.type.toLowerCase(),f=a.layerPointToContainerPoint(c);switch(e){case"mousemove":if(this.options.featureOver)return this.options.featureOver(b.e,d,f,b.data,b.layer);break;case"click":case"touchend":case"mspointerup":this.options.featureClick&&this.options.featureClick(b.e,d,f,b.data,b.layer)}},_manageOffEvents:function(a,b){return this.options.featureOut?this.options.featureOut&&this.options.featureOut(b.e,b.layer):void 0},_findPos:function(a,b){var c,d,e=0,f=0,g=a.getContainer();if(b.e.changedTouches&&b.e.changedTouches.length>0?(c=b.e.changedTouches[0].clientX+window.scrollX,d=b.e.changedTouches[0].clientY+window.scrollY):(c=b.e.clientX,d=b.e.clientY),g.offsetParent){do e+=g.offsetLeft,f+=g.offsetTop;while(g=g.offsetParent);return a.containerPointToLayerPoint(new L.Point(c-e,d-f))}var h=g.getBoundingClientRect(),i=new L.Point(b.e.clientX-h.left-g.clientLeft-window.scrollX,b.e.clientY-h.top-g.clientTop-window.scrollY);return a.containerPointToLayerPoint(i)}}),L.CartoDBGroupLayer=L.CartoDBGroupLayerBase.extend({includes:[LayerDefinition.prototype]}),L.NamedMap=L.CartoDBGroupLayerBase.extend({includes:[cdb.geo.LeafLetLayerView.prototype,NamedMap.prototype,CartoDBLayerCommon.prototype],initialize:function(a){if(a=a||{},L.Util.setOptions(this,a),!a.named_map&&!a.sublayers)throw new Error("cartodb-leaflet needs at least the named_map");NamedMap.call(this,this.options.named_map,this.options),this.fire=this.trigger,CartoDBLayerCommon.call(this),L.TileLayer.prototype.initialize.call(this),this.interaction=[],this.addProfiling()}}),cdb.geo.LeafLetCartoDBLayerGroupView=a(L.CartoDBGroupLayer),cdb.geo.LeafLetCartoDBNamedMapView=a(L.NamedMap))}(),function(){if("undefined"!=typeof L){var a=function(a){return{url:"http://{s}.basemaps.cartocdn.com/"+(a||"light")+"_all/{z}/{x}/{y}.png",subdomains:"abcd",minZoom:0,maxZoom:18,attribution:'Map designs by <a href="http://stamen.com/">Stamen</a>. Data by <a href="http://openstreetmap.org">OpenStreetMap</a>, Provided by <a href="http://cartodb.com">CartoDB</a>'}},b=function(a){return{url:"https://{s}.maps.nlp.nokia.com/maptile/2.1/maptile/newest/"+a+".day/{z}/{x}/{y}/256/png8?lg=eng&token=A7tBPacePg9Mj_zghvKt9Q&app_id=KuYppsdXZznpffJsKT24",subdomains:"1234",minZoom:0,maxZoom:21,attribution:'2012 Nokia <a href="http://here.net/services/terms" target="_blank">Terms of use</a>'}},c={roadmap:a(),gray_roadmap:a(),dark_roadmap:a("dark"),hybrid:b("hybrid"),terrain:b("terrain"),satellite:b("satellite")},d=L.TileLayer.extend({initialize:function(a,b){var d=c[a.get("base_type")];L.TileLayer.prototype.initialize.call(this,d.url,{tms:!1,attribution:d.attribution,minZoom:d.minZoom,maxZoom:d.maxZoom,subdomains:d.subdomains,errorTileUrl:"",opacity:1}),cdb.geo.LeafLetLayerView.call(this,a,this,b)}});_.extend(d.prototype,cdb.geo.LeafLetLayerView.prototype,{_modelUpdated:function(){throw new Error("A GMaps baselayer should never be updated")}}),cdb.geo.LeafLetGmapsTiledLayerView=d}}(),function(){if("undefined"!=typeof L){var a=L.Class.extend({includes:L.Mixin.Events,initialize:function(a,b){cdb.geo.LeafLetLayerView.call(this,a,this,b)},onAdd:function(){this.redraw()},onRemove:function(){var a=this.leafletMap.getContainer();a.style.background="none"},_modelUpdated:function(){this.redraw()},redraw:function(){var a=this.leafletMap.getContainer();if(a.style.backgroundColor=this.model.get("color")||"#FFF",this.model.get("image")){var b="transparent url("+this.model.get("image")+") repeat center center";a.style.background=b}}});_.extend(a.prototype,cdb.geo.LeafLetLayerView.prototype),cdb.geo.LeafLetPlainLayerView=a}}(),function(){if("undefined"!=typeof L){var a=L.TileLayer.extend({initialize:function(a,b){L.TileLayer.prototype.initialize.call(this,a.get("urlTemplate"),{tms:a.get("tms"),attribution:a.get("attribution"),minZoom:a.get("minZoom"),maxZoom:a.get("maxZoom"),subdomains:a.get("subdomains")||"abc",errorTileUrl:a.get("errorTileUrl"),opacity:a.get("opacity")}),cdb.geo.LeafLetLayerView.call(this,a,this,b)}});_.extend(a.prototype,cdb.geo.LeafLetLayerView.prototype,{_modelUpdated:function(){_.defaults(this.leafletLayer.options,_.clone(this.model.attributes)),this.leafletLayer.options.subdomains=this.model.get("subdomains")||"abc",this.leafletLayer.options.attribution=this.model.get("attribution"),this.leafletLayer.options.maxZoom=this.model.get("maxZoom"),this.leafletLayer.options.minZoom=this.model.get("minZoom"),this.leafletLayer.setUrl(this.model.get("urlTemplate"))}}),cdb.geo.LeafLetTiledLayerView=a}}(),function(){if("undefined"!=typeof L){var a=L.TileLayer.WMS.extend({initialize:function(a,b){L.TileLayer.WMS.prototype.initialize.call(this,a.get("urlTemplate"),{attribution:a.get("attribution"),layers:a.get("layers"),format:a.get("format"),transparent:a.get("transparent"),minZoom:a.get("minZomm"),maxZoom:a.get("maxZoom"),subdomains:a.get("subdomains")||"abc",errorTileUrl:a.get("errorTileUrl"),opacity:a.get("opacity")}),cdb.geo.LeafLetLayerView.call(this,a,this,b)}});_.extend(a.prototype,cdb.geo.LeafLetLayerView.prototype,{_modelUpdated:function(){_.defaults(this.leafletLayer.options,_.clone(this.model.attributes)),this.leafletLayer.setUrl(this.model.get("urlTemplate"))}}),cdb.geo.LeafLetWMSLayerView=a}}(),function(){if("undefined"!=typeof L){var a=L.TorqueLayer.extend({initialize:function(a,b){var c=a.get("extra_params");a.attributes.attribution=cdb.config.get("cartodb_attributions");var d=this._getQuery(a);L.TorqueLayer.prototype.initialize.call(this,{table:a.get("table_name"),user:a.get("user_name"),column:a.get("property"),blendmode:a.get("torque-blend-mode"),resolution:1,countby:"count(cartodb_id)",sql_api_domain:a.get("sql_api_domain"),sql_api_protocol:a.get("sql_api_protocol"),sql_api_port:a.get("sql_api_port"),tiler_protocol:a.get("tiler_protocol"),tiler_domain:a.get("tiler_domain"),tiler_port:a.get("tiler_port"),stat_tag:a.get("stat_tag"),animationDuration:a.get("torque-duration"),steps:a.get("torque-steps"),sql:d,visible:a.get("visible"),extra_params:{api_key:c?c.map_key:""},cartodb_logo:a.get("cartodb_logo"),attribution:a.get("attribution"),cdn_url:a.get("no_cdn")?null:a.get("cdn_url")||cdb.CDB_HOST,cartocss:a.get("cartocss")||a.get("tile_style"),named_map:a.get("named_map"),auth_token:a.get("auth_token"),no_cdn:a.get("no_cdn"),dynamic_cdn:a.get("dynamic_cdn"),instanciateCallback:function(){var b=a.get("cartocss")||a.get("tile_style");return"_cdbct_"+cartodb.uniqueCallbackName(b+d)}}),cdb.geo.LeafLetLayerView.call(this,a,this,b),this.fire=this.trigger,a.get("visible")&&this.play(),this.bind("tilesLoaded",function(){this.trigger("load")},this),this.bind("tilesLoading",function(){this.trigger("loading")},this)},onAdd:function(a){L.TorqueLayer.prototype.onAdd.apply(this,[a]),0!=this.options.cartodb_logo&&cdb.geo.common.CartoDBLogo.addWadus({left:8,bottom:8},0,a._container)},_getQuery:function(a){var b=a.get("query"),c=a.get("query_wrapper");return c&&(b=_.template(c)({sql:b||"select * from "+a.get("table_name")})),b},_modelUpdated:function(){var a=this.model.changedAttributes();a!==!1&&(a.tile_style&&this.setCartoCSS(this.model.get("tile_style")),("query"in a||"query_wrapper"in a)&&this.setSQL(this._getQuery(this.model)),"visible"in a&&(this.model.get("visible")?this.show():this.hide()))}});_.extend(a.prototype,cdb.geo.LeafLetLayerView.prototype),cdb.geo.LeafLetTorqueLayer=a}}(),cdb.geo.MapLayer=cdb.core.Model.extend({defaults:{visible:!0,type:"Tiled"},isEqual:function(a){var b=this.toJSON(),c=a.toJSON(),d=["id","order"];_.each(d,function(a){delete b[a],delete c[a],b.options&&delete b.options[a],c.options&&delete c.options[a]});var e=b.type?b.type:b.options.type,f=c.type?c.type:c.options.type;if(e&&e===f){if("Tiled"===e){var g=b.urlTemplate?b.urlTemplate:b.options.urlTemplate,h=c.urlTemplate?c.urlTemplate:c.options.urlTemplate;return g===h?!0:!1}if("WMS"===e){var g=b.urlTemplate?b.urlTemplate:b.options.urlTemplate,h=c.urlTemplate?c.urlTemplate:c.options.urlTemplate,i=b.layers?b.layers:b.options.layers,j=c.layers?c.layers:c.options.layers;return g===h&&i===j?!0:!1}{var k=b.base_type?b.base_type:b.options.base_type;c.base_type?c.base_type:c.options.base_type}return k?_.isEqual(b,c)?!0:!1:!0}return!1}}),cdb.geo.TileLayer=cdb.geo.MapLayer.extend({getTileLayer:function(){}}),cdb.geo.GMapsBaseLayer=cdb.geo.MapLayer.extend({OPTIONS:["roadmap","satellite","terrain","custom"],defaults:{type:"GMapsBase",base_type:"gray_roadmap",style:null}}),cdb.geo.WMSLayer=cdb.geo.MapLayer.extend({defaults:{service:"WMS",request:"GetMap",version:"1.1.1",layers:"",styles:"",format:"image/jpeg",transparent:!1}}),cdb.geo.PlainLayer=cdb.geo.MapLayer.extend({defaults:{type:"Plain",base_type:"plain",className:"plain",color:"#FFFFFF",image:""}}),cdb.geo.TorqueLayer=cdb.geo.MapLayer.extend({defaults:{type:"torque",visible:!0}}),cdb.geo.CartoDBLayer=cdb.geo.MapLayer.extend({defaults:{attribution:"CartoDB",type:"CartoDB",active:!0,query:null,opacity:.99,interactivity:null,interaction:!0,debug:!1,tiler_domain:"cartodb.com",tiler_port:"80",tiler_protocol:"http",sql_api_domain:"cartodb.com",sql_api_port:"80",sql_api_protocol:"http",extra_params:{},cdn_url:null,maxZoom:28},activate:function(){this.set({active:!0,opacity:.99,visible:!0})},deactivate:function(){this.set({active:!1,opacity:0,visible:!1})},invalidate:function(){var a=this.get("extra_params")||a;a.cache_buster=(new Date).getTime(),this.set("extra_params",a),this.trigger("change",this)},toggle:function(){this.get("active")?this.deactivate():this.activate()}}),cdb.geo.CartoDBGroupLayer=cdb.geo.MapLayer.extend({defaults:{visible:!0,type:"layergroup"}}),cdb.geo.CartoDBNamedMapLayer=cdb.geo.MapLayer.extend({defaults:{visible:!0,type:"namedmap"}}),cdb.geo.Layers=Backbone.Collection.extend({model:cdb.geo.MapLayer,initialize:function(){this.comparator=function(a){return parseInt(a.get("order"),10)},this.bind("add",this._assignIndexes)},_assignIndexes:function(a,b,c){function d(a){var b=a.get("type");return e[b]||0}var e={torque:100},f=0;c&&void 0!==c.at&&(f=c.at),0===f&&(this.models[0].set({order:0}),++f);for(var g=f;g<this.size();++g){var h=this.models[g-1],i=h.get("order")-d(h);this.models[g].set({order:d(this.models[g])+i+1})}}}),cdb.geo.Map=cdb.core.Model.extend({defaults:{center:[0,0],zoom:3,minZoom:0,maxZoom:40,scrollwheel:!0,provider:"leaflet"},initialize:function(){this.layers=new cdb.geo.Layers,this.layers.bind("reset",function(){this.layers.size()>=1&&this._adjustZoomtoLayer(this.layers.models[0])},this),this.geometries=new cdb.geo.Geometries},setView:function(a,b){this.set({center:a,zoom:b},{silent:!0}),this.trigger("set_view")},setZoom:function(a){this.set({zoom:a})},enableScrollWheel:function(){this.set({scrollwheel:!0})},disableScrollWheel:function(){this.set({scrollwheel:!1})},getZoom:function(){return this.get("zoom")},setCenter:function(a){this.set({center:a})},setOptions:function(a){if("object"!=typeof a||a.length){if(this.options.debug)throw a+" options has to be an object"}else _.defaults(this.options,a)},getViewBounds:function(){return this.has("view_bounds_sw")&&this.has("view_bounds_ne")?[this.get("view_bounds_sw"),this.get("view_bounds_ne")]:null},getLayerAt:function(a){return this.layers.at(a)},getLayerByCid:function(a){return this.layers.getByCid(a)},_adjustZoomtoLayer:function(a){var b=a.get("maxZoom"),c=a.get("minZoom");_.isNumber(b)&&(this.get("zoom")>b?this.set({zoom:b,maxZoom:b}):this.set("maxZoom",b)),_.isNumber(c)&&(this.get("zoom")<c?this.set({minZoom:c,zoom:c}):this.set("minZoom",c))},addLayer:function(a,b){return 0==this.layers.size()&&this._adjustZoomtoLayer(a),this.layers.add(a,b),this.trigger("layerAdded"),1===this.layers.length&&this.trigger("firstLayerAdded"),a.cid},removeLayer:function(a){this.layers.remove(a)},removeLayerByCid:function(a){var b=this.layers.getByCid(a);b?this.removeLayer(b):cdb.log.error("There's no layer with cid = "+a+".")},removeLayerAt:function(a){var b=this.layers.at(a);b?this.removeLayer(b):cdb.log.error("There's no layer in that position.")},clearLayers:function(){for(;this.layers.length>0;)this.removeLayer(this.layers.at(0))},getBaseLayer:function(){return this.layers.at(0)},isBaseLayerAdded:function(a){var b=this.getBaseLayer();return b&&a.isEqual(b)},getLayerTemplate:function(){var a=this.getBaseLayer();return a&&a.get("options")?a.get("options").urlTemplate:void 0},updateAttribution:function(a,b){var c=this.get("attribution")||[];a&&(c=_.without(c,a)),b&&(_.contains(c,b)||c.push(b)),this.set({attribution:c})},addGeometry:function(a){this.geometries.add(a)},removeGeometry:function(a){this.geometries.remove(a)},setBounds:function(a){this.attributes.view_bounds_sw=[a[0][0],a[0][1]],this.attributes.view_bounds_ne=[a[1][0],a[1][1]],this.trigger("change:view_bounds_ne",this)},fitBounds:function(a,b){var c=this.getBoundsZoom(a,b);if(null!==c){var d=cdb.geo.Map.latlngToMercator(a[0],c),e=cdb.geo.Map.latlngToMercator(a[1],c),f=cdb.geo.Map.mercatorToLatLng({x:.5*(d[0]+e[0]),y:.5*(d[1]+e[1])},c);this.set({center:f,zoom:c})}},getBoundsZoom:function(a,b){if(0===b.x||0===b.y)return null;var c,d,e=[b.x,b.y],f=this.get("minZoom")||0,g=this.get("maxZoom")||24,h=a[1],i=a[0],j=[],k=!0;do f++,c=cdb.geo.Map.latlngToMercator(h,f),d=cdb.geo.Map.latlngToMercator(i,f),j[0]=Math.abs(c[0]-d[0]),j[1]=Math.abs(d[1]-c[1]),k=j[0]<=e[0]||j[1]<=e[1];while(k&&g>=f);return k?null:f-1}},{latlngToMercator:function(a,b){var c=new L.LatLng(a[0],a[1]),d=L.CRS.EPSG3857.latLngToPoint(c,b);return[d.x,d.y]},mercatorToLatLng:function(a,b){var c=L.CRS.EPSG3857.pointToLatLng(a,b);return[c.lat,c.lng]}}),cdb.geo.MapView=cdb.core.View.extend({initialize:function(){if(void 0===this.options.map)throw"you should specify a map model";this.map=this.options.map,this.add_related_model(this.map),this.add_related_model(this.map.layers),this.autoSaveBounds=!1,this.layers={},this.geometries={},this.bind("clean",this._removeLayers,this)},render:function(){return this},addInfowindow:function(a){this.addOverlay(a)},addOverlay:function(a){a&&(this.$el.append(a.render().el),this.addView(a))},getInfoWindows:function(){var a=[];for(var b in this._subviews)this._subviews[b]instanceof cdb.geo.ui.Infowindow&&a.push(this._subviews[b]);return a},showBounds:function(){throw"to be implemented"},_setModelProperty:function(a){if(this._unbindModel(),this.map.set(a),void 0!==a.center||void 0!==a.zoom){var b=this.getBounds();this.map.set({view_bounds_sw:b[0],view_bounds_ne:b[1]}),this.autoSaveBounds&&this._saveLocation()}this._bindModel()},_bindModel:function(){this._unbindModel(),this.map.bind("change:view_bounds_sw",this._changeBounds,this),this.map.bind("change:view_bounds_ne",this._changeBounds,this),this.map.bind("change:zoom",this._setZoom,this),this.map.bind("change:scrollwheel",this._setScrollWheel,this),this.map.bind("change:center",this._setCenter,this),this.map.bind("change:attribution",this._setAttribution,this)},_unbindModel:function(){this.map.unbind("change:view_bounds_sw",null,this),this.map.unbind("change:view_bounds_ne",null,this),this.map.unbind("change:zoom",null,this),this.map.unbind("change:scrollwheel",null,this),this.map.unbind("change:center",null,this),this.map.unbind("change:attribution",null,this)},_changeBounds:function(){var a=this.map.getViewBounds();a&&this.showBounds(a)},showBounds:function(a){this.map.fitBounds(a,this.getSize())},_setAttribution:function(a){this.setAttribution(a)},_addLayers:function(){var a=this;
this._removeLayers(),this.map.layers.each(function(b){a._addLayer(b)})},_removeLayers:function(){for(var a in this.layers){var b=this.layers[a];b.remove(),delete this.layers[a]}},_removeLayer:function(a){var b=this.layers[a.cid];b&&(b.remove(),delete this.layers[a.cid])},_swicthLayerView:function(a,b,c){this._removeLayer(a),this._addLayer(a,this.map.layers,c)},_removeGeometry:function(a){this.geometries[a.cid];delete this.layers[layer.cid]},getLayerByCid:function(a){var b=this.layers[a];return b||cdb.log.debug("layer with cid "+a+" can't be get"),b},_setZoom:function(){throw"to be implemented"},_setCenter:function(){throw"to be implemented"},_addLayer:function(){throw"to be implemented"},_addGeomToMap:function(){throw"to be implemented"},_removeGeomFromMap:function(){throw"to be implemented"},setAutoSaveBounds:function(){this.autoSaveBounds=!0},_saveLocation:_.debounce(function(){this.map.save(null,{silent:!0})},1e3),_addGeometry:function(a){var b=this._addGeomToMap(a);this.geometries[a.cid]=b},_removeGeometry:function(a){var b=this.geometries[a.cid];this._removeGeomFromMap(b),delete this.geometries[a.cid]}},{_getClass:function(a){var b=cdb.geo.LeafletMapView;return"googlemaps"===a&&("undefined"!=typeof google&&"undefined"!=typeof google.maps?b=cdb.geo.GoogleMapsMapView:cdb.log.error("you must include google maps library _before_ include cdb")),b},create:function(a,b){var c=cdb.geo.MapView._getClass(b.get("provider"));return new c({el:a,map:b})}}),cdb.geo.ui.Annotation=cdb.core.View.extend({className:"cartodb-overlay overlay-annotation",defaults:{minZoom:0,maxZoom:40,style:{textAlign:"left",zIndex:5,color:"#ffffff",fontSize:"13",fontFamilyName:"Helvetica",boxColor:"#333333",boxOpacity:.7,boxPadding:10,lineWidth:50,lineColor:"#333333"}},template:cdb.core.Template.compile('<div class="content">    <div class="text widget_text">{{{ text }}}</div>    <div class="stick"><div class="ball"></div></div>    </div>',"mustache"),events:{click:"stopPropagation"},stopPropagation:function(a){a.stopPropagation()},initialize:function(){this.template=this.options.template||this.template,this.mapView=this.options.mapView,this.mobileEnabled=/Android|webOS|iPhone|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),this._cleanStyleProperties(this.options.style),_.defaults(this.options.style,this.defaults.style),this._setupModels(),this._bindMap()},_setupModels:function(){this.model=new cdb.core.Model({display:!0,hidden:!1,text:this.options.text,latlng:this.options.latlng,minZoom:this.options.minZoom||this.defaults.minZoom,maxZoom:this.options.maxZoom||this.defaults.maxZoom}),this.model.on("change:display",this._onChangeDisplay,this),this.model.on("change:text",this._onChangeText,this),this.model.on("change:latlng",this._place,this),this.model.on("change:minZoom",this._applyZoomLevelStyle,this),this.model.on("change:maxZoom",this._applyZoomLevelStyle,this),this.style=new cdb.core.Model(this.options.style),this.style.on("change",this._applyStyle,this),this.add_related_model(this.style)},_bindMap:function(){this.mapView.map.bind("change",this._place,this),this.mapView.map.bind("change:zoom",this._applyZoomLevelStyle,this),this.mapView.bind("zoomstart",this.hide,this),this.mapView.bind("zoomend",this.show,this)},_unbindMap:function(){this.mapView.map.unbind("change",this._place,this),this.mapView.map.unbind("change:zoom",this._applyZoomLevelStyle,this),this.mapView.unbind("zoomstart",this.hide,this),this.mapView.unbind("zoomend",this.show,this)},_onChangeDisplay:function(){this.model.get("display")?this.show():this.hide()},_onChangeText:function(){this.$el.find(".text").html(this.model.get("text"))},_getStandardPropertyName:function(a){if(a){var b=a.split("-");return 1===b.length?a:2===b.length?b[0]+b[1].slice(0,1).toUpperCase()+b[1].slice(1):void 0}},_cleanStyleProperties:function(a){var b={};_.each(a,function(a,c){b[this._getStandardPropertyName(c)]=a},this),this.options.style=b},_belongsToCanvas:function(){var a="mobile"===this.options.device?!0:!1;return a===this.mobileEnabled},show:function(a){if(!this.model.get("hidden")&&this._belongsToCanvas()){this.$el.css({opacity:0,display:"inline-table"}),this.$el.stop().animate({opacity:1},{duration:150,complete:function(){a&&a()}})}},hide:function(a){this.$el.stop().fadeOut(150,function(){a&&a()})},_place:function(){var a=this.model.get("latlng"),b=this.style.get("lineWidth"),c=this.style.get("textAlign"),d=this.mapView.latLonToPixel(a);if(d){var e=d.y-this.$el.height()/2,f=d.x+b;"right"===c&&(f=d.x-this.$el.width()-b-this.$el.find(".ball").width()),this.$el.css({top:e,left:f})}},setMinZoom:function(a){this.model.set("minZoom",a)},setMaxZoom:function(a){this.model.set("maxZoom",a)},setPosition:function(a){this.model.set("latlng",a)},setText:function(a){this.model.set("text",a)},setStyle:function(a,b){var c=this._getStandardPropertyName(a);c&&this.style.set(c,b)},_applyStyle:function(){var a=this.style.get("color"),b=this.style.get("textAlign"),c=(this.style.get("boxColor"),this.style.get("boxOpacity"),this.style.get("boxPadding")),d=this.style.get("lineWidth"),e=(this.style.get("lineColor"),this.style.get("fontFamilyName"));this.$text=this.$el.find(".text"),this.$text.css({color:a,textAlign:b}),this.$el.find(".content").css("padding",c),this.$text.css("font-size",this.style.get("fontSize")+"px"),this.$el.css("z-index",this.style.get("zIndex")),this.$el.find(".stick").css({width:d,left:-d});var f="";"Droid Sans"==e?f="droid":"Vollkorn"==e?f="vollkorn":"Open Sans"==e?f="open_sans":"Roboto"==e&&(f="roboto"),this.$el.removeClass("droid").removeClass("vollkorn").removeClass("roboto").removeClass("open_sans"),this.$el.addClass(f),"right"===b?(this.$el.addClass("align-right"),this.$el.find(".stick").css({left:"auto",right:-d})):this.$el.removeClass("align-right"),this._place(),this._applyZoomLevelStyle()},_getRGBA:function(a,b){return"rgba("+parseInt(a.slice(-6,-4),16)+","+parseInt(a.slice(-4,-2),16)+","+parseInt(a.slice(-2),16)+","+b+" )"},_applyZoomLevelStyle:function(){var a=this.style.get("boxColor"),b=this.style.get("boxOpacity"),c=this.style.get("lineColor"),d=this.model.get("minZoom"),e=this.model.get("maxZoom"),f=this.mapView.map.get("zoom");if(f>=d&&e>=f){var g=this._getRGBA(c,1),h=this._getRGBA(a,b);this.$el.find(".text").animate({opacity:1},150),this.$el.css("background-color",h),this.$el.find(".stick").css("background-color",g),this.$el.find(".ball").css("background-color",g),this.model.set("hidden",!1),this.model.set("display",!0)}else this.model.set("hidden",!0),this.model.set("display",!1)},clean:function(){this._unbindMap(),cdb.core.View.prototype.clean.call(this)},render:function(){this.$el.html(this.template(this.model.attributes));var a=this;return setTimeout(function(){a._applyStyle(),a._applyZoomLevelStyle(),a.show()},500),this}}),cdb.ui.common.FullScreen=cdb.core.View.extend({tagName:"div",className:"cartodb-fullscreen",events:{"click a":"_toggleFullScreen"},initialize:function(){_.bindAll(this,"render"),_.defaults(this.options,this.default_options),this._addWheelEvent()},_addWheelEvent:function(){var a=this,b=this.options.mapView;$(document).on("webkitfullscreenchange mozfullscreenchange fullscreenchange",function(){document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||a.model.get("allowWheelOnFullscreen")&&b.options.map.set("scrollwheel",!1),b.invalidateSize()})},_toggleFullScreen:function(a){a.stopPropagation(),a.preventDefault();var b=window.document,c=b.documentElement;this.options.doc&&(c=$(this.options.doc)[0]);var d=c.requestFullscreen||c.mozRequestFullScreen||c.webkitRequestFullScreen||c.msRequestFullscreen,e=b.exitFullscreen||b.mozCancelFullScreen||b.webkitExitFullscreen||b.msExitFullscreen,f=this.options.mapView;b.fullscreenElement||b.mozFullScreenElement||b.webkitFullscreenElement||b.msFullscreenElement?e.call(b):(d.call(c),f&&this.model.get("allowWheelOnFullscreen")&&f.options.map.set("scrollwheel",!0))},render:function(){var a=this.$el,b=_.extend(this.options);return a.html(this.options.template(b)),this}}),cdb.geo.ui.Header=cdb.core.View.extend({className:"cartodb-header",initialize:function(){var a=this.model.get("extra");this.model.set({title:a.title,description:this._setLinksTarget(a.description),show_title:a.show_title,show_description:a.show_description},{silent:!0})},show:function(){var a=this.model.get("title")&&this.model.get("show_title"),b=this.model.get("description")&&this.model.get("show_description");if(a||b){var c=this;this.$el.show(),a&&c.$title.show(),b&&c.$description.show()}},_setLinksTarget:function(a){if(!a)return a;var b=new RegExp(/<(a)([^>]+)>/g);return a.replace(b,'<$1 target="_blank"$2>')},render:function(){return this.$el.html(this.options.template(this.model.attributes)),this.$title=this.$el.find(".content div.title"),this.$description=this.$el.find(".content div.description"),this.model.get("show_title")||this.model.get("show_description")?this.show():this.hide(),this}}),cdb.geo.ui.Image=cdb.geo.ui.Text.extend({className:"cartodb-overlay image-overlay",events:{click:"stopPropagation"},default_options:{},stopPropagation:function(a){a.stopPropagation()},initialize:function(){_.defaults(this.options,this.default_options),this.template=this.options.template;var a=this;$(window).on("map_resized",function(){a._place()}),$(window).on("resize",function(){a._place()})},_applyStyle:function(){var a=this.model.get("style"),b=a["box-color"],c=a["box-opacity"],d=a["box-width"];this.$text.css(a),this.$el.css("z-index",a["z-index"]);var e="rgba("+parseInt(b.slice(-6,-4),16)+","+parseInt(b.slice(-4,-2),16)+","+parseInt(b.slice(-2),16)+", "+c+" )";this.$el.css({backgroundColor:e}),this.$el.find("img").css({width:d})},render:function(){var a=this.model.get("extra").rendered_text;this.model.get("extra").has_default_image&&(a='<img src="'+this.model.get("extra").public_default_image_url+'" />'),this.$el.html(this.template(_.extend(this.model.attributes,{content:a}))),this.$text=this.$el.find(".text");var b=this;return setTimeout(function(){b._applyStyle(),b._place(),b.show()},900),this}}),cdb.geo.ui.InfoBox=cdb.core.View.extend({className:"cartodb-infobox",defaults:{pos_margin:20,position:"bottom|right",width:200},initialize:function(){_.defaults(this.options,this.defaults),this.options.layer&&this.enable(),this.setTemplate(this.options.template||this.defaultTemplate,"mustache")},setTemplate:function(a){this.template=cdb.core.Template.compile(a,"mustache")},enable:function(){this.options.layer&&this.options.layer.on("featureOver",function(a,b,c,d){this.render(d).show()},this).on("featureOut",function(){this.hide()},this)},disable:function(){this.options.layer&&this.options.layer.off(null,null,this)},setPosition:function(a){var b={};-1!==a.indexOf("top")?b.top=this.options.pos_margin:-1!==a.indexOf("bottom")&&(b.bottom=this.options.pos_margin),-1!==a.indexOf("left")?b.left=this.options.pos_margin:-1!==a.indexOf("right")&&(b.right=this.options.pos_margin),this.$el.css(b)},render:function(a){return this.$el.html(this.template(a)),this.options.width&&this.$el.css("width",this.options.width),this.options.position&&this.setPosition(this.options.position),this}}),cdb.geo.ui.InfowindowModel=Backbone.Model.extend({SYSTEM_COLUMNS:["the_geom","the_geom_webmercator","created_at","updated_at","cartodb_id","cartodb_georef_status"],defaults:{template_name:"infowindow_light",latlng:[0,0],offset:[28,0],maxHeight:180,autoPan:!0,template:"",content:"",visibility:!1,alternative_names:{},fields:null},clearFields:function(){this.set({fields:[]})},saveFields:function(a){a=a||"old_fields",this.set(a,_.clone(this.get("fields")))},fieldCount:function(){var a=this.get("fields");return a?a.length:0},restoreFields:function(a,b){b=b||"old_fields";var c=this.get(b);a&&(c=c.filter(function(b){return _.contains(a,b.name)})),c&&c.length&&this._setFields(c),this.unset(b)},_cloneFields:function(){return _(this.get("fields")).map(function(a){return _.clone(a)})},_setFields:function(a){a.sort(function(a,b){return a.position-b.position}),this.set({fields:a})},sortFields:function(){this.get("fields").sort(function(a,b){return a.position-b.position})},_addField:function(a,b){var c=$.Deferred();if(!this.containsField(a)){var d=this.get("fields");d?(b=void 0===b?d.length:b,d.push({name:a,title:!0,position:b})):(b=void 0===b?0:b,this.set("fields",[{name:a,title:!0,position:b}],{silent:!0}))}return c.resolve(),c.promise()},addField:function(a,b){var c=this;return $.when(this._addField(a,b)).then(function(){c.sortFields(),c.trigger("change:fields"),c.trigger("add:fields")}),this},getFieldProperty:function(a,b){if(this.containsField(a)){var c=this.get("fields")||[],d=_.indexOf(_(c).pluck("name"),a);return c[d][b]}return null},setFieldProperty:function(a,b,c){if(this.containsField(a)){var d=this._cloneFields()||[],e=_.indexOf(_(d).pluck("name"),a);d[e][b]=c,this._setFields(d)}return this},getAlternativeName:function(a){return this.get("alternative_names")&&this.get("alternative_names")[a]},setAlternativeName:function(a,b){var c=this.get("alternative_names")||[];c[a]=b,this.set({alternative_names:c}),this.trigger("change:alternative_names")},getFieldPos:function(a){var b=this.getFieldProperty(a,"position");return void 0==b?Number.MAX_VALUE:b},containsAlternativeName:function(a){var b=this.get("alternative_names")||[];return b[a]},containsField:function(a){var b=this.get("fields")||[];return _.contains(_(b).pluck("name"),a)},removeField:function(a){if(this.containsField(a)){var b=this._cloneFields()||[],c=_.indexOf(_(b).pluck("name"),a);c>=0&&b.splice(c,1),this._setFields(b),this.trigger("remove:fields")}return this},updateContent:function(a){var b=this.get("fields");this.set("content",cdb.geo.ui.InfowindowModel.contentForFields(a,b))}},{contentForFields:function(a,b,c){c=c||{};for(var d=[],e=0;e<b.length;++e){var f=b[e],g=String(a[f.name]);(c.empty_fields||void 0!==a[f.name]&&""!=g)&&d.push({title:f.title?f.name:null,value:a[f.name],index:e?e:null})}return 0===d.length&&d.push({title:null,value:"No data available",index:e?e:null,type:"empty"}),{fields:d,data:a}}}),cdb.geo.ui.Infowindow=cdb.core.View.extend({className:"cartodb-infowindow",spin_options:{lines:10,length:0,width:4,radius:6,corners:1,rotate:0,color:"rgba(0,0,0,0.5)",speed:1,trail:60,shadow:!1,hwaccel:!0,className:"spinner",zIndex:2e9,top:"auto",left:"auto",position:"absolute"},events:{"click .close":"_closeInfowindow","touchstart .close":"_closeInfowindow","MSPointerDown .close":"_closeInfowindow",dragstart:"_checkOrigin",mousedown:"_checkOrigin",touchstart:"_checkOrigin",MSPointerDown:"_checkOrigin",dblclick:"_stopPropagation",DOMMouseScroll:"_stopBubbling",MozMousePixelScroll:"_stopBubbling",mousewheel:"_stopBubbling",dbclick:"_stopPropagation",click:"_stopPropagation"},initialize:function(){var a=this;_.bindAll(this,"render","setLatLng","_setTemplate","_updatePosition","_update","toggle","show","hide"),this.mapView=this.options.mapView,this.options.template&&this.model.set("template",this.options.template),this.model.get("template")?this._compileTemplate():this._setTemplate(),this.model.bind("change:content",this.render,this),this.model.bind("change:template_name",this._setTemplate,this),this.model.bind("change:latlng",this._update,this),this.model.bind("change:visibility",this.toggle,this),this.model.bind("change:template",this._compileTemplate,this),this.model.bind("change:alternative_names",this.render,this),this.model.bind("change:width",this.render,this),this.model.bind("change:maxHeight",this.render,this),this.mapView.map.bind("change",this._updatePosition,this),this.mapView.bind("zoomstart",function(){a.hide(!0)}),this.mapView.bind("zoomend",function(){a.show(!0)}),this.add_related_model(this.mapView.map),this.$el.hide()},render:function(){if(this.template){var a=this.$(".cartodb-popup-content");a.length>0&&null!=a.data()&&a.data().jsp&&a.data().jsp.destroy();var b=_.map(this.model.attributes.content.fields,function(a){return _.clone(a)}),c=this.model.get("content")?this.model.get("content").data:{};if(this.model.get("template_name")){var d=_.clone(this.model.attributes.template_name);b=this._fieldsToString(b,d)}var e={};_.each(this.model.get("content").fields,function(a){e[a.title]=a.value});var f=_.extend({content:{fields:b,data:c}},e);this.$el.html(this.template(f)),this.model.get("width")&&this.$(".cartodb-popup").css("width",this.model.get("width")+"px"),this.$(".cartodb-popup .cartodb-popup-content").css("max-height",this.model.get("maxHeight")+"px");var g=this;setTimeout(function(){var a=g.$(".cartodb-popup-content").outerHeight();g.model.get("maxHeight")<=a&&g.$(".cartodb-popup-content").jScrollPane({maintainPosition:!1,verticalDragMinHeight:20})},1),this._checkLoading(),this._loadCover(),this.isLoadingData()||(this.model.trigger("domready",this,this.$el),this.trigger("domready",this,this.$el))}return this},_getModelTemplate:function(){return this.model.get("template_name")},_setTemplate:function(){this.model.get("template_name")&&(this.template=cdb.templates.getTemplate(this._getModelTemplate()),this.render())},_compileTemplate:function(){var a=this.model.get("template")?this.model.get("template"):cdb.templates.getTemplate(this._getModelTemplate());this.template="function"!=typeof a?new cdb.core.Template({template:a,type:this.model.get("template_type")||"mustache"}).asFunction():a,this.render()},_checkOrigin:function(a){var b=$(a.target).closest(".jspVerticalBar").length>0&&"touchstart"!=a.type;b||a.stopPropagation()},_fieldsToString:function(a,b){var c=[];if(a&&a.length>0){var d=this;c=_.map(a,function(a,c){return d._sanitizeField(a,b,a.index||c)})}return c},_sanitizeField:function(a,b,c){(null==a.value||void 0==a.value)&&(a.value="");var d=this.model.getAlternativeName(a.title);a.title&&d?a.title=d:a.title&&(a.title=a.title.replace(/_/g," "));var e=a.value.toString();return!a.type&&0==c&&a.value.length>35&&b&&-1!=b.search("_header_")&&(e=a.value.substr(0,32)+"..."),!a.type&&1==c&&a.value.length>35&&b&&-1!=b.search("_header_with_image")&&(e=a.value.substr(0,32)+"..."),this._isValidURL(a.value)&&(e="<a href='"+a.value+"' target='_blank'>"+e+"</a>"),0==c&&-1!=b.search("_header_with_image")&&(e=a.value),a.value=e,a},isLoadingData:function(){var a=this.model.get("content");return a.fields&&1==a.fields.length&&"loading"===a.fields[0].type},_checkLoading:function(){this.isLoadingData()?this._startSpinner():this._stopSpinner()},_stopSpinner:function(){this.spinner&&this.spinner.stop()},_startSpinner:function(a){this._stopSpinner();var a=this.$el.find(".loading");if(a){var b=-1!=this.model.get("template_name").search("dark");this.spin_options.color=b?"#FFF":"rgba(0,0,0,0.5)",this.spinner=new Spinner(this.spin_options).spin(),a.append(this.spinner.el)}},_containsCover:function(){return this.$el.find(".cartodb-popup.header").attr("data-cover")?!0:!1},_getCoverURL:function(){var a=this.model.get("content");return a&&a.fields&&a.fields.length>0?(a.fields[0].value||"").toString():!1},_loadCover:function(){if(this._containsCover()){var a=this.$(".cover"),b=this.$(".shadow"),c=this._getCoverURL();if(!this._isValidURL(c))return b.hide(),void cdb.log.info("Header image url not valid");var d=document.getElementById("spinner"),e={lines:9,length:4,width:2,radius:4,corners:1,rotate:0,color:"#ccc",speed:1,trail:60,shadow:!0,hwaccel:!1,zIndex:2e9},f=new Spinner(e).spin(d),g=a.find("img");g.hide(function(){this.remove()}),g=$("<img />").attr("src",c),a.append(g),g.load(function(){f.stop();var b=g.width(),c=g.height(),d=a.width(),e=a.height(),h=c/b,i=e/d;if(b>d&&c>e)if(i>h)g.css({height:e});else{var j=c/(b/d);g.css({width:d,top:"50%",position:"absolute","margin-top":-1*parseInt(j,10)/2})}else{var j=c/(b/d);g.css({width:d,top:"50%",position:"absolute","margin-top":-1*parseInt(j,10)/2})}g.fadeIn(300)}).error(function(){f.stop()})}},_isValidURL:function(a){if(a){var b=/^(http|ftp|https):\/\/[\w-]+(\.[\w-]+)+([\w.,@?^=%&amp;:\/~+#-|]*[\w@?^=%&amp;\/~+#-])?$/;return null!=String(a).match(b)?!0:!1}return!1},toggle:function(){this.model.get("visibility")?this.show():this.hide()},_stopBubbling:function(a){a.preventDefault(),a.stopPropagation()},_stopPropagation:function(a){a.stopPropagation()},setLoading:function(){return this.model.set({content:{fields:[{title:null,alternative_name:null,value:"Loading content...",index:null,type:"loading"}],data:{}}}),this},setError:function(){return this.model.set({content:{fields:[{title:null,alternative_name:null,value:"There has been an error...",index:null,type:"error"}],data:{}}}),this},setLatLng:function(a){return this.model.set("latlng",a),this},_closeInfowindow:function(a){a&&(a.preventDefault(),a.stopPropagation()),this.model.get("visibility")&&(this.model.set("visibility",!1),this.trigger("close"))},showInfowindow:function(){this.model.set("visibility",!0)},show:function(a){var b=this;this.model.get("visibility")&&(b.$el.css({left:-5e3}),b._update(a))},isHidden:function(){return!this.model.get("visibility")},hide:function(a){(a||!this.model.get("visibility"))&&this._animateOut()},_update:function(a){if(!this.isHidden()){var b=0;if(!a)var b=this.adjustPan();this._updatePosition(),this._animateIn(b)}},_animateIn:function(a){!$.browser.msie||$.browser.msie&&parseInt($.browser.version)>8?(this.$el.css({marginBottom:"-10px",display:"block",opacity:0}),this.$el.delay(a).animate({opacity:1,marginBottom:0},300)):this.$el.show()},_animateOut:function(){if(!$.browser.msie||$.browser.msie&&parseInt($.browser.version)>8){var a=this;this.$el.animate({marginBottom:"-10px",opacity:"0",display:"block"},180,function(){a.$el.css({display:"none"})})}else this.$el.hide()},_updatePosition:function(){if(!this.isHidden()){var a=this.model.get("offset");pos=this.mapView.latLonToPixel(this.model.get("latlng")),x=this.$el.position().left,y=this.$el.position().top,containerHeight=this.$el.outerHeight(!0),containerWidth=this.$el.width(),left=pos.x-a[0],size=this.mapView.getSize(),bottom=-1*(pos.y-a[1]-size.y),this.$el.css({bottom:bottom,left:left})}},adjustPan:function(){var a=this.model.get("offset");if(this.model.get("autoPan")&&!this.isHidden()){var b=(this.$el.position().left,this.$el.position().top,this.$el.outerHeight(!0)+15),c=this.$el.width(),d=this.mapView.latLonToPixel(this.model.get("latlng")),e={x:0,y:0};return size=this.mapView.getSize(),wait_callback=0,d.x-a[0]<0&&(e.x=d.x-a[0]-10),d.x-a[0]+c>size.x&&(e.x=d.x+c-size.x-a[0]+10),d.y-b<0&&(e.y=d.y-b-10),d.y-b>size.y&&(e.y=d.y+b-size.y),(e.x||e.y)&&(this.mapView.panBy(e),wait_callback=300),wait_callback}}}),cdb.geo.ui.LayerSelector=cdb.core.View.extend({className:"cartodb-layer-selector-box",events:{click:"_openDropdown",dblclick:"killEvent",mousedown:"killEvent"},initialize:function(){this.map=this.options.mapView.map,this.mapView=this.options.mapView,this.mapView.bind("click zoomstart drag",function(){this.dropdown&&this.dropdown.hide()},this),this.add_related_model(this.mapView),this.layers=[]},render:function(){return this.$el.html(this.options.template(this.options)),this.dropdown=new cdb.ui.common.Dropdown({className:"cartodb-dropdown border",template:this.options.dropdown_template,target:this.$el.find("a"),speedIn:300,speedOut:200,position:"position",tick:"right",vertical_position:"down",horizontal_position:"right",vertical_offset:7,horizontal_offset:13}),cdb.god&&cdb.god.bind("closeDialogs",this.dropdown.hide,this.dropdown),this.$el.append(this.dropdown.render().el),this._getLayers(),this._setCount(),this},_getLayers:function(){var a=this;this.layers=[],_.each(this.map.layers.models,function(b){if("layergroup"==b.get("type")||"namedmap"===b.get("type"))for(var c=a.mapView.getLayerByCid(b.cid),d=0;d<c.getLayerCount();++d){var e=c.getLayer(d),f=new cdb.core.Model(e);f.set("order",d),f.set("type","layergroup"),f.set("visible",!c.getSubLayer(d).get("hidden")),f.bind("change:visible",function(a){this.trigger("change:visible",a.get("visible"),a.get("order"),a)},a),a.options.layer_names?f.set("layer_name",a.options.layer_names[d]):f.set("layer_name",e.options.layer_name);var g=a._createLayer("LayerViewFromLayerGroup",{model:f,layerView:c,layerIndex:d});g.bind("switchChanged",a._setCount,a),a.layers.push(g)}else if("CartoDB"===b.get("type")||"torque"===b.get("type")){var g=a._createLayer("LayerView",{model:b});g.bind("switchChanged",a._setCount,a),a.layers.push(g),g.model.bind("change:visible",function(a){this.trigger("change:visible",a.get("visible"),a.get("order"),a)},a)}})},_createLayer:function(a,b){var c=new cdb.geo.ui[a](b);return this.$("ul").append(c.render().el),this.addView(c),c},_setCount:function(){for(var a=0,b=0,c=this.layers.length;c>b;++b){var d=this.layers[b];d.model.get("visible")&&a++}this.$(".count").text(a),this.trigger("switchChanged",this)},_openDropdown:function(){this.dropdown.open()}}),cdb.geo.ui.LayerView=cdb.core.View.extend({tagName:"li",defaults:{template:'      <a class="layer" href="#/change-layer"><%= layer_name %></a>      <a href="#switch" class="right <%= visible ? "enabled" : "disabled" %> switch"><span class="handle"></span></a>    '},events:{click:"_onSwitchClick"},initialize:function(){this.model.has("visible")||this.model.set("visible",!1),this.model.bind("change:visible",this._onSwitchSelected,this),this.add_related_model(this.model),this._onSwitchSelected(),this.template=this.options.template?cdb.templates.getTemplate(this.options.template):_.template(this.defaults.template)},render:function(){var a=_.clone(this.model.attributes);return a.layer_name=a.layer_name||a.table_name,this.$el.append(this.template(a)),this},_onSwitchSelected:function(){var a=this.model.get("visible");this.$el.find(".switch").removeClass(a?"disabled":"enabled").addClass(a?"enabled":"disabled"),this.trigger("switchChanged")},_onSwitchClick:function(a){this.killEvent(a),this.model.set("visible",!this.model.get("visible"))}}),cdb.geo.ui.LayerViewFromLayerGroup=cdb.geo.ui.LayerView.extend({_onSwitchSelected:function(){cdb.geo.ui.LayerView.prototype._onSwitchSelected.call(this);var a=this.options.layerView.getSubLayer(this.options.layerIndex),b=this.model.get("visible");b?a.show():a.hide()}}),cdb.geo.ui.LegendItemModel=cdb.core.Model.extend({defaults:{name:"Untitled",visible:!0,value:""}}),cdb.geo.ui.LegendItems=Backbone.Collection.extend({model:cdb.geo.ui.LegendItemModel}),cdb.geo.ui.LegendItem=cdb.core.View.extend({tagName:"li",initialize:function(){_.bindAll(this,"render"),this.template=this.options.template?_.template(this.options.template):cdb.templates.getTemplate("geo/legend")},render:function(){var a;a="image"==this.model.get("type")&&this.model.get("value")?"url( "+this.model.get("value")+")":this.model.get("value");var b=_.extend(this.model.toJSON(),{value:a});return this.$el.html(this.template(b)),this.$el}}),cdb.geo.ui.Legend=cdb.core.View.extend({className:"cartodb-legend",events:{dragstart:"_stopPropagation",mousedown:"_stopPropagation",touchstart:"_stopPropagation",MSPointerDown:"_stopPropagation",dblclick:"_stopPropagation",mousewheel:"_stopPropagation",DOMMouseScroll:"_stopPropagation",dbclick:"_stopPropagation",click:"_stopPropagation"},initialize:function(){_.bindAll(this,"render","show","hide"),_.defaults(this.options,this.default_options),this.map=this.options.map,this._setupModel(),this._setupItems(),this._updateLegendType()},_stopPropagation:function(a){a.stopPropagation()},_setupModel:function(){this.model||(this.model=new cdb.geo.ui.LegendModel({type:this.options.type||cdb.geo.ui.LegendModel.prototype.defaults.type,title:this.options.title||cdb.geo.ui.LegendModel.prototype.defaults.title,show_title:this.options.show_title||cdb.geo.ui.LegendModel.prototype.defaults.show_title,template:this.options.template||cdb.geo.ui.LegendModel.prototype.defaults.template})),this.add_related_model(this.model),this.model.bind("change",this._updateLegendType,this)},_updateLegendType:function(){var a=this.model.get("type");if(this.legend_name=this._capitalize(a)+"Legend","none"==a||null==a)this.legend_name=null,this.model.set({type:"none"},{silent:!0});else if(!cdb.geo.ui[this.legend_name])return this.legend_name=null,void this.model.set({type:this.model.previous("type")},{silent:!0});this._refresh()},_refresh:function(){this.view&&this.view.clean();{var a=this.model.get("type");this.model.get("title"),this.model.get("show_title"),this.model.get("template")}a&&this.legend_name?(this.view=new cdb.geo.ui[this.legend_name]({model:this.model}),this.$el.removeClass(),this.$el.addClass(this.className+" "+this.model.get("type")),this.show()):(this.hide(),this.$el.removeClass(),this.$el.addClass(this.className+" none")),this.render()},_setupItems:function(){this.items=this.model.items,this.options.data&&this.items.reset(this.options.data),this.items.bind("add remove change:value change:name",this.render,this)},show:function(){var a=this.model.get("type");a&&"none"!=a&&this.$el.show()},hide:function(){this.model.get("type")&&this.$el.hide()},_capitalize:function(a){return a&&_.isString(a)?a.charAt(0).toUpperCase()+a.slice(1):void 0},render:function(){return this.view&&(this.model.get("template")?(this.$el.html(this.view.render().$el.html()),this.$el.removeClass(this.model.get("type")),this.$el.addClass("wrapper")):this.$el.html(this.view.render().$el.html())),this}}),cdb.geo.ui.DebugLegend=cdb.core.View.extend({}),cdb.geo.ui.BaseLegend=cdb.core.View.extend({_bindModel:function(){this.model.bind("change:template change:title change:show_title",this.render,this)},addTo:function(a){$(a).html(this.render().$el)},setTitle:function(a){this.model.set("title",a)},showTitle:function(){this.model.set("show_title",!0)},hideTitle:function(){this.model.set("show_title",!1)}}),cdb.geo.ui.NoneLegend=cdb.geo.ui.BaseLegend.extend({}),cdb.geo.ui.Legend.None=cdb.core.View.extend({}),cdb.geo.ui.ChoroplethLegend=cdb.geo.ui.BaseLegend.extend({className:"choropleth-legend",template:_.template('<% if (title && show_title) { %>\n<div class="legend-title"><%= title %></div><% } %><ul><li class="min">		<%= leftLabel %></li><li class="max">		<%= rightLabel %></li><li class="graph count_<%= buckets_count %>">	<div class="colors"><%= colors %>\n	</div></li></ul>'),initialize:function(){this.items=this.model.items},_generateColorList:function(){var a="";if(this.model.get("colors"))return _.map(this.model.get("colors"),function(a){return'\n	<div class="quartile" style="background-color:'+a+'"></div>'}).join("");for(var b=2;b<this.items.length;b++){var c=this.items.at(b).get("value");a+='\n	<div class="quartile" style="background-color:'+c+'"></div>'}return a},setLeftLabel:function(a){this.model.set("leftLabel",a)},setRightLabel:function(a){this.model.set("rightLabel",a)},setColors:function(a){this.model.set("colors",a)},render:function(){if(this.model.get("template")){var a=_.template(this.model.get("template"));this.$el.html(a(this.model.toJSON()))}else if(this.items.length>=2){this.leftLabel=this.items.at(0),this.rightLabel=this.items.at(1);var b=this.model.get("leftLabel")||this.leftLabel.get("value"),c=this.model.get("rightLabel")||this.rightLabel.get("value"),d=this._generateColorList(),e=_.extend(this.model.toJSON(),{leftLabel:b,rightLabel:c,colors:d,buckets_count:d.length});this.$el.html(this.template(e))}return this}}),cdb.geo.ui.DensityLegend=cdb.geo.ui.BaseLegend.extend({className:"density-legend",template:_.template('<% if (title && show_title) { %>\n<div class="legend-title"><%= title %></div><% } %><ul><li class="min">	<%= leftLabel %></li><li class="max">	<%= rightLabel %></li><li class="graph count_<%= buckets_count %>">	<div class="colors"><%= colors %>\n	</div></li></ul>'),initialize:function(){this.items=this.model.items},setLeftLabel:function(a){this.model.set("leftLabel",a)},setRightLabel:function(a){this.model.set("rightLabel",a)},setColors:function(a){this.model.set("colors",a)},_generateColorList:function(){var a="";if(this.model.get("colors"))return _.map(this.model.get("colors"),function(a){return'\n		<div class="quartile" style="background-color:'+a+'"></div>'
}).join("");for(var b=2;b<this.items.length;b++){var c=this.items.at(b).get("value");a+='\n		<div class="quartile" style="background-color:'+c+'"></div>'}return a},render:function(){if(this.model.get("template")){var a=_.template(this.model.get("template"));this.$el.html(a(this.model.toJSON()))}else if(this.items.length>=2){this.leftLabel=this.items.at(0),this.rightLabel=this.items.at(1);var b=this.model.get("leftLabel")||this.leftLabel.get("value"),c=this.model.get("rightLabel")||this.rightLabel.get("value"),d=this._generateColorList(),e=_.extend(this.model.toJSON(),{leftLabel:b,rightLabel:c,colors:d,buckets_count:d.length});this.$el.html(this.template(e))}return this}}),cdb.geo.ui.Legend.Density=cdb.geo.ui.DensityLegend.extend({type:"density",className:"cartodb-legend density",initialize:function(){this.items=this.options.items,this.model=new cdb.geo.ui.LegendModel({type:this.type,title:this.options.title,show_title:this.options.title?!0:!1,leftLabel:this.options.left||this.options.leftLabel,rightLabel:this.options.right||this.options.rightLabel,colors:this.options.colors,buckets_count:this.options.colors?this.options.colors.length:0,items:this.options.items}),this._bindModel()},_bindModel:function(){this.model.bind("change:colors change:template change:title change:show_title change:colors change:leftLabel change:rightLabel",this.render,this)},_generateColorList:function(){return _.map(this.model.get("colors"),function(a){return'<div class="quartile" style="background-color:'+a+'"></div>'}).join("")},render:function(){var a=_.extend(this.model.toJSON(),{colors:this._generateColorList()});return this.$el.html(this.template(a)),this}}),cdb.geo.ui.IntensityLegend=cdb.geo.ui.BaseLegend.extend({className:"intensity-legend",template:_.template('<% if (title && show_title) { %>\n<div class="legend-title"><%= title %></div><% } %><ul><li class="min">	<%= leftLabel %></li><li class="max">	<%= rightLabel %></li><li class="graph"></li></ul>'),initialize:function(){this.items=this.model.items},_bindModel:function(){this.model.bind("change:template",this.render,this)},setColor:function(a){this.model.set("color",a)},setLeftLabel:function(a){this.model.set("leftLabel",a)},setRightLabel:function(a){this.model.set("rightLabel",a)},_hexToRGB:function(a){var b=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);return b?{r:parseInt(b[1],16),g:parseInt(b[2],16),b:parseInt(b[3],16)}:null},_rgbToHex:function(a,b,c){function d(a){var b=a.toString(16);return 1==b.length?"0"+b:b}return"#"+d(a)+d(b)+d(c)},_calculateMultiply:function(a,b){var c=this._hexToRGB(a);if(c){for(var d=c.r,e=c.g,f=c.b,g=0;b>=g;g++)d=Math.round(d*c.r/255),e=Math.round(e*c.g/255),f=Math.round(f*c.b/255);return this._rgbToHex(d,e,f)}return"#ffffff"},_renderGraph:function(a){var b="";b+="background: <%= color %>;",b+="background: -moz-linear-gradient(left, <%= color %> 0%, <%= right %> 100%);",b+="background: -webkit-gradient(linear, left top, right top, color-stop(0%,<%= color %>), color-stop(100%,<%= right %>));",b+="background: -webkit-linear-gradient(left, <%= color %> 0%,<%= right %> 100%);",b+="background: -o-linear-gradient(left, <%= color %> 0%,<%= right %> 100%);",b+="background: -ms-linear-gradient(left, <%= color %> 0%,<%= right %> 100%)",b+="background: linear-gradient(to right, <%= color %> 0%,<%= right %> 100%);",b+="filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='<%= color %>', endColorstr='<%= right %>',GradientType=1 );",b+="background-image: -ms-linear-gradient(left, <%= color %> 0%,<%= right %> 100%)";var c=_.template(b),d=this._calculateMultiply(a,4);this.$el.find(".graph").attr("style",c({color:a,right:d}))},render:function(){if(this.model.get("template")){var a=_.template(this.model.get("template"));this.$el.html(a(this.model.toJSON()))}else if(this.items.length>=3){this.leftLabel=this.items.at(0),this.rightLabel=this.items.at(1);var b=this.model.get("color")||this.items.at(2).get("value"),c=this.model.get("leftLabel")||this.leftLabel.get("value"),d=this.model.get("rightLabel")||this.rightLabel.get("value"),e=_.extend(this.model.toJSON(),{color:b,leftLabel:c,rightLabel:d});this.$el.html(this.template(e)),this._renderGraph(b)}return this}}),cdb.geo.ui.CategoryLegend=cdb.geo.ui.BaseLegend.extend({className:"category-legend",template:_.template('<% if (title && show_title) { %>\n<div class="legend-title"><%= title %></div><% } %><ul></ul>'),initialize:function(){this.items=this.model.items},_bindModel:function(){this.model.bind("change:title change:show_title change:template",this.render,this)},_renderItems:function(){this.items.each(this._renderItem,this)},_renderItem:function(a){view=new cdb.geo.ui.LegendItem({model:a,className:a.get("value")&&a.get("value").indexOf("http")>=0||a.get("type")&&"image"==a.get("type")?"bkg":"",template:'		<div class="bullet" style="background: <%= value %>"></div> <%= name || ((name === false) ? "false": "null") %>'}),this.$el.find("ul").append(view.render())},render:function(){if(this.model.get("template")){var a=_.template(this.model.get("template"));this.$el.html(a(this.model.toJSON()))}else this.$el.html(this.template(this.model.toJSON())),this.items.length>0?this._renderItems():this.$el.html('<div class="warning">The category legend is empty</div>');return this}}),cdb.geo.ui.Legend.Category=cdb.geo.ui.CategoryLegend.extend({className:"cartodb-legend category",type:"category",initialize:function(){this.items=new cdb.geo.ui.LegendItems(this.options.data),this.model=new cdb.geo.ui.LegendModel({type:this.type,title:this.options.title,show_title:this.options.title?!0:!1}),this._bindModel()},render:function(){return this.$el.html(this.template(this.model.toJSON())),this._renderItems(),this}}),cdb.geo.ui.ColorLegend=cdb.geo.ui.BaseLegend.extend({className:"color-legend",type:"color",template:_.template('<% if (title && show_title) { %>\n<div class="legend-title"><%= title %></div><% } %><ul></ul>'),initialize:function(){this.items=this.model.items},_renderItems:function(){this.items.each(this._renderItem,this)},_renderItem:function(a){view=new cdb.geo.ui.LegendItem({model:a,className:a.get("value")&&a.get("value").indexOf("http")>=0?"bkg":"",template:'		<div class="bullet" style="background: <%= value %>"></div> <%= name || ((name === false) ? "false": "null") %>'}),this.$el.find("ul").append(view.render())},render:function(){return this.$el.html(this.template(this.model.toJSON())),this.items.length>0?this._renderItems():this.$el.html('<div class="warning">The color legend is empty</div>'),this}}),cdb.geo.ui.Legend.Color=cdb.geo.ui.Legend.Category.extend({}),cdb.geo.ui.StackedLegend=cdb.core.View.extend({events:{dragstart:"_stopPropagation",mousedown:"_stopPropagation",touchstart:"_stopPropagation",MSPointerDown:"_stopPropagation",dblclick:"_stopPropagation",mousewheel:"_stopPropagation",DOMMouseScroll:"_stopPropagation",dbclick:"_stopPropagation",click:"_stopPropagation"},className:"cartodb-legend-stack",initialize:function(){_.each(this.options.legends,this._setupBinding,this)},_stopPropagation:function(a){a.stopPropagation()},getLegendByIndex:function(a){if(!this._layerByIndex){this._layerByIndex={};for(var b=this.options.legends,c=0;c<b.length;++c){var d=b[c];this._layerByIndex[d.options.index]=d}}return this._layerByIndex[a]},_setupBinding:function(a){a.model.bind("change:type",this._checkVisibility,this),this.add_related_model(a.model)},_checkVisibility:function(){var a=_.some(this.options.legends,function(a){return a.model.get("type")&&("none"!=a.model.get("type")||a.model.get("template"))},this);a?this.show():this.hide(),_.each(this.options.legends,function(a){var b=a.model.get("type");b&&"none"!=b?a.show():a.hide()},this)},_renderItems:function(){_.each(this.options.legends,function(a){this.$el.append(a.render().$el)},this)},show:function(){this.$el.show()},hide:function(){this.$el.hide()},addTo:function(a){$(a).html(this.render().$el)},render:function(){return this._renderItems(),this._checkVisibility(),this}}),cdb.geo.ui.Legends=Backbone.Collection.extend({model:cdb.geo.ui.LegendModel}),cdb.geo.ui.Legend.Stacked=cdb.geo.ui.StackedLegend.extend({initialize:function(){if(this.options.legends){var a=_.map(this.options.legends,function(a){return a.model});this.legendItems=new cdb.geo.ui.Legends(a),this.legendItems.bind("add remove change",this.render,this)}else if(this.options.data){var a=_.map(this.options.data,function(a){return new cdb.geo.ui.LegendModel(a)});this.legendItems=new cdb.geo.ui.Legends(a),this.legendItems.bind("add remove change",this.render,this)}},_capitalize:function(a){return a&&_.isString(a)?a.charAt(0).toUpperCase()+a.slice(1):void 0},render:function(){return this.$el.empty(),this.legends=[],this.legendItems&&this.legendItems.length>0&&this.legendItems.each(this._renderLegend,this),this},_renderLegend:function(a){var b=a.get("type");b||(b="custom"),b=this._capitalize(b);var c=new cdb.geo.ui.Legend[b](a.attributes);this.legends.push(c),a.get("visible")!==!1&&this.$el.append(c.render().$el)},getLegendAt:function(a){return this.legends[a]},addLegend:function(a){var b=new cdb.geo.ui.LegendModel(a);this.legendItems.push(b)},removeLegendAt:function(a){var b=this.legendItems.at(a);this.legendItems.remove(b)}}),cdb.geo.ui.LegendModel=cdb.core.Model.extend({defaults:{type:null,show_title:!1,title:"",template:""},initialize:function(){this.items=new cdb.geo.ui.LegendItems(this.get("items")),this.items.bind("add remove reset change",function(){this.set({items:this.items.toJSON()})},this),this.bind("change:items",this._onUpdateItems,this),this.bind("change:title change:show_title",this._onUpdateTitle,this),this.bind("change:template",this._onUpdateTemplate,this)},_onUpdateTemplate:function(){this.template=this.get("template")},_onUpdateTitle:function(){this.title=this.get("title"),this.show_title=this.get("show_title")},_onUpdateItems:function(){var a=this.get("items");this.items.reset(a)}}),cdb.geo.ui.CustomLegend=cdb.geo.ui.BaseLegend.extend({className:"custom-legend",type:"custom",template:_.template('<% if (title && show_title) { %>\n<div class="legend-title"><%= title %></div><% } %><ul></ul>'),initialize:function(){this.items=this.model.items},setData:function(a){this.items=new cdb.geo.ui.LegendItems(a),this.model.items=this.items,this.model.set("items",a)},_renderItems:function(){this.items.each(this._renderItem,this)},_renderItem:function(a){view=new cdb.geo.ui.LegendItem({model:a,className:a.get("value")&&a.get("value").indexOf("http")>=0?"bkg":"",template:'		<div class="bullet" style="background:<%= value %>"></div>\n		<%= name || "null" %>'}),this.$el.find("ul").append(view.render())},render:function(){if(this.model.get("template")){var a=_.template(this.model.get("template"));this.$el.html(a(this.model.toJSON()))}else this.$el.html(this.template(this.model.toJSON())),this.items.length>0?this._renderItems():this.$el.html('<div class="warning">The legend is empty</div>');return this}}),cdb.geo.ui.Legend.Custom=cdb.geo.ui.CustomLegend.extend({className:"cartodb-legend custom",type:"custom",initialize:function(){this.items=new cdb.geo.ui.LegendItems(this.options.data||this.options.items),this.model=new cdb.geo.ui.LegendModel({type:this.type,title:this.options.title,show_title:this.options.title?!0:!1,items:this.items.models}),this._bindModel()},_bindModel:function(){this.model.bind("change:items change:template change:title change:show_title",this.render,this)}}),cdb.geo.ui.BubbleLegend=cdb.geo.ui.BaseLegend.extend({className:"bubble-legend",template:_.template('<% if (title && show_title) { %>\n<div class="legend-title"><%= title %></div><% } %><ul><li>	<%= min %></li><li class="graph">		<div class="bubbles"></div></li><li>	<%= max %></li></ul>'),initialize:function(){this.items=this.model.items},_bindModel:function(){this.model.bind("change:template change:title change:show_title change:color change:min change:max",this.render,this)},setColor:function(a){this.model.set("color",a)},setMinValue:function(a){this.model.set("min",a)},setMaxValue:function(a){this.model.set("max",a)},_renderGraph:function(a){this.$el.find(".graph").css("background",a)},render:function(){if(this.model.get("template")){var a=_.template(this.model.get("template"));this.$el.html(a(this.model.toJSON())),this.$el.removeClass("bubble-legend")}else{var b=this.model.get("color")||(this.items.length>=3?this.items.at(2).get("value"):"");if(this.items.length>=3){var c=this.model.get("min")||this.items.at(0).get("value"),d=this.model.get("max")||this.items.at(1).get("value"),e=_.extend(this.model.toJSON(),{min:c,max:d});this.$el.html(this.template(e))}this._renderGraph(b)}return this}}),cdb.geo.ui.Legend.Bubble=cdb.geo.ui.BubbleLegend.extend({className:"cartodb-legend bubble",type:"bubble",initialize:function(){this.model=new cdb.geo.ui.LegendModel({type:this.type,title:this.options.title,min:this.options.min,max:this.options.max,color:this.options.color,show_title:this.options.title?!0:!1}),this.add_related_model(this.model),this._bindModel()},render:function(){return this.$el.html(this.template(this.model.toJSON())),this._renderGraph(this.model.get("color")),this}}),cdb.geo.ui.Legend.Choropleth=cdb.geo.ui.ChoroplethLegend.extend({type:"choropleth",className:"cartodb-legend choropleth",initialize:function(){this.items=this.options.items,this.model=new cdb.geo.ui.LegendModel({type:this.type,title:this.options.title,show_title:this.options.title?!0:!1,leftLabel:this.options.left||this.options.leftLabel,rightLabel:this.options.right||this.options.rightLabel,colors:this.options.colors,buckets_count:this.options.colors?this.options.colors.length:0}),this.add_related_model(this.model),this._bindModel()},_bindModel:function(){this.model.bind("change:template change:title change:show_title change:colors change:leftLabel change:rightLabel",this.render,this)},_generateColorList:function(){return _.map(this.model.get("colors"),function(a){return'		<div class="quartile" style="background-color:'+a+'"></div>'}).join("")},render:function(){var a=_.extend(this.model.toJSON(),{colors:this._generateColorList()});return this.$el.html(this.template(a)),this}}),cdb.geo.ui.Legend.Intensity=cdb.geo.ui.IntensityLegend.extend({className:"cartodb-legend intensity",type:"intensity",initialize:function(){this.items=this.options.items,this.model=new cdb.geo.ui.LegendModel({type:this.type,title:this.options.title,show_title:this.options.title?!0:!1,color:this.options.color,leftLabel:this.options.left||this.options.leftLabel,rightLabel:this.options.right||this.options.rightLabel}),this.add_related_model(this.model),this._bindModel()},_bindModel:function(){this.model.bind("change:title change:show_title change:color change:leftLabel change:rightLabel",this.render,this)},render:function(){return this.$el.html(this.template(this.model.toJSON())),this._renderGraph(this.model.get("color")),this}}),cdb.geo.ui.MobileLayer=cdb.core.View.extend({events:{"click h3":"_toggle",dblclick:"_stopPropagation"},tagName:"li",className:"cartodb-mobile-layer has-toggle",template:cdb.core.Template.compile("<% if (show_title) { %><h3><%= layer_name %><% } %><a href='#' class='toggle<%= toggle_class %>'></a></h3>"),_stopPropagation:function(a){a.stopPropagation()},initialize:function(){_.defaults(this.options,this.default_options),this.model.bind("change:visible",this._onChangeVisible,this)},_onChangeVisible:function(){this.$el.find(".legend")[this.model.get("visible")?"fadeIn":"fadeOut"](150),this.$el[this.model.get("visible")?"removeClass":"addClass"]("hidden"),this.trigger("change_visibility",this)},_toggle:function(a){a.preventDefault(),a.stopPropagation(),this.options.hide_toggle||this.model.set("visible",!this.model.get("visible"))},_renderLegend:function(){if(this.options.show_legends&&!(this.model.get("legend")&&("none"==this.model.get("legend").type||!this.model.get("legend").type)||this.model.get("legend")&&this.model.get("legend").items&&0==this.model.get("legend").items.length)){this.$el.addClass("has-legend");var a=new cdb.geo.ui.Legend(this.model.get("legend"));a.undelegateEvents(),this.$el.append(a.render().$el)}},_truncate:function(a,b){return a.substr(0,b-1)+(a.length>b?"&hellip;":"")},render:function(){var a=this.model.get("layer_name");a=a?this._truncate(a,23):"untitled";var b=_.extend(this.model.attributes,{layer_name:this.options.show_title?a:"",toggle_class:this.options.hide_toggle?" hide":""});return this.$el.html(this.template(_.extend(b,{show_title:this.options.show_title}))),this.options.hide_toggle&&this.$el.removeClass("has-toggle"),this.model.get("visible")||this.$el.addClass("hidden"),this.model.get("legend")&&this._renderLegend(),this._onChangeVisible(),this}}),cdb.geo.ui.Mobile=cdb.core.View.extend({className:"cartodb-mobile",events:{"click .cartodb-attribution-button":"_onAttributionClick","click .toggle":"_toggle","click .fullscreen":"_toggleFullScreen","click .backdrop":"_onBackdropClick","dblclick .aside":"_stopPropagation","dragstart .aside":"_checkOrigin","mousedown .aside":"_checkOrigin","touchstart .aside":"_checkOrigin","MSPointerDown .aside":"_checkOrigin"},initialize:function(){_.bindAll(this,"_toggle","_reInitScrollpane"),_.defaults(this.options,this.default_options),this.hasLayerSelector=!1,this.mobileEnabled=/Android|webOS|iPhone|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),this.visibility_options=this.options.visibility_options||{},this.mapView=this.options.mapView,this.map=this.mapView.map,this.template=this.options.template?this.options.template:cdb.templates.getTemplate("geo/zoom"),this.overlays=this.options.overlays,this._setupModel(),window.addEventListener("orientationchange",_.bind(this.doOnOrientationChange,this)),this._addWheelEvent()},_addWheelEvent:function(){var a=this.options.mapView;$(document).on("webkitfullscreenchange mozfullscreenchange fullscreenchange",function(){document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||a.options.map.set("scrollwheel",!1),a.invalidateSize()})},_setupModel:function(){this.model=new Backbone.Model({open:!1,layer_count:0}),this.model.on("change:open",this._onChangeOpen,this),this.model.on("change:layer_count",this._onChangeLayerCount,this)},_checkOrigin:function(a){var b=$(a.target).closest(".jspVerticalBar").length>0&&"touchstart"!=a.type;b||a.stopPropagation()},_stopPropagation:function(a){a.stopPropagation()},_onBackdropClick:function(a){a.preventDefault(),a.stopPropagation(),this.$el.find(".backdrop").fadeOut(250),this.$el.find(".cartodb-attribution").fadeOut(250)},_onAttributionClick:function(a){a.preventDefault(),a.stopPropagation(),this.$el.find(".backdrop").fadeIn(250),this.$el.find(".cartodb-attribution").fadeIn(250)},_toggle:function(a){a.preventDefault(),a.stopPropagation(),this.model.set("open",!this.model.get("open"))},_toggleFullScreen:function(a){a.stopPropagation(),a.preventDefault();var b=window.document,c=$("#map > div")[0],d=c.requestFullscreen||c.mozRequestFullScreen||c.webkitRequestFullScreen,e=b.exitFullscreen||b.mozCancelFullScreen||b.webkitExitFullscreen,f=this.options.mapView;b.fullscreenElement||b.mozFullScreenElement||b.webkitFullscreenElement?e.call(b):(d.call(c),f&&f.options.map.set("scrollwheel",!0))},_open:function(){var a=this.$el.find(".aside").width();this.$el.find(".cartodb-header").animate({right:a},200),this.$el.find(".aside").animate({right:0},200),this.$el.find(".cartodb-attribution-button").animate({right:a+parseInt(this.$el.find(".cartodb-attribution-button").css("right"))},200),this.$el.find(".cartodb-attribution").animate({right:a+parseInt(this.$el.find(".cartodb-attribution-button").css("right"))},200),this._initScrollPane()},_close:function(){this.$el.find(".cartodb-header").animate({right:0},200),this.$el.find(".aside").animate({right:-this.$el.find(".aside").width()},200),this.$el.find(".cartodb-attribution-button").animate({right:20},200),this.$el.find(".cartodb-attribution").animate({right:20},200)},default_options:{timeout:0,msg:""},_stopPropagation:function(a){a.stopPropagation()},doOnOrientationChange:function(){switch(window.orientation){case-90:case 90:this.recalc("landscape");break;default:this.recalc("portrait")}},recalc:function(){var a=$(".legends > div.cartodb-legend-stack").height();this.$el.hasClass("open")&&100>a&&!this.$el.hasClass("torque")?(this.$el.css("height",a),this.$el.find(".top-shadow").hide(),this.$el.find(".bottom-shadow").hide()):this.$el.hasClass("open")&&100>a&&this.$el.hasClass("legends")&&this.$el.hasClass("torque")&&(this.$el.css("height",a+$(".legends > div.torque").height()),this.$el.find(".top-shadow").hide(),this.$el.find(".bottom-shadow").hide())},_onChangeLayerCount:function(){var a=this.model.get("layer_count"),b=a+" layer"+(1!=a?"s":"");this.$el.find(".aside .layer-container > h3").html(b)},_onChangeOpen:function(){this.model.get("open")?this._open():this._close()},_createLayer:function(a,b){return new cdb.geo.ui[a](b)},_getLayers:function(){this.layers=[],this.options.layerView?this._getLayersFromLayerView():_.each(this.map.layers.models,this._getLayer,this)},_getLayersFromLayerView:function(){if(this.options.layerView&&"layergroup"==this.options.layerView.model.get("type"))this.layers=_.map(this.options.layerView.layers,function(b,c){var d=new cdb.core.Model(b);return d.set("order",c),d.set("type","layergroup"),d.set("visible",b.visible),d.set("layer_name",b.options.layer_name),a=this._createLayer("LayerViewFromLayerGroup",{model:d,layerView:this.options.layerView,layerIndex:c}),a.model},this);else if(this.options.layerView&&"torque"==this.options.layerView.model.get("type")){var a=this._createLayer("LayerView",{model:this.options.layerView.model});this.layers.push(a.model)}},_getLayer:function(a){if("layergroup"==a.get("type")||"namedmap"===a.get("type"))for(var b=this.mapView.getLayerByCid(a.cid),c=0;c<b.getLayerCount();++c){var d=b.getLayer(c),e=new cdb.core.Model(d);e.set("order",c),e.set("type","layergroup"),e.set("visible",d.visible),e.set("layer_name",d.options.layer_name),layerView=this._createLayer("LayerViewFromLayerGroup",{model:e,layerView:b,layerIndex:c}),this.layers.push(layerView.model)}else("CartoDB"===a.get("type")||"torque"===a.get("type"))&&("torque"===a.get("type")&&a.on("change:visible",this._toggleSlider,this),this.layers.push(a))},_toggleSlider:function(a){a.get("visible")?(this.$el.addClass("with-torque"),this.slider.show()):(this.$el.removeClass("with-torque"),this.slider.hide())},_reInitScrollpane:function(){this.$(".scrollpane").data("jsp")&&this.$(".scrollpane").data("jsp").reinitialise()},_bindOrientationChange:function(){var a=this,b=function(){$(".cartodb-mobile .scrollpane").css("max-height",a.$el.height()-30),$(".cartodb-mobile .scrollpane").data("jsp")&&$(".cartodb-mobile .scrollpane").data("jsp").reinitialise()};window.addEventListener?window.addEventListener("orientationchange",_.bind(b)):window.attachEvent("orientationchange",b,this)},_renderOverlays:function(){var a=!1,b=!1,c=!1;_.each(this.overlays,function(d){this.visibility_options.search||"search"!=d.type||this.visibility_options.search!==!1&&"false"!==this.visibility_options.search&&(this._addSearch(),a=!0),this.visibility_options.zoomControl||"zoom"!=d.type||"false"!==this.visibility_options.zoomControl&&(this._addZoom(),b=!0),"fullscreen"!=d.type||this.mobileEnabled||this._addFullscreen(),"header"==d.type&&this._addHeader(d),"layer_selector"==d.type&&(c=!0)},this);var d="true"===this.visibility_options.search||this.visibility_options.search===!0,e="true"===this.visibility_options.zoomControl||this.visibility_options.zoomControl===!0,f=this.visibility_options.layer_selector;!a&&d&&this._addSearch(),!b&&e&&this._addZoom(),(f||c&&void 0==f)&&(this.hasLayerSelector=!0)},_initScrollPane:function(){if(!this.$scrollpane){var a=this,b=this.$el.height();this.$scrollpane=this.$el.find(".scrollpane"),setTimeout(function(){a.$scrollpane.css("max-height",b-60),a.$scrollpane.jScrollPane({showArrows:!0})},500)}},_addZoom:function(){var a=cdb.core.Template.compile('    <a href="#zoom_in" class="zoom_in">+</a>    <a href="#zoom_out" class="zoom_out">-</a>    <div class="info"></div>',"mustache"),b=new cdb.geo.ui.Zoom({model:this.options.map,template:a});this.$el.append(b.render().$el),this.$el.addClass("with-zoom")},_addFullscreen:function(){0!=this.visibility_options.fullscreen&&(this.hasFullscreen=!0,this.$el.addClass("with-fullscreen"))},_addSearch:function(){this.hasSearch=!0;var a=cdb.core.Template.compile('      <form>      <span class="loader"></span>      <input type="text" class="text" placeholder="Search for places..." value="" />      <input type="submit" class="submit" value="" />      </form>      ',"mustache"),b=new cdb.geo.ui.Search({template:a,model:this.mapView.map});this.$el.find(".aside").prepend(b.render().$el),this.$el.find(".cartodb-searchbox").show(),this.$el.addClass("with-search")},_addHeader:function(a){this.hasHeader=!0,this.$header=this.$el.find(".cartodb-header");var b=_.template('<div class="hgroup"><% if (show_title) { %><div class="title"><%= title %></div><% } %><% if (show_description) { %><div class="description"><%= description %><% } %></div></div>'),c=a.options.extra,d=!1,e=!1,f=!1;if(c){(this.visibility_options.title||0!=this.visibility_options.title&&c.show_title)&&(d=!0,e=!0),(this.visibility_options.description||0!=this.visibility_options.description&&c.show_description)&&(d=!0,f=!0);var g=b({title:c.title,show_title:e,description:c.description,show_description:f});d&&(this.$el.addClass("with-header"),this.$header.find(".content").append(g))}},_addAttributions:function(){var a="";this.options.mapView.$el.find(".leaflet-control-attribution").hide(),this.options.layerView?(a=this.options.layerView.model.get("attribution"),this.$el.find(".cartodb-attribution").append(a)):this.options.map.get("attribution")&&(a=this.options.map.get("attribution"),_.each(a,function(a){{var b=$("<li></li>");b.html(a)}this.$el.find(".cartodb-attribution").append(b)},this)),a&&this.$el.find(".cartodb-attribution-button").fadeIn(250)},_renderLayers:function(){var a=this.visibility_options.legends,b=this.layers.filter(function(a){return a.get("legend")&&"none"!==a.get("legend").type}),c=b.length?!0:!1;(this.hasLayerSelector||a)&&(this.hasLayerSelector||c)&&0!=this.layers.length&&(1!=this.layers.length||c)&&(this.$el.addClass("with-layers"),this.model.set("layer_count",0),this.hasSearch||this.$el.find(".aside .layer-container").prepend("<h3></h3>"),_.each(this.layers,this._renderLayer,this))},_renderLayer:function(a){var b=a.get("legend")&&""!==a.get("legend").type&&"none"!==a.get("legend").type;if((this.hasLayerSelector||b)&&(this.hasLayerSelector||a.get("visible"))){var c=1==this.layers.length||!this.hasLayerSelector,d=!0;this.visibility_options&&void 0!==this.visibility_options.legends&&(d=this.visibility_options.legends);var e=new cdb.geo.ui.MobileLayer({model:a,show_legends:d,show_title:this.hasLayerSelector?!0:!1,hide_toggle:c});this.$el.find(".aside .layers").append(e.render().$el),e.bind("change_visibility",this._reInitScrollpane,this),this.model.set("layer_count",this.model.get("layer_count")+1)}},_renderTorque:function(){this.options.torqueLayer&&(this.hasTorque=!0,this.slider=new cdb.geo.ui.TimeSlider({type:"time_slider",layer:this.options.torqueLayer,map:this.options.map,pos_margin:0,position:"none",width:"auto"}),this.slider.bind("time_clicked",function(){this.slider.toggleTime()},this),this.$el.find(".torque").append(this.slider.render().$el),this.options.torqueLayer.hidden?this.slider.hide():this.$el.addClass("with-torque"))},render:function(){return this._bindOrientationChange(),this.$el.html(this.template(this.options)),this._renderOverlays(),this._addAttributions(),this.$header=this.$el.find(".cartodb-header"),this.$header.show(),this._getLayers(),this._renderLayers(),this._renderTorque(),this}}),cdb.geo.ui.Search=cdb.core.View.extend({className:"cartodb-searchbox",events:{"click input[type='text']":"_focus","submit form":"_submit",click:"_stopPropagation",dblclick:"_stopPropagation",mousedown:"_stopPropagation"},initialize:function(){},render:function(){return this.$el.html(this.options.template(this.options)),this},_stopPropagation:function(a){a.stopPropagation()},_focus:function(a){a.preventDefault(),$(a.target).focus()},_showLoader:function(){this.$("span.loader").show()},_hideLoader:function(){this.$("span.loader").hide()},_submit:function(a){a.preventDefault();var b=this,c=this.$("input.text").val();this._showLoader(),cdb.geo.geocoder.NOKIA.geocode(c,function(a){if(a.length>0){var c=!0;a[0].boundingbox&&a[0].boundingbox.south!=a[0].boundingbox.north&&a[0].boundingbox.east!=a[0].boundingbox.west||(c=!1),c&&a[0].boundingbox?b.model.setBounds([[parseFloat(a[0].boundingbox.south),parseFloat(a[0].boundingbox.west)],[parseFloat(a[0].boundingbox.north),parseFloat(a[0].boundingbox.east)]]):a[0].lat&&a[0].lon&&(b.model.setCenter([a[0].lat,a[0].lon]),b.model.setZoom(10))}b._hideLoader()})}}),cdb.geo.ui.Share=cdb.core.View.extend({className:"cartodb-share",events:{"click a":"_onClick"},default_options:{},initialize:function(){_.bindAll(this,"_onClick"),_.defaults(this.options,this.default_options),this.template=this.options.template},_applyStyle:function(){},_onClick:function(a){a.preventDefault(),a.stopPropagation(),this.dialog.show()},createDialog:function(){var a=this.options;a.template="",a.share_url=location.href?encodeURIComponent(location.href):a.url;var b=cdb.core.Template.compile(a.template||'      <div class="mamufas">      <div class="block modal {{modal_type}}">      <a href="#close" class="close">x</a>      <div class="head">      <h3>Share this map</h3>      </div>      <div class="content">      <div class="buttons">      <h4>Social</h4>      <ul>      <li><a class="facebook" target="_blank" href="{{ facebook_url }}">Share on Facebook</a></li>      <li><a class="twitter" href="{{ twitter_url }}" target="_blank">Share on Twitter</a></li>      <li><a class="link" href="{{ public_map_url }}" target="_blank">Link to this map</a></li>      </ul>      </div><div class="embed_code">      <h4>Embed this map</h4>      <textarea id="" name="" cols="30" rows="10">{{ code }}</textarea>      </div>      </div>      </div>      </div>      ',a.templateType||"mustache"),c=location.href;c=c.replace("public_map","embed_map");var d=c.replace("embed_map","public_map"),e="<iframe width='100%' height='520' frameborder='0' src='"+c+"' allowfullscreen webkitallowfullscreen mozallowfullscreen oallowfullscreen msallowfullscreen></iframe>";this.dialog=new cdb.ui.common.ShareDialog({title:a.map.get("title"),description:a.map.get("description"),model:this.options.vis.map,code:e,url:a.url,public_map_url:d,share_url:a.share_url,template:b,target:$(".cartodb-share a"),size:$(document).width()>400?"":"small",width:$(document).width()>400?430:216}),$(".cartodb-map-wrapper").append(this.dialog.render().$el)},render:function(){return this.$el.html(this.template(_.extend(this.model.attributes))),this}}),cdb.geo.ui.SwitcherItemModel=Backbone.Model.extend({}),cdb.geo.ui.SwitcherItems=Backbone.Collection.extend({model:cdb.geo.ui.SwitcherItemModel}),cdb.geo.ui.SwitcherItem=cdb.core.View.extend({tagName:"li",events:{"click a":"select"},initialize:function(){_.bindAll(this,"render"),this.template=cdb.templates.getTemplate("templates/map/switcher/item"),this.parent=this.options.parent,this.model.on("change:selected",this.render)},select:function(a){a.preventDefault(),this.parent.toggle(this);var b=this.model.get("callback");b&&b()},render:function(){return 1==this.model.get("selected")?this.$el.addClass("selected"):this.$el.removeClass("selected"),this.$el.html(this.template(this.model.toJSON())),this.$el}}),cdb.geo.ui.Switcher=cdb.core.View.extend({id:"switcher",default_options:{},initialize:function(){this.map=this.model,this.add_related_model(this.model),_.bindAll(this,"render","show","hide","toggle"),_.defaults(this.options,this.default_options),this.collection&&(this.model.collection=this.collection),this.template=this.options.template?this.options.template:cdb.templates.getTemplate("geo/switcher")
},show:function(){this.$el.fadeIn(250)},hide:function(){this.$el.fadeOut(250)},toggle:function(){this.collection&&this.collection.each(function(a){a.set("selected",!a.get("selected"))})},render:function(){var a=this;return void 0!=this.model&&this.$el.html(this.template(this.model.toJSON())),this.collection&&this.collection.each(function(b){var c=new cdb.geo.ui.SwitcherItem({parent:a,className:b.get("className"),model:b});a.$el.find("ul").append(c.render())}),this}}),cdb.geo.ui.Text=cdb.core.View.extend({className:"cartodb-overlay overlay-text",events:{click:"stopPropagation"},default_options:{},stopPropagation:function(a){a.stopPropagation()},initialize:function(){_.defaults(this.options,this.default_options),this.template=this.options.template;var a=this;$(window).on("map_resized",function(){a._place()}),$(window).on("resize",function(){a._place()})},_applyStyle:function(){var a=this.model.get("style"),b=a["box-color"],c=a["box-opacity"],d=a["box-width"],e=a["font-family-name"];this.$text=this.$el.find(".text"),this.$text.css(a),this.$text.css("font-size",a["font-size"]+"px"),this.$el.css("z-index",a["z-index"]);var f="";"Droid Sans"==e?f="droid":"Vollkorn"==e?f="vollkorn":"Open Sans"==e?f="open_sans":"Roboto"==e&&(f="roboto");var g="rgba("+parseInt(b.slice(-6,-4),16)+","+parseInt(b.slice(-4,-2),16)+","+parseInt(b.slice(-2),16)+", "+c+" )";this.$el.removeClass("droid").removeClass("vollkorn").removeClass("roboto").removeClass("open_sans"),this.$el.addClass(f),this.$el.css({backgroundColor:g,maxWidth:d})},_place:function(a){var b=a||this.model.get("extra"),c=this.model.get("y"),d=this.model.get("x"),e=b.bottom-this.$el.height(),f=b.right-this.$el.width(),g=b.top_percentage,h=b.left_percentage,i="auto",j="auto",k=0,l=0,m=b.width,n=b.height,o=b.portrait_dominant_side,p=b.landscape_dominant_side;"bottom"===o&&250>=e?(c="auto",j=e):g>45&&55>g&&(c="50%",k=-n/2),"right"===p&&250>=f?(d="auto",i=f):h>45&&55>h&&(d="50%",l=-m/2),this.$el.css({marginLeft:l,marginTop:k,top:c,left:d,right:i,bottom:j})},show:function(a){this.$el.fadeIn(150,function(){a&&a()})},hide:function(a){this.$el.fadeOut(150,function(){a&&a()})},render:function(){this.$el.html(this.template(_.extend(this.model.attributes,{text:this.model.attributes.extra.rendered_text})));var a=this;return setTimeout(function(){a._applyStyle(),a._place(),a.show()},900),this}}),cdb.geo.ui.TilesLoader=cdb.core.View.extend({className:"cartodb-tiles-loader",default_options:{animationSpeed:500},initialize:function(){_.defaults(this.options,this.default_options),this.isVisible=0,this.template=this.options.template?this.options.template:cdb.templates.getTemplate("geo/tiles_loader")},render:function(){return this.$el.html($(this.template(this.options))),this},show:function(){this.isVisible||(!$.browser.msie||$.browser.msie&&0!=$.browser.version.indexOf("9.")?this.$el.fadeTo(this.options.animationSpeed,1):this.$el.show(),this.isVisible++)},hide:function(){this.isVisible--,this.isVisible>0||(this.isVisible=0,!$.browser.msie||$.browser.msie&&0==$.browser.version.indexOf("9.")?this.$el.stop(!0).fadeTo(this.options.animationSpeed,0):this.$el.hide())},visible:function(){return this.isVisible>0}}),cdb.geo.ui.TimeSlider=cdb.geo.ui.InfoBox.extend({DEFAULT_OFFSET_TOP:30,className:"cartodb-timeslider",defaultTemplate:" <ul>    <li class='controls'><a href='#/stop' class='button stop'>pause</a></li>   <li class='time'><p class='value'></p></li>   <li class='last'><div class='slider-wrapper'><div class='slider'></div></div></li> </ul> ",events:{"click .button":"toggleTime","click .time":"_onClickTime",dragstart:"_stopPropagation",mousedown:"_stopPropagation",touchstart:"_stopPropagation",MSPointerDown:"_stopPropagation",dblclick:"_stopPropagation",mousewheel:"_stopPropagation",DOMMouseScroll:"_stopPropagation",click:"_stopPropagation"},initialize:function(){_.bindAll(this,"_stop","_start","_slide","_bindLayer","_unbindLayer","updateSliderRange","updateSlider","updateTime");this.options.template=this.options.template||this.defaultTemplate,this.options.position="bottom|left",this.options.width=null,this.wasRunning=!1,this._bindLayer(this.options.layer),this.on("clean",this._unbindLayer),cdb.geo.ui.InfoBox.prototype.initialize.call(this)},setLayer:function(a){this._unbindLayer(),this._bindLayer(a),this._initSlider()},_bindLayer:function(a){return this.torqueLayer=a,this.torqueLayer.on("change:time",this.updateSlider),this.torqueLayer.on("change:time",this.updateTime),this.torqueLayer.on("change:steps",this.updateSliderRange),this},_unbindLayer:function(){return this.torqueLayer.off("change:time",this.updateSlider),this.torqueLayer.off("change:time",this.updateTime),this.torqueLayer.off("change:steps",this.updateSliderRange),this},updateSlider:function(a){this.$(".slider").slider({value:a.step})},updateSliderRange:function(a){this.$(".slider").slider({max:a.steps})},updateTime:function(a){var b=this,c=b.torqueLayer.getTimeBounds();if(c)if("date"===c.columnType||this.options.force_format_date){if(c&&void 0!==c.start){var d=b.options.formatter||b.formaterForRange(c.start,c.end);_.isNaN(a.time.getYear())||b.$(".value").text(d(a.time))}}else b.$(".value").text(a.step)},formatter:function(a){this.options.formatter=a},formaterForRange:function(a,b){function c(a){return 10>a?"0"+a:a}a=a.getTime?a.getTime():a,b=b.getTime?b.getTime():b;var d=(b-a)/1e3,e=86400,f=31*e*12;return e>d?function(a){return c(a.getUTCHours())+":"+c(a.getUTCMinutes())}:f>d?function(a){return c(a.getUTCMonth()+1)+"/"+c(a.getUTCDate())+"/"+c(a.getUTCFullYear())}:function(a){return c(a.getUTCMonth()+1)+"/"+c(a.getUTCFullYear())}},_slide:function(a,b){this.killEvent(a);var c=b.value;this.torqueLayer.setStep(c)},_start:function(){this.torqueLayer.isRunning()&&(this.wasRunning=!0,this.toggleTime())},_stop:function(){this.wasRunning&&this.toggleTime(),this.wasRunning=!1},_initSlider:function(){var a=(this.torqueLayer,this.$(".slider"));a.slider({range:"min",min:0,max:this.torqueLayer.options.steps,value:0,step:1,value:this.torqueLayer.getStep(),stop:this._stop,start:this._start,slide:this._slide})},toggleTime:function(a){this.killEvent(a),this.torqueLayer.toggle(),this.$(".button")[this.torqueLayer.isRunning()?"addClass":"removeClass"]("stop").attr("href","#/"+(this.torqueLayer.isRunning()?"pause":"play")).html(this.torqueLayer.isRunning()?"pause":"play")},enable:function(){},_stopPropagation:function(a){a.stopPropagation()},_onClickTime:function(){this.trigger("time_clicked",this)},render:function(){return cdb.geo.ui.InfoBox.prototype.render.apply(this,arguments),this._initSlider(),this}}),cdb.geo.ui.Tooltip=cdb.geo.ui.InfoBox.extend({defaultTemplate:"<p>{{text}}</p>",className:"cartodb-tooltip",defaults:{vertical_offset:0,horizontal_offset:0,position:"top|center"},initialize:function(){this.options.template=this.options.template||this.defaultTemplate,cdb.geo.ui.InfoBox.prototype.initialize.call(this),this._filter=null,this.showing=!1,this.showhideTimeout=null},setLayer:function(a){return this.options.layer=a,this},setFilter:function(a){return this._filter=a,this},setFields:function(a){return this.options.fields=a,this},setAlternativeNames:function(a){this.options.alternative_names=a},enable:function(){this.options.layer&&(this.options.layer.unbind(null,null,this),this.options.layer.on("mouseover",function(a,b,c,d){if(this.options.fields){var e=["fields","content"];this.options.omit_columns&&(e=e.concat(this.options.omit_columns));var f=cdb.geo.ui.InfowindowModel.contentForFields(d,this.options.fields,{empty_fields:this.options.empty_fields});d.content=_.omit(d,e),d.fields=f.fields;var g=this.options.alternative_names;if(g)for(var h=0;h<d.fields.length;++h){var i=d.fields[h];i.title=g[i.title]||i.title}}this.show(c,d),this.showing=!0},this).on("mouseout",function(){this.showing&&(this.hide(),this.showing=!1)},this),this.add_related_model(this.options.layer))},disable:function(){this.options.layer&&this.options.layer.unbind(null,null,this),this.hide(),this.showing=!1},_visibility:function(){var a=this;clearTimeout(this.showhideTimeout),this.showhideTimeout=setTimeout(a._showing?function(){a.$el.fadeIn(100)}:function(){a.$el.fadeOut(200)},50)},hide:function(){this._showing&&(this._showing=!1,this._visibility())},show:function(a,b){return this._filter&&!this._filter(b)?this:(this.render(b),this.setPosition(a),this._showing||(this._showing=!0,this._visibility()),this)},setPosition:function(a){var b={left:0,top:0},c=this.options.position,d=this.$el,e=d.innerHeight(),f=d.innerWidth();-1!==c.indexOf("top")?b.top=-e:-1!==c.indexOf("middle")&&(b.top=-(e/2)),-1!==c.indexOf("left")?b.left=-f:-1!==c.indexOf("center")&&(b.left=-(f/2)),b.top+=this.options.vertical_offset,b.left+=this.options.horizontal_offset,d.css({top:a.y+b.top,left:a.x+b.left})},render:function(a){return this.$el.html(this.template(a)),this}}),cdb.geo.ui.Zoom=cdb.core.View.extend({className:"cartodb-zoom",events:{"click .zoom_in":"zoom_in","click .zoom_out":"zoom_out"},default_options:{timeout:0,msg:""},initialize:function(){this.map=this.model,_.defaults(this.options,this.default_options),this.template=this.options.template?this.options.template:cdb.templates.getTemplate("geo/zoom"),this.map.bind("change:zoom change:minZoom change:maxZoom",this._checkZoom,this)},render:function(){return this.$el.html(this.template(this.options)),this._checkZoom(),this},_checkZoom:function(){var a=this.map.get("zoom");this.$(".zoom_in")[a<this.map.get("maxZoom")?"removeClass":"addClass"]("disabled"),this.$(".zoom_out")[a>this.map.get("minZoom")?"removeClass":"addClass"]("disabled")},zoom_in:function(a){this.map.get("maxZoom")>this.map.getZoom()&&this.map.setZoom(this.map.getZoom()+1),a.preventDefault(),a.stopPropagation()},zoom_out:function(a){this.map.get("minZoom")<this.map.getZoom()&&this.map.setZoom(this.map.getZoom()-1),a.preventDefault(),a.stopPropagation()}}),cdb.geo.ui.ZoomInfo=cdb.core.View.extend({className:"cartodb-zoom-info",initialize:function(){this.model.bind("change:zoom",this.render,this)},render:function(){return this.$el.html(this.model.get("zoom")),this}}),function(){function a(a){return"undefined"!=typeof a}function b(a){d.push("../dist/"+a)}for(var c=[[window.jQuery,"jquery.min.js"],[window._,"underscore-min.js"],[window.Backbone,"backbone.js"],[window.Mustache,"mustache.js"],[window.L,"leaflet.js"]],d=[],e=0;e<c.length;++e){var f=c[e];a(f[0])||b(f[1])}a(window.wax)||b("wax.leaf.js"),a(window.google)&&a(window.google.maps)&&!a(window.wax)&&b("wax.g.js"),b("cartodb.js"),head.js.apply(head,d)}(),cdb.ui.common.Dialog=cdb.core.View.extend({tagName:"div",className:"dialog",events:{"click .ok":"_ok","click .cancel":"_cancel","click .close":"_cancel"},default_options:{title:"title",description:"",ok_title:"Ok",cancel_title:"Cancel",width:300,height:200,clean_on_hide:!1,enter_to_confirm:!1,template_name:"common/views/dialog_base",ok_button_classes:"button green",cancel_button_classes:"",modal_type:"",modal_class:"",include_footer:!0,additionalButtons:[]},initialize:function(){_.defaults(this.options,this.default_options),_.bindAll(this,"render","_keydown"),$(document).bind("keydown",this._keydown),this.bind("clean",this._reClean),this.template_base=this.options.template_base?_.template(this.options.template_base):cdb.templates.getTemplate(this.options.template_name)},render:function(){var a=this.$el;return a.html(this.template_base(this.options)),a.find(".modal").css({width:this.options.width}),this.render_content&&this.$(".content").append(this.render_content()),this.options.modal_class&&this.$el.addClass(this.options.modal_class),this},_keydown:function(a){27===a.keyCode?this._cancel():13===a.keyCode&&this.options.enter_to_confirm&&this._ok()},appendToBody:function(){return $("body").append(this.render().el),this},_ok:function(a){a&&a.preventDefault(),this.ok&&this.ok(this.result),this.hide()},_cancel:function(a){a&&(a.preventDefault(),a.stopPropagation()),this.cancel&&this.cancel(),this.hide()},hide:function(){this.$el.hide(),this.options.clean_on_hide&&this.clean()},open:function(){this.$el.show()},_reClean:function(){$(document).unbind("keydown",this._keydown)}}),cdb.ui.common.Dropdown=cdb.core.View.extend({tagName:"div",className:"dropdown",events:{"click ul li a":"_fireClick"},default_options:{width:160,speedIn:150,speedOut:300,vertical_position:"down",horizontal_position:"right",tick:"right",vertical_offset:0,horizontal_offset:0},initialize:function(){_.bindAll(this,"open","hide","_handleClick","_keydown"),_.defaults(this.options,this.default_options),this.options.template_base?this.template_base=cdb.templates.getTemplate(this.options.template_base):this.options.template&&(this.template_base=this.options.template),$(this.options.target).bind({click:this._handleClick}),$(document).bind("keydown",this._keydown),this.isOpen=!1},render:function(){var a=this.$el;return a.html(this.template_base(this.options)).css({width:this.options.width}),this},_handleClick:function(a){a&&(a.preventDefault(),a.stopPropagation()),this.isOpen?this.hide():this.open()},_keydown:function(a){27===a.keyCode&&this.hide()},hide:function(){this.isOpen=!1,this.$el.hide()},show:function(){this.$el.css({display:"block",opacity:1}),this.isOpen=!0},open:function(a,b){var c=b&&$(b)||this.options.target;this.options.target=c;var d=c[this.options.position||"offset"](),e=c.outerWidth(),f=c.outerHeight(),g=this.$el.outerWidth(),h=this.$el.outerHeight(),i=this;this.$el.css({top:d.top+parseInt("up"==i.options.vertical_position?-h-10-i.options.vertical_offset:f+10-i.options.vertical_offset),left:d.left+parseInt("left"==i.options.horizontal_position?i.options.horizontal_offset-15:e-g+15-i.options.horizontal_offset)}).addClass(("up"==this.options.vertical_position?"vertical_top":"vertical_bottom")+" "+("right"==this.options.horizontal_position?"horizontal_right":"horizontal_left")+" tick_"+this.options.tick),this.show(),this.isOpen=!0},_fireClick:function(a){this.trigger("optionClicked",a,this.el)}}),cdb.ui.common.Notification=cdb.core.View.extend({tagName:"div",className:"dialog",events:{"click .close":"hide"},default_options:{timeout:0,msg:"",hideMethod:"",duration:"normal"},initialize:function(){this.closeTimeout=-1,_.defaults(this.options,this.default_options),this.template=this.options.template?_.template(this.options.template):cdb.templates.getTemplate("common/notification"),this.$el.hide()},render:function(){var a=this.$el;return a.html(this.template(this.options)),this.render_content&&this.$(".content").append(this.render_content()),this},hide:function(a){var b=this;a&&a.preventDefault(),clearTimeout(this.closeTimeout),""!=this.options.hideMethod&&this.$el.is(":visible")?this.$el[this.options.hideMethod](this.options.duration,"swing",function(){b.$el.html(""),b.trigger("notificationDeleted"),b.remove()}):(this.$el.hide(),b.$el.html(""),b.trigger("notificationDeleted"),b.remove())},open:function(a,b){this.render(),this.$el.show(a,b),this.options.timeout&&(this.closeTimeout=setTimeout(_.bind(this.hide,this),this.options.timeout))}}),cdb.ui.common.ShareDialog=cdb.ui.common.Dialog.extend({tagName:"div",className:"cartodb-share-dialog",events:{"click .ok":"_ok","click .cancel":"_cancel","click .close":"_cancel",click:"_stopPropagation",dblclick:"_stopPropagation",mousedown:"_stopPropagation"},default_options:{title:"",description:"",ok_title:"Ok",cancel_title:"Cancel",width:300,height:200,clean_on_hide:!1,enter_to_confirm:!1,template_name:"common/views/dialog_base",ok_button_classes:"button green",cancel_button_classes:"",modal_type:"",modal_class:"",include_footer:!0,additionalButtons:[]},initialize:function(){_.defaults(this.options,this.default_options),_.bindAll(this,"render","_keydown"),this.isOpen=!1;var a=this;this.options.target&&this.options.target.on("click",function(b){b.preventDefault(),b.stopPropagation(),a.open()}),$(document).bind("keydown",this._keydown),this.bind("clean",this._reClean)},_stopPropagation:function(a){a.stopPropagation()},_stripHTML:function(a,b){b=(((b||"")+"").toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join("");var c=/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi;return a&&"string"==typeof a?a.replace(c,function(a,c){return b.indexOf("<"+c.toLowerCase()+">")>-1?a:""}):""},open:function(){var a=this;this.$el.show(0,function(){a.isOpen=!0})},hide:function(){var a=this;this.$el.hide(0,function(){a.isOpen=!1}),this.options.clean_on_hide&&this.clean()},toggle:function(){this.isOpen?this.hide():this.open()},_truncateTitle:function(a,b){return a.substr(0,b-1)+(a.length>b?"":"")},render:function(){var a,b,c=this.$el,d=this.options.title,e=(this.options.description,this._stripHTML(this.options.description)),f=this.options.share_url;this.$el.addClass(this.options.size);var g,h=d+": "+e;g=d&&e?this._truncateTitle(d+": "+e,112)+" %23map ":d?this._truncateTitle(d,112)+" %23map":e?this._truncateTitle(e,112)+" %23map":"%23map",a=this.options.facebook_url?this.options.facebook_url:"http://www.facebook.com/sharer.php?u="+f+"&text="+h,b=this.options.twitter_url?this.options.twitter_url:"https://twitter.com/share?url="+f+"&text="+g;var i=_.extend(this.options,{facebook_url:a,twitter_url:b});return c.html(this.options.template(i)),c.find(".modal").css({width:this.options.width}),this.render_content&&this.$(".content").append(this.render_content()),this.options.modal_class&&this.$el.addClass(this.options.modal_class),this.options.disableLinks&&this.$el.find("a").attr("target",""),this}}),cdb.ui.common.Row=cdb.core.Model.extend({}),cdb.ui.common.TableData=Backbone.Collection.extend({model:cdb.ui.common.Row,fetched:!1,initialize:function(){var a=this;this.bind("reset",function(){a.fetched=!0})},getCell:function(a,b){var c=this.at(a);return c?c.get(b):null},isEmpty:function(){return 0===this.length}}),cdb.ui.common.TableProperties=cdb.core.Model.extend({columnNames:function(){return _.map(this.get("schema"),function(a){return a[0]})},columnName:function(a){return this.columnNames()[a]}}),cdb.ui.common.RowView=cdb.core.View.extend({tagName:"tr",initialize:function(){this.model.bind("change",this.render,this),this.model.bind("destroy",this.clean,this),this.model.bind("remove",this.clean,this),this.model.bind("change",this.triggerChange,this),this.model.bind("sync",this.triggerSync,this),this.model.bind("error",this.triggerError,this),this.add_related_model(this.model),this.order=this.options.order},triggerChange:function(){this.trigger("changeRow")},triggerSync:function(){this.trigger("syncRow")},triggerError:function(){this.trigger("errorRow")},valueView:function(a,b){return b},render:function(){var a,b=this,c=this.model,d="",e=0;a=this.options.row_header?'<td class="rowHeader" data-x="'+e+'">':'<td class="EmptyRowHeader" data-x="'+e+'">';var f=b.valueView("","");f.html&&(f=f[0].outerHTML),a+=f,a+="</td>",e++,d+=a;for(var g=this.order||_.keys(c.attributes),h="",i=c.attributes,j=0,k=g.length;k>j;++j){var l=g[j],m=i[l];if(void 0!==m){var a='<td id="cell_'+c.id+"_"+l+'" data-x="'+e+'">',f=b.valueView(l,m);f.html&&(f=f[0].outerHTML),a+=f,a+="</td>",e++,h+=a}}return d+=h,this.$el.html(d).attr("id","row_"+c.id),this},getCell:function(a){return this.options.row_header&&++a,this.$("td:eq("+a+")")},getTableView:function(){return this.tableView}}),cdb.ui.common.Table=cdb.core.View.extend({tagName:"table",rowView:cdb.ui.common.RowView,events:{"click td":"_cellClick","dblclick td":"_cellDblClick"},default_options:{},initialize:function(){var a=this;_.defaults(this.options,this.default_options),this.dataModel=this.options.dataModel,this.rowViews=[],this.setDataSource(this.dataModel),this.model.bind("change",this.render,this),this.model.bind("change:dataSource",this.setDataSource,this),this.bind("clean",this.clear_rows,this),this.add_related_model(this.dataModel),this.add_related_model(this.model),this.model.bind("removing:row",function(){a.rowsBeingDeleted=a.rowsBeingDeleted?a.rowsBeingDeleted+1:1,a.rowDestroying()}),this.model.bind("remove:row",function(){a.rowsBeingDeleted>0&&(a.rowsBeingDeleted--,a.rowDestroyed(),0==a.dataModel.length&&a.emptyTable())})},headerView:function(a){return a[0]},setDataSource:function(a){this.dataModel&&this.dataModel.unbind(null,null,this),this.dataModel=a,this.dataModel.bind("reset",this._renderRows,this),this.dataModel.bind("error",this._renderRows,this),this.dataModel.bind("add",this.addRow,this)},_renderHeader:function(){var a=this,b=$("<thead>"),c=$("<tr>");return c.append(this.options.row_header?$("<th>").append(a.headerView(["","header"])):$("<th>").append(a.headerView(["","header"]))),_(this.model.get("schema")).each(function(b){c.append($("<th>").append(a.headerView(b)))}),b.append(c),b},clear_rows:function(){this.$("tfoot").remove(),this.$("tr.noRows").remove();for(var a=null;a=this.rowViews.pop();)a.unbind(null,null,this),a.clean();this.rowViews=[]},addRow:function(a,b,c){var d=this,e=new d.rowView({model:a,order:this.model.columnNames(),row_header:this.options.row_header});if(e.tableView=this,e.bind("clean",function(){var a=_.indexOf(d.rowViews,e);d.rowViews.splice(a,1);for(var b=a;b<d.rowViews.length;++b)d.rowViews[b].$el.attr("data-y",b)},this),e.bind("changeRow",this.rowChanged,this),e.bind("saved",this.rowSynched,this),e.bind("errorSaving",this.rowFailed,this),e.bind("saving",this.rowSaving,this),this.retrigger("saving",e),e.render(),c&&void 0!==c.index&&c.index!=d.rowViews.length){e.$el.insertBefore(d.rowViews[c.index].$el),d.rowViews.splice(c.index,0,e);for(var f=c.index;f<d.rowViews.length;++f)d.rowViews[f].$el.attr("data-y",f)}else e.$el.attr("data-y",d.rowViews.length),d.$el.append(e.el),d.rowViews.push(e);this.trigger("createRow")},rowChanged:function(){},rowSynched:function(){},rowFailed:function(){},rowSaving:function(){},rowDestroying:function(){},rowDestroyed:function(){},emptyTable:function(){},isEmptyTable:function(){return 0===this.dataModel.length&&this.dataModel.fetched},_renderRows:function(){if(this.clear_rows(),this.isEmptyTable())this._renderEmpty();else if(this.dataModel.fetched){var a=this;this.dataModel.each(function(b){a.addRow(b)})}else this._renderLoading()},_renderLoading:function(){},_renderEmpty:function(){},addEmptyTableInfo:function(){},render:function(){var a=this;return a.$el.html(a._renderHeader()),a._renderRows(),this},getCell:function(a,b){return this.options.row_header&&++b,this.rowViews[b].getCell(a)},_cellClick:function(a,b){b=b||"cellClick",a.preventDefault();var c=$(a.currentTarget||a.target),d=parseInt(c.attr("data-x"),10),e=parseInt(c.parent().attr("data-y"),10);this.trigger(b,a,c,d,e)},_cellDblClick:function(a){this._cellClick(a,"cellDblClick")}}),cdb.ui.common.TabPane=cdb.core.View.extend({initialize:function(){this.tabs={},this.activeTab=null,this.activePane=null},addTab:function(a,b,c){if(c=c||{active:!0},void 0!==this.tabs[a])cdb.log.debug(a+"already added");else{if(this.tabs[a]=b.cid,this.addView(b),void 0!==c.after){var d=this.$el.children()[c.after];b.$el.insertAfter(d)}else c.prepend?this.$el.prepend(b.el):this.$el.append(b.el);this.trigger("tabAdded",a,b),c.active?this.active(a):b.hide()}},getPreviousPane:function(){var a=_.toArray(this.tabs),b=_.toArray(this._subviews),c=_.indexOf(a,this.activePane.cid)-1;return 0>c&&(c=b.length-1),b[c]},getNextPane:function(){var a=_.toArray(this.tabs),b=_.toArray(this._subviews),c=1+_.indexOf(a,this.activePane.cid);return c>b.length-1&&(c=0),b[c]},getPane:function(a){var b=this.tabs[a];return this._subviews[b]},getActivePane:function(){return this.activePane},size:function(){return _.size(this.tabs)},clean:function(){this.removeTabs(),cdb.core.View.prototype.clean.call(this)},removeTab:function(a){if(void 0!==this.tabs[a]){var b=this.tabs[a];this._subviews[b].clean(),delete this.tabs[a],this.activeTab==a&&(this.activeTab=null),_.size(this.tabs)&&this.active(_.keys(this.tabs)[0])}},removeTabs:function(){for(var a in this.tabs){var b=this.tabs[a];this._subviews[b].clean(),delete this.tabs[a]}this.activeTab=null},active:function(a){var b=this,c=this.tabs[a];if(void 0!==c){if(this.activeTab!==a){var d=this._subviews[c];if(this.activeTab){var e=this._subviews[this.tabs[this.activeTab]];e.hide(),b.trigger("tabDisabled",this.activeTab,e),b.trigger("tabDisabled:"+this.activeTab,e),e.deactivated&&e.deactivated()}d.show(),d.activated&&d.activated(),this.activeTab=a,this.activePane=d,b.trigger("tabEnabled",a,d),b.trigger("tabEnabled:"+a,d)}return this.activePane}},render:function(){return this},each:function(a){var b=this;_.each(this.tabs,function(c,d){a(d,b.getPane(d))})}}),function(){function a(a){for(var b in d)if(-1!==a.indexOf(b))return a.replace(b,d[b]);return a}function b(a,b){b.infowindow&&b.infowindow.fields&&(b.interactivity?-1===b.interactivity.indexOf("cartodb_id")&&(b.interactivity=b.interactivity+",cartodb_id"):b.interactivity="cartodb_id"),a.https&&(b.tiler_protocol="https",b.tiler_port=443,b.sql_api_protocol="https",b.sql_api_port=443),b.cartodb_logo=void 0==a.cartodb_logo?b.cartodb_logo:a.cartodb_logo}var c=cdb.vis.Layers,d={"https://dnv9my2eseobd.cloudfront.net/":"http://a.tiles.mapbox.com/","https://maps.nlp.nokia.com/":"http://maps.nlp.nokia.com/","https://tile.stamen.com/":"http://tile.stamen.com/","https://{s}.maps.nlp.nokia.com/":"http://{s}.maps.nlp.nokia.com/","https://cartocdn_{s}.global.ssl.fastly.net/":"http://{s}.api.cartocdn.com/"};c.register("tilejson",function(b,c){var d=c.tiles[0];return d=b.https?d:a(d),new cdb.geo.TileLayer({urlTemplate:d})}),c.register("tiled",function(b,c){var d=c.urlTemplate;return d=b.https?d:a(d),c.urlTemplate=d,new cdb.geo.TileLayer(c)}),c.register("wms",function(a,b){return new cdb.geo.WMSLayer(b)}),c.register("gmapsbase",function(a,b){return new cdb.geo.GMapsBaseLayer(b)}),c.register("plain",function(a,b){return new cdb.geo.PlainLayer(b)}),c.register("background",function(a,b){return new cdb.geo.PlainLayer(b)});var e=function(a,c){return b(a,c),c.sublayers?(c.type="layergroup",new cdb.geo.CartoDBGroupLayer(c)):new cdb.geo.CartoDBLayer(c)};c.register("cartodb",e),c.register("carto",e),c.register("layergroup",function(a,c){return b(a,c),new cdb.geo.CartoDBGroupLayer(c)}),c.register("namedmap",function(a,c){return b(a,c),new cdb.geo.CartoDBNamedMapLayer(c)}),c.register("torque",function(a,b){return a.https&&b.sql_api_domain&&-1!==b.sql_api_domain.indexOf("cartodb.com")&&(b.sql_api_protocol="https",b.sql_api_port=443,b.tiler_protocol="https",b.tiler_port=443),b.cartodb_logo=void 0==a.cartodb_logo?b.cartodb_logo:a.cartodb_logo,new cdb.geo.TorqueLayer(b)})}(),function(){cdb.vis.Overlay.register("logo",function(){}),cdb.vis.Overlay.register("mobile",function(a,b){var c=cdb.core.Template.compile(a.template||'    <div class="backdrop"></div>    <div class="cartodb-header">      <div class="content">        <a href="#" class="fullscreen"></a>        <a href="#" class="toggle"></a>        </div>      </div>    </div>    <div class="aside">    <div class="layer-container">    <div class="scrollpane"><ul class="layers"></ul></div>    </div>    </div>    <div class="cartodb-attribution"></div>    <a href="#" class="cartodb-attribution-button"></a>    <div class="torque"></div>    ',a.templateType||"mustache"),d=new cdb.geo.ui.Mobile({template:c,mapView:b.mapView,overlays:a.overlays,layerView:a.layerView,visibility_options:a.options,torqueLayer:a.torqueLayer,map:a.map});return d.render()}),cdb.vis.Overlay.register("image",function(a){var b=a.options,c=cdb.core.Template.compile(a.template||'    <div class="content">    <div class="text widget_text">{{{ content }}}</div>    </div>',a.templateType||"mustache"),d=new cdb.geo.ui.Image({model:new cdb.core.Model(b),template:c});return d.render()}),cdb.vis.Overlay.register("text",function(a){var b=a.options,c=cdb.core.Template.compile(a.template||'    <div class="content">    <div class="text widget_text">{{{ text }}}</div>    </div>',a.templateType||"mustache"),d=new cdb.geo.ui.Text({model:new cdb.core.Model(b),template:c,className:"cartodb-overlay overlay-text "+b.device});return d.render()}),cdb.vis.Overlay.register("annotation",function(a,b){var c=a.options,d=cdb.core.Template.compile(a.template||'    <div class="content">    <div class="text widget_text">{{{ text }}}</div>    <div class="stick"><div class="ball"></div></div>    </div>',a.templateType||"mustache"),c=a.options,e=new cdb.geo.ui.Annotation({className:"cartodb-overlay overlay-annotation "+c.device,template:d,mapView:b.mapView,device:c.device,text:c.extra.rendered_text,minZoom:c.style["min-zoom"],maxZoom:c.style["max-zoom"],latlng:c.extra.latlng,style:c.style});return e.render()}),cdb.vis.Overlay.register("zoom_info",function(){}),cdb.vis.Overlay.register("header",function(a){var b=a.options,c=cdb.core.Template.compile(a.template||'    <div class="content">    <div class="title">{{{ title }}}</div>    <div class="description">{{{ description }}}</div>    </div>',a.templateType||"mustache"),d=new cdb.geo.ui.Header({model:new cdb.core.Model(b),template:c});return d.render()}),cdb.vis.Overlay.register("zoom",function(a,b){if(!a.template)return void b.trigger("error","zoom template is empty");var c=new cdb.geo.ui.Zoom({model:a.map,template:cdb.core.Template.compile(a.template)});return c.render()}),cdb.vis.Overlay.register("loader",function(a){var b=new cdb.geo.ui.TilesLoader({template:cdb.core.Template.compile(a.template)});return b.render()}),cdb.vis.Overlay.register("time_slider",function(a){var b=new cdb.geo.ui.TimeSlider(a);return b.render()}),cdb.vis.Overlay.register("_header",function(a){function b(a,b){return a.substr(0,b-1)+(a.length>b?"":"")}a.share_url=location.href?encodeURIComponent(location.href):a.url;var c,d=cdb.core.Template.compile(a.template||"      {{#title}}        <h1>          {{#url}}            <a href='#' onmousedown=\"window.open('{{url}}')\">{{title}}</a>          {{/url}}          {{^url}}            {{title}}          {{/url}}        </h1>      {{/title}}      {{#description}}<p>{{{description}}}</p>{{/description}}      {{#mobile_shareable}}        <div class='social'>          <a class='facebook' target='_blank'            href='http://www.facebook.com/sharer.php?u={{share_url}}&text=Map of {{title}}: {{description}}'>F</a>          <a class='twitter' href='https://twitter.com/share?url={{share_url}}&text={{twitter_title}}'           target='_blank'>T</a>        </div>      {{/mobile_shareable}}    ",a.templateType||"mustache"),e=a.map.get("title"),f=a.map.get("description"),g=e+": "+f;c=e&&f?b(e+": "+f,112)+" %23map ":e?b(e,112)+" %23map":f?b(f,112)+" %23map":"%23map";var h="false"!=a.shareable&&a.shareable?a.shareable:null,i=h;i=i&&/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);var j=new cdb.geo.ui.Header({title:e,description:f,facebook_title:g,twitter_title:c,url:a.url,share_url:a.share_url,mobile_shareable:i,shareable:h&&!i,template:d});return j.render()}),cdb.vis.Overlay.register("infowindow",function(a,b){if(0==_.size(a.fields))return null;var c=new cdb.geo.ui.InfowindowModel({template:a.template,alternative_names:a.alternative_names,fields:a.fields,template_name:a.template_name}),d=a.templateType||"mustache",e=new cdb.geo.ui.Infowindow({model:c,mapView:b.mapView,template:new cdb.core.Template({template:a.template,type:d}).asFunction()});return e}),cdb.vis.Overlay.register("layer_selector",function(a,b){var c=a.options,d=cdb.core.Template.compile(a.template||'      <a href="#/change-visibility" class="layers">Visible layers<div class="count"></div></a>      ',a.templateType||"underscore"),e=cdb.core.Template.compile(a.template||'      <ul></ul><div class="tail"><span class="border"></span></div>      ',a.templateType||"underscore"),f=new cdb.geo.ui.LayerSelector({model:new cdb.core.Model(c),mapView:b.mapView,template:d,dropdown_template:e,layer_names:a.layer_names});return b.legends&&f.bind("change:visible",function(a,c,d){if("torque"===d.get("type")){var e=b.getOverlay("time_slider");e&&e[a?"show":"hide"]()}if("layergroup"===d.get("type")||"torque"===d.get("type")){var f=b.legends&&b.legends.getLegendByIndex(c);f&&f[a?"show":"hide"]()}}),f.render()
}),cdb.vis.Overlay.register("fullscreen",function(a,b){var c=a.options;c.allowWheelOnFullscreen=!1;var d=cdb.core.Template.compile(a.template||'<a href="#"></a>',a.templateType||"mustache"),e=new cdb.ui.common.FullScreen({doc:"#map > div",model:new cdb.core.Model(c),mapView:b.mapView,template:d});return e.render()}),cdb.vis.Overlay.register("share",function(a,b){var c=a.options,d=cdb.core.Template.compile(a.template||'<a href="#"></a>',a.templateType||"mustache"),e=new cdb.geo.ui.Share({model:new cdb.core.Model(c),vis:b,map:b.map,template:d});return e.createDialog(),e.render()}),cdb.vis.Overlay.register("search",function(a,b){var c=(a.options,cdb.core.Template.compile(a.template||'      <form>        <span class="loader"></span>        <input type="text" class="text" value="" />        <input type="submit" class="submit" value="" />      </form>    ',a.templateType||"mustache")),d=new cdb.geo.ui.Search({template:c,model:b.map});return d.render()}),cdb.vis.Overlay.register("tooltip",function(a,b){var c;if(!a.layer){var d=b.getLayers();d.length>1&&(c=d[1]),a.layer=c}if(!a.layer)throw new Error("layer is null");a.layer.setInteraction(!0);var e=new cdb.geo.ui.Tooltip(a);return e}),cdb.vis.Overlay.register("infobox",function(a,b){var c,d=b.getLayers();if(a.layer||(d.length>1&&(c=d[1]),a.layer=c),!a.layer)throw new Error("layer is null");a.layer.setInteraction(!0);var e=new cdb.geo.ui.InfoBox(a);return e})}(),function(){var a={_types:{},register:function(b,c){a._types[b]=c},create:function(b,c,d){var e=a._types[b];if(!e)return void cdb.log.error("Overlay: "+b+" does not exist");d.options="string"==typeof d.options?JSON.parse(d.options):d.options,d.options=d.options||{};var f=e(d,c);return f?(f.type=b,f):!1}};cdb.vis.Overlay=a;var b={_types:{},register:function(a,b){this._types[a]=b},create:function(a,b,c){if(!a)return cdb.log.error("creating a layer without type"),null;var d=this._types[a.toLowerCase()],e={};return e.type=a,_.extend(e,c,c.options),new d(b,e)},moduleForLayer:function(a){return"torque"===a.toLowerCase()?"torque":null},modulesForLayers:function(a){var c=_(a).map(function(a){return b.moduleForLayer(a.type||a.kind)});return _.compact(_.uniq(c))}};cdb.vis.Layers=b;var c=cdb.vis.Loader={queue:[],current:void 0,_script:null,head:null,loadScript:function(a){var b=document.createElement("script");return b.type="text/javascript",b.src=a,b.async=!0,c.head||(c.head=document.getElementsByTagName("head")[0]),setTimeout(function(){c.head.appendChild(b)},0),b},get:function(a,b){c._script?c.queue.push([a,b]):(c.current=b,c._script=c.loadScript(a+(~a.indexOf("?")?"&":"?")+"callback=vizjson"))},getPath:function(a){var b=document.getElementsByTagName("script"),c=/\/?cartodb[\-\._]?([\w\-\._]*)\.js\??/;for(i=0,len=b.length;len>i;i++)if(src=b[i].src,matches=src.match(c)){var d=src.split("/");return delete d[d.length-1],d.join("/")+a}return null},loadModule:function(a){var b="cartodb.mod."+a+(cartodb.DEBUG?".uncompressed.js":".js"),d=this.getPath(b);d||cartodb.log.error("can't find cartodb.js file"),c.loadScript(d)}};window.vizjson=function(a){c.current&&c.current(a),c.head.removeChild(c._script),c._script=null;var b=c.queue.shift();b&&c.get(b[0],b[1])},cartodb.moduleLoad=function(a,b){cartodb[a]=b,cartodb.config.modules.add({name:b})};var d=cdb.core.View.extend({initialize:function(){_.bindAll(this,"loadingTiles","loadTiles","_onResize"),this.https=!1,this.overlays=[],this.moduleChecked=!1,this.layersLoading=0,this.options.mapView&&(this.mapView=this.options.mapView,this.map=this.mapView.map),window.addEventListener?window.addEventListener("orientationchange",_.bind(this.doOnOrientationChange,this)):window.attachEvent("orientationchange",this.doOnOrientationChange,this)},doOnOrientationChange:function(){},checkModules:function(a){var c=b.modulesForLayers(a);return _.every(_.map(c,function(a){return void 0!==cartodb[a]}))},loadModules:function(a,d){function e(){f.checkModules(a)&&(cdb.config.unbind("moduleLoaded",e),d())}for(var f=this,g=b.modulesForLayers(a),h=0;h<g.length;++h)c.loadModule(g[h]);cdb.config.bind("moduleLoaded",e),_.defer(e)},_addLayers:function(a,b){for(var c=0;c<a.length;++c){var d=a[c];this.loadLayer(d,b)}},addLegends:function(a,b){this.legends=new cdb.geo.ui.StackedLegend({legends:this.createLegendView(a)}),b||this.mapView.addOverlay(this.legends)},_setLayerOptions:function(a){var b=[],b=_.map(this.getLayers().slice(1),function(a){return a.getSubLayers?a.getSubLayers():a});for(b=_.flatten(b),i=0;i<Math.min(a.sublayer_options.length,b.length);++i){var c=a.sublayer_options[i],d=b[i],e=this.legends&&this.legends.getLegendByIndex(i);if(e&&e[c.visible?"show":"hide"](),d.model&&"torque"===d.model.get("type")){if(c.visible===!1){d.model.set("visible",!1);var f=this.getOverlay("time_slider");f&&f.hide()}}else c.visible===!1&&d.hide()}},_addOverlays:function(a,b){a=_.sortBy(a,function(a){return null==a.order?1e3:a.order}),this._createOverlays(a,b)},addTimeSlider:function(a){a&&this.addOverlay({type:"time_slider",layer:a})},_setupSublayers:function(a,b){b.sublayer_options=[],_.each(a.slice(1),function(a){"layergroup"===a.type?_.each(a.options.layer_definition.layers,function(a){b.sublayer_options.push({visible:void 0!==a.visible?a.visible:!0})}):"namedmap"===a.type?_.each(a.options.named_map.layers,function(a){b.sublayer_options.push({visible:void 0!==a.visible?a.visible:!0})}):"torque"===a.type&&b.sublayer_options.push({visible:void 0!==a.options.visible?a.options.visible:!0})})},load:function(a,b){var c=this;if("string"==typeof a){var d=a;return cdb.vis.Loader.get(d,function(a){a?c.load(a,b):c.throwError("error fetching viz.json file")}),this}if(!this.checkModules(a.layers))return this.moduleChecked?(c.throwError("modules couldn't be loaded"),this):(this.moduleChecked=!0,this.loadModules(a.layers,function(){c.load(a,b)}),this);window&&window.location.protocol&&"https:"===window.location.protocol&&(this.https=!0),a.https&&(this.https=a.https),b=b||{},this._applyOptions(a,b);var e=!!_.find(a.overlays,function(a){return"logo"===a.type&&a.options.display});this.cartodb_logo=void 0!==b.cartodb_logo?b.cartodb_logo:e,this.mobile?this.cartodb_logo=!1:e||void 0!==b.cartodb_logo||(this.cartodb_logo=!0);var f=void 0===b.scrollwheel?a.scrollwheel:b.scrollwheel;if(a.maxZoom||(a.maxZoom=20),a.minZoom||(a.minZoom=0),this.gmaps_base_type&&"leaflet"===a.map_provider){var g=["roadmap","gray_roadmap","dark_roadmap","hybrid","satellite","terrain"];_.contains(g,this.gmaps_base_type)?a.layers?(a.layers[0].options.type="GMapsBase",a.layers[0].options.base_type=this.gmaps_base_type,a.layers[0].options.name=this.gmaps_base_type,this.gmaps_style&&(a.layers[0].options.style="string"==typeof this.gmaps_style?JSON.parse(this.gmaps_style):this.gmaps_style),a.map_provider="googlemaps",a.layers[0].options.attribution=""):cdb.log.error("No base map loaded. Using Leaflet."):cdb.log.error('GMaps base_type "'+this.gmaps_base_type+" is not supported. Using leaflet.")}var h={title:a.title,description:a.description,maxZoom:a.maxZoom,minZoom:a.minZoom,legends:a.legends,scrollwheel:f,provider:a.map_provider};if(a.bounding_box_sw&&a.bounding_box_ne&&(h.bounding_box_sw=a.bounding_box_sw,h.bounding_box_ne=a.bounding_box_ne),a.bounds)h.view_bounds_sw=a.bounds[0],h.view_bounds_ne=a.bounds[1];else{var i=a.center;"string"==typeof i&&(i=$.parseJSON(i)),h.center=i||[0,0],h.zoom=void 0==a.zoom?4:a.zoom}var j=new cdb.geo.Map(h);this.map=j,this.updated_at=a.updated_at||(new Date).getTime();var k=this.$el.outerHeight();0===k&&(this.mapConfig=h,$(window).bind("resize",this._onResize));var l=$("<div>").css({position:"relative",width:"100%",height:"100%"});this.container=l;var m=$("<div>").addClass("cartodb-map-wrapper").css({position:"absolute",top:0,left:0,right:0,bottom:0,width:"100%"});l.append(m),this.$el.append(l);var n=new cdb.geo.MapView.create(m,j);if(this.mapView=n,this._addLayers(a.layers,b),(b.legends||void 0===b.legends&&this.map.get("legends")!==!1)&&this.addLegends(a.layers,this.mobile_enabled),b.time_slider){var o=_(this.getLayers()).filter(function(a){return"torque"===a.model.get("type")});o&&o.length&&(this.torqueLayer=o[0],!this.mobile_enabled&&this.torqueLayer&&this.addTimeSlider(this.torqueLayer))}return b.sublayer_options||this._setupSublayers(a.layers,b),b.sublayer_options&&this._setLayerOptions(b),this.mobile_enabled&&(void 0===b.legends&&(b.legends=this.legends?!0:!1),this.addMobile(a.overlays,a.layers,b)),this._addOverlays(a.overlays,b),_.defer(function(){c.trigger("done",c,c.getLayers())}),this},_addFullScreen:function(){this.addOverlay({options:{allowWheelOnFullscreen:!0},type:"fullscreen"})},_createOverlays:function(a,b){_.each(a,function(a){var c=a.type;if(!(this.mobile_enabled&&"zoom"===c||this.mobile_enabled&&"header"===c||"fullscreen"===c&&$.browser.msie&&parseFloat($.browser.version)<=10)){if("image"===c||"text"===c||"annotation"===c){var d="mobile"==a.options.device?!0:!1;if(this.mobile!==d)return;if(!b[c]&&void 0!==b[c])return}var e=this.addOverlay(a);e&&c in b&&b[c]===!1&&e.hide();var f=a.options;if(("share"==c&&b.shareable||"share"==c&&e.model.get("display")&&void 0==b.shareable)&&e.show(),("layer_selector"==c&&b[c]||"layer_selector"==c&&e.model.get("display")&&void 0==b[c])&&e.show(),("fullscreen"==c&&b[c]||"fullscreen"==c&&e.model.get("display")&&void 0==b[c])&&e.show(),!this.mobile_enabled&&("search"==c&&b[c]||"search"==c&&f.display&&void 0==b[c])&&e.show(),!this.mobile_enabled&&"header"===c){var g=e.model;void 0!==b.title&&g.set("show_title",b.title),void 0!==b.description&&g.set("show_description",b.description),(g.get("show_title")||g.get("show_description"))&&$(".cartodb-map-wrapper").addClass("with_header"),e.render()}}},this)},addMobile:function(a,b,c){var d,e=b[1];e.options&&e.options.layer_definition?d=e.options.layer_definition.layers:e.options&&e.options.named_map&&e.options.named_map.layers&&(d=e.options.named_map.layers),this.addOverlay({type:"mobile",layers:d,overlays:a,options:c,torqueLayer:this.torqueLayer})},createLegendView:function(a){for(var b=[],c=a.length-1;c>=0;--c){var d=a[c];if(d.legend){d.legend.data=d.legend.items;var e=d.legend;(e.items&&e.items.length||e.template)&&(d.legend.index=c,b.push(new cdb.geo.ui.Legend(d.legend)))}d.options&&d.options.layer_definition?b=b.concat(this.createLegendView(d.options.layer_definition.layers)):d.options&&d.options.named_map&&d.options.named_map.layers&&(b=b.concat(this.createLegendView(d.options.named_map.layers)))}return b},addOverlay:function(b){b.map=this.map;var c=a.create(b.type,this,b);return c&&("loader"==b.type&&(this.loader=c),this.mapView.addOverlay(c),this.overlays.push(c),c.bind("clean",function(){for(var a in this.overlays){var b=this.overlays[a];if(c.cid===b.cid)return void this.overlays.splice(a,1)}},this),"header"==b.type),c},_applyOptions:function(a,b){function c(b){if(!a.overlays)return null;for(var c=0;c<a.overlays.length;++c)if(a.overlays[c].type===b)return a.overlays[c]}function d(b){if(a.overlays)for(var c=0;c<a.overlays.length;++c)if(a.overlays[c].type===b)return void a.overlays.splice(c,1)}b=b||{},b=_.defaults(b,{tiles_loader:!0,loaderControl:!0,infowindow:!0,tooltip:!0,time_slider:!0}),a.overlays=a.overlays||[],a.layers=a.layers||[],this.infowindow=b.infowindow,this.tooltip=b.tooltip,b.https&&(this.https=!0),b.gmaps_base_type&&(this.gmaps_base_type=b.gmaps_base_type),b.gmaps_style&&(this.gmaps_style=b.gmaps_style),this.mobile=/Android|webOS|iPhone|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),this.mobile_enabled=b.mobile_layout&&this.mobile||b.force_mobile,(b.force_mobile===!1||"false"===b.force_mobile)&&(this.mobile_enabled=!1),b.title||(a.title=null),b.description||(a.description=null),b.tiles_loader||d("loader"),b.loaderControl||d("loader"),!this.mobile_enabled&&b.search&&(c("search")||a.overlays.push({type:"search",order:3})),(b.title&&a.title||b.description&&a.description)&&(c("header")||a.overlays.unshift({type:"header",order:1,shareable:b.shareable?!0:!1,url:a.url,options:{extra:{title:a.title,description:a.description,show_title:b.title,show_description:b.description}}})),b.layer_selector&&(c("layer_selector")||a.overlays.push({type:"layer_selector"})),b.shareable&&!this.mobile_enabled&&(c("share")||a.overlays.push({type:"share",order:2,url:a.url})),this.mobile_enabled&&(d("logo"),d("share")),this.mobile&&d("zoom");var e=parseInt(b.zoom);isNaN(e)||(a.zoom=e,a.bounds=null);var f=parseFloat(b.center_lat),g=parseFloat(b.center_lon);isNaN(f)||isNaN(g)||(a.center=[f,g],a.bounds=null),void 0!==b.center&&(a.center=b.center,a.bounds=null);var h=parseFloat(b.sw_lat),i=parseFloat(b.sw_lon),j=parseFloat(b.ne_lat),k=parseFloat(b.ne_lon);if(isNaN(h)||isNaN(i)||isNaN(j)||isNaN(k)||(a.bounds=[[h,i],[j,k]]),a.layers.length>1)for(var l=b.auth_token,m=1;m<a.layers.length;++m){var n=a.layers[m].options;n.no_cdn=b.no_cdn,n.force_cors=b.force_cors,l&&(n.auth_token=l)}},setMapPosition:function(){},createLayer:function(a){var c=b.create(a.type||a.kind,this,a);return this.mapView.createLayer(c)},_getSqlApi:function(a){a=a||{};var b=a.sql_api_port,c=a.sql_api_domain+(b?":"+b:""),d=a.sql_api_protocol,e="v1";-1!==c.indexOf("cartodb.com")&&(d="http",c="cartodb.com",e="v2");var f=new cartodb.SQL({user:a.user_name,protocol:d,host:c,version:e});return f},addTooltip:function(a){if(a&&a.containTooltip&&a.containTooltip()){for(var b=0;b<a.getLayerCount();++b){var c=a.getTooltipData(b);if(c){if(!a.tooltip){var d=new cdb.geo.ui.Tooltip({layer:a,template:c.template,position:"bottom|right",vertical_offset:10,horizontal_offset:4,fields:c.fields,omit_columns:["cartodb_id"]});a.tooltip=d,this.mapView.addOverlay(d)}a.setInteraction(b,!0)}}a.tooltip&&a.bind("featureOver",function(b,c,d,e,f){var g=a.getTooltipData(f);g?(a.tooltip.setTemplate(g.template),a.tooltip.setFields(g.fields),a.tooltip.setAlternativeNames(g.alternative_names),a.tooltip.enable()):a.tooltip.disable()})}},addInfowindow:function(b){if(b.containInfowindow&&b.containInfowindow()){for(var c=this.mapView,d="featureClick",e=null,f=0;f<b.getLayerCount();++f)if(b.getInfowindowData(f)){e||(e=a.create("infowindow",this,b.getInfowindowData(f),!0),c.addInfowindow(e));var g=b.getLayerNumberByIndex(f);b.setInteraction(g,!0)}if(e){e.bind("close",function(){for(var a=0;a<b.getLayerCount();++a){var c=b.tooltip;c&&c.setFilter(null)}}),b.bind(d,function(a,c,d,f,g){var h=b.getInfowindowData(g);if(h){var i=_.pluck(h.fields,"name"),j=f.cartodb_id;b.fetchAttributes(g,j,i,function(a){var b=_.defaults({offset:h.offset,width:h.width,maxHeight:h.maxHeight},cdb.geo.ui.InfowindowModel.prototype.defaults);e.model.set({fields:h.fields,template:h.template,template_type:h.template_type,alternative_names:h.alternative_names,offset:b.offset,width:b.width,maxHeight:b.maxHeight}),a?(e.model.updateContent(a),e.adjustPan()):e.setError()}),e.setLatLng(c).setLoading().showInfowindow(),b.tooltip&&b.tooltip.setFilter(function(a){return a.cartodb_id!==j}).hide()}});b.bind("mouseover",function(){c.setCursor("pointer")}),b.bind("mouseout",function(){c.setCursor("auto")}),b.infowindow=e.model}}},loadLayer:function(a,c){var d=this.map,e=this.mapView,f=d.addLayer(b.create(a.type||a.kind,this,a),c),g=e.getLayerByCid(f);if(!g)return void this.throwError("layer can't be created",d.layers.getByCid(f));if(g&&this.infowindow&&g.containInfowindow&&g.containInfowindow()&&this.addInfowindow(g),g&&this.tooltip&&g.containTooltip&&g.containTooltip()&&this.addTooltip(g),g){var h=this,i=function(){h.loadingTiles(c)},j=function(){h.loadTiles(c)};g.bind("loading",i),g.bind("load",j)}return g},loadingTiles:function(){this.loader&&this.loader.show(),0===this.layersLoading&&this.trigger("loading"),this.layersLoading++},loadTiles:function(){this.loader&&this.loader.hide(),this.layersLoading--,this.layersLoading<=0&&(this.layersLoading=0,this.trigger("load"))},throwError:function(a,b){cdb.log.error(a);var c=this;_.defer(function(){c.trigger("error",a,b)})},error:function(a){return this.bind("error",a)},done:function(a){return this.bind("done",a)},getNativeMap:function(){return this.mapView.getNativeMap()},getLayers:function(){var a=this;return _.compact(this.map.layers.map(function(b){return a.mapView.getLayerByCid(b.cid)}))},getOverlays:function(){return this.overlays},getOverlay:function(a){return _(this.overlays).find(function(b){return b.type==a})},getOverlaysByType:function(a){return _(this.overlays).filter(function(b){return b.type==a})},_onResize:function(){$(window).unbind("resize",this._onResize);var a=this;a.mapView.invalidateSize(),setTimeout(function(){var b=a.mapConfig;b.view_bounds_sw?a.mapView.map.setBounds([b.view_bounds_sw,b.view_bounds_ne]):a.mapView.map.set({center:b.center,zoom:b.zoom})},150)}},{addInfowindow:function(a,b,c,d){var e=_.defaults(d||{},{infowindowTemplate:cdb.vis.INFOWINDOW_TEMPLATE.light,templateType:"mustache",triggerEvent:"featureClick",templateName:"light",extraFields:[],cursorInteraction:!0});if(!a)throw new Error("map is not valid");if(!b)throw new Error("layer is not valid");if(!c&&void 0===c.length)throw new Error("fields should be a list of strings");var f=[];c=c.concat(e.extraFields);for(var g=0;g<c.length;++g)f.push({name:c,order:g});var h=new cdb.geo.ui.InfowindowModel({fields:f,template_name:e.templateName}),i=new cdb.geo.ui.Infowindow({model:h,mapView:a.viz.mapView,template:new cdb.core.Template({template:e.infowindowTemplate,type:e.templateType}).asFunction()});a.viz.mapView.addInfowindow(i);try{b.setInteractivity(c)}catch(j){}return b.setInteraction(!0),b.bind(e.triggerEvent,function(a,b,d,e){for(var f,g=[],h=0;h<c.length;++h){var j=c[h];(f=e[j])&&g.push({title:j,value:f,index:0})}i.model.set({content:{fields:g,data:e}}),i.setLatLng(b).showInfowindow(),i.adjustPan()},i),i.bind("clean",function(){b.unbind(e.triggerEvent,null,i)}),e.cursorInteraction&&cdb.vis.Vis.addCursorInteraction(a,b),i},addCursorInteraction:function(a,b){var c=a.viz.mapView;b.bind("mouseover",function(){c.setCursor("pointer")}),b.bind("mouseout",function(){c.setCursor("auto")})},removeCursorInteraction:function(a,b){var c=a.viz.mapView;b.unbind(null,null,c)}});cdb.vis.INFOWINDOW_TEMPLATE={light:['<div class="cartodb-popup">','<a href="#close" class="cartodb-popup-close-button close">x</a>','<div class="cartodb-popup-content-wrapper">','<div class="cartodb-popup-content">',"{{#content.fields}}","{{#title}}<h4>{{title}}</h4>{{/title}}","{{#value}}",'<p {{#type}}class="{{ type }}"{{/type}}>{{{ value }}}</p>',"{{/value}}","{{^value}}",'<p class="empty">null</p>',"{{/value}}","{{/content.fields}}","</div>","</div>",'<div class="cartodb-popup-tip-container"></div>',"</div>"].join("")},cdb.vis.Vis=d}(),cdb.$=$,cdb.L=L,cdb.Mustache=Mustache,cdb.Backbone=Backbone,cdb._=_}();for(var i in __prev)__prev[i]&&(window[i]=__prev[i])}();